X-Received: by 10.31.146.6 with SMTP id u6mr119226vkd.46.1501794664942;
        Thu, 03 Aug 2017 14:11:04 -0700 (PDT)
X-BeenThere: singularity@lbl.gov
Received: by 10.36.23.207 with SMTP id 198ls460438ith.18.gmail; Thu, 03 Aug
 2017 14:11:04 -0700 (PDT)
X-Received: by 10.99.43.67 with SMTP id r64mr132113pgr.320.1501794663944;
        Thu, 03 Aug 2017 14:11:03 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1501794663; cv=none;
        d=google.com; s=arc-20160816;
        b=bT4/uTNyiBgg05mh6EoUcckrxywuBSEduoCpw0/zbBRnyGSvewPBYgUbmKO8/8j8C0
         gdRi5Z1eJdabLZV0f9RostA1HANSUDATUN8F6z/Hp6YLdtHdL71QYmY2B5d0rrq8FHyB
         vYbi+9Hp38QNl7hLFhlcYGqr9ILtkfTfjMjEe8azOhbU5dctLBG1QXsCz2Dvppf83i5d
         Hg3nZqgWifAJxK3qHEPZ6U38bnrO683NS68jg+i/aRh6lRN6bZuEayvEBC3+OwnJcRjQ
         2u/UtYp65ZEwCN7euY+4ZSql70VA/MU1KC5tJLHdg5jYz5PMy2HMDhNFtQqyZ4nrAlj6
         9CcA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=to:subject:message-id:date:from:references:in-reply-to:mime-version
         :dkim-signature:arc-authentication-results;
        bh=rawV/nXwKx5RVcDJhoxXziaoB94pRRi304i4o0BeCjk=;
        b=jXEOn7BlYcPEWo08SvG8OW7AfZhwi6cHjGLKSS+hFwLg1XOHsow2jrhFRn4oA+K/5n
         7THIWPFU8C3zYMLKYjF82H/N6UDJxhZk+t8nw8PqmAjG0jEanXGWjv0+mEBU4R2PJbNd
         OuZ5zJFfJf/UG9uAfxOWEAgqybbtoV5yJ5cMi61Md5IGb1zd+B1ZYSxM0VAW1XusuuiW
         fejV0k4tP/qrs/uCticAPMKNA/GhkP9c+zIdTe7IH66MIr0kWylWmu6q49XMF0nKMHic
         v5BZEGItMGf6rf3sI4BKwcKorZs4ySlMIPaTgG04MyhRcwi0h5SYIIWBbCTduJlbD4/K
         /ddw==
ARC-Authentication-Results: i=1; mx.google.com;
       dkim=pass head...@gmail.com header.b=dbWjuyDF;
       spf=pass (google.com: domain of vso...@gmail.com designates 209.85.217.182 as permitted sender) smtp.mailfrom=vso...@gmail.com
Return-Path: <vso...@gmail.com>
Received: from fe3.lbl.gov (fe3.lbl.gov. [128.3.41.68])
        by mx.google.com with ESMTP id e188si21716138pfg.307.2017.08.03.14.11.03
        for <singu...@lbl.gov>;
        Thu, 03 Aug 2017 14:11:03 -0700 (PDT)
Received-SPF: pass (google.com: domain of vso...@gmail.com designates 209.85.217.182 as permitted sender) client-ip=209.85.217.182;
Authentication-Results: mx.google.com;
       dkim=pass head...@gmail.com header.b=dbWjuyDF;
       spf=pass (google.com: domain of vso...@gmail.com designates 209.85.217.182 as permitted sender) smtp.mailfrom=vso...@gmail.com
X-Ironport-SBRS: 3.4
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A2G3AgA8kINZhrbZVdFaAxwBAQQBAQoBA?=
 =?us-ascii?q?RcBAQQBAQoBAYJEQIEPbScHg2eBPphrgW6WFQ6BQUADIQEOhRcChDcHQRYBAQE?=
 =?us-ascii?q?BAQEBAQEBAQIQAQEBCAsLCCgvgjMFAgMaBgQERikvAQEBAQEBAQEBAQEBAQEBG?=
 =?us-ascii?q?gINHj8BAQEBAgEaCR0BDQ4eAwELBgMCCw0gAQkCAiEBAQ4DAQUBCxEOBwQBHAS?=
 =?us-ascii?q?IPIE5AQMNCAULj3ORGz+MCoIEBQEcgwkFg1wKGScNVoMrAQEBAQYBAQEBAQEBA?=
 =?us-ascii?q?QEXAgEFEoMWggKDL4MnglcpgUABEgFADBqCTIJhBYpgjQuHVjyHU4dphHGCD4V?=
 =?us-ascii?q?YimGMKIUagncUH4EVJgJ8Mwt3FWOEbg8QDIIDJDYFA4cNR4FrAQEB?=
X-IronPort-AV: E=Sophos;i="5.41,317,1498546800"; 
   d="scan'208,217";a="84320054"
Received: from mail-ua0-f182.google.com ([209.85.217.182])
  by fe3.lbl.gov with ESMTP; 03 Aug 2017 14:11:01 -0700
Received: by mail-ua0-f182.google.com with SMTP id q25so11633335uah.1
        for <singu...@lbl.gov>; Thu, 03 Aug 2017 14:11:01 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to;
        bh=rawV/nXwKx5RVcDJhoxXziaoB94pRRi304i4o0BeCjk=;
        b=dbWjuyDFiMsl9yNlN5rpdBRnNAHGp9//uOr6uIEuTffC9PmQnzD/JR+H3LhwqVDTyi
         onzZsRa/s2IGO71us8TLmIQrRYEFUbYZ83SIfujapJHpjm9qpxf5i1XTkuLOqWQbMAyg
         l/p9YB9gJ91G25ZybvDlGt7iO8l7naeNVT+8gUvklCSDpHrBF50XnGduEbhBxpd3mmRS
         iQAXwqtlrqdOddl1XPk+m78DRhYBHPdaW6lYJdl0eJX8MndJFcHQD5EVzT8OjbVF2HhM
         d1lLPfAQ99qWQQ3z/aiKDeJqfnyiBa09F8pru8Bc2dFjrsJJFHZEmGI1DznHJZxcjpw0
         BD+Q==
X-Gm-Message-State: AHYfb5idrPReh1AA+pjdtkSchK5GdwMR+HCEHNaNMnZqQB/NvO/WC6/O
	8ZmE8D3IvnqmT5MH/p6AlmQbAKgtYrha+TU=
X-Received: by 10.159.55.49 with SMTP id z46mr87238uad.131.1501794660170; Thu,
 03 Aug 2017 14:11:00 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.103.69.84 with HTTP; Thu, 3 Aug 2017 14:10:39 -0700 (PDT)
In-Reply-To: <e8470d35-8671-4736-91d8-9b68ba47e24c@lbl.gov>
References: <9d25d29a-08d9-4bc4-bbcf-3327a841b3da@lbl.gov> <e847efae-1f98-4eb2-b2b5-1bf80c0a3476@lbl.gov>
 <CAM=pu+K1A92qd8JBPT9NhHrP_Pv-OPf-cnkNVCfqxeMKbH4MRg@mail.gmail.com> <e8470d35-8671-4736-91d8-9b68ba47e24c@lbl.gov>
From: vanessa s <vso...@gmail.com>
Date: Thu, 3 Aug 2017 17:10:39 -0400
Message-ID: <CAM=pu+Lc-9f8+7vjkPLy-Fd3OYM_XSEtoTYrusgGkU-=P58VYg@mail.gmail.com>
Subject: Re: [Singularity] Re: can't run singularity exec as a regular user
To: singularity@lbl.gov
Content-Type: multipart/alternative; boundary="001a1145c59e3ec3c80555dfd143"

--001a1145c59e3ec3c80555dfd143
Content-Type: text/plain; charset="UTF-8"

I think the line where it's hitting a bug is here:

https://github.com/singularityware/singularity/blob/adf5259ac94d7b213c649f073dcda32459b0c8b7/src/util/suid.c#L80

Specifically somewhere after this command:

>
> ( singularity_registry_get("NOSUID") != NULL )



When I run a similar command, I see the following:

VERBOSE [U=0,P=29387]      singularity_suid_init()
> Running SUID program workflow
> VERBOSE [U=0,P=29387]      singularity_suid_init()
> Checking program has appropriate permissions
> VERBOSE [U=0,P=29387]      singularity_suid_init()
> Checking configuration file is properly owned by root
> VERBOSE [U=0,P=29387]      singularity_suid_init()
> Checking if singularity.conf allows us to run as suid
> DEBUG   [U=0,P=29387]      singularity_config_get_bool_char_impl()
> Called singularity_config_get_bool(allow setuid, yes)
> DEBUG   [U=0,P=29387]      singularity_config_get_value_impl()
> Returning configuration value allow setuid='yes'
> DEBUG   [U=0,P=29387]      singularity_config_get_bool_char_impl()
> Return singularity_config_get_bool(allow setuid, yes) = 1
> DEBUG   [U=0,P=29387]      singularity_registry_get()
>  Returning NULL on 'NOSUID'
> VERBOSE [U=0,P=29387]      singularity_priv_userns()
> Invoking the user namespace


and I return NULL too, but it doesn't error out. So you don't get to the
last line to invoke the user namespace... I'm not completely sure about the
issue, but given centos 6, I bet you it has to do with the OS / version.
Do others have thoughts? Could you try a completely new install with no
changes to the config, and do a simple shell for some docker:// uri so I
can recreate your use case exactly?



On Thu, Aug 3, 2017 at 4:45 PM, toufique <tech...@gmail.com> wrote:

> Hi Vanessa,
>
> command:
>
> singularity --debug create --size 30000 /tmp/debian_jessie_tvb_1.img .
> (not that this time i tried creating the container in /tmp .  So, no
> involvment of NFS here for the container)
>
>
> Here is the debug output:
>
> Enabling debugging
> Ending argument loop
> Singularity version: 2.3.1-dist
> Exec'ing: /data/apps/singularity/2.3.1/libexec/singularity/cli/create.exec
> VERBOSE [U=2527,P=48257]   message_init()                            Set
> messagelevel to: 5
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Initialize configuration file: /data/apps/singularity/2.3.1/
> etc/singularity/singularity.conf
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_parse()
>  Starting parse of configuration file /data/apps/singularity/2.3.1/
> etc/singularity/singularity.conf
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key allow setuid = 'yes'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key max loop devices = '256'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key allow pid ns = 'yes'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key config passwd = 'yes'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key config group = 'yes'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key config resolv_conf = 'yes'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key mount proc = 'yes'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key mount sys = 'yes'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key mount dev = 'yes'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key mount home = 'yes'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key mount tmp = 'yes'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key mount hostfs = 'no'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key bind path = '/etc/localtime'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key bind path = '/etc/hosts'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key bind path = '/dfs1'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key bind path = '/dfs2'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key bind path = '/data'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key user bind control = 'yes'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key enable overlay = 'yes'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key mount slave = 'yes'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>  Got config key sessiondir max size = '16'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_parse()
>  Finished parsing configuration file '/data/apps/singularity/2.3.1/
> etc/singularity/singularity.conf'
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_init()
> Initializing Singularity Registry
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>  Adding value to registry: 'WRITABLE' = '1'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>  Returning singularity_registry_set(WRITABLE, 1) = 0
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>  Adding value to registry: 'LIBEXECDIR' = '/data/apps/singularity/2.3.1/
> libexec'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>  Returning singularity_registry_set(libexecdir,
> /data/apps/singularity/2.3.1/libexec) = 0
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>  Adding value to registry: 'COMMAND' = 'create'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>  Returning singularity_registry_set(COMMAND, create) = 0
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>  Adding value to registry: 'IMAGESIZE' = '30000'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>  Returning singularity_registry_set(IMAGESIZE, 30000) = 0
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>  Adding value to registry: 'MESSAGELEVEL' = '5'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>  Returning singularity_registry_set(MESSAGELEVEL, 5) = 0
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>  Adding value to registry: 'VERSION' = '2.3.1-dist'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>  Returning singularity_registry_set(version, 2.3.1-dist) = 0
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>  Adding value to registry: 'LOCALSTATEDIR' = '/data/apps/singularity/2.3.1/
> var'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>  Returning singularity_registry_set(localstatedir,
> /data/apps/singularity/2.3.1/var) = 0
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>  Adding value to registry: 'SYSCONFDIR' = '/data/apps/singularity/2.3.1/
> etc'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>  Returning singularity_registry_set(sysconfdir,
> /data/apps/singularity/2.3.1/etc) = 0
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>  Adding value to registry: 'BINDIR' = '/data/apps/singularity/2.3.1/bin'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>  Returning singularity_registry_set(bindir, /data/apps/singularity/2.3.1/bin)
> = 0
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>  Adding value to registry: 'IMAGE' = '/tmp/debian_jessie_tvb_1.img'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>  Returning singularity_registry_set(IMAGE, /tmp/debian_jessie_tvb_1.img)
> = 0
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()
>  Returning NULL on 'HOME'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()
>  Returning NULL on 'TARGET_UID'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()
>  Returning NULL on 'TARGET_GID'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()
> Initializing user info
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()
> Set the calling user's username to: itoufiqu
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()
> Marking uinfo structure as ready
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()
> Obtaining home directory
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_priv_init()
> Set home (via getpwuid()) to: /data/users/itoufiqu
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()
> Running SUID program workflow
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()
> Checking program has appropriate permissions
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()
> Checking configuration file is properly owned by root
> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()
> Checking if singularity.conf allows us to run as suid
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_get_bool_char_impl()
> Called singularity_config_get_bool(allow setuid, yes)
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_get_value_impl()
> Returning configuration value allow setuid='yes'
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_get_bool_char_impl()
> Return singularity_config_get_bool(allow setuid, yes) = 1
> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()
>  Returning NULL on 'NOSUID'
> ^[[0m^[[91mERROR   [U=2527,P=48257]   singularity_suid_init()
>       Singularity is not running with appropriate privileges!
> ^[[0m^[[91mERROR   [U=2527,P=48257]   singularity_suid_init()
>       Check installation path is not mounted with 'nosuid', and/or consult
> manual.
> ^[[0m^[[31mABORT   [U=2527,P=48257]   singularity_suid_init()
>       Retval = 255
>
>
> Some info on the host, let me know if you need more info:
>
>
> [itoufiqu@compute-7-2 2.3.1]$ cat /etc/redhat-release
>
> CentOS release 6.8 (Final)
>
> [itoufiqu@compute-7-2 2.3.1]$ uname -a
>
> Linux compute-7-2.local 3.10.104-1.el6.elrepo.x86_64 #1 SMP Fri Oct 21
> 10:27:14 EDT 2016 x86_64 x86_64 x86_64 GNU/Linux
>
> Thanks again!
>
> On Thursday, August 3, 2017 at 1:38:02 PM UTC-7, vanessa wrote:
>>
>> Could you please show the output with --debug and singularity --version?
>>
>> singularity --debug create --size 30000 /tmp/debian_jessie_tvb.img
>>> singularity --version
>>
>>
>> and also throw in information about the host, if easy to get :)
>>
>> On Thu, Aug 3, 2017 at 4:24 PM, toufique <te...@gmail.com> wrote:
>>
>>> Hi Vanessa,
>>>
>>> I finally had some time to look into this earlier today.  Per your
>>> suggestion, I tried creating a container as myself, no luck:
>>>
>>> [itoufiqu@compute-7-2 ~]$ singularity -v create --size 30000
>>> /tmp/debian_jessie_tvb.img
>>> Increasing verbosity level (2)
>>> Singularity version: 2.3.1-dist
>>> Exec'ing: /data/apps/singularity/2.3.1/libexec/singularity/cli/create.
>>> exec
>>> VERBOSE: Set messagelevel to: 2
>>> VERBOSE: Initialize configuration file: /data/apps/singularity/2.3.1/e
>>> tc/singularity/singularity.conf
>>> VERBOSE: Initializing Singularity Registry
>>> ERROR  : Singularity is not running with appropriate privileges!
>>> ERROR  : Check installation path is not mounted with 'nosuid', and/or
>>> consult manual.
>>> ABORT  : Retval = 255
>>>
>>> [itoufiqu@compute-7-2 ~]$ whoami
>>> itoufiqu
>>>
>>>
>>> singularity was installed as 'root' .  Below is the config file:
>>>
>>> allow setuid = yes
>>> max loop devices = 256
>>> config passwd = yes
>>> config group = yes
>>> config resolv_conf = yes
>>> mount proc = yes
>>> mount sys = yes
>>> mount dev = yes
>>> mount home = yes
>>> mount tmp = yes
>>> mount hostfs = no
>>> bind path = /etc/localtime
>>> bind path = /etc/hosts
>>> bind path = /dfs1
>>> bind path = /dfs2
>>> bind path = /data
>>> user bind control = yes
>>> enable overlay = yes
>>> mount slave = yes
>>> sessiondir max size = 16
>>>
>>> What do I need to do get this fixed, please?
>>>
>>> thanks.
>>>
>>>
>>> On Thursday, July 27, 2017 at 5:35:33 PM UTC-7, toufique wrote:
>>>>
>>>> Hi,
>>>>
>>>> I am sure this has been discussed in this forum.
>>>>
>>>> I have a container that I have setup as 'root' . Now when I go about
>>>> using that container to get (even) a 'shell' off the container, I get the
>>>> error below:
>>>>
>>>> ./singularity shell /tmp/singularity_containers/debian_latest.img
>>>>
>>>> ERROR  : Singularity is not running with appropriate privileges!
>>>> ERROR  : Check installation path is not mounted with 'nosuid', and/or
>>>> consult manual.
>>>> ABORT  : Retval = 255
>>>>
>>>> How do I fix this so, I can install containers as a 'root' user but
>>>> still be able to run -  'exec' , 'run', 'shell' commands as a regular user?
>>>>
>>>> Thanks for your help!
>>>>
>>> --
>>> You received this message because you are subscribed to the Google
>>> Groups "singularity" group.
>>> To unsubscribe from this group and stop receiving emails from it, send
>>> an email to singu...@lbl.gov.
>>>
>>
>>
>>
>> --
>> Vanessa Villamia Sochat
>> Stanford University '16
>> (603) 321-0676
>>
> --
> You received this message because you are subscribed to the Google Groups
> "singularity" group.
> To unsubscribe from this group and stop receiving emails from it, send an
> email to singu...@lbl.gov.
>



-- 
Vanessa Villamia Sochat
Stanford University '16
(603) 321-0676

--001a1145c59e3ec3c80555dfd143
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">I think the line where it&#39;s hitting a bug is here:<div=
><br></div><div><a href=3D"https://github.com/singularityware/singularity/b=
lob/adf5259ac94d7b213c649f073dcda32459b0c8b7/src/util/suid.c#L80">https://g=
ithub.com/singularityware/singularity/blob/adf5259ac94d7b213c649f073dcda324=
59b0c8b7/src/util/suid.c#L80</a><br></div><div><br></div><div>Specifically =
somewhere after this command:</div><blockquote class=3D"gmail_quote" style=
=3D"margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding=
-left:1ex"><br><span style=3D"color:rgb(36,41,46);font-family:SFMono-Regula=
r,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;font-size:12=
px;white-space:pre;background-color:rgb(255,251,221)">( </span><span class=
=3D"gmail-pl-c1" style=3D"box-sizing:border-box;color:rgb(0,92,197);font-fa=
mily:SFMono-Regular,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,mono=
space;font-size:12px;white-space:pre">singularity_registry_get</span><span =
style=3D"color:rgb(36,41,46);font-family:SFMono-Regular,Consolas,&quot;Libe=
ration Mono&quot;,Menlo,Courier,monospace;font-size:12px;white-space:pre;ba=
ckground-color:rgb(255,251,221)">(</span><span class=3D"gmail-pl-s" style=
=3D"box-sizing:border-box;color:rgb(3,47,98);font-family:SFMono-Regular,Con=
solas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;font-size:12px;wh=
ite-space:pre"><span class=3D"gmail-pl-pds" style=3D"box-sizing:border-box"=
>&quot;</span>NOSUID<span class=3D"gmail-pl-pds" style=3D"box-sizing:border=
-box">&quot;</span></span><span style=3D"color:rgb(36,41,46);font-family:SF=
Mono-Regular,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;f=
ont-size:12px;white-space:pre;background-color:rgb(255,251,221)">) !=3D </s=
pan><span class=3D"gmail-pl-c1" style=3D"box-sizing:border-box;color:rgb(0,=
92,197);font-family:SFMono-Regular,Consolas,&quot;Liberation Mono&quot;,Men=
lo,Courier,monospace;font-size:12px;white-space:pre">NULL</span><span style=
=3D"color:rgb(36,41,46);font-family:SFMono-Regular,Consolas,&quot;Liberatio=
n Mono&quot;,Menlo,Courier,monospace;font-size:12px;white-space:pre;backgro=
und-color:rgb(255,251,221)"> )</span></blockquote><div><br></div><div><br><=
/div><div>When I run a similar command, I see the following:</div><div><br>=
</div><div><blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.=
8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">VERBOSE [U=3D0=
,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_suid_init() =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Running SUID program workflow=
<br>VERBOSE [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_suid_init() =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Checking pro=
gram has appropriate permissions<br>VERBOSE [U=3D0,P=3D29387] =C2=A0 =C2=A0=
 =C2=A0singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 Checking configuration file is properly owned by root<=
br>VERBOSE [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_suid_init() =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Checking if =
singularity.conf allows us to run as suid<br>DEBUG =C2=A0 [U=3D0,P=3D29387]=
 =C2=A0 =C2=A0 =C2=A0singularity_config_get_bool_char_impl() =C2=A0 Called =
singularity_config_get_bool(allow setuid, yes)<br>DEBUG =C2=A0 [U=3D0,P=3D2=
9387] =C2=A0 =C2=A0 =C2=A0singularity_config_get_value_impl() =C2=A0 =C2=A0=
 =C2=A0 Returning configuration value allow setuid=3D&#39;yes&#39;<br>DEBUG=
 =C2=A0 [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_config_get_bool_c=
har_impl() =C2=A0 Return singularity_config_get_bool(allow setuid, yes) =3D=
 1<br>DEBUG =C2=A0 [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_regist=
ry_get() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning N=
ULL on &#39;NOSUID&#39;<br>VERBOSE [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0si=
ngularity_priv_userns() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 Invoking the user namespace</blockquote><div><br></div><div>and I re=
turn NULL too, but it doesn&#39;t error out. So you don&#39;t get to the la=
st line to invoke the user namespace... I&#39;m not completely sure about t=
he issue, but given centos 6, I bet you it has to do with the OS / version.=
=C2=A0 Do others have thoughts? Could you try a completely new install with=
 no changes to the config, and do a simple shell for some docker:// uri so =
I can recreate your use case exactly?</div></div><div><br></div><div><br></=
div></div><div class=3D"gmail_extra"><br><div class=3D"gmail_quote">On Thu,=
 Aug 3, 2017 at 4:45 PM, toufique <span dir=3D"ltr">&lt;<a href=3D"mailto:t=
ech...@gmail.com" target=3D"_blank">tech...@gmail.com</a>&gt;</span> wrote:=
<br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-lef=
t:1px #ccc solid;padding-left:1ex"><div dir=3D"ltr">Hi Vanessa,<div><br></d=
iv><div>command:=C2=A0</div><div><br></div><div>singularity --debug create =
--size 30000 /tmp/debian_jessie_tvb_1.img . (not that this time i tried cre=
ating the container in /tmp .=C2=A0 So, no involvment of NFS here for the c=
ontainer)=C2=A0<br></div><div><br></div><div><br></div><div>Here is the deb=
ug output:</div><div><br></div><div><div>Enabling debugging</div><div>Endin=
g argument loop</div><span class=3D""><div>Singularity version: 2.3.1-dist<=
/div><div>Exec&#39;ing: /data/apps/singularity/2.3.1/<wbr>libexec/singulari=
ty/cli/<wbr>create.exec</div></span><div>VERBOSE [U=3D2527,P=3D48257] =C2=
=A0 message_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Set messagelevel to: 5</div><div>^=
[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Initialize configuration fi=
le: /data/apps/singularity/2.3.1/<wbr>etc/singularity/singularity.<wbr>conf=
</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_config=
_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Starting pa=
rse of configuration file /data/apps/singularity/2.3.1/<wbr>etc/singularity=
/singularity.<wbr>conf</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 s=
ingularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0Got config key allow setuid =3D &#39;yes&#39;</div><div>^[[0mVERBOSE =
[U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key max loop devices =3D &#39=
;256&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_co=
nfig_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got con=
fig key allow pid ns =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=
=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0Got config key config passwd =3D &#39;yes&#39;</div=
><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key confi=
g group =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=
=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0Got config key config resolv_conf =3D &#39;yes&#39;</div><div>=
^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key mount proc =
=3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singul=
arity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0Got config key mount sys =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2=
527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key mount dev =3D &#39;yes&#39;</=
div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse(=
) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key mou=
nt home =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=
=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0Got config key mount tmp =3D &#39;yes&#39;</div><div>^[[0mVERB=
OSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key mount hostfs =3D &#=
39;no&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_c=
onfig_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got co=
nfig key bind path =3D &#39;/etc/localtime&#39;</div><div>^[[0mVERBOSE [U=
=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key bind path =3D &#39;/etc/ho=
sts&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_con=
fig_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got conf=
ig key bind path =3D &#39;/dfs1&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D4=
8257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0Got config key bind path =3D &#39;/dfs2&#39;</div><div>=
^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key bind path =
=3D &#39;/data&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 sing=
ularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0Got config key user bind control =3D &#39;yes&#39;</div><div>^[[0mVERBOS=
E [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key enable overlay =3D &#3=
9;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_c=
onfig_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got co=
nfig key mount slave =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=
=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0Got config key sessiondir max size =3D &#39;16&#39;=
</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_config=
_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Finished pa=
rsing configuration file &#39;/data/apps/singularity/2.3.1/<wbr>etc/singula=
rity/singularity.<wbr>conf&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257]=
 =C2=A0 singularity_registry_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 Initializing Singularity Registry</div><div>^[[0mVERBOSE [U=3D25=
27,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &#39;WRITABLE&#39; =
=3D &#39;1&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 sin=
gularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0Returning singularity_registry_set(<wbr>WRITABLE, 1) =3D 0</div><div>=
^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &=
#39;LIBEXECDIR&#39; =3D &#39;/data/apps/singularity/2.3.1/<wbr>libexec&#39;=
</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_regist=
ry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning s=
ingularity_registry_set(<wbr>libexecdir, /data/apps/singularity/2.3.1/<wbr>=
libexec) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singulari=
ty_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Ad=
ding value to registry: &#39;COMMAND&#39; =3D &#39;create&#39;</div><div>^[=
[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_r=
egistry_set(<wbr>COMMAND, create) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=
=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &#39;IMAGESIZE&#39; =3D &=
#39;30000&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 sing=
ularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0Returning singularity_registry_set(<wbr>IMAGESIZE, 30000) =3D 0</div><di=
v>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registr=
y: &#39;MESSAGELEVEL&#39; =3D &#39;5&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D=
2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_registry_set(<wbr>MESS=
AGELEVEL, 5) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singu=
larity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0Adding value to registry: &#39;VERSION&#39; =3D &#39;2.3.1-dist&#39;</di=
v><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_s=
et() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singu=
larity_registry_set(<wbr>version, 2.3.1-dist) =3D 0</div><div>^[[0mVERBOSE =
[U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &#39;LOCALSTAT=
EDIR&#39; =3D &#39;/data/apps/singularity/2.3.1/<wbr>var&#39;</div><div>^[[=
0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_r=
egistry_set(<wbr>localstatedir, /data/apps/singularity/2.3.1/<wbr>var) =3D =
0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_s=
et() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to=
 registry: &#39;SYSCONFDIR&#39; =3D &#39;/data/apps/singularity/2.3.1/<wbr>=
etc&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularit=
y_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Ret=
urning singularity_registry_set(<wbr>sysconfdir, /data/apps/singularity/2.3=
.1/<wbr>etc) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singu=
larity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0Adding value to registry: &#39;BINDIR&#39; =3D &#39;/data/apps/singulari=
ty/2.3.1/<wbr>bin&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=
=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0Returning singularity_registry_set(<wbr>bindir, /data/apps/sin=
gularity/2.3.1/<wbr>bin) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =
=C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0Adding value to registry: &#39;IMAGE&#39; =3D &#39;/tmp/debia=
n_jessie_tvb_1.img&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =
=C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0Returning singularity_registry_set(<wbr>IMAGE, /tmp/debian_je=
ssie_tvb_1.img) =3D 0</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=
=A0 singularity_registry_get() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0Returning NULL on &#39;HOME&#39;</div><div>^[[0mDEBUG =C2=A0 [=
U=3D2527,P=3D48257] =C2=A0 singularity_registry_get() =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning NULL on &#39;TARGET_UID&#39;</d=
iv><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_=
get() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning NULL=
 on &#39;TARGET_GID&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =
=C2=A0 singularity_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 Initializing user info</div><div>^[[0mDEBUG =C2=A0 [U=
=3D2527,P=3D48257] =C2=A0 singularity_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Set the calling user&#39;s username =
to: itoufiqu</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singul=
arity_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 Marking uinfo structure as ready</div><div>^[[0mDEBUG =C2=A0 [U=3D25=
27,P=3D48257] =C2=A0 singularity_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Obtaining home directory</div><div>^[[0m=
VERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_priv_init() =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Set home (via getpwuid()) =
to: /data/users/itoufiqu</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0=
 singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 Running SUID program workflow</div><div>^[[0mVERBOSE [U=3D252=
7,P=3D48257] =C2=A0 singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Checking program has appropriate permission=
s</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_suid_init(=
) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Checking c=
onfiguration file is properly owned by root</div><div>^[[0mVERBOSE [U=3D252=
7,P=3D48257] =C2=A0 singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Checking if singularity.conf allows us to r=
un as suid</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singular=
ity_config_get_bool_<wbr>char_impl() =C2=A0 Called singularity_config_get_b=
ool(<wbr>allow setuid, yes)</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257=
] =C2=A0 singularity_config_get_value_<wbr>impl() =C2=A0 =C2=A0 =C2=A0 Retu=
rning configuration value allow setuid=3D&#39;yes&#39;</div><div>^[[0mDEBUG=
 =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_config_get_bool_<wbr>char_i=
mpl() =C2=A0 Return singularity_config_get_bool(<wbr>allow setuid, yes) =3D=
 1</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_regi=
stry_get() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning=
 NULL on &#39;NOSUID&#39;</div><div>^[[0m^[[91mERROR =C2=A0 [U=3D2527,P=3D4=
8257] =C2=A0 singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 Singularity is not running with appropriate privil=
eges!</div><div>^[[0m^[[91mERROR =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singula=
rity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 Check installation path is not mounted with &#39;nosuid&#39;, and/or=
 consult manual.</div><div>^[[0m^[[31mABORT =C2=A0 [U=3D2527,P=3D48257] =C2=
=A0 singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 Retval =3D 255</div><div><br></div><div><br></div><div>So=
me info on the host, let me know if you need more info:=C2=A0</div><div><br=
></div><div><br></div><div>[itoufiqu@compute-7-2 2.3.1]$ cat /etc/redhat-re=
lease =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=C2=A0<br></div><div><d=
iv>CentOS release 6.8 (Final) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0</div><div>[itoufiqu@compute-7-2 2.3.1]$ uname -=
a =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=C2=A0</d=
iv><div>Linux compute-7-2.local 3.10.104-1.el6.elrepo.x86_64 #1 SMP Fri Oct=
 21 10:27:14 EDT 2016 x86_64 x86_64 x86_64 GNU/Linux =C2=A0</div></div><div=
><br></div><div>Thanks again!</div><span class=3D""><div><br></div>On Thurs=
day, August 3, 2017 at 1:38:02 PM UTC-7, vanessa wrote:</span><blockquote c=
lass=3D"gmail_quote" style=3D"margin:0;margin-left:0.8ex;border-left:1px #c=
cc solid;padding-left:1ex"><span class=3D""><div dir=3D"ltr">Could you plea=
se show the output with --debug and singularity --version?<div><br></div><b=
lockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-le=
ft:1px solid rgb(204,204,204);padding-left:1ex"><span style=3D"font-size:12=
.8px">singularity --debug create --size 30000 /tmp/debian_jessie_tvb.img</s=
pan><span style=3D"font-size:12.8px"><br></span><span style=3D"font-size:12=
.8px">singularity --version</span></blockquote><div><br></div><div>and also=
 throw in information about the host, if easy to get :)=C2=A0</div></div></=
span><div><br><div class=3D"gmail_quote"><div><div class=3D"h5">On Thu, Aug=
 3, 2017 at 4:24 PM, toufique <span dir=3D"ltr">&lt;<a rel=3D"nofollow">te.=
..@gmail.com</a>&gt;</span> wrote:<br></div></div><blockquote class=3D"gmai=
l_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left=
:1ex"><div><div class=3D"h5"><div dir=3D"ltr">Hi Vanessa,<div><br></div><di=
v>I finally had some time to look into this earlier today.=C2=A0 Per your s=
uggestion, I tried creating a container as myself, no luck:=C2=A0<br><br><d=
iv>[itoufiqu@compute-7-2 ~]$ singularity -v create --size 30000 /tmp/debian=
_jessie_tvb.img</div><div>Increasing verbosity level (2)</div><div>Singular=
ity version: 2.3.1-dist</div><div>Exec&#39;ing: /data/apps/singularity/2.3.=
1/l<wbr>ibexec/singularity/cli/create.<wbr>exec</div><div>VERBOSE: Set mess=
agelevel to: 2</div><div>VERBOSE: Initialize configuration file: /data/apps=
/singularity/2.3.1/e<wbr>tc/singularity/singularity.con<wbr>f</div><div>VER=
BOSE: Initializing Singularity Registry</div><span><div>ERROR =C2=A0: Singu=
larity is not running with appropriate privileges!</div><div>ERROR =C2=A0: =
Check installation path is not mounted with &#39;nosuid&#39;, and/or consul=
t manual.</div><div>ABORT =C2=A0: Retval =3D 255</div><div><br></div></span=
><div>[itoufiqu@compute-7-2 ~]$ whoami</div><div><span style=3D"color:inher=
it;font-size:inherit">itoufiqu</span><br></div><div><br></div><div><br></di=
v><div>singularity was installed as &#39;root&#39; .=C2=A0 Below is the con=
fig file:=C2=A0</div><div><br></div><div><div>allow setuid =3D yes</div><di=
v>max loop devices =3D 256</div><div>config passwd =3D yes</div><div>config=
 group =3D yes</div><div>config resolv_conf =3D yes</div><div>mount proc =
=3D yes</div><div>mount sys =3D yes</div><div>mount dev =3D yes</div><div>m=
ount home =3D yes</div><div>mount tmp =3D yes</div><div>mount hostfs =3D no=
</div><div>bind path =3D /etc/localtime</div><div>bind path =3D /etc/hosts<=
/div><div>bind path =3D /dfs1</div><div>bind path =3D /dfs2</div><div>bind =
path =3D /data</div><div>user bind control =3D yes</div><div>enable overlay=
 =3D yes</div><div>mount slave =3D yes</div><div>sessiondir max size =3D 16=
</div></div><div><br></div><div>What do I need to do get this fixed, please=
?</div><div><br></div><div>thanks.</div><div><div><div><br></div><div><br><=
/div>On Thursday, July 27, 2017 at 5:35:33 PM UTC-7, toufique wrote:<blockq=
uote class=3D"gmail_quote" style=3D"margin:0;margin-left:0.8ex;border-left:=
1px #ccc solid;padding-left:1ex"><div dir=3D"ltr">Hi,=C2=A0<div><br></div><=
div>I am sure this has been discussed in this forum.</div><div><br></div><d=
iv>I have a container that I have setup as &#39;root&#39; .=C2=A0Now when I=
 go about using that container to get (even) a &#39;shell&#39; off the cont=
ainer, I get the error below:<br><br><div>./singularity shell /tmp/singular=
ity_containers/de<wbr>bian_latest.img =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0</div><div>ERROR =C2=
=A0: Singularity is not running with appropriate privileges!</div><div>ERRO=
R =C2=A0: Check installation path is not mounted with &#39;nosuid&#39;, and=
/or consult manual.</div><div>ABORT =C2=A0: Retval =3D 255</div></div><div>=
<br></div><div>How do I fix this so, I can install containers as a &#39;roo=
t&#39; user but still be able to run - =C2=A0&#39;exec&#39; , &#39;run&#39;=
, &#39;shell&#39; commands as a regular user?</div><div><br></div><div>Than=
ks for your help!</div></div></blockquote></div></div></div></div></div></d=
iv><div><div><div><div class=3D"h5">

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br></div></div>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a rel=3D"nofollow">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><span class=3D""><br><br clear=3D"all"><div>=
<br></div>-- <br><div>Vanessa Villamia Sochat<br>Stanford University &#39;1=
6<br><div><div><div><a href=3D"tel:(603)%20321-0676" value=3D"+16033210676"=
 target=3D"_blank">(603) 321-0676</a></div></div></div></div>
</span></div>
</blockquote></div></div><div class=3D"HOEnZb"><div class=3D"h5">

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.<wbr>gov</a>.<br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
<div class=3D"gmail_signature" data-smartmail=3D"gmail_signature">Vanessa V=
illamia Sochat<br>Stanford University &#39;16<br><div><div><div>(603) 321-0=
676</div></div></div></div>
</div>

--001a1145c59e3ec3c80555dfd143--
