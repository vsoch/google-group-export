X-Received: by 10.129.97.139 with SMTP id v133mr2640889ywb.126.1476400860594;
        Thu, 13 Oct 2016 16:21:00 -0700 (PDT)
X-BeenThere: singularity@lbl.gov
Received: by 10.107.31.77 with SMTP id f74ls2094151iof.52.gmail; Thu, 13 Oct
 2016 16:20:59 -0700 (PDT)
X-Received: by 10.98.81.199 with SMTP id f190mr13626728pfb.36.1476400859228;
        Thu, 13 Oct 2016 16:20:59 -0700 (PDT)
Return-Path: <gmku...@lbl.gov>
Received: from fe4.lbl.gov (fe4.lbl.gov. [128.3.41.71])
        by mx.google.com with ESMTP id uj9si13529577pac.74.2016.10.13.16.20.59
        for <singu...@lbl.gov>;
        Thu, 13 Oct 2016 16:20:59 -0700 (PDT)
Received-SPF: pass (google.com: domain of gmku...@lbl.gov designates 209.85.215.69 as permitted sender) client-ip=209.85.215.69;
Authentication-Results: mx.google.com;
       spf=pass (google.com: domain of gmku...@lbl.gov designates 209.85.215.69 as permitted sender) smtp.mailfrom=gmku...@lbl.gov
IronPort-PHdr: 9a23:nQBcKRNkSO0g5SFvMTQl6mtUPXoX/o7sNwtQ0KIMzox0KfzyrarrMEGX3/hxlliBBdydsKMezbaL+Pq9EUU7or+5+EgYd5JNUxJXwe43pCcHRPC/NEvgMfTxZDY7FskRHHVs/nW8LFQHUJ2mPw6anHS+4HYoFwnlMkItf6KuS9SU05n8jb360qaQSj0AvCC6b7J2IUf+hiTqne5Sv7FfLL0swADCuHpCdrce72ppIVWOg0S0vZ/or9Ze6SAYh9YNv44FD+SpN5k+VqFSWTEvMmQp45/wtB/MUA+G/HoAQyYLlAFVCRPO9hDwU7/1uC+8ue1jixWdaNb3S78pXT247rt6AEvziSEIKjow6mDLm+R0hqYdrxW/8U9R2YnRNcu6LvdxebnMNfZcDUlcRNpDWjYLStezaogSFfYTMPxwq4P54VQJs03tVkGXGOrzx2oQ1TfN1qog3rFkTww=
X-Ironport-SBRS: 2.7
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: A2FNAACJFQBYf0XXVdFcHQEFAQsBGAEFAQsBglw1AQEBAQF0bQ8HgziJdZcFglaFBYdFhRSBRhsnHQEGgXSCMIFaAoIFBzgUAQEBAQEBAQEBAQECEAEBCQsLCRcxgjIEAgECEQUEATkKMQEBAQEBAQEBAQEBAQEBAQEaAggFIg8DDwIZAQEBAwESESswCwsLDSoCAiEBDwMBBQELEQYIBwQBHAQBh0xKAw8IBahrgTI+MotCiQ0Ng3IBAQEBAQUBAQEBAQEiEIsCgkeBUhEBgyCCWwWJIIYVihg1AYYmhkuDC4I8jTmIZYQUgj0THoERDw9bgmWCSh40B4VdRzGBKAEBAQ
X-IronPort-AV: E=Sophos;i="5.31,490,1473145200"; 
   d="scan'208,217";a="43076440"
Received: from mail-lf0-f69.google.com ([209.85.215.69])
  by fe4.lbl.gov with ESMTP; 13 Oct 2016 16:20:57 -0700
Received: by mail-lf0-f69.google.com with SMTP id f134so36944239lfg.6
        for <singu...@lbl.gov>; Thu, 13 Oct 2016 16:20:57 -0700 (PDT)
X-Gm-Message-State: AA6/9RnM/G51d5IPZ81JCWKthIU7WOkg7Im9ZMxdjN1bUrzgJHt1uucQZAYixK5IremlmcfTXFS2OpuXT2XnKrQNljPFkwl1A2ooTW6a5FKMRMNG4NU3MHHRCuMH3aVeW/CL54Xr//spce5wxoz9aF6OQVw=
X-Received: by 10.25.66.72 with SMTP id p69mr175282lfa.82.1476400856622;
        Thu, 13 Oct 2016 16:20:56 -0700 (PDT)
X-Received: by 10.25.66.72 with SMTP id p69mr175263lfa.82.1476400856230; Thu,
 13 Oct 2016 16:20:56 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.25.167.67 with HTTP; Thu, 13 Oct 2016 16:20:55 -0700 (PDT)
In-Reply-To: <c1907e4e-d873-4532-9e88-bccb5a57c04a@lbl.gov>
References: <33de4201-8a0d-4012-a1fa-1d4e729926b7@lbl.gov> <1c1cf001-51aa-454e-8986-b64d010583f9@lbl.gov>
 <CAN7etTwsFM1edg+ujDsKMktBD=i14qw0JzegWvzZeuZL7Zjqdw@mail.gmail.com> <c1907e4e-d873-4532-9e88-bccb5a57c04a@lbl.gov>
From: "Gregory M. Kurtzer" <gmku...@lbl.gov>
Date: Thu, 13 Oct 2016 16:20:55 -0700
Message-ID: <CAN7etTyycRXEXy9g4PDi_rKgdXcYr6G-uPWUhc6HA02hiHh0rQ@mail.gmail.com>
Subject: Re: [Singularity] Re: Does the singularity can run the HPL?
To: singularity <singu...@lbl.gov>
Content-Type: multipart/alternative; boundary=94eb2c1a07c895054b053ec75c52

--94eb2c1a07c895054b053ec75c52
Content-Type: text/plain; charset=UTF-8

I don't think so. Pulling the metadata from the image, and loading the
relevant bits from a single NFS point is not the most scalable. I think it
has to do with PMI. Does it work if you execute it via mpirun?


On Thu, Oct 13, 2016 at 4:11 PM, Steve Mehlberg <sgmeh...@gmail.com>
wrote:

> Gregory,
>
> We were testing with 5 nodes, 56 tasks.  We were using an nfs system
> connected to an EXT4 fs.  Could the problem be all those processes trying
> to load the same image at the same time from the same place?  I just ran
> the test again and it takes about 3 seconds on a bare metal run for the
> output to start displaying and 25 seconds with a singularity run. This was
> using the IMB benchmark, but my experience was similar with HPL (High
> Performance Linpack) and others.
>
> The commands I used were:
>
> srun -N5 -n56 -w node[4-6,8-9] --mpi=pmix run.it
> srun -N5 -n56 -w node[4-6,8-9] --mpi=pmix singularity exec c7a.img run.it
>
> run.it just sources the environment and executes the benchmark.
>
> -Steve
>
> On Wednesday, October 12, 2016 at 3:37:20 PM UTC-6, Gregory M. Kurtzer
> wrote:
>>
>> Hi Steve,
>>
>> 30 seconds to startup? How many nodes were you testing on, and what kind
>> of file system is the image sitting on?
>>
>>
>>
>> On Tue, Oct 11, 2016 at 1:50 PM, Steve Mehlberg <sg...@gmail.com>
>> wrote:
>>
>>> I have run HPL on a cluster (3-8 nodes) using singularity.  I used slurm
>>> to start several processes/containers on several nodes in my cluster for
>>> testing singularity.  I configured some short runs, and one run that took
>>> 3.5 hours.  My task was to compare bare metal runs with singularity runs.
>>> I compared cputime and elapsed time from slurm sacct.  When starting the
>>> singularity runs there is a slight delay (up to 30 seconds, I'm assuming
>>> for the containers to load) - if that time is removed then the singularity
>>> and bare metal runs are nearly identical.  With the start up time, the 3.5
>>> hour singularity run took ~0.5% more time than bare metal.
>>>
>>>
>>> On Tuesday, October 11, 2016 at 8:07:19 AM UTC-6, zhenjin zhang wrote:
>>>>
>>>> Does the singularity can run the HPL?
>>>>
>>> --
>>> You received this message because you are subscribed to the Google
>>> Groups "singularity" group.
>>> To unsubscribe from this group and stop receiving emails from it, send
>>> an email to singu...@lbl.gov.
>>>
>>
>>
>>
>> --
>> Gregory M. Kurtzer
>> HPC Systems Architect and Technology Developer
>> Lawrence Berkeley National Laboratory HPCS
>> University of California Berkeley Research IT
>> Singularity Linux Containers (http://singularity.lbl.gov/)
>> Warewulf Cluster Management (http://warewulf.lbl.gov/)
>> GitHub: https://github.com/gmkurtzer, Twitter: https://twitt
>> er.com/gmkurtzer
>>
> --
> You received this message because you are subscribed to the Google Groups
> "singularity" group.
> To unsubscribe from this group and stop receiving emails from it, send an
> email to singu...@lbl.gov.
>



-- 
Gregory M. Kurtzer
HPC Systems Architect and Technology Developer
Lawrence Berkeley National Laboratory HPCS
University of California Berkeley Research IT
Singularity Linux Containers (http://singularity.lbl.gov/)
Warewulf Cluster Management (http://warewulf.lbl.gov/)
GitHub: https://github.com/gmkurtzer, Twitter: https://twitter.com/gmkurtzer

--94eb2c1a07c895054b053ec75c52
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">I don&#39;t think so.=C2=A0Pulling the metadata from the i=
mage, and loading the relevant bits from a single NFS point is not the most=
 scalable.=C2=A0I think it has to do with PMI. Does it work if you execute =
it via mpirun?=C2=A0<div><br></div></div><div class=3D"gmail_extra"><br><di=
v class=3D"gmail_quote">On Thu, Oct 13, 2016 at 4:11 PM, Steve Mehlberg <sp=
an dir=3D"ltr">&lt;<a href=3D"mailto:sgmeh...@gmail.com" target=3D"_blank">=
sgmeh...@gmail.com</a>&gt;</span> wrote:<br><blockquote class=3D"gmail_quot=
e" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">=
<div dir=3D"ltr">Gregory,<br><br>We were testing with 5 nodes, 56 tasks.=C2=
=A0 We were using an nfs system connected to an EXT4 fs.=C2=A0 Could the pr=
oblem be all those processes trying to load the same image at the same time=
 from the same place?=C2=A0 I just ran the test again and it takes about 3 =
seconds on a bare metal run for the output to start displaying and 25 secon=
ds with a singularity run. This was using the IMB benchmark, but my experie=
nce was similar with HPL (High Performance Linpack) and others.<br><br>The =
commands I used were:<br><br>srun -N5 -n56 -w node[4-6,8-9] --mpi=3Dpmix <a=
 href=3D"http://run.it" target=3D"_blank">run.it</a><br>srun -N5 -n56 -w no=
de[4-6,8-9] --mpi=3Dpmix singularity exec c7a.img <a href=3D"http://run.it"=
 target=3D"_blank">run.it</a><br><br><a href=3D"http://run.it" target=3D"_b=
lank">run.it</a> just sources the environment and executes the benchmark.<b=
r><br>-Steve<span class=3D""><br><br>On Wednesday, October 12, 2016 at 3:37=
:20 PM UTC-6, Gregory M. Kurtzer wrote:</span><blockquote class=3D"gmail_qu=
ote" style=3D"margin:0;margin-left:0.8ex;border-left:1px #ccc solid;padding=
-left:1ex"><span class=3D""><div dir=3D"ltr">Hi Steve,<div><br></div><div>3=
0 seconds to startup? How many nodes were you testing on, and what kind of =
file system is the image sitting on?<div><br></div><div><br></div></div></d=
iv></span><div><br><div class=3D"gmail_quote"><span class=3D"">On Tue, Oct =
11, 2016 at 1:50 PM, Steve Mehlberg <span dir=3D"ltr">&lt;<a rel=3D"nofollo=
w">sg...@gmail.com</a>&gt;</span> wrote:<br></span><blockquote class=3D"gma=
il_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-lef=
t:1ex"><span class=3D""><div dir=3D"ltr">I have run HPL on a cluster (3-8 n=
odes) using singularity.=C2=A0 I used slurm to start several processes/cont=
ainers on several nodes in my cluster for testing singularity.=C2=A0 I conf=
igured some short runs, and one run that took 3.5 hours.=C2=A0 My task was =
to compare bare metal runs with singularity runs.=C2=A0 I compared cputime =
and elapsed time from slurm sacct.=C2=A0 When starting the singularity runs=
 there is a slight delay (up to 30 seconds, I&#39;m assuming for the contai=
ners to load) - if that time is removed then the singularity and bare metal=
 runs are nearly identical.=C2=A0 With the start up time, the 3.5 hour sing=
ularity run took ~0.5% more time than bare metal.<div><div><br><br>On Tuesd=
ay, October 11, 2016 at 8:07:19 AM UTC-6, zhenjin zhang wrote:<blockquote c=
lass=3D"gmail_quote" style=3D"margin:0;margin-left:0.8ex;border-left:1px #c=
cc solid;padding-left:1ex"><div dir=3D"ltr">Does the singularity can run th=
e HPL?<br></div></blockquote></div></div></div></span><div><div><span class=
=3D"">

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br></span>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a rel=3D"nofollow">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><span class=3D""><br><br clear=3D"all"><div>=
<br></div>-- <br><div><div dir=3D"ltr"><div><div dir=3D"ltr"><div><div dir=
=3D"ltr"><div><div dir=3D"ltr"><div dir=3D"ltr"><div dir=3D"ltr"><div>Grego=
ry M. Kurtzer</div><div>HPC Systems Architect and Technology Developer</div=
><div>Lawrence Berkeley National Laboratory HPCS<br>University of Californi=
a Berkeley Research IT<br>Singularity Linux Containers=C2=A0(<a href=3D"htt=
p://singularity.lbl.gov/" rel=3D"nofollow" target=3D"_blank">http://singula=
rity<wbr>.lbl.gov/</a>)</div><div>Warewulf Cluster Management=C2=A0(<a href=
=3D"http://warewulf.lbl.gov/" rel=3D"nofollow" target=3D"_blank">http://war=
ewulf.lb<wbr>l.gov/</a>)</div><div>GitHub:=C2=A0<a href=3D"https://github.c=
om/gmkurtzer" rel=3D"nofollow" target=3D"_blank">https://github.com/gmk<wbr=
>urtzer</a>,=C2=A0<span style=3D"font-size:12.8px">Twitter:=C2=A0</span><a =
href=3D"https://twitter.com/gmkurtzer" style=3D"font-size:12.8px" rel=3D"no=
follow" target=3D"_blank">https://twitt<wbr>er.com/gmkurtzer</a></div></div=
></div></div></div></div></div></div></div></div></div>
</span></div>
</blockquote></div><div class=3D"HOEnZb"><div class=3D"h5">

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.<wbr>gov</a>.<br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
<div class=3D"gmail_signature" data-smartmail=3D"gmail_signature"><div dir=
=3D"ltr"><div><div dir=3D"ltr"><div><div dir=3D"ltr"><div><div dir=3D"ltr">=
<div dir=3D"ltr"><div dir=3D"ltr"><div>Gregory M. Kurtzer</div><div>HPC Sys=
tems Architect and Technology Developer</div><div>Lawrence Berkeley Nationa=
l Laboratory HPCS<br>University of California Berkeley Research IT<br>Singu=
larity Linux Containers=C2=A0(<a href=3D"http://singularity.lbl.gov/" targe=
t=3D"_blank">http://singularity.lbl.gov/</a>)</div><div>Warewulf Cluster Ma=
nagement=C2=A0(<a href=3D"http://warewulf.lbl.gov/" target=3D"_blank">http:=
//warewulf.lbl.gov/</a>)</div><div>GitHub:=C2=A0<a href=3D"https://github.c=
om/gmkurtzer" target=3D"_blank">https://github.com/gmkurtzer</a>,=C2=A0<spa=
n style=3D"font-size:12.8px">Twitter:=C2=A0</span><a href=3D"https://twitte=
r.com/gmkurtzer" style=3D"font-size:12.8px" target=3D"_blank">https://twitt=
er.com/gmkurtzer</a></div></div></div></div></div></div></div></div></div><=
/div></div>
</div>

--94eb2c1a07c895054b053ec75c52--
