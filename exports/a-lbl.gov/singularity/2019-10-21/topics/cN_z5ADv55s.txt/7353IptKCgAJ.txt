X-Received: by 10.107.141.78 with SMTP id p75mr26102847iod.12.1469644199010;
        Wed, 27 Jul 2016 11:29:59 -0700 (PDT)
X-BeenThere: singularity@lbl.gov
Received: by 10.107.15.25 with SMTP id x25ls936285ioi.5.gmail; Wed, 27 Jul
 2016 11:29:58 -0700 (PDT)
X-Received: by 10.66.51.98 with SMTP id j2mr52751325pao.87.1469644198567;
        Wed, 27 Jul 2016 11:29:58 -0700 (PDT)
Return-Path: <y...@onerussian.com>
Received: from fe3.lbl.gov (fe3.lbl.gov. [128.3.41.68])
        by mx.google.com with ESMTPS id j65si7580179pfj.96.2016.07.27.11.29.57
        for <singu...@lbl.gov>
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Wed, 27 Jul 2016 11:29:58 -0700 (PDT)
Received-SPF: neutral (google.com: 129.170.30.229 is neither permitted nor denied by best guess record for domain of y...@onerussian.com) client-ip=129.170.30.229;
Authentication-Results: mx.google.com;
       spf=neutral (google.com: 129.170.30.229 is neither permitted nor denied by best guess record for domain of y...@onerussian.com) smtp.mailfrom=y...@onerussian.com
X-Ironport-SBRS: None
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: A0GhAwAc/ZhX/+UeqoFaAx6Dd3yjYA8JAQEFAYEPAYdDjCGBPUEfgXKFexQBAQEBAQEBA1onQQ4BggABIhcGCisqAi8IGQEbAQQBI1sJAgsaAgUhAgIPBQcGGzSIFwMPCAUJrnKJMw1EAQaDdAV8hGGFFYI0D4JEBYI1gloFmH00hhiGMoIoiVGFeYgohAWDeB42gUtFHIFoIDKFA4M9AQEB
X-IPAS-Result: A0GhAwAc/ZhX/+UeqoFaAx6Dd3yjYA8JAQEFAYEPAYdDjCGBPUEfgXKFexQBAQEBAQEBA1onQQ4BggABIhcGCisqAi8IGQEbAQQBI1sJAgsaAgUhAgIPBQcGGzSIFwMPCAUJrnKJMw1EAQaDdAV8hGGFFYI0D4JEBYI1gloFmH00hhiGMoIoiVGFeYgohAWDeB42gUtFHIFoIDKFA4M9AQEB
X-IronPort-AV: E=Sophos;i="5.28,430,1464678000"; 
   d="scan'208";a="31539691"
Received: from washoe.dartmouth.edu (HELO smtp.onerussian.com) ([129.170.30.229])
  by fe3.lbl.gov with ESMTP; 27 Jul 2016 11:29:57 -0700
Received: from smtp.onerussian.com ([192.168.100.6] helo=washoe.onerussian.com)
	by smtp.onerussian.com with esmtps (TLS1.2:RSA_AES_128_CBC_SHA1:128)
	(Exim 4.80)
	(envelope-from <y...@onerussian.com>)
	id 1bSTad-0005zw-VH
	for singu...@lbl.gov; Wed, 27 Jul 2016 14:29:55 -0400
Received: from yoh by washoe.onerussian.com with local (Exim 4.84)
	(envelope-from <y...@onerussian.com>)
	id 1bSTad-0005zr-Q6
	for singu...@lbl.gov; Wed, 27 Jul 2016 14:29:55 -0400
Date: Wed, 27 Jul 2016 14:29:55 -0400
From: Yaroslav Halchenko <y...@dartmouth.edu>
To: singularity@lbl.gov
Subject: Re: [Singularity] Scientific Linux 7x packages
Message-ID: <20160727182955.GJ22292@onerussian.com>
References: <ab3762fb-b607-44e5-b227-2e9baafce223@lbl.gov>
 <CA+3XN_+J5EJY-pb2vM12qkHFg8GAf0wq6y-5oDT4pZ7YKPc3QQ@mail.gmail.com>
 <CAN7etTwJHh8rq2RsssGng5EAK1qKFsfQYD+oRSJ6kGgtt1BW9w@mail.gmail.com>
 <CA+3XN_+TCYV5B9C8ys8pwfeHPPEYpgAMpavNpOgensGtqwDEaA@mail.gmail.com>
 <874m7dsk7y.fsf@pc102091.liv.ac.uk>
 <CAN7etTwvLcq6WhOQUWuoMw+9EzdeeJFnzgsqXfs8+XnDg9rwvw@mail.gmail.com>
 <87eg6gqan0.fsf@pc102091.liv.ac.uk>
 <CAN7etTzeZAinD27Q=-Ou8p=voRLwYYk=-pdV5AcA9VNSHKpDBQ@mail.gmail.com>
 <75f09279-32fb-4452-80fb-f7a61259136f@lbl.gov>
 <87popzosaq.fsf@pc102091.liv.ac.uk>
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Disposition: inline
In-Reply-To: <87popzosaq.fsf@pc102091.liv.ac.uk>
X-URL: http://www.onerussian.com
X-Image-Url: http://www.onerussian.com/img/yoh.png
X-PGP-Key: http://www.onerussian.com/gpg-yoh.asc
X-fingerprint: C5B9 05F0 E8D9 FD96 68FF  366F A2DE 2350 62DA 33FA
User-Agent: Mutt/1.5.23 (2014-03-12)
X-SA-Exim-Connect-IP: 192.168.100.6
X-SA-Exim-Rcpt-To: singu...@lbl.gov
X-SA-Exim-Mail-From: y...@onerussian.com
X-SA-Exim-Scanned: No (on smtp.onerussian.com); SAEximRunCond expanded to false


On Wed, 27 Jul 2016, Dave Love wrote:

> Yaroslav Halchenko <yarik...@gmail.com> writes:

> > So, even though main mass of people doesn't use 'set -u', I don't think it 
> > should be used as an argument anywhere where additional rigor is desired, 

> I'm all for extra checks -- and I found bugs by adding them -- if the
> engineering trades-off are worth it, but I don't see how it helps here,
> especially in comparison with putting effort into checking the setuid
> program.

one doesn't exclude another.

> > e.g. in applications where a "mistake" due to some variable being undefined 
> > (e.g. as in rm -rf $var/) could be quite sever.

> But surely ${var:-}/ will have the same effect.

yeap, it would.  That is why I would never use ${var:-}/ in such a
way in this particular context.  That is the point.

> > Moreover, I don't see why bash scripts should anyhow be special in treating 
> > variables in comparison to other mainline languages (may be discarding 
> > basic if it still allows for undefined variables as it did iirc in early 
> > 90s).  Requirement to explicitly assign (or define to carry a specific 
> > default value) a variable before using it is imho again a common practice.  

> That's not happening here anyway.  (I avoided declarations in the docker
> import support because they weren't used elsewhere.)  How does it help
> to replace

>   ...
>   ... "$x" ...

> with

>   set -u
>   ...
>   ... "${x:-}" ...
> ?

it would help in other lines of code happen I decide to use some
variable but forget to assure that it gets properly defined, or still
named the same way as before (e.g. renaming env variable in top script,
but forgetting to rename it in underlying script which would just
blindly still use it)

> > And in cases where variable is expected to be undefined or carry no value 
> > -- to explicitly check for that one way (${var:-}) or another (surround 
> > code block with set +u to disable checks, and set -u to enable this safety 
> > measure).  IMHO, and in my experience, such a simple measure does make 
> > scripts more robust.

> Fair enough, but I've never been convinced by anything other than care
> and understanding when it comes to shell scripts.

I am not trying to diminish value of "care and understanding".  IMHO
with set -u  you actually enforce yourself for more care, e.g., once
again, by implicitly and automagically verifying that every used
variable was defined.

-- 
Yaroslav O. Halchenko
Center for Open Neuroscience     http://centerforopenneuroscience.org
Dartmouth College, 419 Moore Hall, Hinman Box 6207, Hanover, NH 03755
Phone: +1 (603) 646-9834                       Fax: +1 (603) 646-1419
WWW:   http://www.linkedin.com/in/yarik        
