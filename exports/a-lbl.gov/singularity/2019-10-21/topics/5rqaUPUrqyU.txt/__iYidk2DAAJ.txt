X-Received: by 10.107.22.132 with SMTP id 126mr670005iow.21.1501816461047;
        Thu, 03 Aug 2017 20:14:21 -0700 (PDT)
X-BeenThere: singularity@lbl.gov
Received: by 10.36.43.135 with SMTP id h129ls832975ita.15.canary-gmail; Thu,
 03 Aug 2017 20:14:20 -0700 (PDT)
X-Received: by 10.84.224.11 with SMTP id r11mr1057484plj.232.1501816460037;
        Thu, 03 Aug 2017 20:14:20 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1501816459; cv=none;
        d=google.com; s=arc-20160816;
        b=Ujkj7w4B2W12wKzzGIHCW6lhvKKQ32ZnppJfvWF/1875laVHxOWwyfrXge25Bs4AwT
         Y3hZLjO28z7hY9E38FVk/QwhWX4sVzwCaQyEq6qBKNYmv/HA0VJcuzXPDV7RdK5Zsgx3
         l17j+Y8QUP1VYrhO71lNSiT0cyMY0tIagdA4RSvtJNvw3NJhiH6DBEalSFs/st2Ab4jE
         y0Ia2YFE0Jts1RhJvx+pXhpD+sy025rSyGB/Ct1FjP0f0y2CSfMQiO3ehQ9U0ipk8y0T
         WP+8ePtlcCVOjXZ6HbMX//g5JkysFi/UfjBJb4BKJlQvJyT+VPpHzqti0ca4z41Bk5gL
         PxyQ==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=to:subject:message-id:date:from:references:in-reply-to:mime-version
         :dkim-signature:arc-authentication-results;
        bh=pglUoOxoTnh5oyZRuov5JB7XOPj4MKZFd7P5WMkAMeA=;
        b=C5iNbV4mEhme6lhhOd5RUtlMxv+ZrSZd8zaG0bjUKr8H1AKI6/DztGNovI9t7SD2F0
         Moudlm1834sG2P3SqXvX9M2SkBGyhCOMCw98zAGQldCVaA9eMjpwUJ7Tx8JzO6zo360I
         p6UX1Y+dLHhLkMa9bi99EZ+iHspP0p45ZJ/AtOCcp51hb0YnW2OceoMmkoDn1IkQNmLf
         ghL6hglO2U3YeUQY1LwK0U1lrA2sl9nexe/FVKiVJ1owZ2HHpJX1vv78NRIXWHAZZNDd
         +41sLE5DdF5506zE2tle4lpLIeU4XAe6nsZ7HxonyQJ9ES+YhQcxXOdZCvq07AbNHzHb
         uSeA==
ARC-Authentication-Results: i=1; mx.google.com;
       dkim=pass head...@gmail.com header.b=og8lrjW+;
       spf=pass (google.com: domain of vso...@gmail.com designates 209.85.213.46 as permitted sender) smtp.mailfrom=vso...@gmail.com
Return-Path: <vso...@gmail.com>
Received: from fe4.lbl.gov (fe4.lbl.gov. [128.3.41.71])
        by mx.google.com with ESMTP id u8si367698plh.55.2017.08.03.20.14.19
        for <singu...@lbl.gov>;
        Thu, 03 Aug 2017 20:14:19 -0700 (PDT)
Received-SPF: pass (google.com: domain of vso...@gmail.com designates 209.85.213.46 as permitted sender) client-ip=209.85.213.46;
Authentication-Results: mx.google.com;
       dkim=pass head...@gmail.com header.b=og8lrjW+;
       spf=pass (google.com: domain of vso...@gmail.com designates 209.85.213.46 as permitted sender) smtp.mailfrom=vso...@gmail.com
X-Ironport-SBRS: 3.4
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A2HaAAC65YNZhi7VVdFaAxoBAQEBAgEBA?=
 =?us-ascii?q?QEIAQEBARUBAQEBAgEBAQEIAQEBAYJEQIEPgRQHg2eBPohjkAiBElyCcJMlDoF?=
 =?us-ascii?q?BQAMhAQ6BCYM/TwKEOAc/GAEBAQEBAQEBAQEBAhABAQEICwsIKC+CMwUCAxoGB?=
 =?us-ascii?q?ARGKQMBAQEBAQEBAQEiAQEBAQEBAQEBAQEBAQEBARoCDR4EOwEBAQECARoBCB0?=
 =?us-ascii?q?BDQ4eAwELBgMCCw0gAQkCAiEBAQ4DAQUBCxEOBwQBHASIPIE5AQMNCAULj2SRG?=
 =?us-ascii?q?z+KVhGBI4IEBQEcgwkFg1oKGScNVoMrAQEBBwEBAQEBAQEBARcCBhKDFoICgy+?=
 =?us-ascii?q?DJ4JXKYFAARIBQAwagkyCYQWJZXuHc4UYh1Y8h1OHaYRxgg9ZhH+KYYwohFw+g?=
 =?us-ascii?q?ngUH4EVDxCBBTMLdxVjhEQqDxAMggMkNgEBAQEBA4ZfR4FrAQEB?=
X-IronPort-AV: E=Sophos;i="5.41,319,1498546800"; 
   d="scan'208,217";a="83748044"
Received: from mail-vk0-f46.google.com ([209.85.213.46])
  by fe4.lbl.gov with ESMTP; 03 Aug 2017 20:14:11 -0700
Received: by mail-vk0-f46.google.com with SMTP id r199so1630303vke.4
        for <singu...@lbl.gov>; Thu, 03 Aug 2017 20:14:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to;
        bh=pglUoOxoTnh5oyZRuov5JB7XOPj4MKZFd7P5WMkAMeA=;
        b=og8lrjW+2XsalLL4S4tjsLELgH93MUEHnpuGn2eXHhIlh2RSfGaCC2TmgoD/cW62vR
         UDdyCZqf2WtffLRXFkBE87vXLElurigZO61hNJVeWJkq13ONWnDKXqyWD7s/Jz9h29DR
         afTPxZTZaZOMKKncPwa7ac2nfrCd2ArtABgblpRMG53FJ3mFBCOJyGuQXWHnByPsBH9U
         J+k64F5Qh1Q5JkCOp1j7SFczANw25vep0u5a/iArwtwYLZmIrVfK8KZx9cOEPbJ9d0SJ
         6WpNabgxfS9i73G/Hao/S5lKvcHgUAvpWcDSbjK/ef4EjH+4BZb5USpHSeETtHpdfPCI
         CX5w==
X-Gm-Message-State: AHYfb5gWR6amK9Zudt/kLNBDP4r/O9e/Cc+2J0XQWiJFXeP6OOshEXIJ
	Jx0bLdRIgmSFlFHrRn7H7/Is2yCMwprNSZU=
X-Received: by 10.31.98.65 with SMTP id w62mr586071vkb.160.1501816450050; Thu,
 03 Aug 2017 20:14:10 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.103.69.84 with HTTP; Thu, 3 Aug 2017 20:13:49 -0700 (PDT)
In-Reply-To: <24435673-68ff-42e8-8988-6706e17537e2@lbl.gov>
References: <9d25d29a-08d9-4bc4-bbcf-3327a841b3da@lbl.gov> <e847efae-1f98-4eb2-b2b5-1bf80c0a3476@lbl.gov>
 <CAM=pu+K1A92qd8JBPT9NhHrP_Pv-OPf-cnkNVCfqxeMKbH4MRg@mail.gmail.com>
 <e8470d35-8671-4736-91d8-9b68ba47e24c@lbl.gov> <CAM=pu+Lc-9f8+7vjkPLy-Fd3OYM_XSEtoTYrusgGkU-=P58VYg@mail.gmail.com>
 <a396e8fe-fae0-4c4c-8b76-9724a48bd84c@lbl.gov> <CAM=pu+J1ehSAubYr=cNVysyyBE++uhJv=vEL0u_LFMT9RPdY+g@mail.gmail.com>
 <24435673-68ff-42e8-8988-6706e17537e2@lbl.gov>
From: vanessa s <vso...@gmail.com>
Date: Thu, 3 Aug 2017 23:13:49 -0400
Message-ID: <CAM=pu++hvRJfijS3CgtGbOi5y7C9b8Oe1+4zxH3vDFUD7P9Anw@mail.gmail.com>
Subject: Re: [Singularity] Re: can't run singularity exec as a regular user
To: singularity@lbl.gov
Content-Type: multipart/alternative; boundary="94eb2c095a3605fd010555e4e430"

--94eb2c095a3605fd010555e4e430
Content-Type: text/plain; charset="UTF-8"

Hey Toufique,

I just tried this out in a Docker image:

*docker run -it --privileged centos:6.8 bash*

First I tried installing from the tarball for 2.3.1

yum install -y wget gcc
> wget https://github.com/singularityware/singularity/
> releases/download/2.3.1/singularity-2.3.1.tar.gz
> tar -xzvf singularity-2.3.1.tar.gz

cd singularity-2.3.1

 ./configure --prefix=/usr/local
> make
> sudo make install   (on docker you are sudo so I didn't need the sudo bit
> :O)


 Did it go somewhere?

[root@595a27c176f2 singularity-2.3.1]# which singularity
> /usr/local/bin/singularity


I ran your example command, but I got a different error:

singularity -vvv create  --size 300 /tmp/debian_jessie_tvb_2-2-1.img
> VERBOSE: Running child program: /sbin/mkfs.ext3
> Singularity: create-suid (U=0,P=11951)> Failed to exec program
> /sbin/mkfs.ext3: No such file or directory
> ERROR  : Failed to exec program /sbin/mkfs.ext3: No such file or directory
> Singularity: create-suid (U=0,P=11951)> Retval = 255
> ABORT  : Retval = 255
> INFO   : Image is done: /tmp/debian_jessie_tvb_2-2-1.img


guess I can't make filesystems? let's install a bunch of crap from Google
searches and see if we can after that:

>
> yum install -y e2fsprogs-1.41.12-23.el6.x86_64  < -- I found with "yum
> whatprovides */mkfs.ext3"


trying again...


singularity -vvv create  --size 300 /tmp/meatball.img
> INFO   : Image is done: /tmp/meatball.img


success! Let's import..

# singularity import /tmp/meatball.img docker://ubuntu
> Docker image path: index.docker.io/library/ubuntu:latest
> Cache folder set to /root/.singularity/docker
> Importing: base Singularity environment
> Importing:
> /root/.singularity/docker/sha256:e0a742c2abfd5e2a6f8ed15b1c78e873cf9559b96a04204daf6de5df01e3124c.tar.gz
> Importing:
> /root/.singularity/docker/sha256:486cb8339a27635fa93dc47aa0c689326a0a7cce388966d16daf8d265436cf7f.tar.gz
> Importing:
> /root/.singularity/docker/sha256:dc6f0d824617ad8a5d1163a5b2084814665dd83156317ad06ccf14deb517a053.tar.gz
> Importing:
> /root/.singularity/docker/sha256:4f7a5649a30e3f318ce5d7e4dbcbbeb6c0938c4cbae4d4a641fe910562ff4978.tar.gz
> Importing:
> /root/.singularity/docker/sha256:672363445ad2c734e29221a6b47f4e614b5adc8a3cdca3364f62db2ed2bdff0c.tar.gz
> Importing:
> /root/.singularity/metadata/sha256:fe44851d529f465f9aa107b32351c8a0a722fc0619a2a7c22b058084fac068a4.tar.gz
> [root@595a27c176f2 sbin]# singularity shell /tmp/meatball.img
> Singularity: action-suid (U=0,P=12168)> USER=root, IMAGE='meatball.img',
> COMMAND='shell'
> Singularity: Invoking an interactive shell within container...
> Singularity meatball.img:/sbin> uname -a
> Linux 595a27c176f2 4.4.0-87-generic #110-Ubuntu SMP Tue Jul 18 12:55:35
> UTC 2017 x86_64 x86_64 x86_64 GNU/Linux
> Singularity meatball.img:/sbin>


so I can't reproduce your error with 2.3.1, and it's one of those things I
can only go as far as to reproduce your basic setup, but it's not actually
the cluster setup you have. What I would suggest you do is what I've done,
get a new instance (Docker or actual machine somewhere) and recreate the
installation. Then you can compare your cluster version with your
(hopefully working) instance version, and figuring out the bug will come
down to identifying differences in the error output of the two
(**importantly produced on the same host, same singularity install) and
then tracing that.

Hope this was helpful!

Best,

Vanessa

On Thu, Aug 3, 2017 at 6:24 PM, toufique <tech...@gmail.com> wrote:

> I see the latest release is 2.3.1.  I have the tarball already.  I can
> recompile 2.3.1 again. But I did not make any changes in my current build
> except adding the following lines:
>
> bind path = /dfs1
> bind path = /dfs2
> bind path = /data
>
>
> I am not sure if there is any other URL to clone from:
>
> (when I search for latest release, I end up on the following page)
> https://github.com/singularityware/singularity/releases/
>
> Also, I just tried compiling 2.2.1, i get a simillar error:
>
>
> itoufiqu@compute-7-2 ~]$ singularity -vvv create  --size 300
> /tmp/debian_jessie_tvb_2-2-1.img
> increasing verbosity level (4)
> ending argument loop
> Exec'ing: /data/apps/singularity/2.2.1/libexec/singularity/cli/create.exec
> --sizeERROR: Calling user must be root!
>
> [itoufiqu@compute-7-2 ~]$ which singularity
> /data/apps/singularity/2.2.1/bin/singularity < -- note that I am using
> version 2.2.1 here
>
>
>
> If this is an OS issue (possibly OS being older ? ) issue, would it be
> possible to provide a patch (back ported?) to help address this issue?  We
> are really counting on singularity to work in our environment in UC Irvine,
> we have plans to move to a much newer version of Debian distro, but we
> can't at this time.  We looked into docker, but it is something that we
> can't do cluster-wide.  Singularity seems to be the tool that we can run
> through the cluster, especially being on an older OS.
>
> Thanks again for all the help!
>
>
>
> On Thursday, August 3, 2017 at 2:54:32 PM UTC-7, vanessa wrote:
>>
>> Yes, just remove what you have, clone the repo fresh, and then run
>>>
>>>
>>> cd singularity
>>
>> ./autogen.sh
>>> ./configure --prefix=/usr/local
>>> make
>>> sudo make install
>>
>>
>>
>> On Thu, Aug 3, 2017 at 5:39 PM, toufique <te...@gmail.com> wrote:
>>
>>> hi Vanessa,
>>>
>>> what did you mean by trying a new install with no changes in the
>>> config?  I can reinstall 2.3.1 ( in a different install location)  -- is
>>> that what you meant?  Do I need to install ( ./configure, make, make
>>> install) as myself or 'root'? Does it help installing this as myself?  are
>>> there any plans to fix this bug? If not, should I try an older version of
>>> singularity?
>>>
>>> thanks.
>>>
>>> On Thursday, August 3, 2017 at 2:11:04 PM UTC-7, vanessa wrote:
>>>>
>>>> I think the line where it's hitting a bug is here:
>>>>
>>>> https://github.com/singularityware/singularity/blob/adf5259a
>>>> c94d7b213c649f073dcda32459b0c8b7/src/util/suid.c#L80
>>>>
>>>> Specifically somewhere after this command:
>>>>
>>>>>
>>>>> ( singularity_registry_get("NOSUID") != NULL )
>>>>
>>>>
>>>>
>>>> When I run a similar command, I see the following:
>>>>
>>>> VERBOSE [U=0,P=29387]      singularity_suid_init()
>>>>> Running SUID program workflow
>>>>> VERBOSE [U=0,P=29387]      singularity_suid_init()
>>>>> Checking program has appropriate permissions
>>>>> VERBOSE [U=0,P=29387]      singularity_suid_init()
>>>>> Checking configuration file is properly owned by root
>>>>> VERBOSE [U=0,P=29387]      singularity_suid_init()
>>>>> Checking if singularity.conf allows us to run as suid
>>>>> DEBUG   [U=0,P=29387]      singularity_config_get_bool_char_impl()
>>>>> Called singularity_config_get_bool(allow setuid, yes)
>>>>> DEBUG   [U=0,P=29387]      singularity_config_get_value_impl()
>>>>> Returning configuration value allow setuid='yes'
>>>>> DEBUG   [U=0,P=29387]      singularity_config_get_bool_char_impl()
>>>>> Return singularity_config_get_bool(allow setuid, yes) = 1
>>>>> DEBUG   [U=0,P=29387]      singularity_registry_get()
>>>>>  Returning NULL on 'NOSUID'
>>>>> VERBOSE [U=0,P=29387]      singularity_priv_userns()
>>>>> Invoking the user namespace
>>>>
>>>>
>>>> and I return NULL too, but it doesn't error out. So you don't get to
>>>> the last line to invoke the user namespace... I'm not completely sure about
>>>> the issue, but given centos 6, I bet you it has to do with the OS /
>>>> version.  Do others have thoughts? Could you try a completely new install
>>>> with no changes to the config, and do a simple shell for some docker:// uri
>>>> so I can recreate your use case exactly?
>>>>
>>>>
>>>>
>>>> On Thu, Aug 3, 2017 at 4:45 PM, toufique <te...@gmail.com> wrote:
>>>>
>>>>> Hi Vanessa,
>>>>>
>>>>> command:
>>>>>
>>>>> singularity --debug create --size 30000 /tmp/debian_jessie_tvb_1.img .
>>>>> (not that this time i tried creating the container in /tmp .  So, no
>>>>> involvment of NFS here for the container)
>>>>>
>>>>>
>>>>> Here is the debug output:
>>>>>
>>>>> Enabling debugging
>>>>> Ending argument loop
>>>>> Singularity version: 2.3.1-dist
>>>>> Exec'ing: /data/apps/singularity/2.3.1/libexec/singularity/cli/create.
>>>>> exec
>>>>> VERBOSE [U=2527,P=48257]   message_init()
>>>>>  Set messagelevel to: 5
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Initialize configuration file: /data/apps/singularity/2.3.1/e
>>>>> tc/singularity/singularity.conf
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_parse()
>>>>>    Starting parse of configuration file /data/apps/singularity/2.3.1/e
>>>>> tc/singularity/singularity.conf
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key allow setuid = 'yes'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key max loop devices = '256'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key allow pid ns = 'yes'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key config passwd = 'yes'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key config group = 'yes'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key config resolv_conf = 'yes'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key mount proc = 'yes'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key mount sys = 'yes'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key mount dev = 'yes'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key mount home = 'yes'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key mount tmp = 'yes'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key mount hostfs = 'no'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key bind path = '/etc/localtime'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key bind path = '/etc/hosts'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key bind path = '/dfs1'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key bind path = '/dfs2'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key bind path = '/data'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key user bind control = 'yes'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key enable overlay = 'yes'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key mount slave = 'yes'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>>>    Got config key sessiondir max size = '16'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_parse()
>>>>>    Finished parsing configuration file '/data/apps/singularity/2.3.1/
>>>>> etc/singularity/singularity.conf'
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_init()
>>>>>     Initializing Singularity Registry
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>>>    Adding value to registry: 'WRITABLE' = '1'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>>>    Returning singularity_registry_set(WRITABLE, 1) = 0
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>>>    Adding value to registry: 'LIBEXECDIR' = '/data/apps/singularity/2.3.1/
>>>>> libexec'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>>>    Returning singularity_registry_set(libexecdir,
>>>>> /data/apps/singularity/2.3.1/libexec) = 0
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>>>    Adding value to registry: 'COMMAND' = 'create'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>>>    Returning singularity_registry_set(COMMAND, create) = 0
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>>>    Adding value to registry: 'IMAGESIZE' = '30000'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>>>    Returning singularity_registry_set(IMAGESIZE, 30000) = 0
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>>>    Adding value to registry: 'MESSAGELEVEL' = '5'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>>>    Returning singularity_registry_set(MESSAGELEVEL, 5) = 0
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>>>    Adding value to registry: 'VERSION' = '2.3.1-dist'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>>>    Returning singularity_registry_set(version, 2.3.1-dist) = 0
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>>>    Adding value to registry: 'LOCALSTATEDIR' =
>>>>> '/data/apps/singularity/2.3.1/var'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>>>    Returning singularity_registry_set(localstatedir,
>>>>> /data/apps/singularity/2.3.1/var) = 0
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>>>    Adding value to registry: 'SYSCONFDIR' = '/data/apps/singularity/2.3.1/
>>>>> etc'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>>>    Returning singularity_registry_set(sysconfdir,
>>>>> /data/apps/singularity/2.3.1/etc) = 0
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>>>    Adding value to registry: 'BINDIR' = '/data/apps/singularity/2.3.1/
>>>>> bin'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>>>    Returning singularity_registry_set(bindir,
>>>>> /data/apps/singularity/2.3.1/bin) = 0
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>>>    Adding value to registry: 'IMAGE' = '/tmp/debian_jessie_tvb_1.img'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>>>    Returning singularity_registry_set(IMAGE,
>>>>> /tmp/debian_jessie_tvb_1.img) = 0
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()
>>>>>    Returning NULL on 'HOME'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()
>>>>>    Returning NULL on 'TARGET_UID'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()
>>>>>    Returning NULL on 'TARGET_GID'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()
>>>>>     Initializing user info
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()
>>>>>     Set the calling user's username to: itoufiqu
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()
>>>>>     Marking uinfo structure as ready
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()
>>>>>     Obtaining home directory
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_priv_init()
>>>>>     Set home (via getpwuid()) to: /data/users/itoufiqu
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()
>>>>>     Running SUID program workflow
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()
>>>>>     Checking program has appropriate permissions
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()
>>>>>     Checking configuration file is properly owned by root
>>>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()
>>>>>     Checking if singularity.conf allows us to run as suid
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_get_bool_char_impl()
>>>>>   Called singularity_config_get_bool(allow setuid, yes)
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_get_value_impl()
>>>>>     Returning configuration value allow setuid='yes'
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_get_bool_char_impl()
>>>>>   Return singularity_config_get_bool(allow setuid, yes) = 1
>>>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()
>>>>>    Returning NULL on 'NOSUID'
>>>>> ^[[0m^[[91mERROR   [U=2527,P=48257]   singularity_suid_init()
>>>>>           Singularity is not running with appropriate privileges!
>>>>> ^[[0m^[[91mERROR   [U=2527,P=48257]   singularity_suid_init()
>>>>>           Check installation path is not mounted with 'nosuid', and/or
>>>>> consult manual.
>>>>> ^[[0m^[[31mABORT   [U=2527,P=48257]   singularity_suid_init()
>>>>>           Retval = 255
>>>>>
>>>>>
>>>>> Some info on the host, let me know if you need more info:
>>>>>
>>>>>
>>>>> [itoufiqu@compute-7-2 2.3.1]$ cat /etc/redhat-release
>>>>>
>>>>> CentOS release 6.8 (Final)
>>>>>
>>>>> [itoufiqu@compute-7-2 2.3.1]$ uname -a
>>>>>
>>>>> Linux compute-7-2.local 3.10.104-1.el6.elrepo.x86_64 #1 SMP Fri Oct 21
>>>>> 10:27:14 EDT 2016 x86_64 x86_64 x86_64 GNU/Linux
>>>>>
>>>>> Thanks again!
>>>>>
>>>>> On Thursday, August 3, 2017 at 1:38:02 PM UTC-7, vanessa wrote:
>>>>>>
>>>>>> Could you please show the output with --debug and singularity
>>>>>> --version?
>>>>>>
>>>>>> singularity --debug create --size 30000 /tmp/debian_jessie_tvb.img
>>>>>>> singularity --version
>>>>>>
>>>>>>
>>>>>> and also throw in information about the host, if easy to get :)
>>>>>>
>>>>>> On Thu, Aug 3, 2017 at 4:24 PM, toufique <te...@gmail.com> wrote:
>>>>>>
>>>>>>> Hi Vanessa,
>>>>>>>
>>>>>>> I finally had some time to look into this earlier today.  Per your
>>>>>>> suggestion, I tried creating a container as myself, no luck:
>>>>>>>
>>>>>>> [itoufiqu@compute-7-2 ~]$ singularity -v create --size 30000
>>>>>>> /tmp/debian_jessie_tvb.img
>>>>>>> Increasing verbosity level (2)
>>>>>>> Singularity version: 2.3.1-dist
>>>>>>> Exec'ing: /data/apps/singularity/2.3.1/l
>>>>>>> ibexec/singularity/cli/create.exec
>>>>>>> VERBOSE: Set messagelevel to: 2
>>>>>>> VERBOSE: Initialize configuration file:
>>>>>>> /data/apps/singularity/2.3.1/etc/singularity/singularity.conf
>>>>>>> VERBOSE: Initializing Singularity Registry
>>>>>>> ERROR  : Singularity is not running with appropriate privileges!
>>>>>>> ERROR  : Check installation path is not mounted with 'nosuid',
>>>>>>> and/or consult manual.
>>>>>>> ABORT  : Retval = 255
>>>>>>>
>>>>>>> [itoufiqu@compute-7-2 ~]$ whoami
>>>>>>> itoufiqu
>>>>>>>
>>>>>>>
>>>>>>> singularity was installed as 'root' .  Below is the config file:
>>>>>>>
>>>>>>> allow setuid = yes
>>>>>>> max loop devices = 256
>>>>>>> config passwd = yes
>>>>>>> config group = yes
>>>>>>> config resolv_conf = yes
>>>>>>> mount proc = yes
>>>>>>> mount sys = yes
>>>>>>> mount dev = yes
>>>>>>> mount home = yes
>>>>>>> mount tmp = yes
>>>>>>> mount hostfs = no
>>>>>>> bind path = /etc/localtime
>>>>>>> bind path = /etc/hosts
>>>>>>> bind path = /dfs1
>>>>>>> bind path = /dfs2
>>>>>>> bind path = /data
>>>>>>> user bind control = yes
>>>>>>> enable overlay = yes
>>>>>>> mount slave = yes
>>>>>>> sessiondir max size = 16
>>>>>>>
>>>>>>> What do I need to do get this fixed, please?
>>>>>>>
>>>>>>> thanks.
>>>>>>>
>>>>>>>
>>>>>>> On Thursday, July 27, 2017 at 5:35:33 PM UTC-7, toufique wrote:
>>>>>>>>
>>>>>>>> Hi,
>>>>>>>>
>>>>>>>> I am sure this has been discussed in this forum.
>>>>>>>>
>>>>>>>> I have a container that I have setup as 'root' . Now when I go
>>>>>>>> about using that container to get (even) a 'shell' off the container, I get
>>>>>>>> the error below:
>>>>>>>>
>>>>>>>> ./singularity shell /tmp/singularity_containers/debian_latest.img
>>>>>>>>
>>>>>>>> ERROR  : Singularity is not running with appropriate privileges!
>>>>>>>> ERROR  : Check installation path is not mounted with 'nosuid',
>>>>>>>> and/or consult manual.
>>>>>>>> ABORT  : Retval = 255
>>>>>>>>
>>>>>>>> How do I fix this so, I can install containers as a 'root' user but
>>>>>>>> still be able to run -  'exec' , 'run', 'shell' commands as a regular user?
>>>>>>>>
>>>>>>>> Thanks for your help!
>>>>>>>>
>>>>>>> --
>>>>>>> You received this message because you are subscribed to the Google
>>>>>>> Groups "singularity" group.
>>>>>>> To unsubscribe from this group and stop receiving emails from it,
>>>>>>> send an email to singu...@lbl.gov.
>>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> --
>>>>>> Vanessa Villamia Sochat
>>>>>> Stanford University '16
>>>>>> (603) 321-0676
>>>>>>
>>>>> --
>>>>> You received this message because you are subscribed to the Google
>>>>> Groups "singularity" group.
>>>>> To unsubscribe from this group and stop receiving emails from it, send
>>>>> an email to singu...@lbl.gov.
>>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Vanessa Villamia Sochat
>>>> Stanford University '16
>>>> (603) 321-0676
>>>>
>>> --
>>> You received this message because you are subscribed to the Google
>>> Groups "singularity" group.
>>> To unsubscribe from this group and stop receiving emails from it, send
>>> an email to singu...@lbl.gov.
>>>
>>
>>
>>
>> --
>> Vanessa Villamia Sochat
>> Stanford University '16
>> (603) 321-0676
>>
> --
> You received this message because you are subscribed to the Google Groups
> "singularity" group.
> To unsubscribe from this group and stop receiving emails from it, send an
> email to singu...@lbl.gov.
>



-- 
Vanessa Villamia Sochat
Stanford University '16
(603) 321-0676

--94eb2c095a3605fd010555e4e430
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Hey Toufique,<div><br></div><div>I just tried this out in =
a Docker image:</div><div><br></div><div><b>docker run -it --privileged cen=
tos:6.8 bash</b><br></div><div><b><br></b></div><div>First I tried installi=
ng from the tarball for 2.3.1</div><div><br></div><blockquote class=3D"gmai=
l_quote" style=3D"margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,20=
4,204);padding-left:1ex">yum install -y wget gcc<br>wget=C2=A0<a href=3D"ht=
tps://github.com/singularityware/singularity/releases/download/2.3.1/singul=
arity-2.3.1.tar.gz" target=3D"_blank">https://github.com/<wbr>singularitywa=
re/singularity/<wbr>releases/download/2.3.1/<wbr>singularity-2.3.1.tar.gz</=
a><br>tar -xzvf=C2=A0singularity-2.3.1.tar.gz</blockquote><blockquote class=
=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-left:1px solid rg=
b(204,204,204);padding-left:1ex">cd singularity-2.3.1=C2=A0</blockquote><bl=
ockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-lef=
t:1px solid rgb(204,204,204);padding-left:1ex">=C2=A0./configure --prefix=
=3D/usr/local<br>make<br>sudo make install =C2=A0 (on docker you are sudo s=
o I didn&#39;t need the sudo bit :O)</blockquote><div><br></div><div>=C2=A0=
Did it go somewhere?</div><div><br></div><div><blockquote class=3D"gmail_qu=
ote" style=3D"margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,20=
4);padding-left:1ex">[root@595a27c176f2 singularity-2.3.1]# which singulari=
ty<br>/usr/local/bin/singularity</blockquote></div><div><br></div><div>I ra=
n your example command, but I got a different error:</div><div><br></div><b=
lockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-le=
ft:1px solid rgb(204,204,204);padding-left:1ex"><span style=3D"font-size:12=
.8px">singularity -vvv create =C2=A0--size 300 /tmp/debian_jessie_tvb_2-2-1=
.</span><span style=3D"font-size:12.8px">i<wbr>mg<br></span><span style=3D"=
font-size:12.8px">VERBOSE: Running child program: /sbin/mkfs.ext3<br></span=
><span style=3D"font-size:12.8px">Singularity: create-suid (U=3D0,P=3D11951=
)&gt; Failed to exec program /sbin/mkfs.ext3: No such file or directory</sp=
an><span style=3D"font-size:12.8px"><br></span><span style=3D"font-size:12.=
8px">ERROR =C2=A0: Failed to exec program /sbin/mkfs.ext3: No such file or =
directory<br></span><span style=3D"font-size:12.8px">Singularity: create-su=
id (U=3D0,P=3D11951)&gt; Retval =3D 255</span><span style=3D"font-size:12.8=
px"><br></span><span style=3D"font-size:12.8px">ABORT =C2=A0: Retval =3D 25=
5<br></span><span style=3D"font-size:12.8px">INFO =C2=A0 : Image is done: /=
tmp/debian_jessie_tvb_2-2-1.<wbr>img</span></blockquote><div><div style=3D"=
font-size:12.8px"><br></div></div><div style=3D"font-size:12.8px">guess I c=
an&#39;t make filesystems? let&#39;s install a bunch of crap from Google se=
arches and see if we can after that:</div><blockquote style=3D"margin:0px 0=
px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex" class=
=3D"gmail_quote"><br>yum install -y=C2=A0e2fsprogs-1.41.12-23.el6.x86_64 =
=C2=A0&lt; -- I found with &quot;yum whatprovides */mkfs.ext3&quot;</blockq=
uote><div><br></div><div>trying again...</div><div><br></div><div><span sty=
le=3D"font-size:12.8px"><br class=3D"gmail-Apple-interchange-newline"></spa=
n><blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;borde=
r-left:1px solid rgb(204,204,204);padding-left:1ex"><span style=3D"font-siz=
e:12.8px">singularity -vvv create =C2=A0--size 300 /tmp/meatball.</span><sp=
an style=3D"font-size:12.8px">i<wbr>mg<br></span><span style=3D"font-size:1=
2.8px">INFO =C2=A0 : Image is done: /tmp/meatball.img</span></blockquote></=
div><div><span style=3D"font-size:12.8px"><br></span></div><div><span style=
=3D"font-size:12.8px">success! Let&#39;s import..</span></div><div><span st=
yle=3D"font-size:12.8px"><br></span></div><div><blockquote class=3D"gmail_q=
uote" style=3D"margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,2=
04);padding-left:1ex"><span style=3D"font-size:12.8px"># singularity import=
 /tmp/meatball.img docker://ubuntu<br></span><span style=3D"font-size:12.8p=
x">Docker image path: <a href=3D"http://index.docker.io/library/ubuntu:late=
st">index.docker.io/library/ubuntu:latest</a><br></span><span style=3D"font=
-size:12.8px">Cache folder set to /root/.singularity/docker<br></span><span=
 style=3D"font-size:12.8px">Importing: base Singularity environment<br></sp=
an><span style=3D"font-size:12.8px">Importing: /root/.singularity/docker/sh=
a256:e0a742c2abfd5e2a6f8ed15b1c78e873cf9559b96a04204daf6de5df01e3124c.tar.g=
z<br></span><span style=3D"font-size:12.8px">Importing: /root/.singularity/=
docker/sha256:486cb8339a27635fa93dc47aa0c689326a0a7cce388966d16daf8d265436c=
f7f.tar.gz<br></span><span style=3D"font-size:12.8px">Importing: /root/.sin=
gularity/docker/sha256:dc6f0d824617ad8a5d1163a5b2084814665dd83156317ad06ccf=
14deb517a053.tar.gz<br></span><span style=3D"font-size:12.8px">Importing: /=
root/.singularity/docker/sha256:4f7a5649a30e3f318ce5d7e4dbcbbeb6c0938c4cbae=
4d4a641fe910562ff4978.tar.gz<br></span><span style=3D"font-size:12.8px">Imp=
orting: /root/.singularity/docker/sha256:672363445ad2c734e29221a6b47f4e614b=
5adc8a3cdca3364f62db2ed2bdff0c.tar.gz<br></span><span style=3D"font-size:12=
.8px">Importing: /root/.singularity/metadata/sha256:fe44851d529f465f9aa107b=
32351c8a0a722fc0619a2a7c22b058084fac068a4.tar.gz<br></span><span style=3D"f=
ont-size:12.8px">[root@595a27c176f2 sbin]# singularity shell /tmp/meatball.=
img=C2=A0<br></span><span style=3D"font-size:12.8px">Singularity: action-su=
id (U=3D0,P=3D12168)&gt; USER=3Droot, IMAGE=3D&#39;meatball.img&#39;, COMMA=
ND=3D&#39;shell&#39;</span><span style=3D"font-size:12.8px"><br></span><spa=
n style=3D"font-size:12.8px">Singularity: Invoking an interactive shell wit=
hin container...</span><span style=3D"font-size:12.8px"><br></span><span st=
yle=3D"font-size:12.8px">Singularity meatball.img:/sbin&gt; uname -a<br></s=
pan><span style=3D"font-size:12.8px">Linux 595a27c176f2 4.4.0-87-generic #1=
10-Ubuntu SMP Tue Jul 18 12:55:35 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux<b=
r></span><span style=3D"font-size:12.8px">Singularity meatball.img:/sbin&gt=
;=C2=A0</span></blockquote></div><div><span style=3D"font-size:12.8px"><br>=
</span></div><div>so I can&#39;t reproduce your error with 2.3.1, and it&#3=
9;s one of those things I can only go as far as to reproduce your basic set=
up, but it&#39;s not actually the cluster setup you have. What I would sugg=
est you do is what I&#39;ve done, get a new instance (Docker or actual mach=
ine somewhere) and recreate the installation. Then you can compare your clu=
ster version with your (hopefully working) instance version, and figuring o=
ut the bug will come down to identifying differences in the error output of=
 the two (**importantly produced on the same host, same singularity install=
) and then tracing that.</div><div><br></div><div>Hope this was helpful!=C2=
=A0</div><div><br></div><div>Best,</div><div><br></div><div>Vanessa</div></=
div><div class=3D"gmail_extra"><br><div class=3D"gmail_quote">On Thu, Aug 3=
, 2017 at 6:24 PM, toufique <span dir=3D"ltr">&lt;<a href=3D"mailto:tech...=
@gmail.com" target=3D"_blank">tech...@gmail.com</a>&gt;</span> wrote:<br><b=
lockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px =
#ccc solid;padding-left:1ex"><div dir=3D"ltr">I see the latest release is 2=
.3.1.=C2=A0 I have the tarball already.=C2=A0 I can recompile 2.3.1 again. =
But I did not make any changes in my current build except adding the follow=
ing lines:<span class=3D""><div><br></div><div><div>bind path =3D /dfs1</di=
v><div>bind path =3D /dfs2</div><div>bind path =3D /data</div></div><div><b=
r></div><div><br></div></span><div>I am not sure if there is any other URL =
to clone from:<div><br><div>(when I search for latest release, I end up on =
the following page)</div><div><a href=3D"https://github.com/singularityware=
/singularity/releases/" target=3D"_blank">https://github.com/<wbr>singulari=
tyware/singularity/<wbr>releases/</a>=C2=A0<br></div><div><br></div><div>Al=
so, I just tried compiling 2.2.1, i get a simillar error:=C2=A0</div><div><=
br></div><div><br></div><div><div>itoufiqu@compute-7-2 ~]$ singularity -vvv=
 create =C2=A0--size 300 /tmp/debian_jessie_tvb_2-2-1.<wbr>img</div><div>in=
creasing verbosity level (4)</div><div>ending argument loop</div><div>Exec&=
#39;ing: /data/apps/singularity/2.2.1/<wbr>libexec/singularity/cli/<wbr>cre=
ate.exec --size<span style=3D"background-color:rgb(255,255,0)">ERROR: Calli=
ng user must be root!</span></div><div><span style=3D"background-color:rgb(=
255,255,0)"><br></span></div><div>[itoufiqu@compute-7-2 ~]$ which singulari=
ty =C2=A0 =C2=A0 =C2=A0 =C2=A0</div><div>/data/apps/singularity/<span style=
=3D"background-color:rgb(255,0,0)">2.2.1/</span>b<wbr>in/singularity &lt; -=
- note that I am using version 2.2.1 here</div></div><div><br></div><div>=
=C2=A0</div><div><br></div><div>If this is an OS issue (possibly OS being o=
lder ? ) issue, would it be possible to provide a patch (back ported?) to h=
elp address this issue?=C2=A0 We are really counting on singularity to work=
 in our environment in UC Irvine, we have plans to move to a much newer ver=
sion of Debian distro, but we can&#39;t at this time.=C2=A0 We looked into =
docker, but it is something that we can&#39;t do cluster-wide.=C2=A0 Singul=
arity seems to be the tool that we can run through the cluster, especially =
being on an older OS. =C2=A0</div><div><br></div><div>Thanks again for all =
the help!</div><div><br></div><div><span class=3D""><br><br>On Thursday, Au=
gust 3, 2017 at 2:54:32 PM UTC-7, vanessa wrote:</span><blockquote class=3D=
"gmail_quote" style=3D"margin:0;margin-left:0.8ex;border-left:1px #ccc soli=
d;padding-left:1ex"><span class=3D""><div dir=3D"ltr">Yes, just remove what=
 you have, clone the repo fresh, and then run=C2=A0<blockquote class=3D"gma=
il_quote" style=3D"margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,2=
04,204);padding-left:1ex"><br>cd singularity=C2=A0</blockquote><blockquote =
class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-left:1px sol=
id rgb(204,204,204);padding-left:1ex">./autogen.sh<br>./configure --prefix=
=3D/usr/local<br>make<br>sudo make install</blockquote><div><br></div></div=
></span><div><div class=3D"h5"><div><br><div class=3D"gmail_quote">On Thu, =
Aug 3, 2017 at 5:39 PM, toufique <span dir=3D"ltr">&lt;<a rel=3D"nofollow">=
te...@gmail.com</a>&gt;</span> wrote:<br><blockquote class=3D"gmail_quote" =
style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><di=
v dir=3D"ltr">hi Vanessa,=C2=A0<div><br></div><div>what did you mean by try=
ing a new install with no changes in the config?=C2=A0 I can reinstall 2.3.=
1 ( in a different install location) =C2=A0-- is that what you meant?=C2=A0=
 Do I need to install ( ./configure, make, make install) as myself or &#39;=
root&#39;? Does it help installing this as myself? =C2=A0are there any plan=
s to fix this bug? If not, should I try an older version of singularity? =
=C2=A0</div><div><br></div><div>thanks.<span><br><br>On Thursday, August 3,=
 2017 at 2:11:04 PM UTC-7, vanessa wrote:</span><blockquote class=3D"gmail_=
quote" style=3D"margin:0;margin-left:0.8ex;border-left:1px #ccc solid;paddi=
ng-left:1ex"><span><div dir=3D"ltr">I think the line where it&#39;s hitting=
 a bug is here:<div><br></div><div><a href=3D"https://github.com/singularit=
yware/singularity/blob/adf5259ac94d7b213c649f073dcda32459b0c8b7/src/util/su=
id.c#L80" rel=3D"nofollow" target=3D"_blank">https://github.com/singularity=
<wbr>ware/singularity/blob/adf5259a<wbr>c94d7b213c649f073dcda32459b0c8<wbr>=
b7/src/util/suid.c#L80</a><br></div><div><br></div><div>Specifically somewh=
ere after this command:</div><blockquote class=3D"gmail_quote" style=3D"mar=
gin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1=
ex"><br><span style=3D"color:rgb(36,41,46);font-family:SFMono-Regular,Conso=
las,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;font-size:12px;whit=
e-space:pre-wrap;background-color:rgb(255,251,221)">( </span><span style=3D=
"color:rgb(0,92,197);font-family:SFMono-Regular,Consolas,&quot;Liberation M=
ono&quot;,Menlo,Courier,monospace;font-size:12px;white-space:pre-wrap">sing=
ularity_registry_get</span><span style=3D"color:rgb(36,41,46);font-family:S=
FMono-Regular,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;=
font-size:12px;white-space:pre-wrap;background-color:rgb(255,251,221)">(</s=
pan><span style=3D"color:rgb(3,47,98);font-family:SFMono-Regular,Consolas,&=
quot;Liberation Mono&quot;,Menlo,Courier,monospace;font-size:12px;white-spa=
ce:pre-wrap"><span>&quot;</span>NOSU<wbr>ID<span>&quot;</span></span><span =
style=3D"color:rgb(36,41,46);font-family:SFMono-Regular,Consolas,&quot;Libe=
ration Mono&quot;,Menlo,Courier,monospace;font-size:12px;white-space:pre-wr=
ap;background-color:rgb(255,251,221)">) !=3D </span><span style=3D"color:rg=
b(0,92,197);font-family:SFMono-Regular,Consolas,&quot;Liberation Mono&quot;=
,Menlo,Courier,monospace;font-size:12px;white-space:pre-wrap">NULL</span><s=
pan style=3D"color:rgb(36,41,46);font-family:SFMono-Regular,Consolas,&quot;=
Liberation Mono&quot;,Menlo,Courier,monospace;font-size:12px;white-space:pr=
e-wrap;background-color:rgb(255,251,221)"> )</span></blockquote><div><br></=
div><div><br></div><div>When I run a similar command, I see the following:<=
/div><div><br></div><div><blockquote class=3D"gmail_quote" style=3D"margin:=
0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex">=
VERBOSE [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_suid_init() =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Running SUID pr=
ogram workflow<br>VERBOSE [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity=
_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 Checking program has appropriate permissions<br>VERBOSE [U=3D0,P=3D29387] =
=C2=A0 =C2=A0 =C2=A0singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Checking configuration file is properly own=
ed by root<br>VERBOSE [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_sui=
d_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Che=
cking if singularity.conf allows us to run as suid<br>DEBUG =C2=A0 [U=3D0,P=
=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_config_get_bool_c<wbr>har_impl() =
=C2=A0 Called singularity_config_get_bool(al<wbr>low setuid, yes)<br>DEBUG =
=C2=A0 [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_config_get_value_<=
wbr>impl() =C2=A0 =C2=A0 =C2=A0 Returning configuration value allow setuid=
=3D&#39;yes&#39;<br>DEBUG =C2=A0 [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0sing=
ularity_config_get_bool_c<wbr>har_impl() =C2=A0 Return singularity_config_g=
et_bool(al<wbr>low setuid, yes) =3D 1<br>DEBUG =C2=A0 [U=3D0,P=3D29387] =C2=
=A0 =C2=A0 =C2=A0singularity_registry_get() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0Returning NULL on &#39;NOSUID&#39;<br>VERBOSE [U=3D=
0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_priv_userns() =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Invoking the user namespace</bloc=
kquote><div><br></div><div>and I return NULL too, but it doesn&#39;t error =
out. So you don&#39;t get to the last line to invoke the user namespace... =
I&#39;m not completely sure about the issue, but given centos 6, I bet you =
it has to do with the OS / version.=C2=A0 Do others have thoughts? Could yo=
u try a completely new install with no changes to the config, and do a simp=
le shell for some docker:// uri so I can recreate your use case exactly?</d=
iv></div><div><br></div><div><br></div></div></span><div><div><div><br><div=
 class=3D"gmail_quote">On Thu, Aug 3, 2017 at 4:45 PM, toufique <span dir=
=3D"ltr">&lt;<a rel=3D"nofollow">te...@gmail.com</a>&gt;</span> wrote:<br><=
blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px=
 #ccc solid;padding-left:1ex"><div dir=3D"ltr">Hi Vanessa,<div><br></div><d=
iv>command:=C2=A0</div><div><br></div><div>singularity --debug create --siz=
e 30000 /tmp/debian_jessie_tvb_1.img . (not that this time i tried creating=
 the container in /tmp .=C2=A0 So, no involvment of NFS here for the contai=
ner)=C2=A0<br></div><div><br></div><div><br></div><div>Here is the debug ou=
tput:</div><div><br></div><div><div>Enabling debugging</div><div>Ending arg=
ument loop</div><span><div>Singularity version: 2.3.1-dist</div><div>Exec&#=
39;ing: /data/apps/singularity/2.3.1/l<wbr>ibexec/singularity/cli/create.<w=
br>exec</div></span><div>VERBOSE [U=3D2527,P=3D48257] =C2=A0 message_init()=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0Set messagelevel to: 5</div><div>^[[0mVERBOSE [U=3D=
2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Initialize configuration file: /data/apps/si=
ngularity/2.3.1/e<wbr>tc/singularity/singularity.con<wbr>f</div><div>^[[0mD=
EBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Starting parse of configura=
tion file /data/apps/singularity/2.3.1/e<wbr>tc/singularity/singularity.con=
<wbr>f</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_confi=
g_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config=
 key allow setuid =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48=
257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0Got config key max loop devices =3D &#39;256&#39;</div>=
<div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key allow=
 pid ns =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=
=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0Got config key config passwd =3D &#39;yes&#39;</div><div>^[[0m=
VERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key config group =
=3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singul=
arity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0Got config key config resolv_conf =3D &#39;yes&#39;</div><div>^[[0mVERBO=
SE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key mount proc =3D &#39;ye=
s&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_confi=
g_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config=
 key mount sys =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257=
] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0Got config key mount dev =3D &#39;yes&#39;</div><div>^[[0m=
VERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key mount home =3D =
&#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularit=
y_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got=
 config key mount tmp =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=
=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0Got config key mount hostfs =3D &#39;no&#39;</div><=
div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key bind pat=
h =3D &#39;/etc/localtime&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =
=C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0Got config key bind path =3D &#39;/etc/hosts&#39;</div><div>^=
[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key bind path =
=3D &#39;/dfs1&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 sing=
ularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0Got config key bind path =3D &#39;/dfs2&#39;</div><div>^[[0mVERBOSE [U=
=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key bind path =3D &#39;/data&#=
39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_p=
arse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config ke=
y user bind control =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D=
48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0Got config key enable overlay =3D &#39;yes&#39;</div><=
div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key mount sl=
ave =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 si=
ngularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0Got config key sessiondir max size =3D &#39;16&#39;</div><div>^[[0mDE=
BUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Finished parsing configurat=
ion file &#39;/data/apps/singularity/2.3.1/<wbr>etc/singularity/<a href=3D"=
http://singularity.co" rel=3D"nofollow" target=3D"_blank">singularity.co</a=
><wbr>nf&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularit=
y_registry_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Initiali=
zing Singularity Registry</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=
=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0Adding value to registry: &#39;WRITABLE&#39; =3D &#39;1&#39;</=
div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry=
_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning sin=
gularity_registry_set(WRITA<wbr>BLE, 1) =3D 0</div><div>^[[0mVERBOSE [U=3D2=
527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &#39;LIBEXECDIR&#3=
9; =3D &#39;/data/apps/singularity/2.3.1/<wbr>libexec&#39;</div><div>^[[0mD=
EBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_regis=
try_set(libex<wbr>ecdir, /data/apps/singularity/2.3.1/l<wbr>ibexec) =3D 0</=
div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set(=
) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to re=
gistry: &#39;COMMAND&#39; =3D &#39;create&#39;</div><div>^[[0mDEBUG =C2=A0 =
[U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_registry_set(COMMA=
<wbr>ND, create) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 s=
ingularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0Adding value to registry: &#39;IMAGESIZE&#39; =3D &#39;30000&#39;</di=
v><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_s=
et() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singu=
larity_registry_set(IMAGE<wbr>SIZE, 30000) =3D 0</div><div>^[[0mVERBOSE [U=
=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &#39;MESSAGELEV=
EL&#39; =3D &#39;5&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =
=C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0Returning singularity_registry_set(MESSA<wbr>GELEVEL, 5) =3D =
0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_s=
et() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to=
 registry: &#39;VERSION&#39; =3D &#39;2.3.1-dist&#39;</div><div>^[[0mDEBUG =
=C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_registry_se=
t(versi<wbr>on, 2.3.1-dist) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D4825=
7] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0Adding value to registry: &#39;LOCALSTATEDIR&#39; =3D &#39=
;/data/apps/singularity/2.3.1/<wbr>var&#39;</div><div>^[[0mDEBUG =C2=A0 [U=
=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_registry_set(local<=
wbr>statedir, /data/apps/singularity/2.3.1/v<wbr>ar) =3D 0</div><div>^[[0mV=
ERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &#39;SY=
SCONFDIR&#39; =3D &#39;/data/apps/singularity/2.3.1/<wbr>etc&#39;</div><div=
>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularit=
y_registry_set(sysco<wbr>nfdir, /data/apps/singularity/2.3.1/e<wbr>tc) =3D =
0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_s=
et() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to=
 registry: &#39;BINDIR&#39; =3D &#39;/data/apps/singularity/2.3.1/<wbr>bin&=
#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_re=
gistry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returni=
ng singularity_registry_set(bindi<wbr>r, /data/apps/singularity/2.3.1/b<wbr=
>in) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_r=
egistry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding=
 value to registry: &#39;IMAGE&#39; =3D &#39;/tmp/debian_jessie_tvb_1.img&#=
39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_reg=
istry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returnin=
g singularity_registry_set(IMAGE<wbr>, /tmp/debian_jessie_tvb_1.img) =3D 0<=
/div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registr=
y_get() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning NU=
LL on &#39;HOME&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=
=A0 singularity_registry_get() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0Returning NULL on &#39;TARGET_UID&#39;</div><div>^[[0mDEBUG =
=C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_get() =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning NULL on &#39;TARGET_GID=
&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_p=
riv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 I=
nitializing user info</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=
=A0 singularity_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 Set the calling user&#39;s username to: itoufiqu</div><di=
v>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_priv_init() =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Marking uinfo s=
tructure as ready</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 s=
ingularity_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 Obtaining home directory</div><div>^[[0mVERBOSE [U=3D2527,P=3D48=
257] =C2=A0 singularity_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 Set home (via getpwuid()) to: /data/users/itoufiqu=
</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_suid_init()=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Running SUI=
D program workflow</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singu=
larity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 Checking program has appropriate permissions</div><div>^[[0mVERBOSE =
[U=3D2527,P=3D48257] =C2=A0 singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Checking configuration file is pr=
operly owned by root</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 sin=
gularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 Checking if singularity.conf allows us to run as suid</div><div>=
^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_config_get_bool_c=
h<wbr>ar_impl() =C2=A0 Called singularity_config_get_bool(al<wbr>low setuid=
, yes)</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_=
config_get_value_i<wbr>mpl() =C2=A0 =C2=A0 =C2=A0 Returning configuration v=
alue allow setuid=3D&#39;yes&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=
=3D48257] =C2=A0 singularity_config_get_bool_ch<wbr>ar_impl() =C2=A0 Return=
 singularity_config_get_bool(al<wbr>low setuid, yes) =3D 1</div><div>^[[0mD=
EBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_get() =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning NULL on &#39;NOSU=
ID&#39;</div><div>^[[0m^[[91mERROR =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singu=
larity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 Singularity is not running with appropriate privileges!</div><div>^[=
[0m^[[91mERROR =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_suid_init() =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Check instal=
lation path is not mounted with &#39;nosuid&#39;, and/or consult manual.</d=
iv><div>^[[0m^[[31mABORT =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_sui=
d_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Ret=
val =3D 255</div><div><br></div><div><br></div><div>Some info on the host, =
let me know if you need more info:=C2=A0</div><div><br></div><div><br></div=
><div>[itoufiqu@compute-7-2 2.3.1]$ cat /etc/redhat-release =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=C2=A0<br></div><div><div>CentOS release =
6.8 (Final) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0</div><div>[itoufiqu@compute-7-2 2.3.1]$ uname -a =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=C2=A0</div><div>Linux =
compute-7-2.local 3.10.104-1.el6.elrepo.x86_64 #1 SMP Fri Oct 21 10:27:14 E=
DT 2016 x86_64 x86_64 x86_64 GNU/Linux =C2=A0</div></div><div><br></div><di=
v>Thanks again!</div><span><div><br></div>On Thursday, August 3, 2017 at 1:=
38:02 PM UTC-7, vanessa wrote:</span><blockquote class=3D"gmail_quote" styl=
e=3D"margin:0;margin-left:0.8ex;border-left:1px #ccc solid;padding-left:1ex=
"><span><div dir=3D"ltr">Could you please show the output with --debug and =
singularity --version?<div><br></div><blockquote class=3D"gmail_quote" styl=
e=3D"margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);paddin=
g-left:1ex"><span style=3D"font-size:12.8px">singularity --debug create --s=
ize 30000 /tmp/debian_jessie_tvb.img</span><span style=3D"font-size:12.8px"=
><br></span><span style=3D"font-size:12.8px">singularity --version</span></=
blockquote><div><br></div><div>and also throw in information about the host=
, if easy to get :)=C2=A0</div></div></span><div><br><div class=3D"gmail_qu=
ote"><div><div>On Thu, Aug 3, 2017 at 4:24 PM, toufique <span dir=3D"ltr">&=
lt;<a rel=3D"nofollow">te...@gmail.com</a>&gt;</span> wrote:<br></div></div=
><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1=
px #ccc solid;padding-left:1ex"><div><div><div dir=3D"ltr">Hi Vanessa,<div>=
<br></div><div>I finally had some time to look into this earlier today.=C2=
=A0 Per your suggestion, I tried creating a container as myself, no luck:=
=C2=A0<br><br><div>[itoufiqu@compute-7-2 ~]$ singularity -v create --size 3=
0000 /tmp/debian_jessie_tvb.img</div><div>Increasing verbosity level (2)</d=
iv><div>Singularity version: 2.3.1-dist</div><div>Exec&#39;ing: /data/apps/=
singularity/2.3.1/l<wbr>ibexec/singularity/cli/create.<wbr>exec</div><div>V=
ERBOSE: Set messagelevel to: 2</div><div>VERBOSE: Initialize configuration =
file: /data/apps/singularity/2.3.1/e<wbr>tc/singularity/singularity.con<wbr=
>f</div><div>VERBOSE: Initializing Singularity Registry</div><span><div>ERR=
OR =C2=A0: Singularity is not running with appropriate privileges!</div><di=
v>ERROR =C2=A0: Check installation path is not mounted with &#39;nosuid&#39=
;, and/or consult manual.</div><div>ABORT =C2=A0: Retval =3D 255</div><div>=
<br></div></span><div>[itoufiqu@compute-7-2 ~]$ whoami</div><div><span styl=
e=3D"color:inherit;font-size:inherit">itoufiqu</span><br></div><div><br></d=
iv><div><br></div><div>singularity was installed as &#39;root&#39; .=C2=A0 =
Below is the config file:=C2=A0</div><div><br></div><div><div>allow setuid =
=3D yes</div><div>max loop devices =3D 256</div><div>config passwd =3D yes<=
/div><div>config group =3D yes</div><div>config resolv_conf =3D yes</div><d=
iv>mount proc =3D yes</div><div>mount sys =3D yes</div><div>mount dev =3D y=
es</div><div>mount home =3D yes</div><div>mount tmp =3D yes</div><div>mount=
 hostfs =3D no</div><div>bind path =3D /etc/localtime</div><div>bind path =
=3D /etc/hosts</div><div>bind path =3D /dfs1</div><div>bind path =3D /dfs2<=
/div><div>bind path =3D /data</div><div>user bind control =3D yes</div><div=
>enable overlay =3D yes</div><div>mount slave =3D yes</div><div>sessiondir =
max size =3D 16</div></div><div><br></div><div>What do I need to do get thi=
s fixed, please?</div><div><br></div><div>thanks.</div><div><div><div><br><=
/div><div><br></div>On Thursday, July 27, 2017 at 5:35:33 PM UTC-7, toufiqu=
e wrote:<blockquote class=3D"gmail_quote" style=3D"margin:0;margin-left:0.8=
ex;border-left:1px #ccc solid;padding-left:1ex"><div dir=3D"ltr">Hi,=C2=A0<=
div><br></div><div>I am sure this has been discussed in this forum.</div><d=
iv><br></div><div>I have a container that I have setup as &#39;root&#39; .=
=C2=A0Now when I go about using that container to get (even) a &#39;shell&#=
39; off the container, I get the error below:<br><br><div>./singularity she=
ll /tmp/singularity_containers/de<wbr>bian_latest.img =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0</div>=
<div>ERROR =C2=A0: Singularity is not running with appropriate privileges!<=
/div><div>ERROR =C2=A0: Check installation path is not mounted with &#39;no=
suid&#39;, and/or consult manual.</div><div>ABORT =C2=A0: Retval =3D 255</d=
iv></div><div><br></div><div>How do I fix this so, I can install containers=
 as a &#39;root&#39; user but still be able to run - =C2=A0&#39;exec&#39; ,=
 &#39;run&#39;, &#39;shell&#39; commands as a regular user?</div><div><br><=
/div><div>Thanks for your help!</div></div></blockquote></div></div></div><=
/div></div></div><div><div><div><div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br></div></div>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a rel=3D"nofollow">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><span><br><br clear=3D"all"><div><br></div>-=
- <br><div>Vanessa Villamia Sochat<br>Stanford University &#39;16<br><div><=
div><div><a value=3D"+16033210676">(603) 321-0676</a></div></div></div></di=
v>
</span></div>
</blockquote></div></div><div><div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a rel=3D"nofollow">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
<div>Vanessa Villamia Sochat<br>Stanford University &#39;16<br><div><div><d=
iv><a value=3D"+16033210676">(603) 321-0676</a></div></div></div></div>
</div>
</div></div></blockquote></div></div><div><div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a rel=3D"nofollow">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
<div>Vanessa Villamia Sochat<br>Stanford University &#39;16<br><div><div><d=
iv><a href=3D"tel:(603)%20321-0676" value=3D"+16033210676" target=3D"_blank=
">(603) 321-0676</a></div></div></div></div>
</div>
</div></div></blockquote></div></div></div></div><div class=3D"HOEnZb"><div=
 class=3D"h5">

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.<wbr>gov</a>.<br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
<div class=3D"gmail_signature" data-smartmail=3D"gmail_signature">Vanessa V=
illamia Sochat<br>Stanford University &#39;16<br><div><div><div>(603) 321-0=
676</div></div></div></div>
</div>

--94eb2c095a3605fd010555e4e430--
