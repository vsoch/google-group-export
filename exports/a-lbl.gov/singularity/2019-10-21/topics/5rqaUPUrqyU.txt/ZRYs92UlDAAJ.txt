X-Received: by 10.36.23.133 with SMTP id 127mr29800ith.18.1501797272999;
        Thu, 03 Aug 2017 14:54:32 -0700 (PDT)
X-BeenThere: singularity@lbl.gov
Received: by 10.107.192.65 with SMTP id q62ls2245939iof.0.gmail; Thu, 03 Aug
 2017 14:54:25 -0700 (PDT)
X-Received: by 10.98.138.197 with SMTP id o66mr218608pfk.207.1501797265361;
        Thu, 03 Aug 2017 14:54:25 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1501797265; cv=none;
        d=google.com; s=arc-20160816;
        b=lhQQSNbX6Ww4TLo0DSUPCK1RmAjC6sNj4BIWWSWpMuwb2s/ka15j49AJypj/bevwN6
         sKxCrVLVr3XA7zUVNhhKg+amc41ZV4cX97HzBmPyagiVXHY3hiZjb5j4dCghQ/9lb1Mb
         iIFdfGAaZ0dEAKoKdJ/X1THFsOwkzd4yctrrJ4fhMRsUdqeHBBitiF0Ev2lz/2D+vE1g
         nXGPAMaCfq7ZqBkW9kHGRukqwPlCFOqDCFJtyUils62Yqgwrgi0UTb4LpTP5lLCt9di9
         3iPS/FD3ay1BXHZW40ST9No6aW5d9cjeVvdW6bE/gejMcb2KDNgmo4aPky/WWwE0VD5n
         xrtA==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=to:subject:message-id:date:from:references:in-reply-to:mime-version
         :dkim-signature:arc-authentication-results;
        bh=b2bmBLL+GGLQJzcw94pj8dJhG7B+ApO9H4dqcHLZcYM=;
        b=jZU0tvWhaDQEzAHO+efPEL/D/uDBuiKwY0qeTiRD2+r5vC4jF7R69t7imeeyhcc4FK
         0JDxM1ncVz99x8Uv0bfYvy8cI20aI8+UnqlILOrbuG4L1UH4mjTwFwC5BLVSeEsufNHj
         vjFn3Dpx2ONxfpCgaaMyYbhIkQZf4IswePaoDEmNlaT8ojQRfmDftNtSl/vdGHLjjhTW
         5EQpp8ngRIh+Te7a5Nx9wG1XbcYkh5sRU+uFWfrB0wuX2WoOWNiMSEiyeP3gmg0443Mx
         ExW29RnsmWmF9E6ENOrEJ0WGV63ECuogEbtw/StZOHkuZtJ+WJe4cTdyu0qc3VbRrp7q
         QNxg==
ARC-Authentication-Results: i=1; mx.google.com;
       dkim=pass head...@gmail.com header.b=e8U39vyp;
       spf=pass (google.com: domain of vso...@gmail.com designates 209.85.217.172 as permitted sender) smtp.mailfrom=vso...@gmail.com
Return-Path: <vso...@gmail.com>
Received: from fe3.lbl.gov (fe3.lbl.gov. [128.3.41.68])
        by mx.google.com with ESMTP id 14si1562129plf.625.2017.08.03.14.54.25
        for <singu...@lbl.gov>;
        Thu, 03 Aug 2017 14:54:25 -0700 (PDT)
Received-SPF: pass (google.com: domain of vso...@gmail.com designates 209.85.217.172 as permitted sender) client-ip=209.85.217.172;
Authentication-Results: mx.google.com;
       dkim=pass head...@gmail.com header.b=e8U39vyp;
       spf=pass (google.com: domain of vso...@gmail.com designates 209.85.217.172 as permitted sender) smtp.mailfrom=vso...@gmail.com
X-Ironport-SBRS: 3.4
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A2FbAQDFmoNZhqzZVdFaAxwBAQQBAQoBA?=
 =?us-ascii?q?RcBAQQBAQoBAYJEQIEPgRQHg2eBPohjkAiBElyCcJMlDoFBQAMhAQ6BCYIvgV8?=
 =?us-ascii?q?ChDcHPxgBAQEBAQEBAQEBAQIQAQEBCAsLCCgvgjMFAgMaBgQERikuAQEBAQEBA?=
 =?us-ascii?q?QEBAQEBAQEBARoCDR4EOwEBAQECARoJHQENDh4DAQsGAwILDSABCQICIQEBDgM?=
 =?us-ascii?q?BBQELEQ4HBAEcBIg8gTkBAw0IBQuPaZEbP4wKggQFARyDCQWDXAoZJw1WgysBA?=
 =?us-ascii?q?QEBBgEBAQEBAQEBARcCBhKDFoICgy+DJ4JXKYFAARIBQAwagkyCYQWKYI0Lh1Y?=
 =?us-ascii?q?8h1OHaYRxgg9ZhH+KYYwoDYRPPoJ3FB+BFR+BBTMLdxVjhG4PEAyCAyQ2BQOGc?=
 =?us-ascii?q?0eBawEBAQ?=
X-IronPort-AV: E=Sophos;i="5.41,317,1498546800"; 
   d="scan'208,217";a="84325994"
Received: from mail-ua0-f172.google.com ([209.85.217.172])
  by fe3.lbl.gov with ESMTP; 03 Aug 2017 14:54:18 -0700
Received: by mail-ua0-f172.google.com with SMTP id q25so12026403uah.1
        for <singu...@lbl.gov>; Thu, 03 Aug 2017 14:54:18 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to;
        bh=b2bmBLL+GGLQJzcw94pj8dJhG7B+ApO9H4dqcHLZcYM=;
        b=e8U39vypfr/vLFrIDhEEbm9rcaH8yXEvkV9/9fxJiX15kdu3aooKKoRVykTUsMFZkg
         7lwuR1eK/84ylqaWOJDlzuNEtcuiHOyxbf6ed2Jo+FpU0pqxqNqvicaxUEnUKwVoUIyD
         /isaEpfJqd5QmRmmvEZ0UE3Na208rvI8MPvY68vhHEJTK6nghAs8kWksxvBEIGYRTSS/
         dZIPEuOV4CGfIcVyTBllRliLDoDb8Vg8OsoYYSLfk8J+MlB+jbKCAOxfMQdDlU7S8yrt
         bnx5Ij0hdc8uSJpXYF4BFnCaUrJdHXRVIFfxO20/GdP6EAyfv6r9PGi+JCEEtNcKISs7
         fy6Q==
X-Gm-Message-State: AHYfb5jfiUUdQ5QtKD0N7F8vdrw2323WXuVQlAOYiVA2hmD24srW5EzU
	D1rYRoJmKDj1G8F4zP8qTb8L5sky6IfA
X-Received: by 10.176.64.166 with SMTP id i35mr216259uad.42.1501797257973;
 Thu, 03 Aug 2017 14:54:17 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.103.69.84 with HTTP; Thu, 3 Aug 2017 14:53:57 -0700 (PDT)
In-Reply-To: <a396e8fe-fae0-4c4c-8b76-9724a48bd84c@lbl.gov>
References: <9d25d29a-08d9-4bc4-bbcf-3327a841b3da@lbl.gov> <e847efae-1f98-4eb2-b2b5-1bf80c0a3476@lbl.gov>
 <CAM=pu+K1A92qd8JBPT9NhHrP_Pv-OPf-cnkNVCfqxeMKbH4MRg@mail.gmail.com>
 <e8470d35-8671-4736-91d8-9b68ba47e24c@lbl.gov> <CAM=pu+Lc-9f8+7vjkPLy-Fd3OYM_XSEtoTYrusgGkU-=P58VYg@mail.gmail.com>
 <a396e8fe-fae0-4c4c-8b76-9724a48bd84c@lbl.gov>
From: vanessa s <vso...@gmail.com>
Date: Thu, 3 Aug 2017 17:53:57 -0400
Message-ID: <CAM=pu+J1ehSAubYr=cNVysyyBE++uhJv=vEL0u_LFMT9RPdY+g@mail.gmail.com>
Subject: Re: [Singularity] Re: can't run singularity exec as a regular user
To: singularity@lbl.gov
Content-Type: multipart/alternative; boundary="94eb2c1243b21614910555e06c12"

--94eb2c1243b21614910555e06c12
Content-Type: text/plain; charset="UTF-8"

Yes, just remove what you have, clone the repo fresh, and then run
>
>
> cd singularity

./autogen.sh
> ./configure --prefix=/usr/local
> make
> sudo make install



On Thu, Aug 3, 2017 at 5:39 PM, toufique <tech...@gmail.com> wrote:

> hi Vanessa,
>
> what did you mean by trying a new install with no changes in the config?
> I can reinstall 2.3.1 ( in a different install location)  -- is that what
> you meant?  Do I need to install ( ./configure, make, make install) as
> myself or 'root'? Does it help installing this as myself?  are there any
> plans to fix this bug? If not, should I try an older version of
> singularity?
>
> thanks.
>
> On Thursday, August 3, 2017 at 2:11:04 PM UTC-7, vanessa wrote:
>>
>> I think the line where it's hitting a bug is here:
>>
>> https://github.com/singularityware/singularity/blob/adf5259a
>> c94d7b213c649f073dcda32459b0c8b7/src/util/suid.c#L80
>>
>> Specifically somewhere after this command:
>>
>>>
>>> ( singularity_registry_get("NOSUID") != NULL )
>>
>>
>>
>> When I run a similar command, I see the following:
>>
>> VERBOSE [U=0,P=29387]      singularity_suid_init()
>>> Running SUID program workflow
>>> VERBOSE [U=0,P=29387]      singularity_suid_init()
>>> Checking program has appropriate permissions
>>> VERBOSE [U=0,P=29387]      singularity_suid_init()
>>> Checking configuration file is properly owned by root
>>> VERBOSE [U=0,P=29387]      singularity_suid_init()
>>> Checking if singularity.conf allows us to run as suid
>>> DEBUG   [U=0,P=29387]      singularity_config_get_bool_char_impl()
>>> Called singularity_config_get_bool(allow setuid, yes)
>>> DEBUG   [U=0,P=29387]      singularity_config_get_value_impl()
>>> Returning configuration value allow setuid='yes'
>>> DEBUG   [U=0,P=29387]      singularity_config_get_bool_char_impl()
>>> Return singularity_config_get_bool(allow setuid, yes) = 1
>>> DEBUG   [U=0,P=29387]      singularity_registry_get()
>>>  Returning NULL on 'NOSUID'
>>> VERBOSE [U=0,P=29387]      singularity_priv_userns()
>>> Invoking the user namespace
>>
>>
>> and I return NULL too, but it doesn't error out. So you don't get to the
>> last line to invoke the user namespace... I'm not completely sure about the
>> issue, but given centos 6, I bet you it has to do with the OS / version.
>> Do others have thoughts? Could you try a completely new install with no
>> changes to the config, and do a simple shell for some docker:// uri so I
>> can recreate your use case exactly?
>>
>>
>>
>> On Thu, Aug 3, 2017 at 4:45 PM, toufique <te...@gmail.com> wrote:
>>
>>> Hi Vanessa,
>>>
>>> command:
>>>
>>> singularity --debug create --size 30000 /tmp/debian_jessie_tvb_1.img .
>>> (not that this time i tried creating the container in /tmp .  So, no
>>> involvment of NFS here for the container)
>>>
>>>
>>> Here is the debug output:
>>>
>>> Enabling debugging
>>> Ending argument loop
>>> Singularity version: 2.3.1-dist
>>> Exec'ing: /data/apps/singularity/2.3.1/libexec/singularity/cli/create.
>>> exec
>>> VERBOSE [U=2527,P=48257]   message_init()                            Set
>>> messagelevel to: 5
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Initialize configuration file: /data/apps/singularity/2.3.1/e
>>> tc/singularity/singularity.conf
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_parse()
>>>  Starting parse of configuration file /data/apps/singularity/2.3.1/e
>>> tc/singularity/singularity.conf
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key allow setuid = 'yes'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key max loop devices = '256'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key allow pid ns = 'yes'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key config passwd = 'yes'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key config group = 'yes'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key config resolv_conf = 'yes'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key mount proc = 'yes'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key mount sys = 'yes'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key mount dev = 'yes'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key mount home = 'yes'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key mount tmp = 'yes'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key mount hostfs = 'no'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key bind path = '/etc/localtime'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key bind path = '/etc/hosts'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key bind path = '/dfs1'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key bind path = '/dfs2'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key bind path = '/data'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key user bind control = 'yes'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key enable overlay = 'yes'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key mount slave = 'yes'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()
>>>  Got config key sessiondir max size = '16'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_parse()
>>>  Finished parsing configuration file '/data/apps/singularity/2.3.1/
>>> etc/singularity/singularity.conf'
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_init()
>>>   Initializing Singularity Registry
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>  Adding value to registry: 'WRITABLE' = '1'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>  Returning singularity_registry_set(WRITABLE, 1) = 0
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>  Adding value to registry: 'LIBEXECDIR' = '/data/apps/singularity/2.3.1/
>>> libexec'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>  Returning singularity_registry_set(libexecdir,
>>> /data/apps/singularity/2.3.1/libexec) = 0
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>  Adding value to registry: 'COMMAND' = 'create'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>  Returning singularity_registry_set(COMMAND, create) = 0
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>  Adding value to registry: 'IMAGESIZE' = '30000'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>  Returning singularity_registry_set(IMAGESIZE, 30000) = 0
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>  Adding value to registry: 'MESSAGELEVEL' = '5'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>  Returning singularity_registry_set(MESSAGELEVEL, 5) = 0
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>  Adding value to registry: 'VERSION' = '2.3.1-dist'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>  Returning singularity_registry_set(version, 2.3.1-dist) = 0
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>  Adding value to registry: 'LOCALSTATEDIR' = '/data/apps/singularity/2.3.1/
>>> var'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>  Returning singularity_registry_set(localstatedir,
>>> /data/apps/singularity/2.3.1/var) = 0
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>  Adding value to registry: 'SYSCONFDIR' = '/data/apps/singularity/2.3.1/
>>> etc'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>  Returning singularity_registry_set(sysconfdir,
>>> /data/apps/singularity/2.3.1/etc) = 0
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>  Adding value to registry: 'BINDIR' = '/data/apps/singularity/2.3.1/bin'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>  Returning singularity_registry_set(bindir,
>>> /data/apps/singularity/2.3.1/bin) = 0
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()
>>>  Adding value to registry: 'IMAGE' = '/tmp/debian_jessie_tvb_1.img'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()
>>>  Returning singularity_registry_set(IMAGE,
>>> /tmp/debian_jessie_tvb_1.img) = 0
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()
>>>  Returning NULL on 'HOME'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()
>>>  Returning NULL on 'TARGET_UID'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()
>>>  Returning NULL on 'TARGET_GID'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()
>>>   Initializing user info
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()
>>>   Set the calling user's username to: itoufiqu
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()
>>>   Marking uinfo structure as ready
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()
>>>   Obtaining home directory
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_priv_init()
>>>   Set home (via getpwuid()) to: /data/users/itoufiqu
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()
>>>   Running SUID program workflow
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()
>>>   Checking program has appropriate permissions
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()
>>>   Checking configuration file is properly owned by root
>>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()
>>>   Checking if singularity.conf allows us to run as suid
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_get_bool_char_impl()
>>>   Called singularity_config_get_bool(allow setuid, yes)
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_get_value_impl()
>>>   Returning configuration value allow setuid='yes'
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_get_bool_char_impl()
>>>   Return singularity_config_get_bool(allow setuid, yes) = 1
>>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()
>>>  Returning NULL on 'NOSUID'
>>> ^[[0m^[[91mERROR   [U=2527,P=48257]   singularity_suid_init()
>>>         Singularity is not running with appropriate privileges!
>>> ^[[0m^[[91mERROR   [U=2527,P=48257]   singularity_suid_init()
>>>         Check installation path is not mounted with 'nosuid', and/or
>>> consult manual.
>>> ^[[0m^[[31mABORT   [U=2527,P=48257]   singularity_suid_init()
>>>         Retval = 255
>>>
>>>
>>> Some info on the host, let me know if you need more info:
>>>
>>>
>>> [itoufiqu@compute-7-2 2.3.1]$ cat /etc/redhat-release
>>>
>>> CentOS release 6.8 (Final)
>>>
>>> [itoufiqu@compute-7-2 2.3.1]$ uname -a
>>>
>>> Linux compute-7-2.local 3.10.104-1.el6.elrepo.x86_64 #1 SMP Fri Oct 21
>>> 10:27:14 EDT 2016 x86_64 x86_64 x86_64 GNU/Linux
>>>
>>> Thanks again!
>>>
>>> On Thursday, August 3, 2017 at 1:38:02 PM UTC-7, vanessa wrote:
>>>>
>>>> Could you please show the output with --debug and singularity --version?
>>>>
>>>> singularity --debug create --size 30000 /tmp/debian_jessie_tvb.img
>>>>> singularity --version
>>>>
>>>>
>>>> and also throw in information about the host, if easy to get :)
>>>>
>>>> On Thu, Aug 3, 2017 at 4:24 PM, toufique <te...@gmail.com> wrote:
>>>>
>>>>> Hi Vanessa,
>>>>>
>>>>> I finally had some time to look into this earlier today.  Per your
>>>>> suggestion, I tried creating a container as myself, no luck:
>>>>>
>>>>> [itoufiqu@compute-7-2 ~]$ singularity -v create --size 30000
>>>>> /tmp/debian_jessie_tvb.img
>>>>> Increasing verbosity level (2)
>>>>> Singularity version: 2.3.1-dist
>>>>> Exec'ing: /data/apps/singularity/2.3.1/libexec/singularity/cli/create.
>>>>> exec
>>>>> VERBOSE: Set messagelevel to: 2
>>>>> VERBOSE: Initialize configuration file: /data/apps/singularity/2.3.1/e
>>>>> tc/singularity/singularity.conf
>>>>> VERBOSE: Initializing Singularity Registry
>>>>> ERROR  : Singularity is not running with appropriate privileges!
>>>>> ERROR  : Check installation path is not mounted with 'nosuid', and/or
>>>>> consult manual.
>>>>> ABORT  : Retval = 255
>>>>>
>>>>> [itoufiqu@compute-7-2 ~]$ whoami
>>>>> itoufiqu
>>>>>
>>>>>
>>>>> singularity was installed as 'root' .  Below is the config file:
>>>>>
>>>>> allow setuid = yes
>>>>> max loop devices = 256
>>>>> config passwd = yes
>>>>> config group = yes
>>>>> config resolv_conf = yes
>>>>> mount proc = yes
>>>>> mount sys = yes
>>>>> mount dev = yes
>>>>> mount home = yes
>>>>> mount tmp = yes
>>>>> mount hostfs = no
>>>>> bind path = /etc/localtime
>>>>> bind path = /etc/hosts
>>>>> bind path = /dfs1
>>>>> bind path = /dfs2
>>>>> bind path = /data
>>>>> user bind control = yes
>>>>> enable overlay = yes
>>>>> mount slave = yes
>>>>> sessiondir max size = 16
>>>>>
>>>>> What do I need to do get this fixed, please?
>>>>>
>>>>> thanks.
>>>>>
>>>>>
>>>>> On Thursday, July 27, 2017 at 5:35:33 PM UTC-7, toufique wrote:
>>>>>>
>>>>>> Hi,
>>>>>>
>>>>>> I am sure this has been discussed in this forum.
>>>>>>
>>>>>> I have a container that I have setup as 'root' . Now when I go about
>>>>>> using that container to get (even) a 'shell' off the container, I get the
>>>>>> error below:
>>>>>>
>>>>>> ./singularity shell /tmp/singularity_containers/debian_latest.img
>>>>>>
>>>>>> ERROR  : Singularity is not running with appropriate privileges!
>>>>>> ERROR  : Check installation path is not mounted with 'nosuid', and/or
>>>>>> consult manual.
>>>>>> ABORT  : Retval = 255
>>>>>>
>>>>>> How do I fix this so, I can install containers as a 'root' user but
>>>>>> still be able to run -  'exec' , 'run', 'shell' commands as a regular user?
>>>>>>
>>>>>> Thanks for your help!
>>>>>>
>>>>> --
>>>>> You received this message because you are subscribed to the Google
>>>>> Groups "singularity" group.
>>>>> To unsubscribe from this group and stop receiving emails from it, send
>>>>> an email to singu...@lbl.gov.
>>>>>
>>>>
>>>>
>>>>
>>>> --
>>>> Vanessa Villamia Sochat
>>>> Stanford University '16
>>>> (603) 321-0676
>>>>
>>> --
>>> You received this message because you are subscribed to the Google
>>> Groups "singularity" group.
>>> To unsubscribe from this group and stop receiving emails from it, send
>>> an email to singu...@lbl.gov.
>>>
>>
>>
>>
>> --
>> Vanessa Villamia Sochat
>> Stanford University '16
>> (603) 321-0676
>>
> --
> You received this message because you are subscribed to the Google Groups
> "singularity" group.
> To unsubscribe from this group and stop receiving emails from it, send an
> email to singu...@lbl.gov.
>



-- 
Vanessa Villamia Sochat
Stanford University '16
(603) 321-0676

--94eb2c1243b21614910555e06c12
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Yes, just remove what you have, clone the repo fresh, and =
then run=C2=A0<blockquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px=
 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex"><br>cd sing=
ularity=C2=A0</blockquote><blockquote class=3D"gmail_quote" style=3D"margin=
:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex"=
>./autogen.sh<br>./configure --prefix=3D/usr/local<br>make<br>sudo make ins=
tall</blockquote><div><br></div></div><div class=3D"gmail_extra"><br><div c=
lass=3D"gmail_quote">On Thu, Aug 3, 2017 at 5:39 PM, toufique <span dir=3D"=
ltr">&lt;<a href=3D"mailto:tech...@gmail.com" target=3D"_blank">tech...@gma=
il.com</a>&gt;</span> wrote:<br><blockquote class=3D"gmail_quote" style=3D"=
margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir=3D"=
ltr">hi Vanessa,=C2=A0<div><br></div><div>what did you mean by trying a new=
 install with no changes in the config?=C2=A0 I can reinstall 2.3.1 ( in a =
different install location) =C2=A0-- is that what you meant?=C2=A0 Do I nee=
d to install ( ./configure, make, make install) as myself or &#39;root&#39;=
? Does it help installing this as myself? =C2=A0are there any plans to fix =
this bug? If not, should I try an older version of singularity? =C2=A0</div=
><div><br></div><div>thanks.<span class=3D""><br><br>On Thursday, August 3,=
 2017 at 2:11:04 PM UTC-7, vanessa wrote:</span><blockquote class=3D"gmail_=
quote" style=3D"margin:0;margin-left:0.8ex;border-left:1px #ccc solid;paddi=
ng-left:1ex"><span class=3D""><div dir=3D"ltr">I think the line where it&#3=
9;s hitting a bug is here:<div><br></div><div><a href=3D"https://github.com=
/singularityware/singularity/blob/adf5259ac94d7b213c649f073dcda32459b0c8b7/=
src/util/suid.c#L80" rel=3D"nofollow" target=3D"_blank">https://github.com/=
singularity<wbr>ware/singularity/blob/adf5259a<wbr>c94d7b213c649f073dcda324=
59b0c8<wbr>b7/src/util/suid.c#L80</a><br></div><div><br></div><div>Specific=
ally somewhere after this command:</div><blockquote class=3D"gmail_quote" s=
tyle=3D"margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);pad=
ding-left:1ex"><br><span style=3D"color:rgb(36,41,46);font-family:SFMono-Re=
gular,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;font-siz=
e:12px;white-space:pre-wrap;background-color:rgb(255,251,221)">( </span><sp=
an style=3D"color:rgb(0,92,197);font-family:SFMono-Regular,Consolas,&quot;L=
iberation Mono&quot;,Menlo,Courier,monospace;font-size:12px;white-space:pre=
-wrap">singularity_registry_get</span><span style=3D"color:rgb(36,41,46);fo=
nt-family:SFMono-Regular,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier=
,monospace;font-size:12px;white-space:pre-wrap;background-color:rgb(255,251=
,221)">(</span><span style=3D"color:rgb(3,47,98);font-family:SFMono-Regular=
,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;font-size:12p=
x;white-space:pre-wrap"><span>&quot;</span>NOSU<wbr>ID<span>&quot;</span></=
span><span style=3D"color:rgb(36,41,46);font-family:SFMono-Regular,Consolas=
,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;font-size:12px;white-s=
pace:pre-wrap;background-color:rgb(255,251,221)">) !=3D </span><span style=
=3D"color:rgb(0,92,197);font-family:SFMono-Regular,Consolas,&quot;Liberatio=
n Mono&quot;,Menlo,Courier,monospace;font-size:12px;white-space:pre-wrap">N=
ULL</span><span style=3D"color:rgb(36,41,46);font-family:SFMono-Regular,Con=
solas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;font-size:12px;wh=
ite-space:pre-wrap;background-color:rgb(255,251,221)"> )</span></blockquote=
><div><br></div><div><br></div><div>When I run a similar command, I see the=
 following:</div><div><br></div><div><blockquote class=3D"gmail_quote" styl=
e=3D"margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);paddin=
g-left:1ex">VERBOSE [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_suid_=
init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Runni=
ng SUID program workflow<br>VERBOSE [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0s=
ingularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 Checking program has appropriate permissions<br>VERBOSE [U=3D0,P=
=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Checking configuration file is pr=
operly owned by root<br>VERBOSE [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singu=
larity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 Checking if singularity.conf allows us to run as suid<br>DEBUG =C2=
=A0 [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_config_get_bool_c<wbr=
>har_impl() =C2=A0 Called singularity_config_get_bool(al<wbr>low setuid, ye=
s)<br>DEBUG =C2=A0 [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_config=
_get_value_<wbr>impl() =C2=A0 =C2=A0 =C2=A0 Returning configuration value a=
llow setuid=3D&#39;yes&#39;<br>DEBUG =C2=A0 [U=3D0,P=3D29387] =C2=A0 =C2=A0=
 =C2=A0singularity_config_get_bool_c<wbr>har_impl() =C2=A0 Return singulari=
ty_config_get_bool(al<wbr>low setuid, yes) =3D 1<br>DEBUG =C2=A0 [U=3D0,P=
=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_registry_get() =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning NULL on &#39;NOSUID&#39;<br=
>VERBOSE [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_priv_userns() =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Invoking the user n=
amespace</blockquote><div><br></div><div>and I return NULL too, but it does=
n&#39;t error out. So you don&#39;t get to the last line to invoke the user=
 namespace... I&#39;m not completely sure about the issue, but given centos=
 6, I bet you it has to do with the OS / version.=C2=A0 Do others have thou=
ghts? Could you try a completely new install with no changes to the config,=
 and do a simple shell for some docker:// uri so I can recreate your use ca=
se exactly?</div></div><div><br></div><div><br></div></div></span><div><div=
 class=3D"h5"><div><br><div class=3D"gmail_quote">On Thu, Aug 3, 2017 at 4:=
45 PM, toufique <span dir=3D"ltr">&lt;<a rel=3D"nofollow">te...@gmail.com</=
a>&gt;</span> wrote:<br><blockquote class=3D"gmail_quote" style=3D"margin:0=
 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir=3D"ltr">Hi =
Vanessa,<div><br></div><div>command:=C2=A0</div><div><br></div><div>singula=
rity --debug create --size 30000 /tmp/debian_jessie_tvb_1.img . (not that t=
his time i tried creating the container in /tmp .=C2=A0 So, no involvment o=
f NFS here for the container)=C2=A0<br></div><div><br></div><div><br></div>=
<div>Here is the debug output:</div><div><br></div><div><div>Enabling debug=
ging</div><div>Ending argument loop</div><span><div>Singularity version: 2.=
3.1-dist</div><div>Exec&#39;ing: /data/apps/singularity/2.3.1/l<wbr>ibexec/=
singularity/cli/create.<wbr>exec</div></span><div>VERBOSE [U=3D2527,P=3D482=
57] =C2=A0 message_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Set messagelevel to: 5</div=
><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Initialize configura=
tion file: /data/apps/singularity/2.3.1/e<wbr>tc/singularity/singularity.co=
n<wbr>f</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity=
_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Star=
ting parse of configuration file /data/apps/singularity/2.3.1/e<wbr>tc/sing=
ularity/singularity.con<wbr>f</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =
=C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0Got config key allow setuid =3D &#39;yes&#39;</div><div>^[[0m=
VERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key max loop device=
s =3D &#39;256&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 sing=
ularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0Got config key allow pid ns =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=
=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key config passwd =3D &#39;yes=
&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config=
_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config =
key config group =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D482=
57] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0Got config key config resolv_conf =3D &#39;yes&#39;</di=
v><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key mount=
 proc =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 =
singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0Got config key mount sys =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=
=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key mount dev =3D &#39;yes&#39=
;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_par=
se() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key =
mount home =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =
=C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0Got config key mount tmp =3D &#39;yes&#39;</div><div>^[[0mVER=
BOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key mount hostfs =3D &#=
39;no&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_c=
onfig_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got co=
nfig key bind path =3D &#39;/etc/localtime&#39;</div><div>^[[0mVERBOSE [U=
=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key bind path =3D &#39;/etc/ho=
sts&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_con=
fig_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got conf=
ig key bind path =3D &#39;/dfs1&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D4=
8257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0Got config key bind path =3D &#39;/dfs2&#39;</div><div>=
^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key bind path =
=3D &#39;/data&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 sing=
ularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0Got config key user bind control =3D &#39;yes&#39;</div><div>^[[0mVERBOS=
E [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key enable overlay =3D &#3=
9;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_c=
onfig_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got co=
nfig key mount slave =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=
=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0Got config key sessiondir max size =3D &#39;16&#39;=
</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_config=
_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Finished pa=
rsing configuration file &#39;/data/apps/singularity/2.3.1/<wbr>etc/singula=
rity/<a href=3D"http://singularity.co">singularity.co</a><wbr>nf&#39;</div>=
<div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_init() =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Initializing Singularity R=
egistry</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_regi=
stry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding va=
lue to registry: &#39;WRITABLE&#39; =3D &#39;1&#39;</div><div>^[[0mDEBUG =
=C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_registry_se=
t(WRITA<wbr>BLE, 1) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=
=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0Adding value to registry: &#39;LIBEXECDIR&#39; =3D &#39;/data/=
apps/singularity/2.3.1/<wbr>libexec&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2=
527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_registry_set(libex<wbr=
>ecdir, /data/apps/singularity/2.3.1/l<wbr>ibexec) =3D 0</div><div>^[[0mVER=
BOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &#39;COM=
MAND&#39; =3D &#39;create&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48=
257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0Returning singularity_registry_set(COMMA<wbr>ND, create=
) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_regi=
stry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding va=
lue to registry: &#39;IMAGESIZE&#39; =3D &#39;30000&#39;</div><div>^[[0mDEB=
UG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_registry=
_set(IMAGE<wbr>SIZE, 30000) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D4825=
7] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0Adding value to registry: &#39;MESSAGELEVEL&#39; =3D &#39;=
5&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_=
registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Retur=
ning singularity_registry_set(MESSA<wbr>GELEVEL, 5) =3D 0</div><div>^[[0mVE=
RBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &#39;VER=
SION&#39; =3D &#39;2.3.1-dist&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=
=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_registry_set(versi<wbr>on, 2.=
3.1-dist) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singular=
ity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0A=
dding value to registry: &#39;LOCALSTATEDIR&#39; =3D &#39;/data/apps/singul=
arity/2.3.1/<wbr>var&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =
=C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0Returning singularity_registry_set(local<wbr>statedir, /data/=
apps/singularity/2.3.1/v<wbr>ar) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=
=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &#39;SYSCONFDIR&#39; =3D =
&#39;/data/apps/singularity/2.3.1/<wbr>etc&#39;</div><div>^[[0mDEBUG =C2=A0=
 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_registry_set(sy=
sco<wbr>nfdir, /data/apps/singularity/2.3.1/e<wbr>tc) =3D 0</div><div>^[[0m=
VERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &#39=
;BINDIR&#39; =3D &#39;/data/apps/singularity/2.3.1/<wbr>bin&#39;</div><div>=
^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularit=
y_registry_set(bindi<wbr>r, /data/apps/singularity/2.3.1/b<wbr>in) =3D 0</d=
iv><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set()=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to reg=
istry: &#39;IMAGE&#39; =3D &#39;/tmp/debian_jessie_tvb_1.img&#39;</div><div=
>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularit=
y_registry_set(IMAGE<wbr>, /tmp/debian_jessie_tvb_1.img) =3D 0</div><div>^[=
[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_get() =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning NULL on &#39;=
HOME&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singulari=
ty_registry_get() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Re=
turning NULL on &#39;TARGET_UID&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,=
P=3D48257] =C2=A0 singularity_registry_get() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0Returning NULL on &#39;TARGET_GID&#39;</div><div=
>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_priv_init() =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Initializing us=
er info</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity=
_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 Set the calling user&#39;s username to: itoufiqu</div><div>^[[0mDEBUG =C2=
=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_priv_init() =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Marking uinfo structure as re=
ady</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_pri=
v_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Obt=
aining home directory</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 si=
ngularity_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 Set home (via getpwuid()) to: /data/users/itoufiqu</div><div>^[[=
0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_suid_init() =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Running SUID program work=
flow</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_suid_in=
it() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Checkin=
g program has appropriate permissions</div><div>^[[0mVERBOSE [U=3D2527,P=3D=
48257] =C2=A0 singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 Checking configuration file is properly owned b=
y root</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_suid_=
init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Check=
ing if singularity.conf allows us to run as suid</div><div>^[[0mDEBUG =C2=
=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_config_get_bool_ch<wbr>ar_impl(=
) =C2=A0 Called singularity_config_get_bool(al<wbr>low setuid, yes)</div><d=
iv>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_config_get_val=
ue_i<wbr>mpl() =C2=A0 =C2=A0 =C2=A0 Returning configuration value allow set=
uid=3D&#39;yes&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0=
 singularity_config_get_bool_ch<wbr>ar_impl() =C2=A0 Return singularity_con=
fig_get_bool(al<wbr>low setuid, yes) =3D 1</div><div>^[[0mDEBUG =C2=A0 [U=
=3D2527,P=3D48257] =C2=A0 singularity_registry_get() =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning NULL on &#39;NOSUID&#39;</div><=
div>^[[0m^[[91mERROR =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_suid_in=
it() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Singula=
rity is not running with appropriate privileges!</div><div>^[[0m^[[91mERROR=
 =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_suid_init() =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Check installation path is=
 not mounted with &#39;nosuid&#39;, and/or consult manual.</div><div>^[[0m^=
[[31mABORT =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_suid_init() =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Retval =3D 255<=
/div><div><br></div><div><br></div><div>Some info on the host, let me know =
if you need more info:=C2=A0</div><div><br></div><div><br></div><div>[itouf=
iqu@compute-7-2 2.3.1]$ cat /etc/redhat-release =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0=C2=A0<br></div><div><div>CentOS release 6.8 (Final) =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0</=
div><div>[itoufiqu@compute-7-2 2.3.1]$ uname -a =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=C2=A0</div><div>Linux compute-7-2.lo=
cal 3.10.104-1.el6.elrepo.x86_64 #1 SMP Fri Oct 21 10:27:14 EDT 2016 x86_64=
 x86_64 x86_64 GNU/Linux =C2=A0</div></div><div><br></div><div>Thanks again=
!</div><span><div><br></div>On Thursday, August 3, 2017 at 1:38:02 PM UTC-7=
, vanessa wrote:</span><blockquote class=3D"gmail_quote" style=3D"margin:0;=
margin-left:0.8ex;border-left:1px #ccc solid;padding-left:1ex"><span><div d=
ir=3D"ltr">Could you please show the output with --debug and singularity --=
version?<div><br></div><blockquote class=3D"gmail_quote" style=3D"margin:0p=
x 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1ex"><s=
pan style=3D"font-size:12.8px">singularity --debug create --size 30000 /tmp=
/debian_jessie_tvb.img</span><span style=3D"font-size:12.8px"><br></span><s=
pan style=3D"font-size:12.8px">singularity --version</span></blockquote><di=
v><br></div><div>and also throw in information about the host, if easy to g=
et :)=C2=A0</div></div></span><div><br><div class=3D"gmail_quote"><div><div=
>On Thu, Aug 3, 2017 at 4:24 PM, toufique <span dir=3D"ltr">&lt;<a rel=3D"n=
ofollow">te...@gmail.com</a>&gt;</span> wrote:<br></div></div><blockquote c=
lass=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;=
padding-left:1ex"><div><div><div dir=3D"ltr">Hi Vanessa,<div><br></div><div=
>I finally had some time to look into this earlier today.=C2=A0 Per your su=
ggestion, I tried creating a container as myself, no luck:=C2=A0<br><br><di=
v>[itoufiqu@compute-7-2 ~]$ singularity -v create --size 30000 /tmp/debian_=
jessie_tvb.img</div><div>Increasing verbosity level (2)</div><div>Singulari=
ty version: 2.3.1-dist</div><div>Exec&#39;ing: /data/apps/singularity/2.3.1=
/l<wbr>ibexec/singularity/cli/create.<wbr>exec</div><div>VERBOSE: Set messa=
gelevel to: 2</div><div>VERBOSE: Initialize configuration file: /data/apps/=
singularity/2.3.1/e<wbr>tc/singularity/singularity.con<wbr>f</div><div>VERB=
OSE: Initializing Singularity Registry</div><span><div>ERROR =C2=A0: Singul=
arity is not running with appropriate privileges!</div><div>ERROR =C2=A0: C=
heck installation path is not mounted with &#39;nosuid&#39;, and/or consult=
 manual.</div><div>ABORT =C2=A0: Retval =3D 255</div><div><br></div></span>=
<div>[itoufiqu@compute-7-2 ~]$ whoami</div><div><span style=3D"color:inheri=
t;font-size:inherit">itoufiqu</span><br></div><div><br></div><div><br></div=
><div>singularity was installed as &#39;root&#39; .=C2=A0 Below is the conf=
ig file:=C2=A0</div><div><br></div><div><div>allow setuid =3D yes</div><div=
>max loop devices =3D 256</div><div>config passwd =3D yes</div><div>config =
group =3D yes</div><div>config resolv_conf =3D yes</div><div>mount proc =3D=
 yes</div><div>mount sys =3D yes</div><div>mount dev =3D yes</div><div>moun=
t home =3D yes</div><div>mount tmp =3D yes</div><div>mount hostfs =3D no</d=
iv><div>bind path =3D /etc/localtime</div><div>bind path =3D /etc/hosts</di=
v><div>bind path =3D /dfs1</div><div>bind path =3D /dfs2</div><div>bind pat=
h =3D /data</div><div>user bind control =3D yes</div><div>enable overlay =
=3D yes</div><div>mount slave =3D yes</div><div>sessiondir max size =3D 16<=
/div></div><div><br></div><div>What do I need to do get this fixed, please?=
</div><div><br></div><div>thanks.</div><div><div><div><br></div><div><br></=
div>On Thursday, July 27, 2017 at 5:35:33 PM UTC-7, toufique wrote:<blockqu=
ote class=3D"gmail_quote" style=3D"margin:0;margin-left:0.8ex;border-left:1=
px #ccc solid;padding-left:1ex"><div dir=3D"ltr">Hi,=C2=A0<div><br></div><d=
iv>I am sure this has been discussed in this forum.</div><div><br></div><di=
v>I have a container that I have setup as &#39;root&#39; .=C2=A0Now when I =
go about using that container to get (even) a &#39;shell&#39; off the conta=
iner, I get the error below:<br><br><div>./singularity shell /tmp/singulari=
ty_containers/de<wbr>bian_latest.img =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0</div><div>ERROR =C2=A0=
: Singularity is not running with appropriate privileges!</div><div>ERROR =
=C2=A0: Check installation path is not mounted with &#39;nosuid&#39;, and/o=
r consult manual.</div><div>ABORT =C2=A0: Retval =3D 255</div></div><div><b=
r></div><div>How do I fix this so, I can install containers as a &#39;root&=
#39; user but still be able to run - =C2=A0&#39;exec&#39; , &#39;run&#39;, =
&#39;shell&#39; commands as a regular user?</div><div><br></div><div>Thanks=
 for your help!</div></div></blockquote></div></div></div></div></div></div=
><div><div><div><div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br></div></div>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a rel=3D"nofollow">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><span><br><br clear=3D"all"><div><br></div>-=
- <br><div>Vanessa Villamia Sochat<br>Stanford University &#39;16<br><div><=
div><div><a value=3D"+16033210676">(603) 321-0676</a></div></div></div></di=
v>
</span></div>
</blockquote></div></div><div><div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a rel=3D"nofollow">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
<div>Vanessa Villamia Sochat<br>Stanford University &#39;16<br><div><div><d=
iv><a href=3D"tel:(603)%20321-0676" value=3D"+16033210676" target=3D"_blank=
">(603) 321-0676</a></div></div></div></div>
</div>
</div></div></blockquote></div></div><div class=3D"HOEnZb"><div class=3D"h5=
">

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.<wbr>gov</a>.<br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
<div class=3D"gmail_signature" data-smartmail=3D"gmail_signature">Vanessa V=
illamia Sochat<br>Stanford University &#39;16<br><div><div><div>(603) 321-0=
676</div></div></div></div>
</div>

--94eb2c1243b21614910555e06c12--
