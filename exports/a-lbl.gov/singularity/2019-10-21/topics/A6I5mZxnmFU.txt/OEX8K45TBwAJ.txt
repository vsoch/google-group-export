X-Received: by 2002:a63:6d8f:: with SMTP id i137-v6mr524464pgc.140.1526666235209;
        Fri, 18 May 2018 10:57:15 -0700 (PDT)
X-BeenThere: singularity@lbl.gov
Received: by 2002:a65:5001:: with SMTP id f1-v6ls1898970pgo.15.gmail; Fri, 18
 May 2018 10:57:13 -0700 (PDT)
X-Received: by 2002:a62:303:: with SMTP id 3-v6mr10334277pfd.255.1526666233696;
        Fri, 18 May 2018 10:57:13 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1526666233; cv=none;
        d=google.com; s=arc-20160816;
        b=IYQhNu7LyGeB5XicT0neVF8GQf871j/G/7CZ/MMsgZjflw3NLkmd0mwnUHOgY39Zos
         5aluETeYyIKXZ5q0HJ3FfW5t8/2GSBREbR8oIlYHVpN55VUwHj8ZbUozw2UqoE+Jo+9P
         TXypgi+Tf2P0oB3pXPE63DE6RiCPvRs8uioFqIHwtwCAR3r87YjOyVrI4TJTTI9RcvLM
         P2O7ntxIU3KF2KQe+L+ow4rv1zdRRQJDOGK8iAze2WbxfGr6YZInYy147944tjk2oRUb
         B9CMIkLiSyZrHD/ype8sSFYOOXJfQ9t4dXwE6GO4keINPsJ3YhQ6IFw0OHKVtzlqDTTX
         ZBSw==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=to:subject:message-id:date:from:in-reply-to:references:mime-version
         :dkim-signature:arc-authentication-results;
        bh=VZZ3dHPq7rmeFcSu+54fPdNBKqHkTJrDo+qP7DwsGSY=;
        b=Pf/kSdl9+7KLdosTt0gRG0ybv2G6a/ElGkSxPK/Cm0aNUfClNMw83xhvuAqQreYuPt
         7RtOpW7IjZdyi/UqOdpJeEZ5RY3oi+WZtCeKD+vr9Qiy1XT+4UmO51HvNkWJyzdFNgFi
         R9NRmSCp9vKaGcGXL/LxwYKp3upZXFglT9E0fhYZv1O7Qers3M9fIuYqdBRGP9rdqBhe
         P6YDT2bqT446jhVePnz44bSyp3bd9jbAHNBQCAmfH30SZZF+xcUOLcOKxyjv/WpFAl85
         b8IrDp1MeJ7uuqNiFhc8zTouGe6jRFaUCVd5g8CdsWyCKgdGgR+MxUeAjsqDparD743Z
         DmHw==
ARC-Authentication-Results: i=1; mx.google.com;
       dkim=pass head...@gmail.com header.s=20161025 header.b=TEFCCu8G;
       spf=pass (google.com: domain of georg...@gmail.com designates 209.85.216.179 as permitted sender) smtp.mailfrom=georg...@gmail.com
Return-Path: <georg...@gmail.com>
Received: from fe4.lbl.gov (fe4.lbl.gov. [128.3.41.71])
        by mx.google.com with ESMTP id z10-v6si6185600pgp.419.2018.05.18.10.57.13
        for <singu...@lbl.gov>;
        Fri, 18 May 2018 10:57:13 -0700 (PDT)
Received-SPF: pass (google.com: domain of georg...@gmail.com designates 209.85.216.179 as permitted sender) client-ip=209.85.216.179;
Authentication-Results: mx.google.com;
       dkim=pass head...@gmail.com header.s=20161025 header.b=TEFCCu8G;
       spf=pass (google.com: domain of georg...@gmail.com designates 209.85.216.179 as permitted sender) smtp.mailfrom=georg...@gmail.com
X-Ironport-SBRS: 3.4
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A2H7BAAeE/9ahrPYVdFcHAEBAQQBAQoBA?=
 =?us-ascii?q?YJNAUqBDH0og24GgR2CUIQXjHqBeYEPkzYUgQ4DGDgDIwEMCYFJgi9GAoISITQ?=
 =?us-ascii?q?YAQIBAQEBAQECAQECEAEBAQgLCwgoIwyCNQUCAwIeBQRLJgUBMAEBAQEBAQEBA?=
 =?us-ascii?q?QEfAgwhQwEBAQMBGgkdAQ0OBBoDAQsGAwILBgMBAQEhAQkCAiEBAQ4DAQUBFAg?=
 =?us-ascii?q?OBwQBBxUEgwICKIE+AQMNCAUKjGyQAjyLBYF/BQEXgnAFg08KGSYNVFeCHwIBB?=
 =?us-ascii?q?RKII4FUP4EPgl4ugk9CAQGBJQgBEgE+AQ2CU4JUAoc8JIk0hnUXLAmFaoVugn+?=
 =?us-ascii?q?MfYlfSoQHgjgwgQQcbC5xMxojUDGCEoIUGoNOim4jMAEPjTlHgXABAQ?=
X-IronPort-AV: E=Sophos;i="5.49,415,1520924400"; 
   d="scan'208,217";a="23658056"
Received: from mail-qt0-f179.google.com ([209.85.216.179])
  by fe4.lbl.gov with ESMTP; 18 May 2018 10:57:11 -0700
Received: by mail-qt0-f179.google.com with SMTP id h2-v6so11360744qtp.7
        for <singu...@lbl.gov>; Fri, 18 May 2018 10:57:11 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:references:in-reply-to:from:date:message-id:subject:to;
        bh=VZZ3dHPq7rmeFcSu+54fPdNBKqHkTJrDo+qP7DwsGSY=;
        b=TEFCCu8G7TeTHtClupp1M1j8GHdOgkiRwN7spVqLkpgqR0NIfFEHA3W+wpoIfaFEUM
         A6Y35L36mxXop7hXk8+McS0rE9kE20Vns9gUagutzOU1RSznw2PptMuyusq0/AGs/tlP
         xRWPMaCXGMsf55/MQRozb5c+MV7iL/iJzL2nv0HsI+N943BmE+53xR7766DJ3Wvcg5nF
         MXRhHWg0mr0CGucRzJyJN4hxk5aZzfIzNchyW9wAGEtY+gekqs9wPZmTssTZPRIQFmBO
         HpQfrVF7Vt3FOGaWVMiHNBLURShGJ/W8WcRpU/RgI2izM2KigKLzmq1mdubD9NLO+RVA
         Xy+Q==
X-Gm-Message-State: ALKqPwek1Zpgv5Zky8Gu4qFkSTZZhMaiP83i72Tzd/3le69dy6D631Ef
	YpxZlZINAZ7N5HwzzAyaJ6x7zq9/ZRZn9zAmWz4=
X-Received: by 2002:a0c:9825:: with SMTP id c34-v6mr9806886qvd.150.1526666230797;
 Fri, 18 May 2018 10:57:10 -0700 (PDT)
MIME-Version: 1.0
References: <167671ff-657d-4560-a35f-87091223fe29@lbl.gov> <B58197C146EC324AA00A2A07DC082602C2CBA0C3@XMAIL-MBX-BT1.AD.UCSD.EDU>
In-Reply-To: <B58197C146EC324AA00A2A07DC082602C2CBA0C3@XMAIL-MBX-BT1.AD.UCSD.EDU>
From: George Zaki <georg...@gmail.com>
Date: Fri, 18 May 2018 13:56:59 -0400
Message-ID: <CAB6eJZ+6PDjs3POSQPNoLdaMys5d7iYDYcUeQFpMyzJ6DEP31w@mail.gmail.com>
Subject: Re: [Singularity] Running an mpi program with mvapitch
To: singularity@lbl.gov
Content-Type: multipart/alternative; boundary="000000000000609a8a056c7eaec4"

--000000000000609a8a056c7eaec4
Content-Type: text/plain; charset="UTF-8"

Thanks Marty

Below are the values I got, any obvious mismatch? I git this working fine
with OpenMPI.

Here is also what I try to run:

singularity exec /data/zakigf/candle/swift-hypervisor-horovod-mvapich.simg
mpicc mpi-pi.c -o  mpi-pi.o

[zakigf@cn2360 mpi-example]$ mpiexec -n 1 singularity exec
/data/zakigf/candle/swift-hypervisor-horovod-mvapich.simg mpi-pi.o
Then I kill after no response:

^C[mpiexec@cn2360] Sending Ctrl-C to processes as requested

[mpiexec@cn2360] Press Ctrl-C again to force abort

[mpiexec@cn2360] HYDU_sock_write (utils/sock/sock.c:286): write error (Bad
file descriptor)

[mpiexec@cn2360] HYD_pmcd_pmiserv_send_signal
(pm/pmiserv/pmiserv_cb.c:169): unable to write data to proxy

[mpiexec@cn2360] ui_cmd_cb (pm/pmiserv/pmiserv_pmci.c:79): unable to send
signal downstream

[mpiexec@cn2360] HYDT_dmxu_poll_wait_for_event
(tools/demux/demux_poll.c:76): callback returned error status

[mpiexec@cn2360] HYD_pmci_wait_for_completion
(pm/pmiserv/pmiserv_pmci.c:198): error waiting for event

[mpiexec@cn2360] main (ui/mpich/mpiexec.c:344): process manager error
waiting for completion


Now about the versions:

Singularity: Invoking an interactive shell within container...


Singularity swift-hypervisor-horovod-mvapich.simg:~> mpiexec --version

HYDRA build details:

    Version:                                 3.1.4

    Release Date:                            Wed Sep  7 14:33:43 EDT 2016

    CC:                              gcc

    CXX:                             g++

    F77:                             gfortran

    F90:                             gfortran

    Configure options:                       '--disable-option-checking'
'--prefix=NONE' '--cache-file=/dev/null' '--srcdir=.' 'CC=gcc' 'CFLAGS=
-DNDEBUG -DNVALGRIND -O2' 'LDFLAGS=-L/lib -L/lib -L/lib -Wl,-rpath,/lib
-L/lib -Wl,-rpath,/lib -L/lib -L/lib' 'LIBS=-libmad -libumad -libverbs -ldl
-lrt -lm -lpthread ' 'CPPFLAGS= -I/tmp/mvapich2-2.2/src/mpl/include
-I/tmp/mvapich2-2.2/src/mpl/include -I/tmp/mvapich2-2.2/src/openpa/src
-I/tmp/mvapich2-2.2/src/openpa/src -D_REENTRANT
-I/tmp/mvapich2-2.2/src/mpi/romio/include -I/include -I/include -I/include
-I/include'

    Process Manager:                         pmi

    Launchers available:                     ssh rsh fork slurm ll lsf sge
manual persist

    Topology libraries available:            hwloc

    Resource management kernels available:   user slurm ll lsf sge pbs
cobalt

    Checkpointing libraries available:

    Demux engines available:                 poll select

Singularity swift-hypervisor-horovod-mvapich.simg:~> gcc --version

gcc (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609

Copyright (C) 2015 Free Software Foundation, Inc.

This is free software; see the source for copying conditions.  There is NO

warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.


Singularity swift-hypervisor-horovod-mvapich.simg:~> exit

exit


[zakigf@cn2360 ~]$ ml mvapich2/2.2/gcc-5.3.0

[+] Loading mvapich2 2.2 for GCC 5.3.0

[zakigf@cn2360 ~]$ gcc --version

gcc (GCC) 4.4.7 20120313 (Red Hat 4.4.7-17)

Copyright (C) 2010 Free Software Foundation, Inc.

This is free software; see the source for copying conditions.  There is NO

warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.


[zakigf@cn2360 ~]$ mpiexec --version

HYDRA build details:

    Version:                                 3.1.4

    Release Date:                            Wed Sep  7 14:33:43 EDT 2016

    CC:                              /usr/local/GCC/5.3.0/bin/gcc

    CXX:                             /usr/local/GCC/5.3.0/bin/g++

    F77:                             /usr/local/GCC/5.3.0/bin/gfortran

    F90:                             /usr/local/GCC/5.3.0/bin/gfortran

    Configure options:                       '--disable-option-checking'
'--prefix=/usr/local/MVAPICH2/2.2/gcc-5.3.0'
'--with-slurm-lib=/usr/local/slurm/lib'
'--with-slurm-include=/usr/local/slurm/include' '--enable-debug=none'
'--enable-timing=runtime' 'CC=/usr/local/GCC/5.3.0/bin/gcc'
'CXX=/usr/local/GCC/5.3.0/bin/g++' 'FC=/usr/local/GCC/5.3.0/bin/gfortran'
'F77=/usr/local/GCC/5.3.0/bin/gfortran' '--cache-file=/dev/null'
'--srcdir=.' 'CFLAGS= -DNDEBUG -DNVALGRIND -O2' 'LDFLAGS=-L/lib -L/lib
-L/lib -Wl,-rpath,/lib -L/lib -Wl,-rpath,/lib -L/lib -L/lib' 'LIBS=-libmad
-libumad -libverbs -ldl -lrt -lm -lpthread ' 'CPPFLAGS=
-I/usr/local/src/mvapich2/mvapich2-2.2/src/mpl/include
-I/usr/local/src/mvapich2/mvapich2-2.2/src/mpl/include
-I/usr/local/src/mvapich2/mvapich2-2.2/src/openpa/src
-I/usr/local/src/mvapich2/mvapich2-2.2/src/openpa/src -D_REENTRANT
-I/usr/local/src/mvapich2/mvapich2-2.2/src/mpi/romio/include -I/include
-I/include -I/include -I/include'

    Process Manager:                         pmi

    Launchers available:                     ssh rsh fork slurm ll lsf sge
manual persist

    Topology libraries available:            hwloc

    Resource management kernels available:   user slurm ll lsf sge pbs
cobalt

    Checkpointing libraries available:

    Demux engines available:                 poll select

On Fri, May 18, 2018 at 1:31 PM Kandes, Martin <mka...@sdsc.edu> wrote:

> Hi George,
>
> I run with different gcc compiler versions inside and outside my MPI
> containers. So I would be surprised if that is the issue here. I'm not sure
> I have a good recommendation of where to start debugging your problem. But
> I might start by double checking the MPI versions match inside and outside
> the container. e.g. see [1].
>
> Marty
>
> [1]
>
> [mkandes@comet-ln3 ~]$ srun --partition=debug --pty --nodes=1
> --ntasks-per-node=24 -t 00:30:00 --wait=0 --export=ALL /bin/bash
> srun: job 16364303 queued and waiting for resources
> srun: job 16364303 has been allocated resources
> [mkandes@comet-14-06 ~]$ cd /scratch/mkandes/16364303/
> [mkandes@comet-14-06 16364303]$ cp
> /oasis/scratch/comet/mkandes/temp_project/singularity/images/ubuntu-mvapich2.img
> ./
> [mkandes@comet-14-06 16364303]$ module purge
> [mkandes@comet-14-06 16364303]$ module load gnu
> [mkandes@comet-14-06 16364303]$ module load mvapich2_ib
> [mkandes@comet-14-06 16364303]$ module list
> Currently Loaded Modulefiles:
>   1) gnu/4.9.2         2) mvapich2_ib/2.1
> [mkandes@comet-14-06 16364303]$ module load singularity
> [mkandes@comet-14-06 16364303]$ gcc --version
> gcc (GCC) 4.9.2
> Copyright (C) 2014 Free Software Foundation, Inc.
> This is free software; see the source for copying conditions.  There is NO
> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
>
> [mkandes@comet-14-06 16364303]$ mpirun --version
> HYDRA build details:
>     Version:                                 3.1.4
>     Release Date:                            Thu Apr  2 17:15:15 EDT 2015
>     CC:                              gcc  -fPIC -O3
>     CXX:                             g++  -fPIC -O3
>     F77:                             gfortran -fPIC -O3
>     F90:                             gfortran -fPIC -O3
>     Configure options:                       '--disable-option-checking'
> '--prefix=/opt/mvapich2/gnu/ib' '--enable-shared' '--enable-sharedlibs=gcc'
> '--with-hwloc' '--enable-f77' '--enable-fc' '--enable-hybrid'
> '--with-ib-include=/usr/include/infiniband' '--with-ib-libpath=/usr/lib64'
> '--enable-fast=O3'
> '--with-limic2=/state/partition1/git/mpi-roll/BUILD/sdsc-mvapich2_gnu_ib-2.1/../..//cache/build-limic'
> '--with-slurm=/usr/lib64/slurm' '--with-file-system=lustre' 'CC=gcc'
> 'CFLAGS=-fPIC -O3 -O3' 'CXX=g++' 'CXXFLAGS=-fPIC -O3 -O3' 'FC=gfortran'
> 'FCFLAGS=-fPIC -O3 -O3' 'F77=gfortran' 'FFLAGS=-L/usr/lib64 -L/lib -L/lib
> -fPIC -O3 -O3' '--cache-file=/dev/null' '--srcdir=.' 'LDFLAGS=-L/usr/lib64
> -L/lib -L/lib -L/lib -Wl,-rpath,/lib -L/lib -Wl,-rpath,/lib -L/usr/lib64
> -L/state/partition1/git/mpi-roll/BUILD/sdsc-mvapich2_gnu_ib-2.1/../..//cache/build-limic/lib
> -L/lib -L/lib' 'LIBS=-libmad -lrdmacm -libumad -libverbs -ldl -lrt -llimic2
> -lm -lpthread ' 'CPPFLAGS=-I/usr/include/infiniband
> -I/state/partition1/git/mpi-roll/BUILD/sdsc-mvapich2_gnu_ib-2.1/mvapich2-2.1/src/mpl/include
> -I/state/partition1/git/mpi-roll/BUILD/sdsc-mvapich2_gnu_ib-2.1/mvapich2-2.1/src/mpl/include
> -I/state/partition1/git/mpi-roll/BUILD/sdsc-mvapich2_gnu_ib-2.1/mvapich2-2.1/src/openpa/src
> -I/state/partition1/git/mpi-roll/BUILD/sdsc-mvapich2_gnu_ib-2.1/mvapich2-2.1/src/openpa/src
> -D_REENTRANT
> -I/state/partition1/git/mpi-roll/BUILD/sdsc-mvapich2_gnu_ib-2.1/mvapich2-2.1/src/mpi/romio/include
> -I/include -I/include -I/usr/include/infiniband
> -I/state/partition1/git/mpi-roll/BUILD/sdsc-mvapich2_gnu_ib-2.1/../..//cache/build-limic/include
> -I/include -I/include'
>     Process Manager:                         pmi
>     Launchers available:                     ssh rsh fork slurm ll lsf sge
> manual persist
>     Topology libraries available:            hwloc
>     Resource management kernels available:   user slurm ll lsf sge pbs
> cobalt
>     Checkpointing libraries available:
>     Demux engines available:                 poll select
> [mkandes@comet-14-06 16364303]$ singularity shell ubuntu-mvapich2.img
> Singularity: Invoking an interactive shell within container...
>
> Singularity ubuntu-mvapich2.img:/scratch/mkandes/16364303> gcc --version
> gcc (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609
> Copyright (C) 2015 Free Software Foundation, Inc.
> This is free software; see the source for copying conditions.  There is NO
> warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
>
> Singularity ubuntu-mvapich2.img:/scratch/mkandes/16364303> mpirun --version
> HYDRA build details:
>     Version:                                 3.1.4
>     Release Date:                            Thu Apr  2 17:15:15 EDT 2015
>     CC:                              gcc
>     CXX:                             g++
>     F77:                             gfortran
>     F90:                             gfortran
>     Configure options:                       '--disable-option-checking'
> '--prefix=/opt/mvapich2' '--cache-file=/dev/null' '--srcdir=.' 'CC=gcc'
> 'CFLAGS= -DNDEBUG -DNVALGRIND -O2' 'LDFLAGS=-L/lib -L/lib -L/lib
> -Wl,-rpath,/lib -L/lib -Wl,-rpath,/lib -L/lib -L/lib' 'LIBS=-libmad
> -lrdmacm -libumad -libverbs -ldl -lrt -lm -lpthread ' 'CPPFLAGS=
> -I/tmp/mvapich2-2.1/src/mpl/include -I/tmp/mvapich2-2.1/src/mpl/include
> -I/tmp/mvapich2-2.1/src/openpa/src -I/tmp/mvapich2-2.1/src/openpa/src
> -D_REENTRANT -I/tmp/mvapich2-2.1/src/mpi/romio/include -I/include
> -I/include -I/include -I/include'
>     Process Manager:                         pmi
>     Launchers available:                     ssh rsh fork slurm ll lsf sge
> manual persist
>     Topology libraries available:            hwloc
>     Resource management kernels available:   user slurm ll lsf sge pbs
> cobalt
>     Checkpointing libraries available:
>     Demux engines available:                 poll select
> Singularity ubuntu-mvapich2.img:/scratch/mkandes/16364303>
>
>
> ------------------------------
> *From:* George Zaki [georg...@gmail.com]
> *Sent:* Friday, May 18, 2018 6:48 AM
> *To:* singularity
> *Subject:* [Singularity] Running an mpi program with mvapitch
>
> Hi singularity team,
>
>
> I would like to run an MPI program in a singularity container. The program
> is compiled using mvapicth2.2 using a gcc version 5.4.
>
>
> I can see that my cluster has a compiled version of mvapitch2.2 with gcc
> 5.3
>
>
> When I run:
>
> mpiexe -n 1 singularity exec /path/to/sing/image ./mpi-pi.o
>
> the call does not return.
>
>
>
> Does the gcc version has to be exactly the same? I tried the switch the
> compiler in this image:
>
>
> BootStrap: docker
> From: nvidia/cuda:8.0-cudnn6-devel-ubuntu16.04
>
>
> However when gcc 5.3 is used the mvapitch does not build correctly.
>
>
> If that's the problem, Is there a preferred method of switching gcc
> version in this container singularity container?
>
> Thanks,
> George
>
> --
> You received this message because you are subscribed to the Google Groups
> "singularity" group.
> To unsubscribe from this group and stop receiving emails from it, send an
> email to singu...@lbl.gov.
>
> --
> You received this message because you are subscribed to a topic in the
> Google Groups "singularity" group.
> To unsubscribe from this topic, visit
> https://groups.google.com/a/lbl.gov/d/topic/singularity/A6I5mZxnmFU/unsubscribe
> .
> To unsubscribe from this group and all its topics, send an email to
> singu...@lbl.gov.
>

--000000000000609a8a056c7eaec4
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Thanks Marty<div><br></div><div>Below are the values I got=
, any obvious mismatch? I git this working fine with OpenMPI.</div><div><br=
></div><div>Here is also what I try to run:</div><div><br></div><div>





<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">singularity exec=
 /data/zakigf/candle/swift-hypervisor-horovod-mvapich.simg mpicc mpi-pi.c -=
o<span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 </span>mpi-pi.o<s=
pan class=3D"inbox-inbox-Apple-converted-space">=C2=A0</span></span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">[zakigf@cn2360 m=
pi-example]$ mpiexec -n 1 singularity exec /data/zakigf/candle/swift-hyperv=
isor-horovod-mvapich.simg mpi-pi.o<span class=3D"inbox-inbox-Apple-converte=
d-space">=C2=A0</span></span></p></div><div>Then I kill after no response:<=
/div><div><br></div><div>





<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">^C[mpiexec@cn236=
0] Sending Ctrl-C to processes as requested</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">[mpiexec@cn2360]=
 Press Ctrl-C again to force abort</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">[mpiexec@cn2360]=
 HYDU_sock_write (utils/sock/sock.c:286): write error (Bad file descriptor)=
</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">[mpiexec@cn2360]=
 HYD_pmcd_pmiserv_send_signal (pm/pmiserv/pmiserv_cb.c:169): unable to writ=
e data to proxy</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">[mpiexec@cn2360]=
 ui_cmd_cb (pm/pmiserv/pmiserv_pmci.c:79): unable to send signal downstream=
</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">[mpiexec@cn2360]=
 HYDT_dmxu_poll_wait_for_event (tools/demux/demux_poll.c:76): callback retu=
rned error status</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">[mpiexec@cn2360]=
 HYD_pmci_wait_for_completion (pm/pmiserv/pmiserv_pmci.c:198): error waitin=
g for event</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">[mpiexec@cn2360]=
 main (ui/mpich/mpiexec.c:344): process manager error waiting for completio=
n</span></p><p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><br>=
</span></p><p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">Now a=
bout the versions:</span></p></div><div>





<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">Singularity: Inv=
oking an interactive shell within container...</span></p>
<p class=3D"inbox-inbox-p2"><span class=3D"inbox-inbox-s1"></span><br></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">Singularity swif=
t-hypervisor-horovod-mvapich.simg:~&gt; mpiexec --version<span class=3D"inb=
ox-inbox-Apple-converted-space">=C2=A0</span></span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">HYDRA build deta=
ils:</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Version: <span class=
=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 </span>3.1.4</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Release Date:<span c=
lass=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>W=
ed Sep<span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 </span>7 14:=
33:43 EDT 2016</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>CC:<span class=3D"in=
box-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>gcc <=
span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0</span></span=
></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>CXX: <span class=3D"=
inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>g++ <spa=
n class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0</span></span></=
p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>F77: <span class=3D"=
inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>gfortran=
<span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0</span></spa=
n></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>F90: <span class=3D"=
inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>gfortran=
<span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0</span></spa=
n></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Configure options: <=
span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>&#39;--disable-=
option-checking&#39; &#39;--prefix=3DNONE&#39; &#39;--cache-file=3D/dev/nul=
l&#39; &#39;--srcdir=3D.&#39; &#39;CC=3Dgcc&#39; &#39;CFLAGS=3D -DNDEBUG -D=
NVALGRIND -O2&#39; &#39;LDFLAGS=3D-L/lib -L/lib -L/lib -Wl,-rpath,/lib -L/l=
ib -Wl,-rpath,/lib -L/lib -L/lib&#39; &#39;LIBS=3D-libmad -libumad -libverb=
s -ldl -lrt -lm -lpthread &#39; &#39;CPPFLAGS=3D -I/tmp/mvapich2-2.2/src/mp=
l/include -I/tmp/mvapich2-2.2/src/mpl/include -I/tmp/mvapich2-2.2/src/openp=
a/src -I/tmp/mvapich2-2.2/src/openpa/src -D_REENTRANT -I/tmp/mvapich2-2.2/s=
rc/mpi/romio/include -I/include -I/include -I/include -I/include&#39;</span=
></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Process Manager: <sp=
an class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>pmi</span></=
p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Launchers available:=
 <span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>ssh rsh fork slurm ll =
lsf sge manual persist</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Topology libraries a=
vailable:<span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>hwloc</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Resource management =
kernels available: <span class=3D"inbox-inbox-Apple-converted-space">=C2=A0=
 </span>user slurm ll lsf sge pbs cobalt</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Checkpointing librar=
ies available:<span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=
=A0 =C2=A0 =C2=A0</span></span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Demux engines availa=
ble: <span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>poll select</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">Singularity swif=
t-hypervisor-horovod-mvapich.simg:~&gt; gcc --version<span class=3D"inbox-i=
nbox-Apple-converted-space">=C2=A0</span></span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">gcc (Ubuntu 5.4.=
0-6ubuntu1~16.04.9) 5.4.0 20160609</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">Copyright (C) 20=
15 Free Software Foundation, Inc.</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">This is free sof=
tware; see the source for copying conditions.<span class=3D"inbox-inbox-App=
le-converted-space">=C2=A0 </span>There is NO</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">warranty; not ev=
en for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span></p>
<p class=3D"inbox-inbox-p2"><span class=3D"inbox-inbox-s1"></span><br></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">Singularity swif=
t-hypervisor-horovod-mvapich.simg:~&gt; exit<span class=3D"inbox-inbox-Appl=
e-converted-space">=C2=A0</span></span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">exit</span></p><=
p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><br></span></p><p=
 class=3D"inbox-inbox-inbox-inbox-p1"><span class=3D"inbox-inbox-inbox-inbo=
x-s1">[zakigf@cn2360 ~]$ ml mvapich2/2.2/gcc-5.3.0<span class=3D"inbox-inbo=
x-inbox-inbox-Apple-converted-space">=C2=A0</span></span></p><p class=3D"in=
box-inbox-p1"><span class=3D"inbox-inbox-s1"></span></p><p class=3D"inbox-i=
nbox-inbox-inbox-p1"><span class=3D"inbox-inbox-inbox-inbox-s1">[+] Loading=
 mvapich2 2.2 for GCC 5.3.0</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">[zakigf@cn2360 ~=
]$ gcc --version</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">gcc (GCC) 4.4.7 =
20120313 (Red Hat 4.4.7-17)</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">Copyright (C) 20=
10 Free Software Foundation, Inc.</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">This is free sof=
tware; see the source for copying conditions.<span class=3D"inbox-inbox-App=
le-converted-space">=C2=A0 </span>There is NO</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">warranty; not ev=
en for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span></p>
<p class=3D"inbox-inbox-p2"><span class=3D"inbox-inbox-s1"></span><br></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">[zakigf@cn2360 ~=
]$ mpiexec --version</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1">HYDRA build deta=
ils:</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Version: <span class=
=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 </span>3.1.4</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Release Date:<span c=
lass=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>W=
ed Sep<span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 </span>7 14:=
33:43 EDT 2016</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>CC:<span class=3D"in=
box-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>/usr/=
local/GCC/5.3.0/bin/gcc <span class=3D"inbox-inbox-Apple-converted-space">=
=C2=A0 =C2=A0</span></span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>CXX: <span class=3D"=
inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>/usr/loc=
al/GCC/5.3.0/bin/g++ <span class=3D"inbox-inbox-Apple-converted-space">=C2=
=A0 =C2=A0</span></span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>F77: <span class=3D"=
inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>/usr/loc=
al/GCC/5.3.0/bin/gfortran<span class=3D"inbox-inbox-Apple-converted-space">=
=C2=A0 =C2=A0</span></span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>F90: <span class=3D"=
inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>/usr/loc=
al/GCC/5.3.0/bin/gfortran<span class=3D"inbox-inbox-Apple-converted-space">=
=C2=A0 =C2=A0</span></span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Configure options: <=
span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>&#39;--disable-=
option-checking&#39; &#39;--prefix=3D/usr/local/MVAPICH2/2.2/gcc-5.3.0&#39;=
 &#39;--with-slurm-lib=3D/usr/local/slurm/lib&#39; &#39;--with-slurm-includ=
e=3D/usr/local/slurm/include&#39; &#39;--enable-debug=3Dnone&#39; &#39;--en=
able-timing=3Druntime&#39; &#39;CC=3D/usr/local/GCC/5.3.0/bin/gcc&#39; &#39=
;CXX=3D/usr/local/GCC/5.3.0/bin/g++&#39; &#39;FC=3D/usr/local/GCC/5.3.0/bin=
/gfortran&#39; &#39;F77=3D/usr/local/GCC/5.3.0/bin/gfortran&#39; &#39;--cac=
he-file=3D/dev/null&#39; &#39;--srcdir=3D.&#39; &#39;CFLAGS=3D -DNDEBUG -DN=
VALGRIND -O2&#39; &#39;LDFLAGS=3D-L/lib -L/lib -L/lib -Wl,-rpath,/lib -L/li=
b -Wl,-rpath,/lib -L/lib -L/lib&#39; &#39;LIBS=3D-libmad -libumad -libverbs=
 -ldl -lrt -lm -lpthread &#39; &#39;CPPFLAGS=3D -I/usr/local/src/mvapich2/m=
vapich2-2.2/src/mpl/include -I/usr/local/src/mvapich2/mvapich2-2.2/src/mpl/=
include -I/usr/local/src/mvapich2/mvapich2-2.2/src/openpa/src -I/usr/local/=
src/mvapich2/mvapich2-2.2/src/openpa/src -D_REENTRANT -I/usr/local/src/mvap=
ich2/mvapich2-2.2/src/mpi/romio/include -I/include -I/include -I/include -I=
/include&#39;</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Process Manager: <sp=
an class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>pmi</span></=
p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Launchers available:=
 <span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>ssh rsh fork slurm ll =
lsf sge manual persist</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Topology libraries a=
vailable:<span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>hwloc</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Resource management =
kernels available: <span class=3D"inbox-inbox-Apple-converted-space">=C2=A0=
 </span>user slurm ll lsf sge pbs cobalt</span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Checkpointing librar=
ies available:<span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=
=A0 =C2=A0 =C2=A0</span></span></p>
<p class=3D"inbox-inbox-p1"><span class=3D"inbox-inbox-s1"><span class=3D"i=
nbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 </span>Demux engines availa=
ble: <span class=3D"inbox-inbox-Apple-converted-space">=C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 </span>poll select</span></p></div></di=
v><br><div class=3D"gmail_quote"><div dir=3D"ltr">On Fri, May 18, 2018 at 1=
:31 PM Kandes, Martin &lt;<a href=3D"mailto:mka...@sdsc.edu">mka...@sdsc.ed=
u</a>&gt; wrote:<br></div><blockquote class=3D"gmail_quote" style=3D"margin=
:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex">




<div>
<div style=3D"direction:ltr;font-family:Tahoma;color:#000000;font-size:10pt=
">
<div>Hi George,</div>
<div><br>
</div>
<div>I run with different gcc compiler versions inside and outside my MPI c=
ontainers. So I would be surprised if that is the issue here. I&#39;m not s=
ure I have a good recommendation of where to start debugging your problem. =
But I might start by double checking
 the MPI versions match inside and outside the container. e.g. see [1].</di=
v>
<div><br>
</div>
<div>Marty</div>
<div><br>
</div>
<div>[1]</div>
<div><br>
</div>
<div>[mkandes@comet-ln3 ~]$ srun --partition=3Ddebug --pty --nodes=3D1 --nt=
asks-per-node=3D24 -t 00:30:00 --wait=3D0 --export=3DALL /bin/bash<br>
srun: job 16364303 queued and waiting for resources<br>
srun: job 16364303 has been allocated resources<br>
[mkandes@comet-14-06 ~]$ cd /scratch/mkandes/16364303/<br>
[mkandes@comet-14-06 16364303]$ cp /oasis/scratch/comet/mkandes/temp_projec=
t/singularity/images/ubuntu-mvapich2.img ./<br>
[mkandes@comet-14-06 16364303]$ module purge<br>
[mkandes@comet-14-06 16364303]$ module load gnu<br>
[mkandes@comet-14-06 16364303]$ module load mvapich2_ib<br>
[mkandes@comet-14-06 16364303]$ module list<br>
Currently Loaded Modulefiles:<br>
=C2=A0 1) gnu/4.9.2=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 2) mvap=
ich2_ib/2.1<br>
[mkandes@comet-14-06 16364303]$ module load singularity<br>
[mkandes@comet-14-06 16364303]$ gcc --version<br>
gcc (GCC) 4.9.2<br>
Copyright (C) 2014 Free Software Foundation, Inc.<br>
This is free software; see the source for copying conditions.=C2=A0 There i=
s NO<br>
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.=
<br>
<br>
[mkandes@comet-14-06 16364303]$ mpirun --version<br>
HYDRA build details:<br>
=C2=A0=C2=A0=C2=A0 Version:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 3.1.4=
<br>
=C2=A0=C2=A0=C2=A0 Release Date:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 Thu Apr=C2=A0 2 17:15:15 EDT =
2015<br>
=C2=A0=C2=A0=C2=A0 CC:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 gcc=C2=A0 -fPIC -O3=C2=A0 =
<br>
=C2=A0=C2=A0=C2=A0 CXX:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 g++=C2=A0 -fPIC -O3=C2=A0 <br>
=C2=A0=C2=A0=C2=A0 F77:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 gfortran -fPIC -O3=C2=A0 <br>
=C2=A0=C2=A0=C2=A0 F90:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 gfortran -fPIC -O3=C2=A0 <br>
=C2=A0=C2=A0=C2=A0 Configure options:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0 &#39;--disable-option-checking&#39; &#39;--prefix=3D/=
opt/mvapich2/gnu/ib&#39; &#39;--enable-shared&#39; &#39;--enable-sharedlibs=
=3Dgcc&#39; &#39;--with-hwloc&#39; &#39;--enable-f77&#39; &#39;--enable-fc&=
#39; &#39;--enable-hybrid&#39; &#39;--with-ib-include=3D/usr/include/infini=
band&#39; &#39;--with-ib-libpath=3D/usr/lib64&#39;
 &#39;--enable-fast=3DO3&#39; &#39;--with-limic2=3D/state/partition1/git/mp=
i-roll/BUILD/sdsc-mvapich2_gnu_ib-2.1/../..//cache/build-limic&#39; &#39;--=
with-slurm=3D/usr/lib64/slurm&#39; &#39;--with-file-system=3Dlustre&#39; &#=
39;CC=3Dgcc&#39; &#39;CFLAGS=3D-fPIC -O3 -O3&#39; &#39;CXX=3Dg++&#39; &#39;=
CXXFLAGS=3D-fPIC -O3 -O3&#39; &#39;FC=3Dgfortran&#39;
 &#39;FCFLAGS=3D-fPIC -O3 -O3&#39; &#39;F77=3Dgfortran&#39; &#39;FFLAGS=3D-=
L/usr/lib64 -L/lib -L/lib -fPIC -O3 -O3&#39; &#39;--cache-file=3D/dev/null&=
#39; &#39;--srcdir=3D.&#39; &#39;LDFLAGS=3D-L/usr/lib64 -L/lib -L/lib -L/li=
b -Wl,-rpath,/lib -L/lib -Wl,-rpath,/lib -L/usr/lib64 -L/state/partition1/g=
it/mpi-roll/BUILD/sdsc-mvapich2_gnu_ib-2.1/../..//cache/build-limic/lib
 -L/lib -L/lib&#39; &#39;LIBS=3D-libmad -lrdmacm -libumad -libverbs -ldl -l=
rt -llimic2 -lm -lpthread &#39; &#39;CPPFLAGS=3D-I/usr/include/infiniband -=
I/state/partition1/git/mpi-roll/BUILD/sdsc-mvapich2_gnu_ib-2.1/mvapich2-2.1=
/src/mpl/include -I/state/partition1/git/mpi-roll/BUILD/sdsc-mvapich2_gnu_i=
b-2.1/mvapich2-2.1/src/mpl/include
 -I/state/partition1/git/mpi-roll/BUILD/sdsc-mvapich2_gnu_ib-2.1/mvapich2-2=
.1/src/openpa/src -I/state/partition1/git/mpi-roll/BUILD/sdsc-mvapich2_gnu_=
ib-2.1/mvapich2-2.1/src/openpa/src -D_REENTRANT -I/state/partition1/git/mpi=
-roll/BUILD/sdsc-mvapich2_gnu_ib-2.1/mvapich2-2.1/src/mpi/romio/include
 -I/include -I/include -I/usr/include/infiniband -I/state/partition1/git/mp=
i-roll/BUILD/sdsc-mvapich2_gnu_ib-2.1/../..//cache/build-limic/include -I/i=
nclude -I/include&#39;<br>
=C2=A0=C2=A0=C2=A0 Process Manager:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 pmi<br>
=C2=A0=C2=A0=C2=A0 Launchers available:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0 ssh rsh fork slurm ll lsf sge manual persist<br>
=C2=A0=C2=A0=C2=A0 Topology libraries available:=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 hwloc<br>
=C2=A0=C2=A0=C2=A0 Resource management kernels available:=C2=A0=C2=A0 user =
slurm ll lsf sge pbs cobalt<br>
=C2=A0=C2=A0=C2=A0 Checkpointing libraries available:=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0 <br>
=C2=A0=C2=A0=C2=A0 Demux engines available:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 poll sel=
ect<br>
[mkandes@comet-14-06 16364303]$ singularity shell ubuntu-mvapich2.img <br>
Singularity: Invoking an interactive shell within container...<br>
<br>
Singularity ubuntu-mvapich2.img:/scratch/mkandes/16364303&gt; gcc --version=
<br>
gcc (Ubuntu 5.4.0-6ubuntu1~16.04.9) 5.4.0 20160609<br>
Copyright (C) 2015 Free Software Foundation, Inc.<br>
This is free software; see the source for copying conditions.=C2=A0 There i=
s NO<br>
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.=
<br>
<br>
Singularity ubuntu-mvapich2.img:/scratch/mkandes/16364303&gt; mpirun --vers=
ion<br>
HYDRA build details:<br>
=C2=A0=C2=A0=C2=A0 Version:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 3.1.4=
<br>
=C2=A0=C2=A0=C2=A0 Release Date:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 Thu Apr=C2=A0 2 17:15:15 EDT =
2015<br>
=C2=A0=C2=A0=C2=A0 CC:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 gcc=C2=A0=C2=A0=C2=A0 <br>
=C2=A0=C2=A0=C2=A0 CXX:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 g++=C2=A0=C2=A0=C2=A0 <br>
=C2=A0=C2=A0=C2=A0 F77:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 gfortran=C2=A0=C2=A0 <br>
=C2=A0=C2=A0=C2=A0 F90:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 gfortran=C2=A0=C2=A0 <br>
=C2=A0=C2=A0=C2=A0 Configure options:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0 &#39;--disable-option-checking&#39; &#39;--prefix=3D/=
opt/mvapich2&#39; &#39;--cache-file=3D/dev/null&#39; &#39;--srcdir=3D.&#39;=
 &#39;CC=3Dgcc&#39; &#39;CFLAGS=3D -DNDEBUG -DNVALGRIND -O2&#39; &#39;LDFLA=
GS=3D-L/lib -L/lib -L/lib -Wl,-rpath,/lib -L/lib -Wl,-rpath,/lib -L/lib -L/=
lib&#39;
 &#39;LIBS=3D-libmad -lrdmacm -libumad -libverbs -ldl -lrt -lm -lpthread &#=
39; &#39;CPPFLAGS=3D -I/tmp/mvapich2-2.1/src/mpl/include -I/tmp/mvapich2-2.=
1/src/mpl/include -I/tmp/mvapich2-2.1/src/openpa/src -I/tmp/mvapich2-2.1/sr=
c/openpa/src -D_REENTRANT -I/tmp/mvapich2-2.1/src/mpi/romio/include
 -I/include -I/include -I/include -I/include&#39;<br>
=C2=A0=C2=A0=C2=A0 Process Manager:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 pmi<br>
=C2=A0=C2=A0=C2=A0 Launchers available:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0 ssh rsh fork slurm ll lsf sge manual persist<br>
=C2=A0=C2=A0=C2=A0 Topology libraries available:=C2=A0=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 hwloc<br>
=C2=A0=C2=A0=C2=A0 Resource management kernels available:=C2=A0=C2=A0 user =
slurm ll lsf sge pbs cobalt<br>
=C2=A0=C2=A0=C2=A0 Checkpointing libraries available:=C2=A0=C2=A0=C2=A0=C2=
=A0=C2=A0=C2=A0 <br>
=C2=A0=C2=A0=C2=A0 Demux engines available:=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=
=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0=C2=A0 poll sel=
ect<br>
Singularity ubuntu-mvapich2.img:/scratch/mkandes/16364303&gt;<br>
</div>
<div><br>
</div>
<div><br>
</div>
<div style=3D"font-family:Times New Roman;color:#000000;font-size:16px">
<hr>
<div id=3D"m_2229317604372834394divRpF902262" style=3D"direction:ltr"><font=
 size=3D"2" face=3D"Tahoma" color=3D"#000000"><b>From:</b> George Zaki [<a =
href=3D"mailto:georg...@gmail.com" target=3D"_blank">georg...@gmail.com</a>=
]<br>
<b>Sent:</b> Friday, May 18, 2018 6:48 AM<br>
<b>To:</b> singularity<br>
<b>Subject:</b> [Singularity] Running an mpi program with mvapitch<br>
</font><br>
</div>
<div></div>
<div></div></div></div></div><div><div style=3D"direction:ltr;font-family:T=
ahoma;color:#000000;font-size:10pt"><div style=3D"font-family:Times New Rom=
an;color:#000000;font-size:16px"><div>
<div dir=3D"ltr">
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif">Hi singularity team,</font></p>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif"><br>
</font></p>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif">I would like to run an MPI program in a singularity cont=
ainer. The program is compiled using mvapicth2.2 using a gcc version 5.4.</=
font></p>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif"><br>
</font></p>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif">I can see that my cluster has a compiled version of mvap=
itch2.2 with gcc 5.3</font></p>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif"><br>
</font></p>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif">When I run:</font></p>
<div style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"arial, sans-serif"=
><br>
</font></div>
<div style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"arial, sans-serif"=
>mpiexe -n 1 singularity exec /path/to/sing/image ./mpi-pi.o</font></div>
<div><font size=3D"4" face=3D"arial, sans-serif"><br>
</font></div>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif">the call does not return.</font></p>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif">=C2=A0<br>
</font></p>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif">Does the gcc version has to be exactly the same? I tried=
 the switch the compiler in this image:</font></p>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif"><br>
</font></p>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"></p>
<p style=3D"color:rgb(0,0,0);font-style:normal;font-weight:normal;letter-sp=
acing:normal;text-align:start;text-indent:0px;text-transform:none;white-spa=
ce:normal;word-spacing:0px">
</p>
<p></p>
<div style=3D"color:rgb(0,0,0);font-style:normal;font-weight:normal;letter-=
spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-s=
pace:normal;word-spacing:0px">
<font size=3D"4" face=3D"arial, sans-serif">BootStrap: docker<br>
</font></div>
<div style=3D"color:rgb(0,0,0);font-style:normal;font-weight:normal;letter-=
spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-s=
pace:normal;word-spacing:0px">
<font size=3D"4" face=3D"arial, sans-serif">From: nvidia/cuda:8.0-cudnn6-de=
vel-ubuntu16.04<br>
</font></div>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif"><br>
</font></p>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif">However when gcc 5.3 is used the mvapitch does not build=
 correctly.</font></p>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif"><br>
</font></p>
<p class=3D"MsoNormal" style=3D"color:rgb(0,0,0)"><font size=3D"4" face=3D"=
arial, sans-serif">If that&#39;s the problem, Is there a preferred method o=
f switching gcc version in this container singularity container?</font></p>
<div><font size=3D"4" face=3D"arial, sans-serif"><br>
</font></div>
<div><font size=3D"4" face=3D"arial, sans-serif">Thanks,</font></div>
<div><font size=3D"4" face=3D"arial, sans-serif">George</font></div>
</div>
<p></p>
-- <br></div></div></div></div><div><div style=3D"direction:ltr;font-family=
:Tahoma;color:#000000;font-size:10pt"><div style=3D"font-family:Times New R=
oman;color:#000000;font-size:16px"><div>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to
<a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singu...@lbl.gov</a>.=
<br>
</div>
</div>
</div>
</div>


<p></p>

-- <br>
You received this message because you are subscribed to a topic in the Goog=
le Groups &quot;singularity&quot; group.<br>
To unsubscribe from this topic, visit <a href=3D"https://groups.google.com/=
a/lbl.gov/d/topic/singularity/A6I5mZxnmFU/unsubscribe" target=3D"_blank">ht=
tps://groups.google.com/a/lbl.gov/d/topic/singularity/A6I5mZxnmFU/unsubscri=
be</a>.<br>
To unsubscribe from this group and all its topics, send an email to <a href=
=3D"mailto:singu...@lbl.gov" target=3D"_blank">singu...@lbl.gov</a>.<br>
</blockquote></div>

--000000000000609a8a056c7eaec4--
