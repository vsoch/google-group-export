X-Received: by 10.107.162.209 with SMTP id l200mr9341518ioe.4.1485223683095;
        Mon, 23 Jan 2017 18:08:03 -0800 (PST)
X-BeenThere: singularity@lbl.gov
Received: by 10.36.117.7 with SMTP id y7ls2640900itc.0.gmail; Mon, 23 Jan 2017
 18:08:02 -0800 (PST)
X-Received: by 10.98.194.22 with SMTP id l22mr35733502pfg.178.1485223682394;
        Mon, 23 Jan 2017 18:08:02 -0800 (PST)
Return-Path: <vso...@gmail.com>
Received: from fe4.lbl.gov (fe4.lbl.gov. [128.3.41.71])
        by mx.google.com with ESMTP id 3si17437338pfx.154.2017.01.23.18.08.02
        for <singu...@lbl.gov>;
        Mon, 23 Jan 2017 18:08:02 -0800 (PST)
Received-SPF: pass (google.com: domain of vso...@gmail.com designates 209.85.192.180 as permitted sender) client-ip=209.85.192.180;
Authentication-Results: mx.google.com;
       dkim=pass head...@gmail.com;
       spf=pass (google.com: domain of vso...@gmail.com designates 209.85.192.180 as permitted sender) smtp.mailfrom=vso...@gmail.com
X-Ironport-SBRS: 3.4
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: A2H5AADztYZYhrTAVdFbAx0BBQELARgBBQELAYMSAQEBAQF/A4EGg0sIigiRZR+MeYg1gUobJQMfAQyBbYQFAgICI4FhPxgBAQEBAQEBAQEBAQIQAQEBCAsLCh0wQg6BYwQCAxIFBAQ9DS4BAQEBAQEBAQEBAQEBAQEBGgINHgQVJgEBAQMBGgkEGQENDh4DAQsGBQsKAxgIAQkCAiECDgMBBQELEQ4HBAEcBIhPAQMQBwEFCaBxP4wCgWsYBQEcK4JeBYNpChknDVWCPAEBAQEBAQEDAQEBAQEBAQEBAQEVAgIECQEDAQSIPgiBWYEJglGBShEBCBQZCAwaB4I4LYISHwWJAGiFRH6KaTiGYocAhAiBd1KHWA+GPogfggCELhSCTzKBFB9xDS5UFToQAQOCFYFYKQ8RC4ICUgEBAQSDM4ImDhcwgWcBAQE
X-IronPort-AV: E=Sophos;i="5.33,276,1477983600"; 
   d="scan'208,217";a="61102867"
Received: from mail-pf0-f180.google.com ([209.85.192.180])
  by fe4.lbl.gov with ESMTP; 23 Jan 2017 18:07:59 -0800
Received: by mail-pf0-f180.google.com with SMTP id y143so45783367pfb.0
        for <singu...@lbl.gov>; Mon, 23 Jan 2017 18:08:00 -0800 (PST)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=from:content-transfer-encoding:mime-version:date:subject:message-id
         :references:in-reply-to:to;
        bh=+8SIwUeQWDp8iqIwcpV+wJbD+WRMFKj3iiLoDuQha1I=;
        b=G0OuA2l+WOHIt7K6o2YZGM/e3bMJ3h6CPs44YpL6OliHhvbQEsoMyld761/ft4slZj
         d21Qtpl1ioCql78aygK7Lwlr4dUaYZPRANdFYnCtJLhdXbC3cg0Cl21Uewjyyljr6X4R
         xpDR8oxsNXxJJA0XngyOHp2ApXL2iXMiimY1YQ5JnWonORI1SBsxLR9lOgVsuYM8cV9r
         Oxd6McumLM5uXWTChXKS6eMi4jIWk+hV4lfC+IQQo2nLTho8aCiP3zDU9SagST8GbZSY
         BuCzZl3cXyEsIbgX5PpwZrpD0ofxI0x15ByiuKJ9gLp9UVSs+3LKRMpz8AF13PAEkyUc
         eJig==
X-Gm-Message-State: AIkVDXJ6MTR0nNFNqzH96GjsL4roGqAiaYjopNMKAQ7bbS1kxRao3/6HDAQ4D/Mt8NsH7Q==
X-Received: by 10.99.38.2 with SMTP id m2mr2653932pgm.169.1485223679299;
        Mon, 23 Jan 2017 18:07:59 -0800 (PST)
Return-Path: <vso...@gmail.com>
Received: from [10.39.24.23] ([171.66.213.131])
        by smtp.gmail.com with ESMTPSA id c2sm39755070pfl.61.2017.01.23.18.07.57
        for <singu...@lbl.gov>
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Mon, 23 Jan 2017 18:07:58 -0800 (PST)
From: vanessa s <vso...@gmail.com>
Content-Type: multipart/alternative;
	boundary=Apple-Mail-B72CD182-ACD4-4DAD-A51F-DDCDC8383EC3
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (1.0)
Date: Mon, 23 Jan 2017 18:07:57 -0800
Subject: Re: [Singularity] Tensorflow Docker in Singularity Doesn't See GPU
Message-Id: <09494620-B74C-4714-A3EF-80F668CDFBF6@gmail.com>
References: <72b098d0-2753-44af-b3dd-55fc9b88ff5a@lbl.gov> <CAM=pu+Ji=hKmS0LKRDTz4QifHc4LnkJKRwmZwhWyJm9z0NDktQ@mail.gmail.com> <a0ec2d6e-7eac-4245-9eef-56512f86f4dd@lbl.gov> <28c93b72-1c78-e113-adfb-10c7423218b6@microway.com> <01ed6620-d103-464d-a9bb-de3f44285b3e@lbl.gov>
In-Reply-To: <01ed6620-d103-464d-a9bb-de3f44285b3e@lbl.gov>
To: singularity@lbl.gov
X-Mailer: iPhone Mail (14C92)

--Apple-Mail-B72CD182-ACD4-4DAD-A51F-DDCDC8383EC3
Content-Type: text/plain;
	charset=us-ascii
Content-Transfer-Encoding: quoted-printable

This is great! Do you want to try building the image via Singularity hub? I=
t's a weird one and would be a good test :) Let me know if you have questio=
ns - basically the build file should be a file called "Singularity" (akin t=
o Dockerfile) in the base of the repo that you connect to the hub, and each=
 time you push the image will build. You can maintain different tags by cre=
ating new branches!

https://www.singularity-hub.org

Best,

Vanessa

> On Jan 23, 2017, at 5:51 PM, Raphael Townshend <raph...@gmail.com> wrote:
>=20
> Eliot, thank you for figuring this out.  I updated https://github.com/dro=
rlab/tf-singularity to use pip to install tensorflow-gpu instead of the doc=
ker version, and it works out of the box again.
>=20
> One more thing to note, the tensorflow on docker does not seem to respect=
 version either.  I was trying to get 0.11.0rc2-gpu again and it kept givin=
g me 0.12.1 !  Not sure if this is an issue on Docker's end, or with singul=
arity Docker bootstrap.
>=20
>> On Monday, January 2, 2017 at 10:38:26 AM UTC-8, Eliot Eshelman wrote:
>> I was hitting the same problem. This seems very odd, but it appears the =
Docker image being returned does not include a version of TensorFlow built =
for GPUs.
>>=20
>> I tried the version being used on Sherlock (tensorflow/tensorflow:0.11.0=
rc2-gpu) as well as a new version that is listed on DockerHub (tensorflow/t=
ensorflow:latest-gpu). Neither seems to include GPU support.
>>=20
>>=20
>> If you take the Singularity container from above and run the following c=
ommands, you should end up with a version that works:
>>=20
>> pip uninstall tensorflow protobuf
>> pip install --upgrade https://storage.googleapis.com/tensorflow/linux/gp=
u/tensorflow-0.11.0-cp27-none-linux_x86_64.whl
>>=20
>> To test, run the Singularity and enter this into the Python interpreter:
>> import tensorflow as tf
>> sess =3D tf.Session(config=3Dtf.ConfigProto(log_device_placement=3DTrue)=
)
>>=20
>>=20
>> The way to tell whether you've got a GPU-enabled TensorFlow is to see if=
 any CUDA messages are printed when the tensorflow Python module is importe=
d. A non-GPU version will look like this:
>>=20
>> >>> import tensorflow as tf
>> >>>
>>=20
>> A GPU-enabled version will look something like this:
>>=20
>> >>> import tensorflow as tf
>> I tensorflow/stream_executor/dso_loader.cc:111] successfully opened CUDA=
 library libcublas.so locally
>> I tensorflow/stream_executor/dso_loader.cc:111] successfully opened CUDA=
 library libcudnn.so locally
>> I tensorflow/stream_executor/dso_loader.cc:111] successfully opened CUDA=
 library libcufft.so locally
>> I tensorflow/stream_executor/dso_loader.cc:111] successfully opened CUDA=
 library libcuda.so.1 locally
>> I tensorflow/stream_executor/dso_loader.cc:111] successfully opened CUDA=
 library libcurand.so locally
>> >>>
>>=20
>> P.S. I was also hitting the issue of the nvidia-uvm Linux kernel module =
needing to be loaded before the GPUs could be accessed from within the cont=
ainer. The nvidia-smi utility does not need uvm loaded, so it's not the bes=
t test that CUDA is operational. Better to use some of the samples included=
 with CUDA (they'll return CUDA errors). Once the host had loaded nvidia-uv=
m, all ran fine.
>>=20
>>=20
>>> On 12/25/16 15:21, Bharath Ramsundar wrote:
>>> Good sanity suggestion. I tried running with the python from the runscr=
ipt, but I'm still seeing the same error
>>>=20
>>> rbharath@tensorbr0:~/Tensorflow-singularity-container-with-GPU-support$=
 sudo singularity run ubuntu_tensorflow_GPU.img=20
>>> [sudo] password for rbharath:=20
>>> Python 2.7.6 (default, Oct 26 2016, 20:30:19)=20
>>> [GCC 4.8.4] on linux2
>>> Type "help", "copyright", "credits" or "license" for more              =
   information.
>>> >>> import tensorflow as tf
>>> >>> tf.Session(config=3Dtf.ConfigProto(log_device_placement=3DTrue))
>>> Device mapping: no known devices.
>>> I tensorflow/core/common_runtime/direct_session.cc:255] Device mapping:
>>>=20
>>> <tensorflow.python.client.session.Session object at 0x7f07bf8c1e90>
>>>=20
>>> This isn't my local machine python since the date (Oct 26) doesn't matc=
h the date (Nov 19th) on my system /usr/bin/python
>>>=20
>>> rbharath@tensorbr0:~/Tensorflow-singularity-container-with-GPU-support$=
 /usr/bin/python
>>> Python 2.7.12 (default, Nov 19 2016, 06:48:10)=20
>>> [GCC 5.4.0 20160609] on linux2
>>> Type "help", "copyright", "credits" or "license" for more              =
   information.
>>>=20
>>>> On Sunday, December 25, 2016 at 5:36:41 AM UTC-8, vanessa wrote:
>>>> Can you confirm that you are using the python inside the container? Yo=
u specify it in your runscript, but then in the example call ipython:
>>>>=20
>>>> /usr/local/lib/python2.7/dist-packages/IPython/paths.py:69: UserWarnin=
g: IPython parent '/home/rbharath' is not a writable location, using a temp=
 directory.
>>>>=20
>>>> I've run into the bug of using my (local machine) python from inside t=
he image, instead of the image's, so confirming that you are using /usr/bin=
/python inside the image would be a good place to start.
>>>>=20
>>>>> On Sat, Dec 24, 2016 at 11:39 PM, Bharath Ramsundar <bha...@gmail.com=
> wrote:
>>>>> Hi,
>>>>>=20
>>>>> I'm attempting to run Tensorflow within singularity on an Ubuntu 16.0=
4 machine. I'm using the Tensorflow docker to bootstrap (I've been using ht=
tps://github.com/drorlab/tf-singularity and https://github.com/jdongca2003/=
Tensorflow-singularity-container-with-GPU-support as my guides). I'm able t=
o successfully build the singularity image and run tensorflow within it, bu=
t only with CPU. I've checked that I'm using the same NVIDIA driver version=
 and CUDA versions in singularity as on the machine, so I don't think that'=
s the issue. I'm able to use nvidia-smi from                       within t=
he image to view the GPUs, but just not able to access the GPU from tensorf=
low. I've listed my output below, along with the code I used to generate th=
e image. Any advice would be much appreciated :-)
>>>>>=20
>>>>> rbharath:~/Tensorflow-singularity-container-with-GPU-support$ sudo si=
ngularity shell -w ubuntu_tensorflow_GPU.img=20
>>>>> Singularity: Invoking an interactive shell within container...
>>>>>=20
>>>>> Singularity.ubuntu_tensorflow_GPU.img> # nvidia-smi
>>>>> Sun Dec 25 07:35:43 2016      =20
>>>>> +--------------------------------------------------------------------=
---------+
>>>>> | NVIDIA-SMI 367.57                 Driver Version: 367.57           =
         |
>>>>> |-------------------------------+----------------------+-------------=
---------+
>>>>> | GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Unc=
orr. ECC |
>>>>> | Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Co=
mpute M. |
>>>>> |=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D|
>>>>> |   0  GeForce GTX 1080    Off  | 0000:01:00.0      On |             =
     N/A |
>>>>> | 27%   37C    P8    12W / 180W |     62MiB /  8110MiB |      0%     =
 Default |
>>>>> +-------------------------------+----------------------+-------------=
---------+
>>>>> |   1  GeForce GTX 1080    Off  | 0000:02:00.0     Off |             =
     N/A |
>>>>> | 27%   34C    P8    11W / 180W |      1MiB /  8113MiB |      0%     =
 Default |
>>>>> +-------------------------------+----------------------+-------------=
---------+
>>>>>                                                                      =
                                    =20
>>>>> +--------------------------------------------------------------------=
---------+
>>>>> | Processes:                                                         =
                          GPU Memory |
>>>>> |  GPU       PID  Type  Process name                               Us=
age      |
>>>>> |=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D|
>>>>> |    0      3509    G   /usr/lib/xorg/Xorg                           =
   60MiB |
>>>>> +--------------------------------------------------------------------=
---------+
>>>>> Singularity.ubuntu_tensorflow_GPU.img> # ldconfig -p | grep libcuda
>>>>>         libcudart.so.8.0 (libc6,x86-64) =3D> /usr/local/cuda/lib64/li=
bcudart.so.8.0
>>>>>         libcudart.so (libc6,x86-64) =3D> /usr/local/cuda/lib64/libcud=
art.so
>>>>>         libcuda.so.1 (libc6,x86-64) =3D> /usr/local/NVIDIA-Linux-x86_=
64-367.57/libcuda.so.1
>>>>>         libcuda.so (libc6,x86-64) =3D> /usr/local/NVIDIA-Linux-x86_64=
-367.57/libcuda.so
>>>>> Singularity.ubuntu_tensorflow_GPU.img> # ipython
>>>>> /usr/local/lib/python2.7/dist-packages/IPython/paths.py:69: UserWarni=
ng: IPython parent '/home/rbharath' is not a writable location, using a tem=
p directory.
>>>>>   " using a temp directory.".format(parent))
>>>>> Python 2.7.6 (default, Oct 26 2016, 20:30:19)=20
>>>>> Type "copyright", "credits" or "license" for more information.
>>>>>=20
>>>>> IPython 5.1.0 -- An enhanced Interactive Python.
>>>>> ?         -> Introduction and overview of IPython's features.
>>>>> %quickref -> Quick reference.
>>>>> help      -> Python's own help system.
>>>>> object?   -> Details about 'object', use 'object??' for extra details=
.
>>>>>=20
>>>>> In [1]: import tensorflow as tf
>>>>>=20
>>>>> In [2]: tf.Session(config=3Dtf.ConfigProto(log_device_placement=3DTru=
e))
>>>>> Device mapping: no known devices.
>>>>> I tensorflow/core/common_runtime/direct_session.cc:255] Device mappin=
g:
>>>>>=20
>>>>> Out[2]: <tensorflow.python.client.session.Session at 0x7f97c853b210>
>>>>>=20
>>>>> For completeness, I've listed below the code I use to build the image=
. The entrypoint is running=20
>>>>>=20
>>>>> sh build.sh
>>>>>=20
>>>>> ############# build.sh
>>>>> echo "Removing old GPU image"
>>>>> sudo rm -f ubuntu_tensorflow_GPU.img
>>>>> echo "Creating GPU image"
>>>>> sudo singularity create -s 5000 ubuntu_tensorflow_GPU.img
>>>>> echo "Bootstrapping image"
>>>>> sudo singularity bootstrap ubuntu_tensorflow_GPU.img tf-gpu.def
>>>>> echo "Running tensorflow install script"
>>>>> sudo singularity exec -B `pwd`:/mnt -w ubuntu_tensorflow_GPU.img sh /=
mnt/tensorflow.sh
>>>>>=20
>>>>> ############# tf-gpu.def
>>>>> # Copyright (c) 2015-2016, Gregory M. Kurtzer. All rights reserved.
>>>>> #=20
>>>>> # "Singularity" Copyright (c) 2016, The Regents of the University of =
California,
>>>>> # through Lawrence Berkeley National Laboratory (subject to receipt o=
f any
>>>>> # required approvals from the U.S. Dept. of Energy).  All rights rese=
rved.
>>>>>=20
>>>>> BootStrap: docker
>>>>> From: tensorflow/tensorflow:latest-gpu=20
>>>>> IncludeCmd: yes
>>>>>=20
>>>>> %runscript
>>>>>     exec /usr/bin/python "$@"
>>>>>=20
>>>>> %post
>>>>>     apt-get update && apt-get -y upgrade
>>>>>     apt-get install git -y
>>>>>=20
>>>>> ############# tensorflow.sh
>>>>> driver_version=3D367.57
>>>>> cuda_version=3D8.0.44_linux
>>>>> cudnn_version=3D8.0-linux-x64-v5.1
>>>>> sh /mnt/NVIDIA-Linux-x86_64-$driver_version.run -x
>>>>> mv NVIDIA-Linux-x86_64-$driver_version /usr/local/
>>>>> sh /mnt/links.sh $driver_version
>>>>>=20
>>>>> sh /mnt/cuda_$cuda_version.run --toolkit --silent
>>>>> tar xvf /mnt/cudnn-$cudnn_version.tgz -C /usr/local
>>>>>=20
>>>>> driver_path=3D/usr/local/NVIDIA-Linux-x86_64-$driver_version
>>>>> sudo echo "/usr/local/cuda/lib64" >> /etc/ld.so.conf
>>>>> sudo echo "$driver_path" >> /etc/ld.so.conf
>>>>> # ldconfig doesn't list lubcuda*/libcudnn* without explicit commands
>>>>> sudo ldconfig /usr/local/cuda/lib64
>>>>> sudo ldconfig $driver_path
>>>>>=20
>>>>> echo " " >> /environment
>>>>> echo "LD_LIBRARY_PATH=3D/usr/local/cuda/lib64:$driver_path:$LD_LIBRAR=
Y_PATH" >> /environment
>>>>> echo "PATH=3D$driver_path:\$PATH" >> /environment
>>>>> echo "export CUDA_HOME=3D/usr/local/cuda" >> /environment
>>>>> echo "export PATH LD_LIBRARY_PATH" >> /environment
>>>>>=20
>>>>> ############# links.sh
>>>>> #!/usr/bin/bash
>>>>>=20
>>>>> dir=3D/usr/local/NVIDIA-Linux-x86_64-$1
>>>>>=20
>>>>> cd $dir
>>>>>=20
>>>>> ln -s libcuda.so.$1 libcuda.so
>>>>> ln -s libEGL.so.$1 libEGL.so
>>>>> ln -s libGLESv1_CM.so.$1 libGLESv1_CM.so=20
>>>>> ln -s libGLESv2.so.$1 libGLESv2.so
>>>>> ln -s libGL.so.$1 libGL.so
>>>>> ln -s libglx.so.$1 libglx.so
>>>>> ln -s libnvcuvid.so.$1 libnvcuvid.so
>>>>> ln -s libnvidia-cfg.so.$1 libnvidia-cfg.so
>>>>> ln -s libnvidia-compiler.so.$1                             libnvidia-=
compiler.so
>>>>> ln -s libnvidia-eglcore.so.$1 libnvidia-eglcore.so
>>>>> ln -s libnvidia-encode.so.$1 libnvidia-encode.so
>>>>> ln -s libnvidia-fbc.so.$1 libnvidia-fbc.so
>>>>> ln -s libnvidia-glcore.so.$1 libnvidia-glcore.so
>>>>> ln -s libnvidia-glsi.so.$1 libnvidia-glsi.so
>>>>> ln -s libnvidia-gtk2.so.$1 libnvidia-gtk2.so
>>>>> ln -s libnvidia-gtk3.so.$1 libnvidia-gtk3.so
>>>>> ln -s libnvidia-ifr.so.$1 libnvidia-ifr.so
>>>>> ln -s libnvidia-ml.so.$1 libnvidia-ml.so
>>>>> ln -s libnvidia-ml.so.$1 libnvidia-ml.so.1
>>>>> ln -s libnvidia-opencl.so.$1 libnvidia-opencl.so
>>>>> ln -s libnvidia-tls.so.$1 libnvidia-tls.so
>>>>> ln -s libnvidia-wfb.so.$1 libnvidia-wfb.so
>>>>> ln -s libvdpau_nvidia.so.$1 libvdpau_nvidia.so
>>>>> ln -s libvdpau.so.$1 libvdpau.so
>>>>> ln -s libvdpau_trace.so.$1 libvdpau_trace.so
>>>>> ln -s libcuda.so.$1 libcuda.so.1
>>>>>=20
>>>>> --=20
>>>>> You received this message because you are subscribed to the Google Gr=
oups "singularity" group.
>>>>> To unsubscribe from this group and stop receiving emails from it, sen=
d an email to singu...@lbl.gov.
>>>>=20
>>>>=20
>>>>=20
>>>> --=20
>>>> Vanessa Villamia Sochat
>>>> Stanford University '16
>>>> (603) 321-0676
>>> --=20
>>> You received this message because you are subscribed to the Google Grou=
ps "singularity" group.
>>> To unsubscribe from this group and stop receiving emails from it, send =
an email to singu...@lbl.gov.
>>=20
>=20
> --=20
> You received this message because you are subscribed to the Google Groups=
 "singularity" group.
> To unsubscribe from this group and stop receiving emails from it, send an=
 email to singu...@lbl.gov.

--Apple-Mail-B72CD182-ACD4-4DAD-A51F-DDCDC8383EC3
Content-Type: text/html;
	charset=utf-8
Content-Transfer-Encoding: quoted-printable

<html><head><meta http-equiv=3D"content-type" content=3D"text/html; charset=
=3Dutf-8"></head><body dir=3D"auto"><div>This is great! Do you want to try =
building the image via Singularity hub? It's a weird one and would be a goo=
d test :) Let me know if you have questions - basically the build file shou=
ld be a file called "Singularity" (akin to Dockerfile) in the base of the r=
epo that you connect to the hub, and each time you push the image will buil=
d. You can maintain different tags by creating new branches!</div><div id=
=3D"AppleMailSignature"><br></div><div id=3D"AppleMailSignature"><a href=3D=
"https://www.singularity-hub.org">https://www.singularity-hub.org</a><br><b=
r>Best,<div><br></div><div>Vanessa</div></div><div><br>On Jan 23, 2017, at =
5:51 PM, Raphael Townshend &lt;<a href=3D"mailto:raph...@gmail.com">raph...=
@gmail.com</a>&gt; wrote:<br><br></div><blockquote type=3D"cite"><div><div =
dir=3D"ltr">Eliot, thank you for figuring this out. &nbsp;I updated&nbsp;<a=
 href=3D"https://github.com/drorlab/tf-singularity">https://github.com/<wbr=
>drorlab/tf-singularity</a>&nbsp;to use pip to install tensorflow-gpu inste=
ad of the docker version, and it works out of the box again.<div><br></div>=
<div>One more thing to note, the tensorflow on docker does not seem to resp=
ect version either. &nbsp;I was trying to get 0.11.0rc2-gpu again and it ke=
pt giving me 0.12.1 ! &nbsp;Not sure if this is an issue on Docker's end, o=
r with singularity Docker bootstrap.<br><br>On Monday, January 2, 2017 at 1=
0:38:26 AM UTC-8, Eliot Eshelman wrote:<blockquote class=3D"gmail_quote" st=
yle=3D"margin: 0;margin-left: 0.8ex;border-left: 1px #ccc solid;padding-lef=
t: 1ex;">
 =20
   =20
 =20
  <div bgcolor=3D"#FFFFFF" text=3D"#000000">
    <p>I was hitting the same problem. This seems very odd, but it
      appears the Docker image being returned does not include a version
      of TensorFlow built for GPUs.</p>
    <p>I tried the version being used on Sherlock
      (tensorflow/tensorflow:0.11.<wbr>0rc2-gpu) as well as a new version
      that is listed on DockerHub (tensorflow/tensorflow:latest-<wbr>gpu).
      Neither seems to include GPU support.</p>
    <p><br>
    </p>
    <p>If you take the Singularity container from above and run the
      following commands, you should end up with a version that works:</p>
    <p><tt>pip uninstall tensorflow protobuf</tt><tt><br>
      </tt>
     =20
      <tt>pip install --upgrade </tt>
     =20
      <tt><a href=3D"https://storage.googleapis.com/tensorflow/linux/gpu/te=
nsorflow-0.11.0-cp27-none-linux_x86_64.whl" target=3D"_blank" rel=3D"nofoll=
ow" onmousedown=3D"this.href=3D'https://storage.googleapis.com/tensorflow/l=
inux/gpu/tensorflow-0.11.0-cp27-none-linux_x86_64.whl';return true;" onclic=
k=3D"this.href=3D'https://storage.googleapis.com/tensorflow/linux/gpu/tenso=
rflow-0.11.0-cp27-none-linux_x86_64.whl';return true;">https://storage.goog=
leapis.<wbr>com/tensorflow/linux/gpu/<wbr>tensorflow-0.11.0-cp27-none-<wbr>=
linux_x86_64.whl</a></tt></p>
    <p>To test, run the Singularity and enter this into the Python
      interpreter:<br>
    </p>
    <p><tt>import tensorflow as tf</tt><tt><br>
      </tt><tt>sess =3D
        tf.Session(config=3Dtf.<wbr>ConfigProto(log_device_<wbr>placement=
=3DTrue))</tt></p>
    <p><br>
    </p>
    <p>The way to tell whether you've got a GPU-enabled TensorFlow is to
      see if any CUDA messages are printed when the tensorflow Python
      module is imported. A non-GPU version will look like this:</p>
    <p><tt>&gt;&gt;&gt; import tensorflow as tf</tt><tt><br>
      </tt><tt>&gt;&gt;&gt;</tt></p>
    <p>A GPU-enabled version will look something like this:</p>
    <p><tt>&gt;&gt;&gt; import tensorflow as tf</tt><tt><br>
      </tt><tt>I tensorflow/stream_executor/<wbr>dso_loader.cc:111]
        successfully opened CUDA library libcublas.so locally</tt><tt><br>
      </tt><tt>I tensorflow/stream_executor/<wbr>dso_loader.cc:111]
        successfully opened CUDA library libcudnn.so locally</tt><tt><br>
      </tt><tt>I tensorflow/stream_executor/<wbr>dso_loader.cc:111]
        successfully opened CUDA library libcufft.so locally</tt><tt><br>
      </tt><tt>I tensorflow/stream_executor/<wbr>dso_loader.cc:111]
        successfully opened CUDA library libcuda.so.1 locally</tt><tt><br>
      </tt><tt>I tensorflow/stream_executor/<wbr>dso_loader.cc:111]
        successfully opened CUDA library libcurand.so locally</tt><tt><br>
      </tt><tt>&gt;&gt;&gt;</tt><br>
    </p>
    <p><br>
    </p>
    <p>P.S. I was also hitting the issue of the <tt>nvidia-uvm</tt>
      Linux kernel module needing to be loaded before the GPUs could be
      accessed from within the container. The <tt>nvidia-smi</tt>
      utility does not need uvm loaded, so it's not the best test that
      CUDA is operational. Better to use some of the samples included
      with CUDA (they'll return CUDA errors). Once the host had loaded
      nvidia-uvm, all ran fine.<br>
    </p>
    <p><br>
    </p>
    <br>
    <div>On 12/25/16 15:21, Bharath Ramsundar
      wrote:<br>
    </div>
    <blockquote type=3D"cite">
      <div dir=3D"ltr">Good sanity suggestion. I tried running with the
        python from the runscript, but I'm still seeing the same error
        <div><br>
        </div>
        <blockquote style=3D"margin:0 0 0 40px;border:none;padding:0px">
          <div>
            <div><font face=3D"courier new, monospace">rbharath@tensorbr0:~=
/<wbr>Tensorflow-singularity-<wbr>container-with-GPU-support$
                sudo singularity run ubuntu_tensorflow_GPU.img&nbsp;</font>=
</div>
          </div>
          <div>
            <div><font face=3D"courier new, monospace">[sudo] password for
                rbharath:&nbsp;</font></div>
          </div>
          <div>
            <div><font face=3D"courier new, monospace">Python 2.7.6
                (default, Oct 26 2016, 20:30:19)&nbsp;</font></div>
          </div>
          <div>
            <div><font face=3D"courier new, monospace">[GCC 4.8.4] on
                linux2</font></div>
          </div>
          <div>
            <div><font face=3D"courier new, monospace">Type "help",
                "copyright", "credits" or "license" for more
                information.</font></div>
          </div>
          <div>
            <div><font face=3D"courier new, monospace">&gt;&gt;&gt; import
                tensorflow as tf</font></div>
          </div>
          <div>
            <div><font face=3D"courier new, monospace">&gt;&gt;&gt;
                tf.Session(config=3Dtf.<wbr>ConfigProto(log_device_<wbr>pla=
cement=3DTrue))</font></div>
          </div>
          <div>
            <div><font face=3D"courier new, monospace">Device mapping: no
                known devices.</font></div>
          </div>
          <div>
            <div><font face=3D"courier new, monospace">I
                tensorflow/core/common_<wbr>runtime/direct_session.cc:255]
                Device mapping:</font></div>
          </div>
          <div>
            <div><font face=3D"courier new, monospace"><br>
              </font></div>
          </div>
          <div>
            <div><font face=3D"courier new, monospace">&lt;tensorflow.pytho=
n.client.<wbr>session.Session
                object at 0x7f07bf8c1e90&gt;</font></div>
          </div>
        </blockquote>
        <div>
          <div><br>
          </div>
          <div>This isn't my local machine python since the date (Oct
            26) doesn't match the date (Nov 19th) on my system
            /usr/bin/python</div>
          <div><br>
          </div>
        </div>
        <blockquote style=3D"margin:0 0 0 40px;border:none;padding:0px">
          <div>
            <div><font face=3D"courier new, monospace">rbharath@tensorbr0:~=
/<wbr>Tensorflow-singularity-<wbr>container-with-GPU-support$
                /usr/bin/python</font></div>
          </div>
          <div>
            <div><font face=3D"courier new, monospace">Python 2.7.12
                (default, Nov 19 2016, 06:48:10)&nbsp;</font></div>
          </div>
          <div>
            <div><font face=3D"courier new, monospace">[GCC 5.4.0
                20160609] on linux2</font></div>
          </div>
          <div>
            <div><font face=3D"courier new, monospace">Type "help",
                "copyright", "credits" or "license" for more
                information.</font></div>
          </div>
        </blockquote>
        <div>
          <div><br>
          </div>
          On Sunday, December 25, 2016 at 5:36:41 AM UTC-8, vanessa
          wrote:
          <blockquote class=3D"gmail_quote" style=3D"margin:0;margin-left:0=
.8ex;border-left:1px #ccc solid;padding-left:1ex">
            <div dir=3D"ltr">Can you confirm that you are using the python
              inside the container? You specify it in your runscript,
              but then in the example call ipython:
              <div><br>
              </div>
              <div><span>/usr/local/lib/python2.7/dist-</span><span><wbr>pa=
ckages/IPython/paths.py:69:
                  UserWarning: IPython parent '/home/rbharath' is not a
                  writable location, using a temp directory.</span><br>
              </div>
              <div><span><br>
                </span></div>
              <div>I've run into the bug of using my (local machine)
                python from inside the image, instead of the image's, so
                confirming that you are using /usr/bin/python inside the
                image would be a good place to start.</div>
            </div>
            <div><br>
              <div class=3D"gmail_quote">On Sat, Dec 24, 2016 at 11:39 PM,
                Bharath Ramsundar <span dir=3D"ltr">&lt;<a rel=3D"nofollow"=
>bha...@gmail.com</a>&gt;</span>
                wrote:<br>
                <blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8e=
x;border-left:1px #ccc solid;padding-left:1ex">
                  <div dir=3D"ltr">Hi,
                    <div><br>
                    </div>
                    <div>I'm attempting to run Tensorflow within
                      singularity on an Ubuntu 16.04 machine. I'm using
                      the Tensorflow docker to bootstrap (I've been
                      using&nbsp;<a href=3D"https://github.com/drorlab/tf-s=
ingularity" rel=3D"nofollow" target=3D"_blank" onmousedown=3D"this.href=3D'=
https://www.google.com/url?q\x3dhttps%3A%2F%2Fgithub.com%2Fdrorlab%2Ftf-sin=
gularity\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNErD_PABGkMHJcMbrwxntT_wqtN=
Aw';return true;" onclick=3D"this.href=3D'https://www.google.com/url?q\x3dh=
ttps%3A%2F%2Fgithub.com%2Fdrorlab%2Ftf-singularity\x26sa\x3dD\x26sntz\x3d1\=
x26usg\x3dAFQjCNErD_PABGkMHJcMbrwxntT_wqtNAw';return true;">https://github.=
com/<wbr>drorlab/tf-singularity</a>
                      and&nbsp;<a href=3D"https://github.com/jdongca2003/Te=
nsorflow-singularity-container-with-GPU-support" rel=3D"nofollow" target=3D=
"_blank" onmousedown=3D"this.href=3D'https://www.google.com/url?q\x3dhttps%=
3A%2F%2Fgithub.com%2Fjdongca2003%2FTensorflow-singularity-container-with-GP=
U-support\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNF5LvtN0aXWp_5uXatcF3N2BaI=
B-g';return true;" onclick=3D"this.href=3D'https://www.google.com/url?q\x3d=
https%3A%2F%2Fgithub.com%2Fjdongca2003%2FTensorflow-singularity-container-w=
ith-GPU-support\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNF5LvtN0aXWp_5uXatcF=
3N2BaIB-g';return true;">https://github.com/<wbr>jdongca2003/Tensorflow-<wb=
r>singularity-container-with-<wbr>GPU-support</a>
                      as my guides). I'm able to successfully build the
                      singularity image and run tensorflow within it,
                      but only with CPU. I've checked that I'm using the
                      same NVIDIA driver version and CUDA versions in
                      singularity as on the machine, so I don't think
                      that's the issue. I'm able to use nvidia-smi from
                      within the image to view the GPUs, but just not
                      able to access the GPU from tensorflow. I've
                      listed my output below, along with the code I used
                      to generate the image. Any advice would be much
                      appreciated :-)</div>
                    <div><br>
                    </div>
                    <blockquote style=3D"margin:0 0 0 40px;border:none;padd=
ing:0px">
                      <div>
                        <div><font face=3D"courier new, monospace">rbharath=
:~/Tensorflow-<wbr>singularity-container-with-<wbr>GPU-support$
                            sudo singularity shell -w
                            ubuntu_tensorflow_GPU.img&nbsp;</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">Singular=
ity:
                            Invoking an interactive shell within
                            container...</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace"><br>
                          </font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">Singular=
ity.ubuntu_tensorflow_<wbr>GPU.img&gt;
                            # nvidia-smi</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">Sun Dec
                            25 07:35:43 2016 &nbsp; &nbsp; &nbsp;&nbsp;</fo=
nt></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">+-------=
----------------------<wbr>------------------------------<wbr>-------------=
-----+</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">|
                            NVIDIA-SMI 367.57 &nbsp; &nbsp; &nbsp; &nbsp; &=
nbsp; &nbsp; &nbsp; &nbsp; Driver
                            Version: 367.57 &nbsp; &nbsp; &nbsp; &nbsp; &nb=
sp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">|-------=
----------------------<wbr>--+----------------------+----<wbr>-------------=
-----+</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">| GPU
                            &nbsp;Name &nbsp; &nbsp; &nbsp; &nbsp;Persisten=
ce-M| Bus-Id &nbsp; &nbsp; &nbsp;
                            &nbsp;Disp.A | Volatile Uncorr. ECC |</font></d=
iv>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">| Fan
                            &nbsp;Temp &nbsp;Perf &nbsp;Pwr:Usage/Cap| &nbs=
p; &nbsp; &nbsp; &nbsp;
                            Memory-Usage | GPU-Util &nbsp;Compute M. |</fon=
t></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">|=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D<wbr>=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D+=3D=3D=3D=3D<wbr>=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D|</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">| &nbsp;=
 0
                            &nbsp;GeForce GTX 1080 &nbsp; &nbsp;Off &nbsp;|=
 0000:01:00.0 &nbsp; &nbsp;
                            &nbsp;On | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &=
nbsp; &nbsp; &nbsp; &nbsp;N/A |</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">| 27% &n=
bsp;
                            37C &nbsp; &nbsp;P8 &nbsp; &nbsp;12W / 180W | &=
nbsp; &nbsp; 62MiB /
                            &nbsp;8110MiB | &nbsp; &nbsp; &nbsp;0% &nbsp; &=
nbsp; &nbsp;Default |</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">+-------=
----------------------<wbr>--+----------------------+----<wbr>-------------=
-----+</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">| &nbsp;=
 1
                            &nbsp;GeForce GTX 1080 &nbsp; &nbsp;Off &nbsp;|=
 0000:02:00.0 &nbsp; &nbsp;
                            Off | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;=
 &nbsp; &nbsp; &nbsp;N/A |</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">| 27% &n=
bsp;
                            34C &nbsp; &nbsp;P8 &nbsp; &nbsp;11W / 180W | &=
nbsp; &nbsp; &nbsp;1MiB /
                            &nbsp;8113MiB | &nbsp; &nbsp; &nbsp;0% &nbsp; &=
nbsp; &nbsp;Default |</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">+-------=
----------------------<wbr>--+----------------------+----<wbr>-------------=
-----+</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">&nbsp; &=
nbsp; &nbsp; &nbsp;
                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp=
; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nb=
sp; &nbsp; &nbsp; &nbsp; &nbsp;
                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp=
; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">+-------=
----------------------<wbr>------------------------------<wbr>-------------=
-----+</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">|
                            Processes: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &=
nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;=
 &nbsp;
                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp=
; &nbsp; &nbsp; &nbsp; GPU Memory |</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">| &nbsp;=
GPU
                            &nbsp; &nbsp; &nbsp; PID &nbsp;Type &nbsp;Proce=
ss name &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp=
; &nbsp; Usage &nbsp; &nbsp; &nbsp;|</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">|=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D<wbr>=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D<wbr>=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D|</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">| &nbsp;=
 &nbsp;0
                            &nbsp; &nbsp; &nbsp;3509 &nbsp; &nbsp;G &nbsp; =
/usr/lib/xorg/Xorg &nbsp; &nbsp; &nbsp; &nbsp;
                            &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp=
; &nbsp; &nbsp; &nbsp; &nbsp;60MiB |</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">+-------=
----------------------<wbr>------------------------------<wbr>-------------=
-----+</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">Singular=
ity.ubuntu_tensorflow_<wbr>GPU.img&gt;
                            # ldconfig -p | grep libcuda</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">&nbsp; &=
nbsp; &nbsp; &nbsp;
                            libcudart.so.8.0 (libc6,x86-64) =3D&gt;
                            /usr/local/cuda/lib64/<wbr>libcudart.so.8.0</fo=
nt></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">&nbsp; &=
nbsp; &nbsp; &nbsp;
                            libcudart.so (libc6,x86-64) =3D&gt;
                            /usr/local/cuda/lib64/<wbr>libcudart.so</font><=
/div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">&nbsp; &=
nbsp; &nbsp; &nbsp;
                            libcuda.so.1 (libc6,x86-64) =3D&gt;
                            /usr/local/NVIDIA-Linux-x86_<wbr>64-367.57/libc=
uda.so.1</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">&nbsp; &=
nbsp; &nbsp; &nbsp;
                            libcuda.so (libc6,x86-64) =3D&gt;
                            /usr/local/NVIDIA-Linux-x86_<wbr>64-367.57/libc=
uda.so</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">Singular=
ity.ubuntu_tensorflow_<wbr>GPU.img&gt;
                            # ipython</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">/usr/loc=
al/lib/python2.7/dist-<wbr>packages/IPython/paths.py:69:
                            UserWarning: IPython parent '/home/rbharath'
                            is not a writable location, using a temp
                            directory.</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">&nbsp; "
                            using a temp directory.".format(parent))</font>=
</div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">Python
                            2.7.6 (default, Oct 26 2016, 20:30:19)&nbsp;</f=
ont></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">Type
                            "copyright", "credits" or "license" for more
                            information.</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace"><br>
                          </font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">IPython
                            5.1.0 -- An enhanced Interactive Python.</font>=
</div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">? &nbsp;=
 &nbsp; &nbsp;
                            &nbsp; -&gt; Introduction and overview of
                            IPython's features.</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">%quickre=
f
                            -&gt; Quick reference.</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">help &nb=
sp;
                            &nbsp; &nbsp;-&gt; Python's own help system.</f=
ont></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">object?
                            &nbsp; -&gt; Details about 'object', use
                            'object??' for extra details.</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace"><br>
                          </font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">In [1]:
                            import tensorflow as tf</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace"><br>
                          </font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">In [2]:
                            tf.Session(config=3Dtf.<wbr>ConfigProto(log_dev=
ice_<wbr>placement=3DTrue))</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">Device
                            mapping: no known devices.</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">I
                            tensorflow/core/common_<wbr>runtime/direct_sess=
ion.cc:255]
                            Device mapping:</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace"><br>
                          </font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">Out[2]:
                            &lt;tensorflow.python.client.<wbr>session.Sessi=
on
                            at 0x7f97c853b210&gt;</font></div>
                      </div>
                    </blockquote>
                    <div><br>
                    </div>
                    <div>For completeness, I've listed below the code I
                      use to build the image. The entrypoint is running&nbs=
p;<br>
                    </div>
                    <div><br>
                    </div>
                    <blockquote style=3D"margin:0 0 0 40px;border:none;padd=
ing:0px">
                      <div><font face=3D"courier new, monospace">sh
                          build.sh</font></div>
                      <div><font face=3D"courier new, monospace"><br>
                        </font></div>
                      <div><font face=3D"courier new, monospace">##########=
###
                          build.sh</font></div>
                      <div>
                        <div><font face=3D"courier new, monospace">echo
                            "Removing old GPU image"</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">sudo rm
                            -f ubuntu_tensorflow_GPU.img</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">echo
                            "Creating GPU image"</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">sudo
                            singularity create -s 5000
                            ubuntu_tensorflow_GPU.img</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">echo
                            "Bootstrapping image"</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">sudo
                            singularity bootstrap
                            ubuntu_tensorflow_GPU.img tf-gpu.def</font></di=
v>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">echo
                            "Running tensorflow install script"</font></div=
>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">sudo
                            singularity exec -B `pwd`:/mnt -w
                            ubuntu_tensorflow_GPU.img sh
                            /mnt/tensorflow.sh</font></div>
                      </div>
                      <div><font face=3D"courier new, monospace"><br>
                        </font></div>
                      <div><font face=3D"courier new, monospace">##########=
###
                          tf-gpu.def</font></div>
                      <div>
                        <div><font face=3D"courier new, monospace">#
                            Copyright (c) 2015-2016, Gregory M. Kurtzer.
                            All rights reserved.</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">#&nbsp;<=
/font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">#
                            "Singularity" Copyright (c) 2016, The
                            Regents of the University of California,</font>=
</div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">#
                            through Lawrence Berkeley National
                            Laboratory (subject to receipt of any</font></d=
iv>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">#
                            required approvals from the U.S. Dept. of
                            Energy).&nbsp; All rights reserved.</font></div=
>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace"><br>
                          </font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">BootStra=
p:
                            docker</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">From:
                            tensorflow/tensorflow:latest-<wbr>gpu&nbsp;</fo=
nt></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">IncludeC=
md:
                            yes</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace"><br>
                          </font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">%runscri=
pt</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">&nbsp; &=
nbsp;
                            exec /usr/bin/python "$@"</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace"><br>
                          </font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">%post</f=
ont></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">&nbsp; &=
nbsp;
                            apt-get update &amp;&amp; apt-get -y upgrade</f=
ont></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">&nbsp; &=
nbsp;
                            apt-get install git -y</font></div>
                      </div>
                      <div><font face=3D"courier new, monospace"><br>
                        </font></div>
                      <div><font face=3D"courier new, monospace">##########=
###
                          tensorflow.sh</font></div>
                      <div>
                        <div><font face=3D"courier new, monospace">driver_v=
ersion=3D367.57</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">cuda_ver=
sion=3D8.0.44_linux</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">cudnn_ve=
rsion=3D8.0-linux-x64-<wbr>v5.1</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">sh
                            /mnt/NVIDIA-Linux-x86_64-$<wbr>driver_version.r=
un
                            -x</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">mv
                            NVIDIA-Linux-x86_64-$driver_<wbr>version
                            /usr/local/</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">sh
                            /mnt/links.sh $driver_version</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace"><br>
                          </font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">sh
                            /mnt/cuda_$cuda_version.run --toolkit
                            --silent</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">tar xvf
                            /mnt/cudnn-$cudnn_version.tgz -C /usr/local</fo=
nt></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace"><br>
                          </font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">driver_p=
ath=3D/usr/local/NVIDIA-<wbr>Linux-x86_64-$driver_version</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">sudo
                            echo "/usr/local/cuda/lib64" &gt;&gt;
                            /etc/ld.so.conf</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">sudo
                            echo "$driver_path" &gt;&gt; /etc/ld.so.conf</f=
ont></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">#
                            ldconfig doesn't list lubcuda*/libcudnn*
                            without explicit commands</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">sudo
                            ldconfig /usr/local/cuda/lib64</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">sudo
                            ldconfig $driver_path</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace"><br>
                          </font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">echo "
                            " &gt;&gt; /environment</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">echo
                            "LD_LIBRARY_PATH=3D/usr/local/<wbr>cuda/lib64:$=
driver_path:$LD_<wbr>LIBRARY_PATH"
                            &gt;&gt; /environment</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">echo
                            "PATH=3D$driver_path:\$PATH" &gt;&gt;
                            /environment</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">echo
                            "export CUDA_HOME=3D/usr/local/cuda" &gt;&gt;
                            /environment</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">echo
                            "export PATH LD_LIBRARY_PATH" &gt;&gt;
                            /environment</font></div>
                      </div>
                      <div><font face=3D"courier new, monospace"><br>
                        </font></div>
                      <div><font face=3D"courier new, monospace">##########=
###
                          links.sh</font></div>
                      <div>
                        <div><font face=3D"courier new, monospace">#!/usr/b=
in/bash</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace"><br>
                          </font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">dir=3D/u=
sr/local/NVIDIA-Linux-<wbr>x86_64-$1</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace"><br>
                          </font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">cd $dir<=
/font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace"><br>
                          </font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libcuda.so.$1 libcuda.so</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libEGL.so.$1 libEGL.so</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libGLESv1_CM.so.$1 libGLESv1_CM.so&nbsp;</font>=
</div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libGLESv2.so.$1 libGLESv2.so</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libGL.so.$1 libGL.so</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libglx.so.$1 libglx.so</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvcuvid.so.$1 libnvcuvid.so</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-cfg.so.$1 libnvidia-cfg.so</font></di=
v>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-compiler.so.$1
                            libnvidia-compiler.so</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-eglcore.so.$1 libnvidia-eglcore.so</f=
ont></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-encode.so.$1 libnvidia-encode.so</fon=
t></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-fbc.so.$1 libnvidia-fbc.so</font></di=
v>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-glcore.so.$1 libnvidia-glcore.so</fon=
t></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-glsi.so.$1 libnvidia-glsi.so</font></=
div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-gtk2.so.$1 libnvidia-gtk2.so</font></=
div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-gtk3.so.$1 libnvidia-gtk3.so</font></=
div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-ifr.so.$1 libnvidia-ifr.so</font></di=
v>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-ml.so.$1 libnvidia-ml.so</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-ml.so.$1 libnvidia-ml.so.1</font></di=
v>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-opencl.so.$1 libnvidia-opencl.so</fon=
t></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-tls.so.$1 libnvidia-tls.so</font></di=
v>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libnvidia-wfb.so.$1 libnvidia-wfb.so</font></di=
v>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libvdpau_nvidia.so.$1 libvdpau_nvidia.so</font>=
</div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libvdpau.so.$1 libvdpau.so</font></div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libvdpau_trace.so.$1 libvdpau_trace.so</font></=
div>
                      </div>
                      <div>
                        <div><font face=3D"courier new, monospace">ln -s
                            libcuda.so.$1 libcuda.so.1</font></div>
                      </div>
                    </blockquote>
                    <span><font color=3D"#888888">
                        <div><br>
                        </div>
                      </font></span></div>
                  <span><font color=3D"#888888">
                      -- <br>
                      You received this message because you are
                      subscribed to the Google Groups "singularity"
                      group.<br>
                      To unsubscribe from this group and stop receiving
                      emails from it, send an email to <a rel=3D"nofollow">=
singu...@lbl.gov</a>.<br>
                    </font></span></blockquote>
              </div>
              <br>
              <br clear=3D"all">
              <div><br>
              </div>
              -- <br>
              <div>Vanessa Villamia Sochat<br>
                Stanford University '16<br>
                <div>
                  <div>
                    <div>(603) 321-0676</div>
                  </div>
                </div>
              </div>
            </div>
          </blockquote>
        </div>
      </div>
      -- <br>
      You received this message because you are subscribed to the Google
      Groups "singularity" group.<br>
      To unsubscribe from this group and stop receiving emails from it,
      send an email to <a href=3D"javascript:" target=3D"_blank" gdf-obfusc=
ated-mailto=3D"dOMIUEPFDwAJ" rel=3D"nofollow" onmousedown=3D"this.href=3D'j=
avascript:';return true;" onclick=3D"this.href=3D'javascript:';return true;=
">singularity...@lbl.<wbr>gov</a>.<br>
    </blockquote>
    <br>
  </div>

</blockquote></div></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov">singu...@lbl.gov</a>.<br>
</div></blockquote></body></html>
--Apple-Mail-B72CD182-ACD4-4DAD-A51F-DDCDC8383EC3--
