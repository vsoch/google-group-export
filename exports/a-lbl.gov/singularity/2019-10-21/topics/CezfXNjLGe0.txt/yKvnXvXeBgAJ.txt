X-Received: by 10.129.161.66 with SMTP id y63mr52242634ywg.39.1470114079605;
        Mon, 01 Aug 2016 22:01:19 -0700 (PDT)
X-BeenThere: singularity@lbl.gov
Received: by 10.36.1.209 with SMTP id 200ls3585285itk.0.gmail; Mon, 01 Aug
 2016 22:01:19 -0700 (PDT)
X-Received: by 10.66.127.38 with SMTP id nd6mr102598648pab.74.1470114078892;
        Mon, 01 Aug 2016 22:01:18 -0700 (PDT)
Return-Path: <nathan...@gmail.com>
Received: from fe4.lbl.gov (fe4.lbl.gov. [128.3.41.71])
        by mx.google.com with ESMTPS id rb9si1007203pab.270.2016.08.01.22.01.18
        for <singu...@lbl.gov>
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Mon, 01 Aug 2016 22:01:18 -0700 (PDT)
Received-SPF: pass (google.com: domain of nathan...@gmail.com designates 209.85.161.174 as permitted sender) client-ip=209.85.161.174;
Authentication-Results: mx.google.com;
       dkim=pass head...@gmail.com;
       spf=pass (google.com: domain of nathan...@gmail.com designates 209.85.161.174 as permitted sender) smtp.mailfrom=nathan...@gmail.com
X-Ironport-SBRS: 3.4
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: A2EYAQC7J6BXhq6hVdFcgxiBA3yDPoEMoz6JLYZ8doE9QCaBbFSCJwGBDwIlgQ84FAEBAQEBAQEDDwEBAQgLCwkZL4JTOQoGKwEBAQEBAQEBAQEBAQEBAQEaAisEFgsbAQEEARIIAQgdAQ0OHgMBCwYFCw0gAQkCAiECDgMBBQEcDgcEARwEAYd0AQMPCAEECaMKgTI+MYs7gWqCWgWGVQoZJw1Ug0ABAQEBAQUBAQEBAQEBAQEBARQCAgQLBYgSgVKBA4JDgU8RARwZgmgrgi8FgUWER4IRB2CFEguBKYk1NIYYgnyCc0OCNYFrFzeHDDGFSYgrhAWCODCBDw8PgkgRC4FoUgEBAQEDhi+BNgEBAQ
X-IPAS-Result: A2EYAQC7J6BXhq6hVdFcgxiBA3yDPoEMoz6JLYZ8doE9QCaBbFSCJwGBDwIlgQ84FAEBAQEBAQEDDwEBAQgLCwkZL4JTOQoGKwEBAQEBAQEBAQEBAQEBAQEaAisEFgsbAQEEARIIAQgdAQ0OHgMBCwYFCw0gAQkCAiECDgMBBQEcDgcEARwEAYd0AQMPCAEECaMKgTI+MYs7gWqCWgWGVQoZJw1Ug0ABAQEBAQUBAQEBAQEBAQEBARQCAgQLBYgSgVKBA4JDgU8RARwZgmgrgi8FgUWER4IRB2CFEguBKYk1NIYYgnyCc0OCNYFrFzeHDDGFSYgrhAWCODCBDw8PgkgRC4FoUgEBAQEDhi+BNgEBAQ
X-IronPort-AV: E=Sophos;i="5.28,458,1464678000"; 
   d="scan'208,217";a="31350304"
Received: from mail-yw0-f174.google.com ([209.85.161.174])
  by fe4.lbl.gov with ESMTP; 01 Aug 2016 22:01:16 -0700
Received: by mail-yw0-f174.google.com with SMTP id z8so191466571ywa.1
        for <singu...@lbl.gov>; Mon, 01 Aug 2016 22:01:16 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20120113;
        h=from:content-transfer-encoding:mime-version:subject:message-id:date
         :references:in-reply-to:to;
        bh=przNNMLmudDdNI1TcHZhNfJp9NVmlzOlOgYXcyiuKDw=;
        b=M0q/+m8wPeP3wSUy900UPf4XaVxCChblxzWWdoh4SSlR9I7zLX7VkJgi614bNYnaig
         cua1B9NW09N8PWXcTuzlbBkeNMTWBIq4q1PaFSuCDbrghVHZ44MWoQqnwoSQe/sXrb/c
         xjYjV8mjqDpne4Bm43wc2LulCo4+qz0aujo6CAT74BwX3mU6ohjYy0k+Xf+GwaUT6Aw6
         4JyNhSmvjDPfa+zH55Xu+e47UYCtQupF6KbNdqd5ocKbrvoYjf0vKE2Sp7Xhi9oqMBJp
         senIbxknptBq7Rr6vjgFy8EPjH7BtA1czWLxOjDpykMmFOKcUrB9x2q8Eb7jprESr3Wy
         KgVQ==
X-Gm-Message-State: AEkoousPO2mMRU0bUJPcGvvrHe5ZMV8pNchvViWznkkCWiMlrdFESNcZWjRqq4cQ24gf2A==
X-Received: by 10.129.165.71 with SMTP id c68mr46100079ywh.48.1470114075398;
        Mon, 01 Aug 2016 22:01:15 -0700 (PDT)
Return-Path: <nathan...@gmail.com>
Received: from ?IPv6:2600:1000:b12f:4d2c:5c07:f1b6:9ef6:aab8? ([2600:1000:b12f:4d2c:5c07:f1b6:9ef6:aab8])
        by smtp.gmail.com with ESMTPSA id a68sm288290ywh.44.2016.08.01.22.01.14
        for <singu...@lbl.gov>
        (version=TLS1 cipher=ECDHE-RSA-AES128-SHA bits=128/128);
        Mon, 01 Aug 2016 22:01:14 -0700 (PDT)
From: Nathan Lin <nathan...@gmail.com>
Content-Type: multipart/alternative;
	boundary=Apple-Mail-18A17A03-8532-4ABE-AE19-D78E30D4DDBE
Content-Transfer-Encoding: 7bit
Mime-Version: 1.0 (1.0)
Subject: Re: [Singularity] How to use GPU in singularity?
Message-Id: <914F9F3A-B324-4F00-8CC1-925E8F533B92@gmail.com>
Date: Tue, 2 Aug 2016 01:01:12 -0400
References: <02b27dd5-dcc4-4800-97f6-7dcfcc85afd8@lbl.gov> <CAA8GL6Bsyt5oHK8O9GrDS6F=USv-aP0K9a+m8Q+jfOJ8kpxrhA@mail.gmail.com>
 <CAA8GL6DP3KhfbWV7nK5JGxNn4S+=M0=vEV0mACsoRrd6Ag2GpQ@mail.gmail.com>
 <718cb7c4-524f-4b08-bde9-3a36013fba59@lbl.gov> <4e52c56a-5475-4075-a3c7-2ae22191b544@lbl.gov>
 <CAA8GL6BdE1TRBaPD-oM7qcj8QK1cBsmJsUzYyrvkRPBP9CX+hQ@mail.gmail.com>
 <CAMfmYehdPLtiouQqMGqOx4ZbEXFbbPRL5QOxsP_vQo0us1QLuA@mail.gmail.com>
 <B927B7F6-3CFB-452D-92AB-866F9B8024E4@gmail.com> <CAMfmYeiSvcReO4jvSGJkavnex64wGZ8Phxva2kAxJ7pcp48YiA@mail.gmail.com>
 <CAMfmYeiaTxVQSNqwprHe5ckcDHPcJXy3imdepiRL+KkDh12TCQ@mail.gmail.com>
 <65CD778F-6CD1-4DB4-9668-4D89839B7053@gmail.com> <CAMfmYeg_pnJcyKGetK7WVChToaWCgGYH-nrYY9v=2+RSkuWZuQ@mail.gmail.com>
 <C5AE54CB-2BA1-4E59-88FC-D20224A46086@gmail.com> <CAMfmYeg2rR9-U-zyviCeDXRt_QgKv_K0p9pf-+qgoGPQAjxjXA@mail.gmail.com>
 <95039222-908B-4AE8-8844-551646C9733C@gmail.com> <CAA8GL6ATuT+zMyD9zrW5GBH3Br8bm8=RvjKm1PNAGbKGF3psMw@mail.gmail.com>
 <CAMfmYejEioybKBLNSv36dd7ma-Z1hatfssvFUOGiuehBZbk-Ug@mail.gmail.com> <CA+3XN_KmaVuaKqOCbCvocOrw0qghQZq3kiBh1S6T2NKyTgpDTA@mail.gmail.com>
In-Reply-To: <CA+3XN_KmaVuaKqOCbCvocOrw0qghQZq3kiBh1S6T2NKyTgpDTA@mail.gmail.com>
To: singularity@lbl.gov
X-Mailer: iPhone Mail (13G34)

--Apple-Mail-18A17A03-8532-4ABE-AE19-D78E30D4DDBE
Content-Type: text/plain;
	charset=us-ascii
Content-Transfer-Encoding: quoted-printable

Hi Igor,

Yeah that something that definitely comes up. Looks like you already fixed =
it, but yeah you should always look at all the options when you're running =
a silent install. Glad you got it to work though!

Best,
Nathan

> On Aug 2, 2016, at 12:55 AM, Bernard Li <ber...@vanhpc.org> wrote:
>=20
> Hey Igor:
>=20
> If you can make the tensorflow Singularity container available, I'd like =
to try that out on our cluster.
>=20
> Thanks,
>=20
> Bernard
>=20
>> On Monday, 1 August 2016, Igor Yakushin <igor...@gmail.com> wrote:
>> Hi Nathan,
>> The main problem was that if you try to install cuda, it would by defaul=
t install driver as well that might be of different version than the driver=
 installed with NVIDIA*.run file. So when installing cuda, use an option no=
t to install the driver. It is much easier to find NVIDIA*.run file of the =
version you need than cuda*.run with the right driver.  When downloading NV=
IDIA*.run, pay attention that you are asking for Tesla card (if that's what=
 you have). Consumer cards have different driver (I do not remember if it i=
s reflected in the file name but I suspect not, because I made this mistake=
).
>> Thank you,
>> Igor
>>=20
>>=20
>>> On Mon, Aug 1, 2016 at 8:56 AM, Nathan Lin <nathan...@gmail.com> wrote:
>>> That's great to hear Igor! What ended up being the problem?
>>>=20
>>>> On Mon, Aug 1, 2016 at 1:43 AM, Rick Wagner <richard...@gmail.com> wro=
te:
>>>> Igor,
>>>>=20
>>>> If you had a chance to post your definition file or the steps you took=
, I know several of us would appreciate it. Getting TensorFlow running on C=
entOS was a huge effort for our support staff. And that's just one of many =
GPU-enabled applications.
>>>>=20
>>>> --Rick
>>>>=20
>>>>> On Jul 31, 2016, at 10:20 PM, Igor Yakushin <igor...@gmail.com> wrote=
:
>>>>>=20
>>>>> Thank you, Nathan. It finally works!
>>>>>=20
>>>>>> On Sun, Jul 31, 2016 at 5:17 PM, Nathan Lin <nathan...@gmail.com> wr=
ote:
>>>>>> Yes I do
>>>>>>=20
>>>>>>> On Jul 31, 2016, at 5:03 PM, Igor Yakushin <igor...@gmail.com> wrot=
e:
>>>>>>>=20
>>>>>>> Nathan,
>>>>>>> When you import tensorflow in python, does it tell you what cuda li=
braries it is loading or not?
>>>>>>> Do you see these messages:
>>>>>>> =3D=3D=3D=3D=3D=3D
>>>>>>> >>> import tensorflow as tf=20
>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened=
 CUDA library libcublas.so locally=20
>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened=
 CUDA library libcudnn.so locally=20
>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened=
 CUDA library libcufft.so locally=20
>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened=
 CUDA library libcuda.so locally=20
>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened=
 CUDA library libcurand.so locally=20
>>>>>>> =3D=3D=3D=3D=3D=3D
>>>>>>> Thank you,
>>>>>>> Igor
>>>>>>>=20
>>>>>>>> On Sun, Jul 31, 2016 at 1:26 PM, Nathan Lin <nathan...@gmail.com> =
wrote:
>>>>>>>> Hi Igor,
>>>>>>>>=20
>>>>>>>> In regards to your first questions, the OS/drivers of your buildin=
g computer should not matter. I built an Ubuntu 14.04 image on my RHEL 7 bo=
x for our RHEL 6 cluster. I'm not sure that the toolkit is that version spe=
cific, my image seems to work fine and it's running 353.63. There is one th=
ing that I do that may be helpful. I read it somewhere online and am not ac=
tually sure if it does anything, but I've included it in my image definitio=
ns just in case. Apparently there is something about initializing the CUDA =
Toolkit. As part of my definition file I run 'make' on the CUDA sample 'dev=
iceQuery'. Maybe that will help?
>>>>>>>>=20
>>>>>>>> Best,
>>>>>>>> Nathan
>>>>>>>>=20
>>>>>>>>> On Jul 31, 2016, at 1:51 PM, Igor Yakushin <igor...@gmail.com> wr=
ote:
>>>>>>>>>=20
>>>>>>>>> Hi Nathan,
>>>>>>>>> I got a little bit further: nvidia-smi is working now but tensorf=
low still complains:
>>>>>>>>> =3D=3D=3D=3D=3D=3D=3D=3D=3D
>>>>>>>>>=20
>>>>>>>>> =3D=3D=3D=3D=3D=3D=3D=3D=3D
>>>>>>>>> Singularity/ubuntu_14.04.img> nvidia-smi=20
>>>>>>>>> Sun Jul 31 17:33:44 2016       =20
>>>>>>>>> +------------------------------------------------------+         =
              =20
>>>>>>>>> | NVIDIA-SMI 352.55     Driver Version: 352.55         |         =
              =20
>>>>>>>>> |-------------------------------+----------------------+---------=
-------------+=20
>>>>>>>>> | GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile=
 Uncorr. ECC |=20
>>>>>>>>> | Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util=
  Compute M. |=20
>>>>>>>>> |=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D|=20
>>>>>>>>> |   0  Tesla K40m          Off  | 0000:20:00.0     Off |         =
           0 |=20
>>>>>>>>> | N/A   45C    P0    79W / 235W |    158MiB / 11519MiB |     45% =
     Default |=20
>>>>>>>>> +-------------------------------+----------------------+---------=
-------------+=20
>>>>>>>>> |   1  Tesla K40m          Off  | 0000:8B:00.0     Off |         =
           0 |=20
>>>>>>>>> | N/A   23C    P8    18W / 235W |     61MiB / 11519MiB |      0% =
     Default |=20
>>>>>>>>> +-------------------------------+----------------------+---------=
-------------+=20
>>>>>>>>>                                                                  =
             =20
>>>>>>>>> +----------------------------------------------------------------=
-------------+=20
>>>>>>>>> | Processes:                                                     =
  GPU Memory |=20
>>>>>>>>> |  GPU       PID  Type  Process name                             =
  Usage      |=20
>>>>>>>>> |=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D|=20
>>>>>>>>> +----------------------------------------------------------------=
-------------+=20
>>>>>>>>> Singularity/ubuntu_14.04.img> python=20
>>>>>>>>> Python 2.7.6 (default, Mar 22 2014, 22:59:56) =20
>>>>>>>>> [GCC 4.8.2] on linux2=20
>>>>>>>>> Type "help", "copyright", "credits" or "license" for more informa=
tion.=20
>>>>>>>>> >>> import tensorflow=20
>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully open=
ed CUDA library libcublas.so locally=20
>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully open=
ed CUDA library libcudnn.so locally=20
>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully open=
ed CUDA library libcufft.so locally=20
>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully open=
ed CUDA library libcuda.so.1 locally=20
>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully open=
ed CUDA library libcurand.so locally=20
>>>>>>>>> >>> ss =3D tensorflow.Session()=20
>>>>>>>>> E tensorflow/stream_executor/cuda/cuda_driver.cc:491] failed call=
 to cuInit: CUDA_ERROR_NO_DEVICE=20
>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:153] retrie=
ving CUDA diagnostic information for host: midway-l34-02=20
>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:160] hostna=
me: midway-l34-02=20
>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:185] libcud=
a reported version is: 352.93.0=20
>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:356] driver=
 version file contents: """NVRM version: NVIDIA UNIX x86_64 Kernel Module  =
352.55  Thu Oct  8 15:18:00 PDT 2015=20
>>>>>>>>> GCC version:  gcc version 4.4.7 20120313 (Red Hat 4.4.7-16) (GCC)=
 =20
>>>>>>>>> """=20
>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:189] kernel=
 reported version is: 352.55.0=20
>>>>>>>>> E tensorflow/stream_executor/cuda/cuda_diagnostics.cc:296] kernel=
 version 352.55.0 does not match DSO version 352.93.0 -- cannot find workin=
g devices in this configuration=20
>>>>>>>>> I tensorflow/core/common_runtime/gpu/gpu_init.cc:81] No GPU devic=
es available on machine.=20
>>>>>>>>> >>>=20
>>>>>>>>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>>>>>>>>> As far as I understand the problem is that cuda-7.5 was built or =
relies on nvidia 352.93 while I have NVIDIA driver 352.55 both on the host =
and container. So far I could not find cuda-7.5 built with 352.55.
>>>>>>>>> cuda-7.5 has stabs directory in which there is libcuda.so. The pr=
oblem is probably coming from there. However, I doubt I can just replace li=
bcuda.so in the stubs directory by a different version or turn it into symb=
olic link to a different version in the driver? Because its size is much sm=
aller than the size of the real libcuda.so in the driver. So I suspect, it =
is really only some kind of interface to the real library?
>>>>>>>>>=20
>>>>>>>>> Thank you,
>>>>>>>>> Igor
>>>>>>>>>=20
>>>>>>>>>=20
>>>>>>>>>> On Sun, Jul 31, 2016 at 9:36 AM, Igor Yakushin <igor...@gmail.co=
m> wrote:
>>>>>>>>>> Hi Nathan,
>>>>>>>>>> When installing cuda libraries and tensorflow into the singulari=
ty image, is it important to be on the same host with the same version of C=
UDA/OS on which you are going to run later?
>>>>>>>>>> I do not have root on the machine I am going to run later and pr=
epare the image on a different machine with a different version of nvidia d=
river and a different flavor of Linux.
>>>>>>>>>> Thank you,
>>>>>>>>>> Igor
>>>>>>>>>>=20
>>>>>>>>>>=20
>>>>>>>>>>> On Sun, Jul 31, 2016 at 8:39 AM, Nathan Lin <nathan...@gmail.co=
m> wrote:
>>>>>>>>>>> Hi Igor,
>>>>>>>>>>>=20
>>>>>>>>>>> I don't necessarily have a great answer for you. If seems like =
you are doing everything right, yet it is still not working. In my case, ye=
s nvidia-smi as well as TensorFlow both work correctly. I feel like your er=
ror still has to do with the version of libcuda.so you are using. Notice ho=
w Python seems to correctly load libcuda.so, yet there is later an error th=
at is unable to find libcuda.so. My first suspicion is that there is still =
a version mismatch between the drivers installed on the image and on the ho=
st. If you are sure that is not true, it may be possible that the version o=
f the driver that is installed on the machine isn't new enough for the GPU.=
 That actually occurred on our cluster, and after a sysadmin updated the dr=
iver, it worked. Barring that I am not too sure. Maybe if you provide me wi=
th the full details of your installation (the versions of the packages that=
 you have installed, the OS of your image and host), I might be able to thi=
nk about something, but my suspicion is that the driver version on your hos=
t machine may not be new enough.=20
>>>>>>>>>>>=20
>>>>>>>>>>> Best,
>>>>>>>>>>> Nathan=20
>>>>>>>>>>>=20
>>>>>>>>>>>> On Jul 31, 2016, at 12:17 AM, Igor Yakushin <igor...@gmail.com=
> wrote:
>>>>>>>>>>>>=20
>>>>>>>>>>>> Hi Nathan,
>>>>>>>>>>>>=20
>>>>>>>>>>>> I have found exactly the same version of NVIDIA driver and ext=
racted from it the libraries and nvidia executables and copied them in /usr=
/lib64/nvidia and /usr/bin and created the corresponding symbolic links. Ho=
wever, I still cannot use GPU inside singularity: nvidia-smi says "GPU acce=
ss blocked by the operating system" (does it work in your case?) and when t=
ensorflow session starts it also complains that "No GPU devices available o=
n machine". However, notice that tensorflow seems to think that a different=
 version of NVIDIA driver is used. Not sure where it is coming from. The ma=
chine on which the image was built has version 361.42
>>>>>>>>>>>>=20
>>>>>>>>>>>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>>>>>>>>>>>> Python 2.7.12 (default, Jul  1 2016, 15:12:24) =20
>>>>>>>>>>>> [GCC 5.4.0 20160609] on linux2=20
>>>>>>>>>>>> Type "help", "copyright", "credits" or "license" for more info=
rmation.=20
>>>>>>>>>>>> >>> import tensorflow=20
>>>>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully o=
pened CUDA library libcublas.so locally=20
>>>>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully o=
pened CUDA library libcudnn.so locally=20
>>>>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully o=
pened CUDA library libcufft.so locally=20
>>>>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully o=
pened CUDA library libcuda.so locally=20
>>>>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully o=
pened CUDA library libcurand.so locally=20
>>>>>>>>>>>> >>> ss =3D tensorflow.Session()=20
>>>>>>>>>>>> E tensorflow/stream_executor/cuda/cuda_driver.cc:491] failed c=
all to cuInit: CUDA_ERROR_UNKNOWN=20
>>>>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:153] ret=
rieving CUDA diagnostic information for host: midway230=20
>>>>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:160] hos=
tname: midway230=20
>>>>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:185] lib=
cuda reported version is: Not found: was unable to find libcuda.so DSO load=
ed into this program=20
>>>>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:347] dri=
ver version file contents: """NVRM version: NVIDIA UNIX x86_64 Kernel Modul=
e  352.55  Thu Oct  8 15:18:00 PDT 2015=20
>>>>>>>>>>>> GCC version:  gcc version 4.4.7 20120313 (Red Hat 4.4.7-16) (G=
CC) =20
>>>>>>>>>>>> """=20
>>>>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:189] ker=
nel reported version is: 352.55.0=20
>>>>>>>>>>>> I tensorflow/core/common_runtime/gpu/gpu_init.cc:81] No GPU de=
vices available on machine.=20
>>>>>>>>>>>> >>> =20
>>>>>>>>>>>> Singularity/tensorflow_0.9.img> nvidia-smi=20
>>>>>>>>>>>> Failed to initialize NVML: GPU access blocked by the operating=
 system
>>>>>>>>>>>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>>>>>>>>>>>>=20
>>>>>>>>>>>> Thank you,
>>>>>>>>>>>> Igor
>>>>>>>>>>>>=20
>>>>>>>>>>>>=20
>>>>>>>>>>>>> On Thu, Jul 28, 2016 at 9:34 PM, Nathan Lin <nathan...@gmail.=
com> wrote:
>>>>>>>>>>>>> I am not sure how to find the correct driver version, but fro=
m my testing, the version must match exactly. I will admit that I have had =
problems finding specific versions of the driver from NVIDIA's website. I h=
ad to ask a sysadmin for the installer that they used. In order to extract =
the files, you need to use the --extract-only option. For instance, you wil=
l have to run something like ' sh /NVIDIA-Linux-x86_64-352.63.run --extract=
-only'/ . You will then be given a directory with all the libraries that wo=
uld have been installed. You will need to copy the libcuda.so.###.## librar=
y (and you can copy any NVIDIA executables that you want such as nvidia-smi=
). Good luck!
>>>>>>>>>>>>>=20
>>>>>>>>>>>>>> On Thu, Jul 28, 2016 at 8:51 PM, Igor <igor...@gmail.com> wr=
ote:
>>>>>>>>>>>>>> I mean I am using this file from NVIDIA website cuda_7.5.18_=
linux.run to install the driver, opengl, cuda. Driver installation fails, c=
uda succeeds.=20
>>>>>>>>>>>>>> Also, when I run=20
>>>>>>>>>>>>>> sh cuda_7.5.18_linux.run
>>>>>>>>>>>>>> I am offered to install the driver version 352.39 while on t=
he host it is 346.47. I cannot upgrade the host. Any idea where I can get 3=
46.17?
>>>>>>>>>>>>>> I tried using the same link just substitute 18 for something=
 else but have not found the files:
>>>>>>>>>>>>>> wget http://developer.download.nvidia.com/compute/cuda/7.5/P=
rod/local_installers/cuda_7.5.1X_linux.run
>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>> On Thursday, July 28, 2016 at 7:34:55 PM UTC-5, Igor wrote:
>>>>>>>>>>>>>>> Hi Nathan,
>>>>>>>>>>>>>>> When I try to install the driver by running NVIDIA*.run scr=
ipt inside the image, it fails, probably because it tries to modify kernel =
that belongs to host?
>>>>>>>>>>>>>>> How do I extract just libcuda.so.345.67 without installing =
the driver (which is obviously problematic) and why would copying the libra=
ry from the host would not work?
>>>>>>>>>>>>>>> Thank you,
>>>>>>>>>>>>>>> Igor
>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>> On Thursday, July 28, 2016 at 7:18:26 PM UTC-5, Nathan Lin=
 wrote:
>>>>>>>>>>>>>>>> Also if you are using the binary installation of TensorFlo=
w you need CUDA toolkit 7.5 and cuDNN v4. These only need to be installed o=
n our image. As I mentioned earlier you will need the libcuda.so.###.## lib=
rary on your image. It is very important that this is the same version of t=
he NVIDIA driver as you have on your nose (seemingly 346.67 for you). I sho=
uld've have also mentioned that you want the libcuda.so.345.67 library that=
 you get from extracting the NVIDIA installer. It will not work if you try =
to copy the libcuda.so library that from you node.=20
>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>> Let me know if you have any more questions.=20
>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>> Best,
>>>>>>>>>>>>>>>> Nathan
>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>>> On Thursday, July 28, 2016, Nathan Lin <nat...@gmail.com>=
 wrote:
>>>>>>>>>>>>>>>>> Hello,
>>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>>> Yes you are correct. The NVIDIA driver must be installed =
on your image as well. However, you honestly only need the libcuda.so.###.#=
# library and the appropriate links for that library. Once you have those i=
nstalled in your image, it should work.=20
>>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>>> Best,
>>>>>>>>>>>>>>>>> Nathan=20
>>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>>>> On Thursday, July 28, 2016, Igor <igor...@gmail.com> wro=
te:
>>>>>>>>>>>>>>>>>> Hi All,
>>>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>>>> I am trying to use GPU-enabled tensorflow and it cannot =
find GPU card from inside the container.
>>>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>>>> On the host:
>>>>>>>>>>>>>>>>>> $ lspci | grep -i nvidia=20
>>>>>>>>>>>>>>>>>> 20:00.0 3D controller: NVIDIA Corporation GK110BGL [Tesl=
a K40m] (rev a1)=20
>>>>>>>>>>>>>>>>>> 8b:00.0 3D controller: NVIDIA Corporation GK110BGL [Tesl=
a K40m] (rev a1)
>>>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>>>> $ nvidia-smi=20
>>>>>>>>>>>>>>>>>> Thu Jul 28 19:01:42 2016       =20
>>>>>>>>>>>>>>>>>> +------------------------------------------------------+=
                       =20
>>>>>>>>>>>>>>>>>> | NVIDIA-SMI 346.47     Driver Version: 346.47         |=
                       =20
>>>>>>>>>>>>>>>>>> |-------------------------------+----------------------+=
----------------------+=20
>>>>>>>>>>>>>>>>>> | GPU  Name        Persistence-M| Bus-Id        Disp.A |=
 Volatile Uncorr. ECC |=20
>>>>>>>>>>>>>>>>>> | Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage |=
 GPU-Util  Compute M. |=20
>>>>>>>>>>>>>>>>>> |=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D|=20
>>>>>>>>>>>>>>>>>> |   0  Tesla K40m          Off  | 0000:20:00.0     Off |=
                    0 |=20
>>>>>>>>>>>>>>>>>> | N/A   30C    P8    20W / 235W |     66MiB / 11519MiB |=
      0%      Default |=20
>>>>>>>>>>>>>>>>>> +-------------------------------+----------------------+=
----------------------+=20
>>>>>>>>>>>>>>>>>> |   1  Tesla K40m          Off  | 0000:8B:00.0     Off |=
                    0 |=20
>>>>>>>>>>>>>>>>>> | N/A   26C    P8    19W / 235W |     60MiB / 11519MiB |=
      0%      Default |=20
>>>>>>>>>>>>>>>>>> +-------------------------------+----------------------+=
----------------------+=20
>>>>>>>>>>>>>>>>>>                                                         =
                      =20
>>>>>>>>>>>>>>>>>> +-------------------------------------------------------=
----------------------+=20
>>>>>>>>>>>>>>>>>> | Processes:                                            =
           GPU Memory |=20
>>>>>>>>>>>>>>>>>> |  GPU       PID  Type  Process name                    =
           Usage      |=20
>>>>>>>>>>>>>>>>>> |=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D|=20
>>>>>>>>>>>>>>>>>> |    0     11671    G   /usr/bin/X                      =
                 9MiB |=20
>>>>>>>>>>>>>>>>>> |    1     11671    G   /usr/bin/X                      =
                 3MiB |
>>>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>>>> Inside singularity:
>>>>>>>>>>>>>>>>>> $ singularity shell /software/src/singularity_images/ten=
sorflow_0.9.img
>>>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>>>> Singularity/tensorflow_0.9.img> lspci | grep -i nvidia=
=20
>>>>>>>>>>>>>>>>>> bash: lspci: command not found=20
>>>>>>>>>>>>>>>>>> Singularity/tensorflow_0.9.img> nvidia-smi=20
>>>>>>>>>>>>>>>>>> bash: nvidia-smi: command not found=20
>>>>>>>>>>>>>>>>>> Singularity/tensorflow_0.9.img> python=20
>>>>>>>>>>>>>>>>>> Python 2.7.12 (default, Jul  1 2016, 15:12:24) =20
>>>>>>>>>>>>>>>>>> [GCC 5.4.0 20160609] on linux2=20
>>>>>>>>>>>>>>>>>> Type "help", "copyright", "credits" or "license" for mor=
e information.=20
>>>>>>>>>>>>>>>>>> >>> import tensorflow as tf=20
>>>>>>>>>>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successf=
ully opened CUDA library libcublas.so locally=20
>>>>>>>>>>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successf=
ully opened CUDA library libcudnn.so locally=20
>>>>>>>>>>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successf=
ully opened CUDA library libcufft.so locally=20
>>>>>>>>>>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successf=
ully opened CUDA library libcuda.so locally=20
>>>>>>>>>>>>>>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successf=
ully opened CUDA library libcurand.so locally=20
>>>>>>>>>>>>>>>>>> >>> sess =3D tf.Session()=20
>>>>>>>>>>>>>>>>>> E tensorflow/stream_executor/cuda/cuda_driver.cc:491] fa=
iled call to cuInit: CUDA_ERROR_UNKNOWN=20
>>>>>>>>>>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:15=
3] retrieving CUDA diagnostic information for host: midway-l34-01=20
>>>>>>>>>>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:16=
0] hostname: midway-l34-01=20
>>>>>>>>>>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:18=
5] libcuda reported version is: Not found: was unable to find libcuda.so DS=
O loaded into this program=20
>>>>>>>>>>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:34=
7] driver version file contents: """NVRM version: NVIDIA UNIX x86_64 Kernel=
 Module  346.47  Thu Feb 19 18:56:03 PST 2015=20
>>>>>>>>>>>>>>>>>> GCC version:  gcc version 4.4.7 20120313 (Red Hat 4.4.7-=
11) (GCC) =20
>>>>>>>>>>>>>>>>>> """=20
>>>>>>>>>>>>>>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:18=
9] kernel reported version is: 346.47.0=20
>>>>>>>>>>>>>>>>>> I tensorflow/core/common_runtime/gpu/gpu_init.cc:81] No =
GPU devices available on machine.
>>>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>>>> Must there be nvidia driver installed inside the contain=
er? Outside? The container shares the same kernel with the host and nvidia =
kernel module needs to be loaded... How this is handled? Any requirements o=
n nvidia driver and cuda versions inside and outside of the container?
>>>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>>>> Thank you,
>>>>>>>>>>>>>>>>>> Igor
>>>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>>>>>> --=20
>>>>>>>>>>>>>>>>>> You received this message because you are subscribed to =
the Google Groups "singularity" group.
>>>>>>>>>>>>>>>>>> To unsubscribe from this group and stop receiving emails=
 from it, send an email to singu...@lbl.gov.
>>>>>>>>>>>>>>=20
>>>>>>>>>>>>>> --=20
>>>>>>>>>>>>>> You received this message because you are subscribed to the =
Google Groups "singularity" group.
>>>>>>>>>>>>>> To unsubscribe from this group and stop receiving emails fro=
m it, send an email to singu...@lbl.gov.
>>>>>>>>>>>>>=20
>>>>>>>>>>>>> --=20
>>>>>>>>>>>>> You received this message because you are subscribed to the G=
oogle Groups "singularity" group.
>>>>>>>>>>>>> To unsubscribe from this group and stop receiving emails from=
 it, send an email to singu...@lbl.gov.
>>>>>>>>>>>>=20
>>>>>>>>>>>> --=20
>>>>>>>>>>>> You received this message because you are subscribed to the Go=
ogle Groups "singularity" group.
>>>>>>>>>>>> To unsubscribe from this group and stop receiving emails from =
it, send an email to singu...@lbl.gov.
>>>>>>>>>>>=20
>>>>>>>>>>> --=20
>>>>>>>>>>> You received this message because you are subscribed to the Goo=
gle Groups "singularity" group.
>>>>>>>>>>> To unsubscribe from this group and stop receiving emails from i=
t, send an email to singu...@lbl.gov.
>>>>>>>>>=20
>>>>>>>>> --=20
>>>>>>>>> You received this message because you are subscribed to the Googl=
e Groups "singularity" group.
>>>>>>>>> To unsubscribe from this group and stop receiving emails from it,=
 send an email to singu...@lbl.gov.
>>>>>>>>=20
>>>>>>>> --=20
>>>>>>>> You received this message because you are subscribed to the Google=
 Groups "singularity" group.
>>>>>>>> To unsubscribe from this group and stop receiving emails from it, =
send an email to singu...@lbl.gov.
>>>>>>>=20
>>>>>>> --=20
>>>>>>> You received this message because you are subscribed to the Google =
Groups "singularity" group.
>>>>>>> To unsubscribe from this group and stop receiving emails from it, s=
end an email to singu...@lbl.gov.
>>>>>>=20
>>>>>> --=20
>>>>>> You received this message because you are subscribed to the Google G=
roups "singularity" group.
>>>>>> To unsubscribe from this group and stop receiving emails from it, se=
nd an email to singu...@lbl.gov.
>>>>>=20
>>>>> --=20
>>>>> You received this message because you are subscribed to the Google Gr=
oups "singularity" group.
>>>>> To unsubscribe from this group and stop receiving emails from it, sen=
d an email to singu...@lbl.gov.
>>>>=20
>>>> --=20
>>>> You received this message because you are subscribed to the Google Gro=
ups "singularity" group.
>>>> To unsubscribe from this group and stop receiving emails from it, send=
 an email to singu...@lbl.gov.
>>>=20
>>> --=20
>>> You received this message because you are subscribed to the Google Grou=
ps "singularity" group.
>>> To unsubscribe from this group and stop receiving emails from it, send =
an email to singu...@lbl.gov.
>>=20
>> --=20
>> You received this message because you are subscribed to the Google Group=
s "singularity" group.
>> To unsubscribe from this group and stop receiving emails from it, send a=
n email to singu...@lbl.gov.
>=20
> --=20
> You received this message because you are subscribed to the Google Groups=
 "singularity" group.
> To unsubscribe from this group and stop receiving emails from it, send an=
 email to singu...@lbl.gov.

--Apple-Mail-18A17A03-8532-4ABE-AE19-D78E30D4DDBE
Content-Type: text/html;
	charset=utf-8
Content-Transfer-Encoding: quoted-printable

<html><head><meta http-equiv=3D"content-type" content=3D"text/html; charset=
=3Dutf-8"></head><body dir=3D"auto"><div></div><div>Hi Igor,</div><div><br>=
</div><div>Yeah that something that definitely comes up. Looks like you alr=
eady fixed it, but yeah you should always look at all the options when you'=
re running a silent install. Glad you got it to work though!</div><div><br>=
</div><div>Best,</div><div>Nathan</div><div><br>On Aug 2, 2016, at 12:55 AM=
, Bernard Li &lt;<a href=3D"mailto:ber...@vanhpc.org">ber...@vanhpc.org</a>=
&gt; wrote:<br><br></div><blockquote type=3D"cite"><div>Hey Igor:<div><br><=
/div><div>If you can make the tensorflow Singularity container available, I=
'd like to try that out on our cluster.</div><div><br></div><div>Thanks,</d=
iv><div><br></div><div>Bernard<br><br>On Monday, 1 August 2016, Igor Yakush=
in &lt;<a href=3D"mailto:igor...@gmail.com">igor...@gmail.com</a>&gt; wrote=
:<br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-le=
ft:1px #ccc solid;padding-left:1ex"><div dir=3D"ltr">Hi Nathan,<div>The mai=
n problem was that if you try to install cuda, it would by default install =
driver as well that might be of different version than the driver installed=
 with NVIDIA*.run file. So when installing cuda, use an option not to insta=
ll the driver. It is much easier to find NVIDIA*.run file of the version yo=
u need than cuda*.run with the right driver.&nbsp; When downloading NVIDIA*=
.run, pay attention that you are asking for Tesla card (if that's what you =
have). Consumer cards have different driver (I do not remember if it is ref=
lected in the file name but I suspect not, because I made this mistake).</d=
iv><div>Thank you,</div><div>Igor</div><div><br></div></div><div class=3D"g=
mail_extra"><br><div class=3D"gmail_quote">On Mon, Aug 1, 2016 at 8:56 AM, =
Nathan Lin <span dir=3D"ltr">&lt;<a href=3D"javascript:_e(%7B%7D,'cvml','na=
than...@gmail.com');" target=3D"_blank">nathan...@gmail.com</a>&gt;</span> =
wrote:<br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;bord=
er-left:1px #ccc solid;padding-left:1ex"><div dir=3D"ltr">That's great to h=
ear Igor! What ended up being the problem?</div><div><div><div class=3D"gma=
il_extra"><br><div class=3D"gmail_quote">On Mon, Aug 1, 2016 at 1:43 AM, Ri=
ck Wagner <span dir=3D"ltr">&lt;<a href=3D"javascript:_e(%7B%7D,'cvml','ric=
hard...@gmail.com');" target=3D"_blank">richard...@gmail.com</a>&gt;</span>=
 wrote:<br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;bor=
der-left:1px #ccc solid;padding-left:1ex"><div dir=3D"auto"><div></div><div=
>Igor,</div><div><br></div><div>If you had a chance to post your definition=
 file or the steps you took, I know several of us would appreciate it. Gett=
ing TensorFlow running on CentOS was a huge effort for our support staff. A=
nd that's just one of many GPU-enabled applications.</div><span><font color=
=3D"#888888"><div><br></div><div>--Rick</div></font></span><div><div><div><=
br>On Jul 31, 2016, at 10:20 PM, Igor Yakushin &lt;<a href=3D"javascript:_e=
(%7B%7D,'cvml','igor...@gmail.com');" target=3D"_blank">igor...@gmail.com</=
a>&gt; wrote:<br><br></div><blockquote type=3D"cite"><div><div dir=3D"ltr">=
Thank you, Nathan. It finally works!</div><div class=3D"gmail_extra"><br><d=
iv class=3D"gmail_quote">On Sun, Jul 31, 2016 at 5:17 PM, Nathan Lin <span =
dir=3D"ltr">&lt;<a href=3D"javascript:_e(%7B%7D,'cvml','nathan...@gmail.com=
');" target=3D"_blank">nathan...@gmail.com</a>&gt;</span> wrote:<br><blockq=
uote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc =
solid;padding-left:1ex"><div dir=3D"auto"><div></div><div>Yes I do</div><di=
v><div><div><br>On Jul 31, 2016, at 5:03 PM, Igor Yakushin &lt;<a href=3D"j=
avascript:_e(%7B%7D,'cvml','igor...@gmail.com');" target=3D"_blank">igor...=
@gmail.com</a>&gt; wrote:<br><br></div><blockquote type=3D"cite"><div><div =
dir=3D"ltr">Nathan,<div>When you import tensorflow in python, does it tell =
you what cuda libraries it is loading or not?</div><div>Do you see these me=
ssages:</div><div>=3D=3D=3D=3D=3D=3D</div><div><div>&gt;&gt;&gt; import ten=
sorflow as tf&nbsp;</div><div>I tensorflow/stream_executor/dso_loader.cc:10=
8] successfully opened CUDA library libcublas.so locally&nbsp;</div><div>I =
tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA libr=
ary libcudnn.so locally&nbsp;</div><div>I tensorflow/stream_executor/dso_lo=
ader.cc:108] successfully opened CUDA library libcufft.so locally&nbsp;</di=
v><div>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened =
CUDA library libcuda.so locally&nbsp;</div><div>I tensorflow/stream_executo=
r/dso_loader.cc:108] successfully opened CUDA library libcurand.so locally&=
nbsp;</div></div><div>=3D=3D=3D=3D=3D=3D</div><div>Thank you,</div><div>Igo=
r</div></div><div class=3D"gmail_extra"><br><div class=3D"gmail_quote">On S=
un, Jul 31, 2016 at 1:26 PM, Nathan Lin <span dir=3D"ltr">&lt;<a href=3D"ja=
vascript:_e(%7B%7D,'cvml','nathan...@gmail.com');" target=3D"_blank">nathan=
...@gmail.com</a>&gt;</span> wrote:<br><blockquote class=3D"gmail_quote" st=
yle=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div =
dir=3D"auto"><div></div><div>Hi Igor,</div><div><br></div><div>In regards t=
o your first questions, the OS/drivers of your building computer should not=
 matter. I built an Ubuntu 14.04 image on my RHEL 7 box for our RHEL 6 clus=
ter. I'm not sure that the toolkit is that version specific, my image seems=
 to work fine and it's running 353.63. There is one thing that I do that ma=
y be helpful. I read it somewhere online and am not actually sure if it doe=
s anything, but I've included it in my image definitions just in case. Appa=
rently there is something about initializing the CUDA Toolkit. As part of m=
y definition file I run 'make' on the CUDA sample 'deviceQuery'. Maybe that=
 will help?</div><div><br></div><div>Best,</div><div>Nathan</div><div><div>=
<div><br>On Jul 31, 2016, at 1:51 PM, Igor Yakushin &lt;<a href=3D"javascri=
pt:_e(%7B%7D,'cvml','igor...@gmail.com');" target=3D"_blank">igor...@gmail.=
com</a>&gt; wrote:<br><br></div><blockquote type=3D"cite"><div><div dir=3D"=
ltr">Hi Nathan,<div>I got a little bit further: nvidia-smi is working now b=
ut tensorflow still complains:</div><div>=3D=3D=3D=3D=3D=3D=3D=3D=3D</div><=
div><br></div><div>=3D=3D=3D=3D=3D=3D=3D=3D=3D</div><div><span style=3D"fon=
t-family:monospace"><span style=3D"color:rgb(0,0,0)">Singularity/ubuntu_14.=
04.img&gt; nvidia-smi
</span><br>Sun Jul 31 17:33:44 2016 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;<br>+------------------------------------------------------+ &nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>| NVIDIA-SMI 352.55=
 &nbsp;&nbsp;&nbsp;&nbsp;Driver Version: 352.55 &nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;<br>|-------------------------------+----------------------+----=
------------------+
<br>| GPU &nbsp;Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Persistence-=
M| Bus-Id &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disp.A | Volatile Uncor=
r. ECC |
<br>| Fan &nbsp;Temp &nbsp;Perf &nbsp;Pwr:Usage/Cap| &nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;Memory-Usage | GPU-Util &nbsp;Compute M. |
<br>|=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D|
<br>| &nbsp;&nbsp;0 &nbsp;Tesla K40m &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;Off &nbsp;| 0000:20:00.0 &nbsp;&nbsp;&nbsp;&nbsp;Off | &nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 |
<br>| N/A &nbsp;&nbsp;45C &nbsp;&nbsp;&nbsp;P0 &nbsp;&nbsp;&nbsp;79W / 235W=
 | &nbsp;&nbsp;&nbsp;158MiB / 11519MiB | &nbsp;&nbsp;&nbsp;&nbsp;45% &nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;Default |
<br>+-------------------------------+----------------------+---------------=
-------+
<br>| &nbsp;&nbsp;1 &nbsp;Tesla K40m &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;Off &nbsp;| 0000:8B:00.0 &nbsp;&nbsp;&nbsp;&nbsp;Off | &nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 |
<br>| N/A &nbsp;&nbsp;23C &nbsp;&nbsp;&nbsp;P8 &nbsp;&nbsp;&nbsp;18W / 235W=
 | &nbsp;&nbsp;&nbsp;&nbsp;61MiB / 11519MiB | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;0% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Default |
<br>+-------------------------------+----------------------+---------------=
-------+
<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>+-----------------------------------------=
------------------------------------+
<br>| Processes: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GPU Memory |
<br>| &nbsp;GPU &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PID &nbsp;Type &nbsp;Pr=
ocess name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Usage &nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;|
<br>|=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D|
<br>+----------------------------------------------------------------------=
-------+
<br>Singularity/ubuntu_14.04.img&gt; python
<br>Python 2.7.6 (default, Mar 22 2014, 22:59:56) &nbsp;<br>[GCC 4.8.2] on =
linux2
<br>Type "help", "copyright", "credits" or "license" for more information.
<br>&gt;&gt;&gt; import tensorflow
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcublas.so locally
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcudnn.so locally
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcufft.so locally
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcuda.so.1 locally
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcurand.so locally
<br>&gt;&gt;&gt; ss =3D tensorflow.Session()
<br>E tensorflow/stream_executor/cuda/cuda_driver.cc:491] failed call to cu=
Init: CUDA_ERROR_NO_DEVICE
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:153] retrieving C=
UDA diagnostic information for host: midway-l34-02
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:160] hostname: mi=
dway-l34-02
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:185] libcuda repo=
rted version is: 352.93.0
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:356] driver versi=
on file contents: """NVRM version: NVIDIA UNIX x86_64 Kernel Module &nbsp;3=
52.55 &nbsp;Thu Oct &nbsp;8 15:18:00 PDT 2015
<br>GCC version: &nbsp;gcc version 4.4.7 20120313 (Red Hat 4.4.7-16) (GCC) =
&nbsp;<br>"""
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:189] kernel repor=
ted version is: 352.55.0
<br>E tensorflow/stream_executor/cuda/cuda_diagnostics.cc:296] kernel versi=
on 352.55.0 does not match DSO version 352.93.0 -- cannot find working devi=
ces in this configuration
<br>I tensorflow/core/common_runtime/gpu/gpu_init.cc:81] No GPU devices ava=
ilable on machine.
<br>&gt;&gt;&gt; <br>
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D</span></div><div><span =
style=3D"font-family:monospace">As far as I understand the problem is that =
cuda-7.5 was built or relies on nvidia 352.93 while I have NVIDIA driver 35=
2.55 both on the host and container. So far I could not find cuda-7.5 built=
 with 352.55.</span></div><div><span style=3D"font-family:monospace">cuda-7=
.5 has stabs directory in which there is libcuda.so. The problem is probabl=
y coming from there. However, I doubt I can just replace libcuda.so in the =
stubs directory by a different version or turn it into symbolic link to a d=
ifferent version in the driver? Because its size is much smaller than the s=
ize of the real libcuda.so in the driver. So I suspect, it is really only s=
ome kind of interface to the real library?</span></div><div><span style=3D"=
font-family:monospace"><br></span></div><div><span style=3D"font-family:mon=
ospace">Thank you,</span></div><div><span style=3D"font-family:monospace">I=
gor</span></div><div><span style=3D"font-family:monospace"><br></span></div=
></div><div class=3D"gmail_extra"><br><div class=3D"gmail_quote">On Sun, Ju=
l 31, 2016 at 9:36 AM, Igor Yakushin <span dir=3D"ltr">&lt;<a href=3D"javas=
cript:_e(%7B%7D,'cvml','igor...@gmail.com');" target=3D"_blank">igor...@gma=
il.com</a>&gt;</span> wrote:<br><blockquote class=3D"gmail_quote" style=3D"=
margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir=3D"=
ltr">Hi Nathan,<div>When installing cuda libraries and tensorflow into the =
singularity image, is it important to be on the same host with the same ver=
sion of CUDA/OS on which you are going to run later?</div><div>I do not hav=
e root on the machine I am going to run later and prepare the image on a di=
fferent machine with a different version of nvidia driver and a different f=
lavor of Linux.</div><div>Thank you,</div><div>Igor</div><div><br></div></d=
iv><div><div><div class=3D"gmail_extra"><br><div class=3D"gmail_quote">On S=
un, Jul 31, 2016 at 8:39 AM, Nathan Lin <span dir=3D"ltr">&lt;<a href=3D"ja=
vascript:_e(%7B%7D,'cvml','nathan...@gmail.com');" target=3D"_blank">nathan=
...@gmail.com</a>&gt;</span> wrote:<br><blockquote class=3D"gmail_quote" st=
yle=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div =
dir=3D"auto"><div></div><div>Hi Igor,</div><div><br></div><div>I don't nece=
ssarily have a great answer for you. If seems like you are doing everything=
 right, yet it is still not working. In my case, yes nvidia-smi as well as =
TensorFlow both work correctly. I feel like your error still has to do with=
 the version of libcuda.so you are using. Notice how Python seems to correc=
tly load libcuda.so, yet there is later an error that is unable to find lib=
cuda.so. My first suspicion is that there is still a version mismatch betwe=
en the drivers installed on the image and on the host. If you are sure that=
 is not true, it may be possible that the version of the driver that is ins=
talled on the machine isn't new enough for the GPU. That actually occurred =
on our cluster, and after a sysadmin updated the driver, it worked. Barring=
 that I am not too sure. Maybe if you provide me with the full details of y=
our installation (the versions of the packages that you have installed, the=
 OS of your image and host), I might be able to think about something, but =
my suspicion is that the driver version on your host machine may not be new=
 enough.&nbsp;</div><div><br></div><div>Best,</div><div>Nathan&nbsp;</div><=
div><div><div><br>On Jul 31, 2016, at 12:17 AM, Igor Yakushin &lt;<a href=
=3D"javascript:_e(%7B%7D,'cvml','igor...@gmail.com');" target=3D"_blank">ig=
or...@gmail.com</a>&gt; wrote:<br><br></div><blockquote type=3D"cite"><div>=
<div dir=3D"ltr"><div><span style=3D"font-family:monospace"><span style=3D"=
color:rgb(0,0,0)">Hi Nathan,</span></span></div><div><span style=3D"font-fa=
mily:monospace"><span style=3D"color:rgb(0,0,0)"><br></span></span></div><d=
iv><span style=3D"font-family:monospace"><span style=3D"color:rgb(0,0,0)">I=
 have found exactly the same version of NVIDIA driver and extracted from it=
 the libraries and nvidia executables and copied them in /usr/lib64/nvidia =
and /usr/bin and created the corresponding symbolic links. However, I still=
 cannot use GPU inside singularity: nvidia-smi says "GPU access blocked by =
the operating system" (does it work in your case?) and when tensorflow sess=
ion starts it also complains that "No GPU devices available on machine". Ho=
wever, notice that tensorflow seems to think that a different version of NV=
IDIA driver is used. Not sure where it is coming from. The machine on which=
 the image was built has version&nbsp;</span></span><span style=3D"color:rg=
b(0,0,0);font-family:monospace">361.42</span></div><span style=3D"font-fami=
ly:monospace"><span style=3D"color:rgb(0,0,0)"><div><span style=3D"font-fam=
ily:monospace"><span style=3D"color:rgb(0,0,0)"><br></span></span></div><di=
v><span style=3D"font-family:monospace"><span style=3D"color:rgb(0,0,0)">=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D</span></span></div>Python 2.7.12 (defa=
ult, Jul &nbsp;1 2016, 15:12:24) &nbsp;</span><br>[GCC 5.4.0 20160609] on l=
inux2
<br>Type "help", "copyright", "credits" or "license" for more information.
<br>&gt;&gt;&gt; import tensorflow
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcublas.so locally
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcudnn.so locally
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcufft.so locally
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcuda.so locally
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcurand.so locally
<br>&gt;&gt;&gt; ss =3D tensorflow.Session()
<br>E tensorflow/stream_executor/cuda/cuda_driver.cc:491] failed call to cu=
Init: CUDA_ERROR_UNKNOWN
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:153] retrieving C=
UDA diagnostic information for host: midway230
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:160] hostname: mi=
dway230
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:185] libcuda repo=
rted version is: Not found: was unable to find libcuda.so DSO loaded into t=
his program
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:347] driver versi=
on file contents: """NVRM version: NVIDIA UNIX x86_64 Kernel Module &nbsp;3=
52.55 &nbsp;Thu Oct &nbsp;8 15:18:00 PDT 2015
<br>GCC version: &nbsp;gcc version 4.4.7 20120313 (Red Hat 4.4.7-16) (GCC) =
&nbsp;<br>"""
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:189] kernel repor=
ted version is: 352.55.0
<br>I tensorflow/core/common_runtime/gpu/gpu_init.cc:81] No GPU devices ava=
ilable on machine.
<br>&gt;&gt;&gt; &nbsp;<br>Singularity/tensorflow_0.9.img&gt; nvidia-smi
<br>Failed to initialize NVML: GPU access blocked by the operating system<b=
r>
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D</span><div><span style=3D"font-family:mon=
ospace"><br></span></div><div><span style=3D"font-family:monospace">Thank y=
ou,</span></div><div><span style=3D"font-family:monospace">Igor</span></div=
><div><span style=3D"font-family:monospace"><br></span></div></div><div cla=
ss=3D"gmail_extra"><br><div class=3D"gmail_quote">On Thu, Jul 28, 2016 at 9=
:34 PM, Nathan Lin <span dir=3D"ltr">&lt;<a href=3D"javascript:_e(%7B%7D,'c=
vml','nathan...@gmail.com');" target=3D"_blank">nathan...@gmail.com</a>&gt;=
</span> wrote:<br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .=
8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir=3D"ltr">I am no<f=
ont face=3D"arial, helvetica, sans-serif">t sure how to find the correct dr=
iver version, but from my testing, the version must match exactly. I will a=
dmit that I have had problems finding specific versions of the driver from =
NVIDIA's website. I had to ask a sysadmin for the installer that they used.=
 In order to extract the files, you need to use the --extract-only option. =
For instance, you will have to run something like '

















sh /NVIDIA-Linux-x86_64-352.63.run
--extract-only'/ . You will then be given a directory with all the librarie=
s that would have been installed. You will need to copy the libcuda.so.###.=
## library (and you can copy any NVIDIA executables that you want such as n=
vidia-smi). Good luck!</font></div><div><div><div class=3D"gmail_extra"><br=
><div class=3D"gmail_quote">On Thu, Jul 28, 2016 at 8:51 PM, Igor <span dir=
=3D"ltr">&lt;<a href=3D"javascript:_e(%7B%7D,'cvml','igor...@gmail.com');" =
target=3D"_blank">igor...@gmail.com</a>&gt;</span> wrote:<br><blockquote cl=
ass=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;p=
adding-left:1ex"><div dir=3D"ltr"><span style=3D"font-family:monospace"><sp=
an style=3D"color:rgb(0,0,0)">I mean I am using this file from NVIDIA websi=
te cuda_7.5.18_linux.run to install the driver, opengl, cuda. Driver instal=
lation fails, cuda succeeds.&nbsp;</span></span><div><span style=3D"font-fa=
mily:monospace"><font color=3D"#000000">Also, when I run&nbsp;</font></span=
></div><div><span style=3D"font-family:monospace"><font color=3D"#000000">s=
h&nbsp;</font></span><font color=3D"#000000" face=3D"monospace">cuda_7.5.18=
_linux.run</font></div><div><span style=3D"font-family:monospace"><font col=
or=3D"#000000">I am offered to install the driver version&nbsp;</font></spa=
n><span style=3D"font-family:monospace"><span style=3D"color:rgb(0,0,0)">35=
2.39 while on the host it is&nbsp;</span></span><span style=3D"font-family:=
monospace"><span style=3D"color:rgb(0,0,0)">346.47. I cannot upgrade the ho=
st. Any idea where I can get 346.17?</span></span></div><div><span style=3D=
"font-family:monospace"><font color=3D"#000000">I tried using the same link=
 just substitute 18 for something else but have not found the files:</font>=
</span></div><div><span style=3D"font-family:monospace"><span style=3D"colo=
r:rgb(0,0,0)">wget <a href=3D"http://developer.download.nvidia.com/compute/=
cuda/7.5/Prod/local_installers/cuda_7.5.1X_linux.run" target=3D"_blank">htt=
p://developer.download.nvidia.com/compute/cuda/7.5/Prod/local_installers/cu=
da_7.5.1X_linux.run</a></span><br></span><br></div><div><div><div><br></div=
><div><br></div><div>On Thursday, July 28, 2016 at 7:34:55 PM UTC-5, Igor w=
rote:<blockquote class=3D"gmail_quote" style=3D"margin:0;margin-left:0.8ex;=
border-left:1px #ccc solid;padding-left:1ex"><div dir=3D"ltr">Hi Nathan,<di=
v>When I try to install the driver by running NVIDIA*.run script inside the=
 image, it fails, probably because it tries to modify kernel that belongs t=
o host?</div><div>How do I extract just libcuda.so.345.67 without installin=
g the driver (which is obviously problematic) and why would copying the lib=
rary from the host would not work?</div><div>Thank you,</div><div>Igor<br><=
br>On Thursday, July 28, 2016 at 7:18:26 PM UTC-5, Nathan Lin wrote:<blockq=
uote class=3D"gmail_quote" style=3D"margin:0;margin-left:0.8ex;border-left:=
1px #ccc solid;padding-left:1ex">Also if you are using the binary installat=
ion of TensorFlow you need CUDA toolkit 7.5 and cuDNN v4. These only need t=
o be installed on our image. As I mentioned earlier you will need the libcu=
da.so.###.## library on your image. It is very important that this is the s=
ame version of the NVIDIA driver as you have on your nose (seemingly 346.67=
 for you). I should've have also mentioned that you want the libcuda.so.345=
.67 library that you get from extracting the NVIDIA installer. It will not =
work if you try to copy&nbsp;the libcuda.so library that from you node.&nbs=
p;<div><br></div><div>Let me know if you have any more questions.&nbsp;</di=
v><div><br></div><div>Best,</div><div>Nathan<span></span><br><br>On Thursda=
y, July 28, 2016, Nathan Lin &lt;<a rel=3D"nofollow">nat...@gmail.com</a>&g=
t; wrote:<br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;b=
order-left:1px #ccc solid;padding-left:1ex">Hello,<div><br></div><div>Yes y=
ou are correct. The NVIDIA driver must be installed on your image as well. =
However, you honestly only need the libcuda.so.###.## library and the appro=
priate links for that library. Once you have those installed in your image,=
 it should work.&nbsp;</div><div><br></div><div>Best,</div><div>Nathan&nbsp=
;<span></span><br><br>On Thursday, July 28, 2016, Igor &lt;<a>igor...@gmail=
.com</a>&gt; wrote:<br><blockquote class=3D"gmail_quote" style=3D"margin:0 =
0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir=3D"ltr">Hi A=
ll,<div><br><div>I am trying to use GPU-enabled tensorflow and it cannot fi=
nd GPU card from inside the container.</div><div><br></div><div>On the host=
:</div><div><span style=3D"font-family:monospace"><span style=3D"color:rgb(=
0,0,0)">$ lspci | grep -i nvidia
</span><br>20:00.0 3D controller: NVIDIA Corporation GK110BGL [Tesla K40m] =
(rev a1)
<br>8b:00.0 3D controller: NVIDIA Corporation GK110BGL [Tesla K40m] (rev a1=
)<br>
<br></span></div><div><span style=3D"font-family:monospace"><span style=3D"=
color:rgb(0,0,0)">$ nvidia-smi
</span><br>Thu Jul 28 19:01:42 2016 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;<br>+------------------------------------------------------+ &nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>| NVIDIA-SMI 346.47=
 &nbsp;&nbsp;&nbsp;&nbsp;Driver Version: 346.47 &nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;<br>|-------------------------------+----------------------+----=
------------------+
<br>| GPU &nbsp;Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Persistence-=
M| Bus-Id &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disp.A | Volatile Uncor=
r. ECC |
<br>| Fan &nbsp;Temp &nbsp;Perf &nbsp;Pwr:Usage/Cap| &nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;Memory-Usage | GPU-Util &nbsp;Compute M. |
<br>|=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D|
<br>| &nbsp;&nbsp;0 &nbsp;Tesla K40m &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;Off &nbsp;| 0000:20:00.0 &nbsp;&nbsp;&nbsp;&nbsp;Off | &nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 |
<br>| N/A &nbsp;&nbsp;30C &nbsp;&nbsp;&nbsp;P8 &nbsp;&nbsp;&nbsp;20W / 235W=
 | &nbsp;&nbsp;&nbsp;&nbsp;66MiB / 11519MiB | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;0% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Default |
<br>+-------------------------------+----------------------+---------------=
-------+
<br>| &nbsp;&nbsp;1 &nbsp;Tesla K40m &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;Off &nbsp;| 0000:8B:00.0 &nbsp;&nbsp;&nbsp;&nbsp;Off | &nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 |
<br>| N/A &nbsp;&nbsp;26C &nbsp;&nbsp;&nbsp;P8 &nbsp;&nbsp;&nbsp;19W / 235W=
 | &nbsp;&nbsp;&nbsp;&nbsp;60MiB / 11519MiB | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;0% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Default |
<br>+-------------------------------+----------------------+---------------=
-------+
<br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>+-----------------------------------------=
------------------------------------+
<br>| Processes: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GPU Memory |
<br>| &nbsp;GPU &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PID &nbsp;Type &nbsp;Pr=
ocess name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Usage &nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;|
<br>|=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D|
<br>| &nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;&nbsp;11671 &nbsp;&nbsp;&nbsp;G=
 &nbsp;&nbsp;/usr/bin/X &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;9MiB |
<br>| &nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;11671 &nbsp;&nbsp;&nbsp;G=
 &nbsp;&nbsp;/usr/bin/X &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;3MiB |<br>
<br></span></div></div><div><font face=3D"monospace"><br></font></div><div>=
<font face=3D"monospace">Inside singularity:</font></div><div><span style=
=3D"font-family:monospace"><span style=3D"color:rgb(0,0,0)">$ singularity s=
hell /software/src/singularity_images/tensorflow_0.9.img</span><br></span><=
/div><div><span style=3D"font-family:monospace"><span style=3D"color:rgb(0,=
0,0)"><br></span></span></div><div><span style=3D"font-family:monospace"><s=
pan style=3D"color:rgb(0,0,0)">Singularity/tensorflow_0.9.img&gt; lspci | g=
rep -i nvidia
</span><br>bash: lspci: command not found
<br>Singularity/tensorflow_0.9.img&gt; nvidia-smi
<br>bash: nvidia-smi: command not found
<br>Singularity/tensorflow_0.9.img&gt; python
<br>Python 2.7.12 (default, Jul &nbsp;1 2016, 15:12:24) &nbsp;<br>[GCC 5.4.=
0 20160609] on linux2
<br>Type "help", "copyright", "credits" or "license" for more information.
<br>&gt;&gt;&gt; import tensorflow as tf
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcublas.so locally
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcudnn.so locally
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcufft.so locally
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcuda.so locally
<br>I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcurand.so locally
<br>&gt;&gt;&gt; sess =3D tf.Session()
<br>E tensorflow/stream_executor/cuda/cuda_driver.cc:491] failed call to cu=
Init: CUDA_ERROR_UNKNOWN
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:153] retrieving C=
UDA diagnostic information for host: midway-l34-01
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:160] hostname: mi=
dway-l34-01
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:185] libcuda repo=
rted version is: Not found: was unable to find libcuda.so DSO loaded into t=
his program
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:347] driver versi=
on file contents: """NVRM version: NVIDIA UNIX x86_64 Kernel Module &nbsp;3=
46.47 &nbsp;Thu Feb 19 18:56:03 PST 2015
<br>GCC version: &nbsp;gcc version 4.4.7 20120313 (Red Hat 4.4.7-11) (GCC) =
&nbsp;<br>"""
<br>I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:189] kernel repor=
ted version is: 346.47.0
<br>I tensorflow/core/common_runtime/gpu/gpu_init.cc:81] No GPU devices ava=
ilable on machine.<br>
<br></span></div><div><span style=3D"font-family:monospace">Must there be n=
vidia driver installed inside the container? Outside? The container shares =
the same kernel with the host and nvidia kernel module needs to be loaded..=
. How this is handled? Any requirements on nvidia driver and cuda versions =
inside and outside of the container?</span></div><div><span style=3D"font-f=
amily:monospace"><br></span></div><div><span style=3D"font-family:monospace=
">Thank you,</span></div><div><span style=3D"font-family:monospace">Igor</s=
pan></div><div><span style=3D"font-family:monospace"><br></span></div><div>=
<font face=3D"monospace"><br></font></div></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a>singu...@lbl.gov</a>.<br>
</blockquote></div>
</blockquote></div>
</blockquote></div></div></blockquote></div></div></div></div><div><div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"javascript:_e(%7B%7D,'cvml','singularity%...@lbl.gov');"=
 target=3D"_blank">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><br></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"javascript:_e(%7B%7D,'cvml','singularity%...@lbl.gov');"=
 target=3D"_blank">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><br></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"javascript:_e(%7B%7D,'cvml','singularity%...@lbl.gov');"=
 target=3D"_blank">singu...@lbl.gov</a>.<br>
</div></blockquote></div></div></div><div><div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"javascript:_e(%7B%7D,'cvml','singularity%...@lbl.gov');"=
 target=3D"_blank">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><br></div>
</div></div></blockquote></div><br></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"javascript:_e(%7B%7D,'cvml','singularity%...@lbl.gov');"=
 target=3D"_blank">singu...@lbl.gov</a>.<br>
</div></blockquote></div></div></div><div><div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"javascript:_e(%7B%7D,'cvml','singularity%...@lbl.gov');"=
 target=3D"_blank">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><br></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"javascript:_e(%7B%7D,'cvml','singularity%...@lbl.gov');"=
 target=3D"_blank">singu...@lbl.gov</a>.<br>
</div></blockquote></div></div></div><div><div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"javascript:_e(%7B%7D,'cvml','singularity%...@lbl.gov');"=
 target=3D"_blank">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><br></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"javascript:_e(%7B%7D,'cvml','singularity%...@lbl.gov');"=
 target=3D"_blank">singu...@lbl.gov</a>.<br>
</div></blockquote></div></div></div><div><div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"javascript:_e(%7B%7D,'cvml','singularity%...@lbl.gov');"=
 target=3D"_blank">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><br></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"javascript:_e(%7B%7D,'cvml','singularity%...@lbl.gov');"=
 target=3D"_blank">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><br></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"javascript:_e(%7B%7D,'cvml','singularity%...@lbl.gov');"=
 target=3D"_blank">singu...@lbl.gov</a>.<br>
</blockquote></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov">singu...@lbl.gov</a>.<br>
</div></blockquote></body></html>
--Apple-Mail-18A17A03-8532-4ABE-AE19-D78E30D4DDBE--
