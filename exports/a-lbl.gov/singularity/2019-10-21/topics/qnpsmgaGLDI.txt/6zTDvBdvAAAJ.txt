X-Received: by 2002:a65:4907:: with SMTP id p7mr17161460pgs.288.1560202451376;
        Mon, 10 Jun 2019 14:34:11 -0700 (PDT)
X-BeenThere: singularity@lbl.gov
Received: by 2002:aa7:8115:: with SMTP id b21ls2692964pfi.12.gmail; Mon, 10
 Jun 2019 14:34:09 -0700 (PDT)
X-Received: by 2002:a63:a449:: with SMTP id c9mr17592784pgp.149.1560202449353;
        Mon, 10 Jun 2019 14:34:09 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1560202449; cv=none;
        d=google.com; s=arc-20160816;
        b=UBbH2QVBPWBJ3oDs43yRgLU1ldLbTqUxlGRuXLCvoSkzx1FZ2yeB9kdUl+0pyujWtf
         8q/ZZrYupDiOHMH1X0kamM0+XnNDzZpgtWRyIbfJUlIKXDF4EpXAW9Lr8HcXrQyfm4eo
         E+zFE+VDcJDAWv9moh1rCCaVPh9WQRQqgKK4Wi0fCg5k/fGrzEzEforIT9gLugn4UuEM
         PumcBKWC8F1xoG2pPVeHXxB5Pr8vggmrpBWHbVU/1ZH5BM/mamjHn8/TCFM6IWvZRtNl
         lAv3keqhl8/LCULiP5Ws2LP7FWxEDUFykbxd62kxV5Kae+HTOITi6vrurXs1Yo6g+S6f
         KIhg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=to:subject:message-id:date:from:in-reply-to:references:mime-version
         :dkim-signature;
        bh=amltoFRFTkZyTNbMXAr3v7oxPiSuk5uerjrKBR7UBWk=;
        b=j3qrABp5JDzWuQyuorVqmEEbMW4CJTKMszLF4GEZcn1frBNRxgVID4lipeTk3H68ns
         1eLBGJGFjlb9bC4JfYww2o/fmaYgjyG4nr3UdUYySgVTdukDobA6rHhi8J+LW03LzBSU
         kfyNmCjK+WWvmSumVw/04m8kr5H4e2q1eNhLbcbYC/D6Gq/jfwfaDC8P9tsOSNxKpzAn
         3fC1a8I6BMsbfzyH8H4HMO+LVtf/XYorCaFE5hrph9N+KS1vEoRI1BIRxYmEkKfh7n2h
         8DkHl/s1z4LbMuOj9N+QOjNwtrgaF0gsZY64cTnH5+IXkih2SQCUtoNExcErjChbPqt6
         JzXw==
ARC-Authentication-Results: i=1; mx.google.com;
       dkim=pass head...@gmail.com header.s=20161025 header.b=dyoAtffi;
       spf=pass (google.com: domain of vso...@gmail.com designates 209.85.166.47 as permitted sender) smtp.mailfrom=vso...@gmail.com
Return-Path: <vso...@gmail.com>
Received: from fe4.lbl.gov (fe4.lbl.gov. [131.243.228.53])
        by mx.google.com with ESMTP id w65si9725163pgw.6.2019.06.10.14.34.09
        for <singu...@lbl.gov>;
        Mon, 10 Jun 2019 14:34:09 -0700 (PDT)
Received-SPF: pass (google.com: domain of vso...@gmail.com designates 209.85.166.47 as permitted sender) client-ip=209.85.166.47;
Authentication-Results: mx.google.com;
       dkim=pass head...@gmail.com header.s=20161025 header.b=dyoAtffi;
       spf=pass (google.com: domain of vso...@gmail.com designates 209.85.166.47 as permitted sender) smtp.mailfrom=vso...@gmail.com
X-Ironport-SBRS: 2.8
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A2F9RwAlzP5cgC+mVdFjAx+BeIEPWIEUU?=
 =?us-ascii?q?TMohA4HgR2CLTGQHWiYYBSBEAMYAxQhBAkBAQEBAQEBAQEgAQURAQECgQKCdkY?=
 =?us-ascii?q?CgnUjNAkOAQMBAQUBAQEBBAEBAhABAQkNCQgnJQyCOgUCAwIkCgRNOy8BAQEBA?=
 =?us-ascii?q?QEBAQEBAQEBAQEBGgIMASAGEC0BAQEBAgEjBBkBDQ4eAwELBgULDSABCQICIQE?=
 =?us-ascii?q?BDgMBBQELEQ4HBAEHFQSDAiYBgUIBAw4PBQqdGjyLIH4WBQEXgnoFdj0BgwgKG?=
 =?us-ascii?q?ScNYIE6AgcSgSKLXReBf4N1Lj6CGi4ZAQECFQOBFAESAUAMGoJDglgEi0ULgRW?=
 =?us-ascii?q?GTYF9kzo+CYIRhkSJE4NrG4MOlA2TfiiBY4lig3swgS5wMHFwFTsxgjsJgj2DO?=
 =?us-ascii?q?YJkgjBRhQomMAEBDo1gSIF7AQE?=
X-IronPort-AV: E=Sophos;i="5.63,576,1557212400"; 
   d="scan'208,217";a="65259978"
Received: from mail-io1-f47.google.com ([209.85.166.47])
  by fe4.lbl.gov with ESMTP; 10 Jun 2019 14:34:07 -0700
Received: by mail-io1-f47.google.com with SMTP id s7so8111677iob.11
        for <singu...@lbl.gov>; Mon, 10 Jun 2019 14:34:07 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:references:in-reply-to:from:date:message-id:subject:to;
        bh=amltoFRFTkZyTNbMXAr3v7oxPiSuk5uerjrKBR7UBWk=;
        b=dyoAtffiNv/+Enc6W6S1nH6y0cKBvtOfxb2BFKDEHPtmtklEWZGr4eLm6a3cz8bbVS
         8K7ZyeeIXoHNNIKy5P94Ccp1MMW+yD4CCVEtjp480KA5/ifTk8PwzLDvbW3RJACunXOv
         eGI4LDoeoeBvutsYIDBABukKBVfKAfRyvAf43Dj/oNSu2hTXa3BX/ny8M7r/C5pIcDCp
         +Jrifc2JLc7wxCO7dEqyR5squM9YcGKOf0nGz1cNisB7/kX3SeA8xbbgUPpu3QyAsoGv
         e1xA9q5Qx6lpT/BCgJ5o5YJOr9cV9mFkEM2xmh+urBT8j9op91JnTqJiIYb7vjMyH+CS
         1yqA==
X-Gm-Message-State: APjAAAVdbmu4B+xV3Jjq4BmYJJLWEzJAlLQJYTCM/EOPppxR8wN4JGlR
	JT2U6H62L3UeGfeSAo0wwdpBvp/LeWK5+sJdROtusNPg
X-Received: by 2002:a5e:8913:: with SMTP id k19mr13456255ioj.155.1560202446524;
 Mon, 10 Jun 2019 14:34:06 -0700 (PDT)
MIME-Version: 1.0
References: <4e3f0796-dbb8-48ac-a786-28ee3ff9f7f8@lbl.gov> <CAM=pu++9g7EHN1b0DArLbBmrqaLSusyhNLRuVWLzTbKJAGH5kQ@mail.gmail.com>
 <ece8a25d-5717-496b-a8ef-aa60cca30391@lbl.gov> <CAM=pu+L7BL89E6or5ATQ7qZnQ8HhUj7X=cm6H9GAEapg2kSVWg@mail.gmail.com>
 <1e966ec5-e71d-48bf-9ca4-ba43fd7fece3@lbl.gov>
In-Reply-To: <1e966ec5-e71d-48bf-9ca4-ba43fd7fece3@lbl.gov>
From: v <vso...@gmail.com>
Date: Mon, 10 Jun 2019 17:33:54 -0400
Message-ID: <CAM=pu+JARY_MBKVHDH8pgA1972_JytYszjr267Uv2hA6HUwxtA@mail.gmail.com>
Subject: Re: [Singularity] Mounting to Singularity container invoked by
 snakemake on HPC cluster
To: singularity@lbl.gov
Content-Type: multipart/alternative; boundary="0000000000009a587a058afef037"

--0000000000009a587a058afef037
Content-Type: text/plain; charset="UTF-8"

And the final error is a permission denied? Snakemake is helping us a lot
by providing the command that fails, so let's start by determining if it's
the --home bind (or not). Try the same command, but remove the bind to the
custom home:

singularity exec  --bind
> /secondary/projects/bbc/tools/dean_miniconda3/lib/python3.6/site-packages:/mnt/snakemake
> /secondary/projects/bbc/research/smk_pipeline/.snakemake/singularity/2f95debcc77a32fc723cdf8a4ad18fa2.simg
> bash -c 'set -euo pipefail;  Rscript -e
> '\''rmarkdown::render("scripts/edgeR_longReport.Rmd",output_format="html_document")'\'


If you are already sitting in your home, it's redundant anyway. And to
simplify things a bit more, just exec a command like an echo or a which:

singularity exec  --bind
> /secondary/projects/bbc/tools/dean_miniconda3/lib/python3.6/site-packages:/mnt/snakemake
> /secondary/projects/bbc/research/smk_pipeline/.snakemake/singularity/2f95debcc77a32fc723cdf8a4ad18fa2.simg
> bash -c 'echo hello'


And can you show the full output from debug? Snakemake seems to be cching
images in the .snakemake folder, and what I want to also understand is why
it's binding the Python packages base to /mnt/snakemake (do you know?).

Best,

Vanessa

On Mon, Jun 10, 2019 at 4:37 PM Dean Pettinga <dean...@gmail.com> wrote:

> Hey Vanessa,
>
> I've run in debug mode, e.g.
> snakemake --use-singularity --debug
>
> i believe the relevant info from the output is below:
>
> RuleException:
>
> CalledProcessError in line 141 of /secondary/projects/bbc/research/
> smk_pipeline/Snakefile:
>
> Command ' singularity exec --home
> /secondary/projects/bbc/research/smk_pipeline  --bind
> /secondary/projects/bbc/tools/dean_miniconda3/lib/python3.6/site-packages:/mnt/snakemake
> /secondary/projects/bbc/research/smk_pipeline/.snakemake/singularity/2f95debcc77a32fc723cdf8a4ad18fa2.simg
> bash -c 'set -euo pipefail;  Rscript -e '\''rmarkdown::render(
> "scripts/edgeR_longReport.Rmd",output_format="html_document")'\''''
> returned non-zero exit status 255.
>
>  File "/secondary/projects/bbc/research/smk_pipeline/Snakefile", line 141,
> in __rule_edgeR_longReport
>
>  File
> "/secondary/projects/bbc/tools/dean_miniconda3/lib/python3.6/concurrent/futures/thread.py"
> , line 56, in run
>
> I *am* working in a subdirectory of my $HOME directory. It seems like
> this may be the root of the issue.
>
> -Dean
>
> On Tuesday, June 4, 2019 at 5:20:46 PM UTC-4, vanessa wrote:
>>
>> Can you try running with debug? I'm looking at the Snakemake source code
>> and I see a few things. First, snakemake is creating a mountpoint for
>> itself:
>>
>> SNAKEMAKE_MOUNTPOINT = "/mnt/snakemake"
>>
>>
>> which is added as a bind to the container (and I haven't looked further
>> but I'm guessing things like the Snakefile are bound here)
>>
>> args += " --bind {}:{}".format(SNAKEMAKE_SEARCHPATH, SNAKEMAKE_MOUNTPOINT
>> )
>>
>> It might be good to run a test and just list what is included that. What
>> I'm also noticing for the shellcmd function (possibly this is used when you
>> run a singularity command, since it uses exec despite it's name) is that
>> the os.getcwd() is always bound as --home
>>
>> cmd = "{} singularity exec --home {} {} {} {} -c '{}'".format(
>> envvars, os.getcwd(), args, img_path, shell_executable,
>> cmd.replace("'", r"'\''"))
>> logger.debug(cmd)
>>
>>
>> Are you working in a folder that is a subset of your actual home? It
>> seems to be having trouble with that particular bind. Either way, if you
>> might be able to run in debug so we see any commands that are printed? The
>> full code is here, for those interested:
>>
>>
>> https://bitbucket.org/snakemake/snakemake/src/master/snakemake/singularity.py
>>
>>
>>
>> On Tue, Jun 4, 2019 at 4:52 PM Dean Pettinga <de...@gmail.com> wrote:
>>
>>> Hey Vanessa,
>>>
>>> to answer those few things:
>>>
>>> - I'm able to shell into the container and bind anything i want with -B
>>> option
>>> - I've been using --singularity-args in an attempt to bind, but thus
>>> far, it has not worked, leading me to believe it might be an issue to do
>>> with snakemake or the session folder.
>>> - haven't looked at sci-f too closely, but i don't think it's going to
>>> be helpful for my situation.
>>> - My pipeline uses at most 8-16 parallel processes, so i'm planning to
>>> pull the s-hub container as i'm hoping to make this easily reproducible for
>>> other users.
>>>
>>> I'm still at a bit of an impasse...
>>> -Dean
>>>
>>> On Tuesday, June 4, 2019 at 11:01:32 AM UTC-4, vanessa wrote:
>>>>
>>>> I've used Snakemake + Singularity (without the official
>>>> --with-singularity) flag, here is the repo if it's helpful:
>>>> https://github.com/sci-f/snakemake.scif
>>>>
>>>> A few things to try:
>>>>
>>>>  - I would first shell into the container (that works) and see what
>>>> binds you have, by default. If your cluster disabled some set of mounts,
>>>> that could be the issue, or you might need to ask for them.
>>>>  - I'm looking at the Singularity command group
>>>> <https://snakemake.readthedocs.io/en/stable/executable.html?highlight=singularity#SINGULARITY>,
>>>> and I wonder if you can try setting --singularity-args to make binds to
>>>> your system that are needed? It does seem like something might be up with
>>>> the session folder, others can comment too :)
>>>>  - If your pipeline doesn't have needs beyond singularity, you could
>>>> also try the approach I linked above, adding the snakemake deps into a
>>>> container first, and then running it.
>>>>  - Finally, I would recommend pulling an image first and then setting
>>>> --singularity-dir to where it is, that way you can reuse the same image and
>>>> not be pulling a gazillion if you run this in parallel.
>>>>
>>>> Best,
>>>>
>>>> Vanessa
>>>>
>>>> On Tue, Jun 4, 2019 at 10:44 AM Dean Pettinga <de...@gmail.com>
>>>> wrote:
>>>>
>>>>> I'm currently trying to implement a snakemake workflow on a HPC
>>>>> cluster using singularity containers for specific rules.
>>>>>
>>>>> I'm having issues when mounting to the singularity container invoked
>>>>> by snakemake.
>>>>> $ cd /path/to/smk_pipeline
>>>>> $ snakemake --use-singularity
>>>>> ERROR  : Failed to mount home directory /path/to/smk_pipeline -> /cm/
>>>>> local/apps/singularity/2.4.2/var/singularity/mnt/session/path/to/
>>>>> smk_pipeline: Permission denied
>>>>> The rule being run invokes a container hosted at singularity-hub, but
>>>>> it errors out before it's able to do anything.
>>>>>
>>>>> If i shell into a container interactively, no such problem occurs.
>>>>> $ singularity shell rnaseq.simg
>>>>> Singularity: Invoking an interactive shell within container...
>>>>> Singularity rnaseq.simg:~>
>>>>>
>>>>> I think it might be due to the fact that write permissions on /cm/
>>>>> local/apps/singularity/2.4.2/var/singularity/mnt/ are set to 0755.
>>>>> One of our HPC admins suggested that I try to use a different mount
>>>>> point for singularity, but I haven't been able to find any information on
>>>>> this topic in the documentation...
>>>>>
>>>>> I'm confused about why singularity is unable to mount any directories
>>>>> when invoked by snakemake, rather than by myself directly as a user. This
>>>>> may be a question more fit for the snakemake folks, but i thought i'd start
>>>>> here.
>>>>>
>>>>> cheers,
>>>>> Dean
>>>>>
>>>>> --
>>>>> You received this message because you are subscribed to the Google
>>>>> Groups "singularity" group.
>>>>> To unsubscribe from this group and stop receiving emails from it, send
>>>>> an email to si...@lbl.gov.
>>>>> To view this discussion on the web visit
>>>>> https://groups.google.com/a/lbl.gov/d/msgid/singularity/4e3f0796-dbb8-48ac-a786-28ee3ff9f7f8%40lbl.gov
>>>>> <https://groups.google.com/a/lbl.gov/d/msgid/singularity/4e3f0796-dbb8-48ac-a786-28ee3ff9f7f8%40lbl.gov?utm_medium=email&utm_source=footer>
>>>>> .
>>>>>
>>>>
>>>>
>>>> --
>>>> Vanessa Villamia Sochat
>>>> Stanford University '16
>>>> (603) 321-0676
>>>>
>>> --
>>> You received this message because you are subscribed to the Google
>>> Groups "singularity" group.
>>> To unsubscribe from this group and stop receiving emails from it, send
>>> an email to si...@lbl.gov.
>>> To view this discussion on the web visit
>>> https://groups.google.com/a/lbl.gov/d/msgid/singularity/ece8a25d-5717-496b-a8ef-aa60cca30391%40lbl.gov
>>> <https://groups.google.com/a/lbl.gov/d/msgid/singularity/ece8a25d-5717-496b-a8ef-aa60cca30391%40lbl.gov?utm_medium=email&utm_source=footer>
>>> .
>>>
>>
>>
>> --
>> Vanessa Villamia Sochat
>> Stanford University '16
>> (603) 321-0676
>>
> --
> You received this message because you are subscribed to the Google Groups
> "singularity" group.
> To unsubscribe from this group and stop receiving emails from it, send an
> email to singu...@lbl.gov.
> To view this discussion on the web visit
> https://groups.google.com/a/lbl.gov/d/msgid/singularity/1e966ec5-e71d-48bf-9ca4-ba43fd7fece3%40lbl.gov
> <https://groups.google.com/a/lbl.gov/d/msgid/singularity/1e966ec5-e71d-48bf-9ca4-ba43fd7fece3%40lbl.gov?utm_medium=email&utm_source=footer>
> .
>


-- 
Vanessa Villamia Sochat
Stanford University '16
(603) 321-0676

--0000000000009a587a058afef037
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">And the final error is a permission denied? Snakemake is h=
elping us a lot by providing the command that fails, so let&#39;s start by =
determining if it&#39;s the --home bind (or not). Try the same command, but=
 remove the bind to the custom home:<div><br></div><blockquote class=3D"gma=
il_quote" style=3D"margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,2=
04,204);padding-left:1ex">singularity exec=C2=A0 --bind /secondary/projects=
/bbc/tools/dean_miniconda3/lib/python3.6/site-packages:/mnt/snakemake /seco=
ndary/projects/bbc/research/smk_pipeline/.snakemake/singularity/2f95debcc77=
a32fc723cdf8a4ad18fa2.simg bash -c &#39;set -euo pipefail; =C2=A0Rscript -e=
 &#39;\&#39;&#39;rmarkdown::render(&quot;scripts/edgeR_longReport.Rmd&quot;=
,output_format=3D&quot;html_document&quot;)&#39;\&#39;</blockquote><div><br=
></div><div>If you are already sitting in your home, it&#39;s redundant any=
way. And to simplify things a bit more, just exec a command like an echo or=
 a which:</div><div><br></div><blockquote class=3D"gmail_quote" style=3D"ma=
rgin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:=
1ex">singularity exec=C2=A0 --bind /secondary/projects/bbc/tools/dean_minic=
onda3/lib/python3.6/site-packages:/mnt/snakemake /secondary/projects/bbc/re=
search/smk_pipeline/.snakemake/singularity/2f95debcc77a32fc723cdf8a4ad18fa2=
.simg bash -c &#39;echo hello&#39;</blockquote><div><br></div><div>And can =
you show the full output from debug? Snakemake seems to be cching images in=
 the .snakemake folder, and what I want to also understand is why it&#39;s =
binding the Python packages base to /mnt/snakemake (do you know?).=C2=A0=C2=
=A0</div><div><br></div><div>Best,</div><div><br></div><div>Vanessa</div></=
div><br><div class=3D"gmail_quote"><div dir=3D"ltr" class=3D"gmail_attr">On=
 Mon, Jun 10, 2019 at 4:37 PM Dean Pettinga &lt;<a href=3D"mailto:dean...@g=
mail.com" target=3D"_blank">dean...@gmail.com</a>&gt; wrote:<br></div><bloc=
kquote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-left:=
1px solid rgb(204,204,204);padding-left:1ex"><div dir=3D"ltr">Hey Vanessa,<=
div><br></div><div>I&#39;ve run in debug mode, e.g.</div><div class=3D"gmai=
l-m_-8193426787415668992gmail-m_-9040154315795049212prettyprint" style=3D"b=
ackground-color:rgb(250,250,250);border-color:rgb(187,187,187);border-style=
:solid;border-width:1px"><code class=3D"gmail-m_-8193426787415668992gmail-m=
_-9040154315795049212prettyprint"><div class=3D"gmail-m_-819342678741566899=
2gmail-m_-9040154315795049212subprettyprint"><span style=3D"color:rgb(0,0,0=
)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled-=
by-prettify">snakemake </span><span style=3D"color:rgb(102,102,0)" class=3D=
"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-prettify=
">--</span><span style=3D"color:rgb(0,0,136)" class=3D"gmail-m_-81934267874=
15668992gmail-m_-9040154315795049212styled-by-prettify">use</span><span sty=
le=3D"color:rgb(102,102,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-9=
040154315795049212styled-by-prettify">-</span><span style=3D"color:rgb(0,0,=
0)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled=
-by-prettify">singularity </span><span style=3D"color:rgb(102,102,0)" class=
=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-prett=
ify">--</span><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m_-8193426787=
415668992gmail-m_-9040154315795049212styled-by-prettify">debug</span></div>=
</code></div><div><br></div><div>i believe the relevant info from the outpu=
t is below:<br><div class=3D"gmail-m_-8193426787415668992gmail-m_-904015431=
5795049212prettyprint" style=3D"background-color:rgb(250,250,250);border-co=
lor:rgb(187,187,187);border-style:solid;border-width:1px"><code class=3D"gm=
ail-m_-8193426787415668992gmail-m_-9040154315795049212prettyprint"><div cla=
ss=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212subprettyprin=
t"><p class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212p1">=
<span class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212s1">=
<span style=3D"color:rgb(102,0,102)" class=3D"gmail-m_-8193426787415668992g=
mail-m_-9040154315795049212styled-by-prettify">RuleException</span><span st=
yle=3D"color:rgb(102,102,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-=
9040154315795049212styled-by-prettify">:</span></span></p><p class=3D"gmail=
-m_-8193426787415668992gmail-m_-9040154315795049212p1"><span class=3D"gmail=
-m_-8193426787415668992gmail-m_-9040154315795049212s1"><span style=3D"color=
:rgb(102,0,102)" class=3D"gmail-m_-8193426787415668992gmail-m_-904015431579=
5049212styled-by-prettify">CalledProcessError</span><span style=3D"color:rg=
b(0,0,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212=
styled-by-prettify"> </span><span style=3D"color:rgb(0,0,136)" class=3D"gma=
il-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-prettify">in=
</span><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m_-81934267874156689=
92gmail-m_-9040154315795049212styled-by-prettify"> line </span><span style=
=3D"color:rgb(0,102,102)" class=3D"gmail-m_-8193426787415668992gmail-m_-904=
0154315795049212styled-by-prettify">141</span><span style=3D"color:rgb(0,0,=
0)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled=
-by-prettify"> of </span><span style=3D"color:rgb(102,102,0)" class=3D"gmai=
l-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-prettify">/</=
span><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m_-8193426787415668992=
gmail-m_-9040154315795049212styled-by-prettify">secondary</span><span style=
=3D"color:rgb(102,102,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-904=
0154315795049212styled-by-prettify">/</span><span style=3D"color:rgb(0,0,0)=
" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled-b=
y-prettify">projects</span><span style=3D"color:rgb(102,102,0)" class=3D"gm=
ail-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-prettify">/=
</span><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m_-81934267874156689=
92gmail-m_-9040154315795049212styled-by-prettify">bbc</span><span style=3D"=
color:rgb(102,102,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154=
315795049212styled-by-prettify">/</span><span style=3D"color:rgb(0,0,0)" cl=
ass=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-pr=
ettify">research</span><span style=3D"color:rgb(102,102,0)" class=3D"gmail-=
m_-8193426787415668992gmail-m_-9040154315795049212styled-by-prettify">/</sp=
an><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m_-8193426787415668992gm=
ail-m_-9040154315795049212styled-by-prettify">smk_pipeline</span><span styl=
e=3D"color:rgb(102,102,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-90=
40154315795049212styled-by-prettify">/</span><span style=3D"color:rgb(102,0=
,102)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212sty=
led-by-prettify">Snakefile</span><span style=3D"color:rgb(102,102,0)" class=
=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-prett=
ify">:</span></span></p><p class=3D"gmail-m_-8193426787415668992gmail-m_-90=
40154315795049212p1"><span class=3D"gmail-m_-8193426787415668992gmail-m_-90=
40154315795049212s1"><span style=3D"color:rgb(102,0,102)" class=3D"gmail-m_=
-8193426787415668992gmail-m_-9040154315795049212styled-by-prettify">Command=
</span><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m_-81934267874156689=
92gmail-m_-9040154315795049212styled-by-prettify"> </span><span style=3D"co=
lor:rgb(0,136,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-90401543157=
95049212styled-by-prettify">&#39; singularity exec --home /secondary/projec=
ts/bbc/research/smk_pipeline</span><span class=3D"gmail-m_-8193426787415668=
992gmail-m_-9040154315795049212Apple-converted-space"><span style=3D"color:=
rgb(0,136,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-904015431579504=
9212styled-by-prettify"> =C2=A0</span></span><span style=3D"color:rgb(0,136=
,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212style=
d-by-prettify">--bind /secondary/projects/bbc/tools/dean_miniconda3/lib/pyt=
hon3.6/site-packages:/mnt/snakemake /secondary/projects/bbc/research/smk_pi=
peline/.snakemake/singularity/2f95debcc77a32fc723cdf8a4ad18fa2.simg bash -c=
 &#39;</span><span style=3D"color:rgb(0,0,136)" class=3D"gmail-m_-819342678=
7415668992gmail-m_-9040154315795049212styled-by-prettify">set</span><span s=
tyle=3D"color:rgb(0,0,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-904=
0154315795049212styled-by-prettify"> </span><span style=3D"color:rgb(102,10=
2,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styl=
ed-by-prettify">-</span><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m_-=
8193426787415668992gmail-m_-9040154315795049212styled-by-prettify">euo pipe=
fail</span><span style=3D"color:rgb(102,102,0)" class=3D"gmail-m_-819342678=
7415668992gmail-m_-9040154315795049212styled-by-prettify">;</span><span cla=
ss=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212Apple-convert=
ed-space"><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m_-81934267874156=
68992gmail-m_-9040154315795049212styled-by-prettify"> =C2=A0</span></span><=
span style=3D"color:rgb(102,0,102)" class=3D"gmail-m_-8193426787415668992gm=
ail-m_-9040154315795049212styled-by-prettify">Rscript</span><span style=3D"=
color:rgb(0,0,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-90401543157=
95049212styled-by-prettify"> </span><span style=3D"color:rgb(102,102,0)" cl=
ass=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-pr=
ettify">-</span><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m_-81934267=
87415668992gmail-m_-9040154315795049212styled-by-prettify">e </span><span s=
tyle=3D"color:rgb(0,136,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-9=
040154315795049212styled-by-prettify">&#39;\&#39;&#39;</span><span style=3D=
"color:rgb(0,0,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315=
795049212styled-by-prettify">rmarkdown</span><span style=3D"color:rgb(102,1=
02,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212sty=
led-by-prettify">::</span><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m=
_-8193426787415668992gmail-m_-9040154315795049212styled-by-prettify">render=
</span><span style=3D"color:rgb(102,102,0)" class=3D"gmail-m_-8193426787415=
668992gmail-m_-9040154315795049212styled-by-prettify">(</span><span style=
=3D"color:rgb(0,136,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-90401=
54315795049212styled-by-prettify">&quot;scripts/edgeR_longReport.Rmd&quot;<=
/span><span style=3D"color:rgb(102,102,0)" class=3D"gmail-m_-81934267874156=
68992gmail-m_-9040154315795049212styled-by-prettify">,</span><span style=3D=
"color:rgb(0,0,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315=
795049212styled-by-prettify">output_format</span><span style=3D"color:rgb(1=
02,102,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-904015431579504921=
2styled-by-prettify">=3D</span><span style=3D"color:rgb(0,136,0)" class=3D"=
gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-prettify"=
>&quot;html_document&quot;</span><span style=3D"color:rgb(102,102,0)" class=
=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-prett=
ify">)</span><span style=3D"color:rgb(0,136,0)" class=3D"gmail-m_-819342678=
7415668992gmail-m_-9040154315795049212styled-by-prettify">&#39;\&#39;&#39;&=
#39;&#39;</span><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m_-81934267=
87415668992gmail-m_-9040154315795049212styled-by-prettify"> returned non</s=
pan><span style=3D"color:rgb(102,102,0)" class=3D"gmail-m_-8193426787415668=
992gmail-m_-9040154315795049212styled-by-prettify">-</span><span style=3D"c=
olor:rgb(0,0,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-904015431579=
5049212styled-by-prettify">zero </span><span style=3D"color:rgb(0,0,136)" c=
lass=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-p=
rettify">exit</span><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m_-8193=
426787415668992gmail-m_-9040154315795049212styled-by-prettify"> status </sp=
an><span style=3D"color:rgb(0,102,102)" class=3D"gmail-m_-81934267874156689=
92gmail-m_-9040154315795049212styled-by-prettify">255.</span></span></p><p =
class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212p1"><span =
class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212s1"><span =
class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212Apple-conv=
erted-space"><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m_-81934267874=
15668992gmail-m_-9040154315795049212styled-by-prettify"> =C2=A0</span></spa=
n><span style=3D"color:rgb(102,0,102)" class=3D"gmail-m_-819342678741566899=
2gmail-m_-9040154315795049212styled-by-prettify">File</span><span style=3D"=
color:rgb(0,0,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-90401543157=
95049212styled-by-prettify"> </span><span style=3D"color:rgb(0,136,0)" clas=
s=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-pret=
tify">&quot;/secondary/projects/bbc/research/smk_pipeline/Snakefile&quot;</=
span><span style=3D"color:rgb(102,102,0)" class=3D"gmail-m_-819342678741566=
8992gmail-m_-9040154315795049212styled-by-prettify">,</span><span style=3D"=
color:rgb(0,0,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-90401543157=
95049212styled-by-prettify"> line </span><span style=3D"color:rgb(0,102,102=
)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled-=
by-prettify">141</span><span style=3D"color:rgb(102,102,0)" class=3D"gmail-=
m_-8193426787415668992gmail-m_-9040154315795049212styled-by-prettify">,</sp=
an><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m_-8193426787415668992gm=
ail-m_-9040154315795049212styled-by-prettify"> </span><span style=3D"color:=
rgb(0,0,136)" class=3D"gmail-m_-8193426787415668992gmail-m_-904015431579504=
9212styled-by-prettify">in</span><span style=3D"color:rgb(0,0,0)" class=3D"=
gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-prettify"=
> __rule_edgeR_longReport</span></span></p><p class=3D"gmail-m_-81934267874=
15668992gmail-m_-9040154315795049212p1"><span class=3D"gmail-m_-81934267874=
15668992gmail-m_-9040154315795049212s1"><span class=3D"gmail-m_-81934267874=
15668992gmail-m_-9040154315795049212Apple-converted-space"><span style=3D"c=
olor:rgb(0,0,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-904015431579=
5049212styled-by-prettify"> =C2=A0</span></span><span style=3D"color:rgb(10=
2,0,102)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212=
styled-by-prettify">File</span><span style=3D"color:rgb(0,0,0)" class=3D"gm=
ail-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-prettify"> =
</span><span style=3D"color:rgb(0,136,0)" class=3D"gmail-m_-819342678741566=
8992gmail-m_-9040154315795049212styled-by-prettify">&quot;/secondary/projec=
ts/bbc/tools/dean_miniconda3/lib/python3.6/concurrent/futures/thread.py&quo=
t;</span><span style=3D"color:rgb(102,102,0)" class=3D"gmail-m_-81934267874=
15668992gmail-m_-9040154315795049212styled-by-prettify">,</span><span style=
=3D"color:rgb(0,0,0)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154=
315795049212styled-by-prettify"> line </span><span style=3D"color:rgb(0,102=
,102)" class=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212sty=
led-by-prettify">56</span><span style=3D"color:rgb(102,102,0)" class=3D"gma=
il-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-prettify">,<=
/span><span style=3D"color:rgb(0,0,0)" class=3D"gmail-m_-819342678741566899=
2gmail-m_-9040154315795049212styled-by-prettify"> </span><span style=3D"col=
or:rgb(0,0,136)" class=3D"gmail-m_-8193426787415668992gmail-m_-904015431579=
5049212styled-by-prettify">in</span><span style=3D"color:rgb(0,0,0)" class=
=3D"gmail-m_-8193426787415668992gmail-m_-9040154315795049212styled-by-prett=
ify"> run</span></span></p></div></code></div><div><br></div></div><div>I <=
i><b>am</b></i> working in a subdirectory of my $HOME directory. It seems l=
ike this may be the root of the issue.</div><div><br></div><div>-Dean</div>=
<div><br>On Tuesday, June 4, 2019 at 5:20:46 PM UTC-4, vanessa wrote:<block=
quote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-left:1=
px solid rgb(204,204,204);padding-left:1ex"><div dir=3D"ltr">Can you try ru=
nning with debug? I&#39;m looking at the Snakemake source code and I see a =
few things. First, snakemake is creating a mountpoint for itself:<div><br><=
/div><div><div style=3D"line-height:18px"><blockquote class=3D"gmail_quote"=
 style=3D"color:rgb(0,0,0);font-family:SFMono-Medium,&quot;SF Mono&quot;,&q=
uot;Segoe UI Mono&quot;,&quot;Roboto Mono&quot;,&quot;Ubuntu Mono&quot;,Men=
lo,monospace;font-size:13px;white-space:pre-wrap;background-color:rgb(255,2=
55,254);margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);pad=
ding-left:1ex"><span style=3D"color:rgb(101,84,192)">SNAKEMAKE_MOUNTPOINT</=
span> =3D <span style=3D"color:rgb(9,101,69)">&quot;/mnt/snakemake&quot;</s=
pan></blockquote><div style=3D"color:rgb(0,0,0);font-family:SFMono-Medium,&=
quot;SF Mono&quot;,&quot;Segoe UI Mono&quot;,&quot;Roboto Mono&quot;,&quot;=
Ubuntu Mono&quot;,Menlo,monospace;font-size:13px;white-space:pre-wrap;backg=
round-color:rgb(255,255,254)"><br></div><div style=3D"color:rgb(0,0,0);font=
-family:SFMono-Medium,&quot;SF Mono&quot;,&quot;Segoe UI Mono&quot;,&quot;R=
oboto Mono&quot;,&quot;Ubuntu Mono&quot;,Menlo,monospace;font-size:13px;whi=
te-space:pre-wrap;background-color:rgb(255,255,254)"><span style=3D"backgro=
und-color:rgb(255,255,255);color:rgb(34,34,34);font-family:Arial,Helvetica,=
sans-serif;font-size:small;white-space:normal">which is added as a bind to =
the container (and I haven&#39;t looked further but I&#39;m guessing things=
 like the Snakefile are bound here)=C2=A0</span></div><div style=3D"color:r=
gb(0,0,0);font-family:SFMono-Medium,&quot;SF Mono&quot;,&quot;Segoe UI Mono=
&quot;,&quot;Roboto Mono&quot;,&quot;Ubuntu Mono&quot;,Menlo,monospace;font=
-size:13px;white-space:pre-wrap;background-color:rgb(255,255,254)"><span st=
yle=3D"background-color:rgb(255,255,255);color:rgb(34,34,34);font-family:Ar=
ial,Helvetica,sans-serif;font-size:small;white-space:normal"><br></span></d=
iv><div style=3D"color:rgb(0,0,0);font-family:SFMono-Medium,&quot;SF Mono&q=
uot;,&quot;Segoe UI Mono&quot;,&quot;Roboto Mono&quot;,&quot;Ubuntu Mono&qu=
ot;,Menlo,monospace;font-size:13px;white-space:pre-wrap;background-color:rg=
b(255,255,254)"><div style=3D"line-height:18px"><div><span style=3D"color:r=
gb(32,32,32)">args</span> +=3D <span style=3D"color:rgb(9,101,69)">&quot; -=
-bind {}:{}&quot;</span>.<span style=3D"color:rgb(9,30,66);font-weight:bold=
">format</span>(<span style=3D"color:rgb(101,84,192)">SNAKEMAKE_SEARCHPATH<=
/span>, <span style=3D"color:rgb(101,84,192)">SNAKEMAKE_MOUNTPOINT</span>)<=
/div><div><br></div></div></div><div style=3D"line-height:18px"><div><span =
style=3D"background-color:rgb(255,255,255)">It might be good to run a test =
and just list what is included that. What I&#39;m also noticing for the she=
llcmd function (possibly this is used when you run a singularity command, s=
ince it uses exec despite it&#39;s name) is that the os.getcwd() is always =
bound as --home</span></div><div><span style=3D"background-color:rgb(255,25=
5,255)"><br></span></div><div><div style=3D"color:rgb(0,0,0);background-col=
or:rgb(255,255,254);font-family:SFMono-Medium,&quot;SF Mono&quot;,&quot;Seg=
oe UI Mono&quot;,&quot;Roboto Mono&quot;,&quot;Ubuntu Mono&quot;,Menlo,mono=
space;font-size:13px;line-height:18px;white-space:pre-wrap"><div>    <span =
style=3D"color:rgb(32,32,32)">cmd</span> =3D <span style=3D"color:rgb(9,101=
,69)">&quot;{} singularity exec --home {} {} {} {} -c &#39;{}&#39;&quot;</s=
pan>.<span style=3D"color:rgb(9,30,66);font-weight:bold">format</span>(<br>=
</div><div>        <span style=3D"color:rgb(32,32,32)">envvars</span>, <spa=
n style=3D"color:rgb(32,32,32)">os</span>.<span style=3D"color:rgb(32,32,32=
)">getcwd</span>(), <span style=3D"color:rgb(32,32,32)">args</span>, <span =
style=3D"color:rgb(32,32,32)">img_path</span>, <span style=3D"color:rgb(32,=
32,32)">shell_executable</span>,</div><div>        <span style=3D"color:rgb=
(32,32,32)">cmd</span>.<span style=3D"color:rgb(32,32,32)">replace</span>(<=
span style=3D"color:rgb(9,101,69)">&quot;&#39;&quot;</span>, <span style=3D=
"color:rgb(32,32,32)">r</span><span style=3D"color:rgb(9,101,69)">&quot;&#3=
9;\&#39;&#39;&quot;</span>))</div><div>    <span style=3D"color:rgb(32,32,3=
2)">logger</span>.<span style=3D"color:rgb(32,32,32)">debug</span>(<span st=
yle=3D"color:rgb(32,32,32)">cmd</span>)</div></div></div><div><span style=
=3D"background-color:rgb(255,255,255)"><br></span></div><div><span style=3D=
"background-color:rgb(255,255,255)"><br></span></div><div><span style=3D"ba=
ckground-color:rgb(255,255,255)">Are you working in a folder that is a subs=
et of your actual home? It seems to be having trouble with that particular =
bind. Either way, if you might be able to run in debug so we see any comman=
ds that are printed? The full code is here, for those interested:</span></d=
iv><div><span style=3D"background-color:rgb(255,255,255)"><br></span></div>=
<div><a href=3D"https://bitbucket.org/snakemake/snakemake/src/master/snakem=
ake/singularity.py" rel=3D"nofollow" target=3D"_blank">https://bitbucket.or=
g/snakemake/snakemake/src/master/snakemake/singularity.py</a><span style=3D=
"background-color:rgb(255,255,255)"><br></span></div><div><span style=3D"ba=
ckground-color:rgb(255,255,255)"><br></span></div></div><div style=3D"color=
:rgb(0,0,0);font-family:SFMono-Medium,&quot;SF Mono&quot;,&quot;Segoe UI Mo=
no&quot;,&quot;Roboto Mono&quot;,&quot;Ubuntu Mono&quot;,Menlo,monospace;fo=
nt-size:13px;white-space:pre-wrap;background-color:rgb(255,255,254);line-he=
ight:18px"><br></div></div></div></div><br><div class=3D"gmail_quote"><div =
dir=3D"ltr">On Tue, Jun 4, 2019 at 4:52 PM Dean Pettinga &lt;<a rel=3D"nofo=
llow">de...@gmail.com</a>&gt; wrote:<br></div><blockquote class=3D"gmail_qu=
ote" style=3D"margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,20=
4);padding-left:1ex"><div dir=3D"ltr">Hey Vanessa,<div><br></div><div>to an=
swer those few things:<div><br></div><div>- I&#39;m able to shell into the =
container and bind anything i want with -B option</div><div>- I&#39;ve been=
 using --singularity-args in an attempt to bind, but thus far, it has not w=
orked, leading me to believe it might be an issue to do with snakemake or t=
he session folder.</div><div>- haven&#39;t looked at sci-f too closely, but=
 i don&#39;t think it&#39;s going to be helpful for my situation.</div><div=
>- My pipeline uses at most 8-16 parallel processes, so i&#39;m planning to=
 pull the s-hub container as i&#39;m hoping to make this easily reproducibl=
e for other users.<br></div><div><br></div><div>I&#39;m still at a bit of a=
n impasse...</div><div>-Dean</div><div><br>On Tuesday, June 4, 2019 at 11:0=
1:32 AM UTC-4, vanessa wrote:<blockquote class=3D"gmail_quote" style=3D"mar=
gin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1=
ex"><div dir=3D"ltr">I&#39;ve used Snakemake=C2=A0+ Singularity (without th=
e official --with-singularity) flag, here is the repo if it&#39;s helpful:=
=C2=A0<a href=3D"https://github.com/sci-f/snakemake.scif" rel=3D"nofollow" =
target=3D"_blank">https://github.com/sci-f/snakemake.scif</a><div><br></div=
><div>A few things to try:</div><div><br></div><div>=C2=A0- I would first s=
hell into the container (that works) and see what binds you have, by defaul=
t. If your cluster disabled some set of mounts, that could be the issue, or=
 you might need to ask for them.</div><div>=C2=A0- I&#39;m looking at the <=
a href=3D"https://snakemake.readthedocs.io/en/stable/executable.html?highli=
ght=3Dsingularity#SINGULARITY" rel=3D"nofollow" target=3D"_blank">Singulari=
ty command group</a>, and I wonder if you can try setting --singularity-arg=
s to make binds to your system that are needed? It does seem like something=
 might be up with the session folder, others can comment too :)</div><div>=
=C2=A0- If your pipeline doesn&#39;t have needs beyond singularity, you cou=
ld also try the approach I linked above, adding the snakemake deps into a c=
ontainer first, and then running it.</div><div>=C2=A0- Finally, I would rec=
ommend pulling an image first and then setting --singularity-dir to where i=
t is, that way you can reuse the same image and not be pulling a gazillion =
if you run this in parallel.</div><div><br></div><div>Best,</div><div><br><=
/div><div>Vanessa</div></div><br><div class=3D"gmail_quote"><div dir=3D"ltr=
">On Tue, Jun 4, 2019 at 10:44 AM Dean Pettinga &lt;<a rel=3D"nofollow">de.=
..@gmail.com</a>&gt; wrote:<br></div><blockquote class=3D"gmail_quote" styl=
e=3D"margin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);paddin=
g-left:1ex"><div dir=3D"ltr"><div>I&#39;m currently trying to implement a s=
nakemake workflow on a HPC cluster using singularity containers for specifi=
c rules.</div><div><br></div><div>I&#39;m having issues when mounting to th=
e singularity container invoked by snakemake.</div><div><div style=3D"backg=
round-color:rgb(250,250,250);border-color:rgb(187,187,187);border-style:sol=
id;border-width:1px"><code><div><span style=3D"color:rgb(0,0,0)">$ cd </spa=
n><span style=3D"color:rgb(102,102,0)">/</span><font color=3D"#000000"><spa=
n style=3D"color:rgb(0,0,0)">path</span><span style=3D"color:rgb(102,102,0)=
">/</span><span style=3D"color:rgb(0,0,0)">to</span></font><span style=3D"c=
olor:rgb(102,102,0)">/</span><span style=3D"color:rgb(0,0,0)">smk_pipeline<=
br>$ snakemake </span><span style=3D"color:rgb(102,102,0)">--</span><span s=
tyle=3D"color:rgb(0,0,136)">use</span><span style=3D"color:rgb(102,102,0)">=
-</span><span style=3D"color:rgb(0,0,0)">singularity<br>ERROR =C2=A0</span>=
<span style=3D"color:rgb(102,102,0)">:</span><span style=3D"color:rgb(0,0,0=
)"> </span><span style=3D"color:rgb(102,0,102)">Failed</span><span style=3D=
"color:rgb(0,0,0)"> to mount home directory </span><span style=3D"color:rgb=
(102,102,0)">/</span><font color=3D"#000000"><span style=3D"color:rgb(0,0,0=
)">path</span><span style=3D"color:rgb(102,102,0)">/</span><span style=3D"c=
olor:rgb(0,0,0)">to</span></font><span style=3D"color:rgb(102,102,0)">/</sp=
an><span style=3D"color:rgb(0,0,0)">smk_pipeline </span><span style=3D"colo=
r:rgb(102,102,0)">-&gt;</span><span style=3D"color:rgb(0,0,0)"> </span><spa=
n style=3D"color:rgb(0,136,0)">/cm/</span><span style=3D"color:rgb(0,0,136)=
">local</span><span style=3D"color:rgb(102,102,0)">/</span><span style=3D"c=
olor:rgb(0,0,0)">apps</span><span style=3D"color:rgb(102,102,0)">/</span><s=
pan style=3D"color:rgb(0,0,0)">singularity</span><span style=3D"color:rgb(1=
02,102,0)">/</span><span style=3D"color:rgb(0,102,102)">2.4</span><span sty=
le=3D"color:rgb(102,102,0)">.</span><span style=3D"color:rgb(0,102,102)">2<=
/span><span style=3D"color:rgb(102,102,0)">/</span><span style=3D"color:rgb=
(0,0,136)">var</span><span style=3D"color:rgb(102,102,0)">/</span><span sty=
le=3D"color:rgb(0,0,0)">singularity</span><span style=3D"color:rgb(102,102,=
0)">/</span><span style=3D"color:rgb(0,0,0)">mnt</span><span style=3D"color=
:rgb(102,102,0)">/</span><span style=3D"color:rgb(0,0,0)">session</span><sp=
an style=3D"color:rgb(102,102,0)">/</span><font color=3D"#000000"><span sty=
le=3D"color:rgb(0,0,0)">path</span><span style=3D"color:rgb(102,102,0)">/</=
span><span style=3D"color:rgb(0,0,0)">to</span></font><span style=3D"color:=
rgb(102,102,0)">/</span><span style=3D"color:rgb(0,0,0)">smk_pipeline</span=
><span style=3D"color:rgb(102,102,0)">:</span><span style=3D"color:rgb(0,0,=
0)"> </span><span style=3D"color:rgb(102,0,102)">Permission</span><span sty=
le=3D"color:rgb(0,0,0)"> denied</span></div></code></div></div><div>The rul=
e being run invokes a container hosted at singularity-hub, but it errors ou=
t before it&#39;s able to do anything.=C2=A0</div><div style=3D"color:rgb(5=
1,51,51);font-family:Roboto"><br></div><div>If i shell into a container int=
eractively, no such problem occurs.</div><div style=3D"background-color:rgb=
(250,250,250);border-color:rgb(187,187,187);border-style:solid;border-width=
:1px"><code><div><span style=3D"color:rgb(0,0,0)">$ singularity shell rnase=
q</span><span style=3D"color:rgb(102,102,0)">.</span><span style=3D"color:r=
gb(0,0,0)">simg<br></span><span style=3D"color:rgb(102,0,102)">Singularity<=
/span><span style=3D"color:rgb(102,102,0)">:</span><span style=3D"color:rgb=
(0,0,0)"> </span><span style=3D"color:rgb(102,0,102)">Invoking</span><span =
style=3D"color:rgb(0,0,0)"> an interactive shell within container</span><sp=
an style=3D"color:rgb(102,102,0)">...</span><span style=3D"color:rgb(0,0,0)=
"><br></span><span style=3D"color:rgb(102,0,102)">Singularity</span><span s=
tyle=3D"color:rgb(0,0,0)"> rnaseq</span><span style=3D"color:rgb(102,102,0)=
">.</span><span style=3D"color:rgb(0,0,0)">simg</span><span style=3D"color:=
rgb(102,102,0)">:~&gt;</span></div></code></div><div><br>I think it might b=
e due to the fact that write permissions on=C2=A0<span style=3D"font-family=
:monospace;background-color:rgb(250,250,250);color:rgb(0,136,0)">/cm/</span=
><span style=3D"font-family:monospace;background-color:rgb(250,250,250);col=
or:rgb(0,0,136)">local</span><span style=3D"font-family:monospace;backgroun=
d-color:rgb(250,250,250);color:rgb(102,102,0)">/</span><span style=3D"font-=
family:monospace;background-color:rgb(250,250,250);color:rgb(0,0,0)">apps</=
span><span style=3D"font-family:monospace;background-color:rgb(250,250,250)=
;color:rgb(102,102,0)">/</span><span style=3D"font-family:monospace;backgro=
und-color:rgb(250,250,250);color:rgb(0,0,0)">singularity</span><span style=
=3D"font-family:monospace;background-color:rgb(250,250,250);color:rgb(102,1=
02,0)">/</span><span style=3D"font-family:monospace;background-color:rgb(25=
0,250,250);color:rgb(0,102,102)">2.4</span><span style=3D"font-family:monos=
pace;background-color:rgb(250,250,250);color:rgb(102,102,0)">.</span><span =
style=3D"font-family:monospace;background-color:rgb(250,250,250);color:rgb(=
0,102,102)">2</span><span style=3D"font-family:monospace;background-color:r=
gb(250,250,250);color:rgb(102,102,0)">/</span><span style=3D"font-family:mo=
nospace;background-color:rgb(250,250,250);color:rgb(0,0,136)">var</span><sp=
an style=3D"font-family:monospace;background-color:rgb(250,250,250);color:r=
gb(102,102,0)">/</span><span style=3D"font-family:monospace;background-colo=
r:rgb(250,250,250);color:rgb(0,0,0)">singularity</span><span style=3D"font-=
family:monospace;background-color:rgb(250,250,250);color:rgb(102,102,0)">/<=
/span><span style=3D"font-family:monospace;background-color:rgb(250,250,250=
);color:rgb(0,0,0)">mnt</span><span style=3D"font-family:monospace;backgrou=
nd-color:rgb(250,250,250);color:rgb(102,102,0)">/</span>=C2=A0are set to=C2=
=A00755.</div><div>One of our HPC admins suggested that I try to use a diff=
erent mount point for singularity, but I haven&#39;t been able to find any =
information on this topic in the documentation...</div><div><br></div><div>=
I&#39;m confused about why singularity is unable to mount any directories w=
hen invoked by snakemake, rather than by myself directly as a user. This ma=
y be a question more fit for the snakemake folks, but i thought i&#39;d sta=
rt here.</div><div><br></div><div>cheers,</div><div>Dean</div><div>















</div></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a rel=3D"nofollow">si...@lbl.gov</a>.<br>
To view this discussion on the web visit <a href=3D"https://groups.google.c=
om/a/lbl.gov/d/msgid/singularity/4e3f0796-dbb8-48ac-a786-28ee3ff9f7f8%40lbl=
.gov?utm_medium=3Demail&amp;utm_source=3Dfooter" rel=3D"nofollow" target=3D=
"_blank">https://groups.google.com/a/lbl.gov/d/msgid/singularity/4e3f0796-d=
bb8-48ac-a786-28ee3ff9f7f8%40lbl.gov</a>.<br>
</blockquote></div><br clear=3D"all"><div><br></div>-- <br><div dir=3D"ltr"=
>Vanessa Villamia Sochat<br>Stanford University &#39;16<br><div><div><div>(=
603) 321-0676</div></div></div></div>
</blockquote></div></div></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a rel=3D"nofollow">si...@lbl.gov</a>.<br>
To view this discussion on the web visit <a href=3D"https://groups.google.c=
om/a/lbl.gov/d/msgid/singularity/ece8a25d-5717-496b-a8ef-aa60cca30391%40lbl=
.gov?utm_medium=3Demail&amp;utm_source=3Dfooter" rel=3D"nofollow" target=3D=
"_blank">https://groups.google.com/a/lbl.gov/d/msgid/singularity/ece8a25d-5=
717-496b-a8ef-aa60cca30391%40lbl.gov</a>.<br>
</blockquote></div><br clear=3D"all"><div><br></div>-- <br><div dir=3D"ltr"=
>Vanessa Villamia Sochat<br>Stanford University &#39;16<br><div><div><div>(=
603) 321-0676</div></div></div></div>
</blockquote></div></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singu...@lbl.=
gov</a>.<br>
To view this discussion on the web visit <a href=3D"https://groups.google.c=
om/a/lbl.gov/d/msgid/singularity/1e966ec5-e71d-48bf-9ca4-ba43fd7fece3%40lbl=
.gov?utm_medium=3Demail&amp;utm_source=3Dfooter" target=3D"_blank">https://=
groups.google.com/a/lbl.gov/d/msgid/singularity/1e966ec5-e71d-48bf-9ca4-ba4=
3fd7fece3%40lbl.gov</a>.<br>
</blockquote></div><br clear=3D"all"><div><br></div>-- <br><div dir=3D"ltr"=
 class=3D"gmail-m_-8193426787415668992gmail_signature">Vanessa Villamia Soc=
hat<br>Stanford University &#39;16<br><div><div><div>(603) 321-0676</div></=
div></div></div>

--0000000000009a587a058afef037--
