X-Received: by 10.66.150.70 with SMTP id ug6mr4863111pab.1.1470106953180;
        Mon, 01 Aug 2016 20:02:33 -0700 (PDT)
X-BeenThere: singularity@lbl.gov
Received: by 10.107.192.69 with SMTP id q66ls4455560iof.7.gmail; Mon, 01 Aug
 2016 20:02:32 -0700 (PDT)
X-Received: by 10.66.79.138 with SMTP id j10mr40610570pax.60.1470106952619;
        Mon, 01 Aug 2016 20:02:32 -0700 (PDT)
Return-Path: <richard...@gmail.com>
Received: from fe3.lbl.gov (fe3.lbl.gov. [128.3.41.68])
        by mx.google.com with ESMTPS id v64si458881pfk.256.2016.08.01.20.02.32
        for <singu...@lbl.gov>
        (version=TLS1_2 cipher=ECDHE-RSA-AES128-GCM-SHA256 bits=128/128);
        Mon, 01 Aug 2016 20:02:32 -0700 (PDT)
Received-SPF: pass (google.com: domain of richard...@gmail.com designates 209.85.220.50 as permitted sender) client-ip=209.85.220.50;
Authentication-Results: mx.google.com;
       dkim=pass head...@gmail.com;
       spf=pass (google.com: domain of richard...@gmail.com designates 209.85.220.50 as permitted sender) smtp.mailfrom=richard...@gmail.com
X-Ironport-SBRS: 3.4
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: A2EXAQBQDKBXhjLcVdFchBt8gz6kRokthnx2gT1AJoFsVIInAYEPAoE1OBQBAQEBAQEBAw8BAQEICwsJGS+CUzkKBisBAQEBAQEBAQEBAQEBAQEBGgIrBBYLGwEBBAESCAEIHQENDh0BAwELBgULDSABBgMCAiECDgMBBQELEQ4HBAEcBAGHdAEDDwgFCaMJgTI+MYs7gWqCWgWGVAoZJw1Ug0ABAQEBAQEEAQEBAQEBAQEBAQEUAgYQiBIIgUqBA4JDgU8RAYMdK4IvBYFFhEeCEQdghRILaj+JNTSGGIJ8gnNDgjWBaxc3hwwOI4VJiCuEBYI4MIEPDw+CSBELgWxOAQEBAQOGL4E2AQEB
X-IPAS-Result: A2EXAQBQDKBXhjLcVdFchBt8gz6kRokthnx2gT1AJoFsVIInAYEPAoE1OBQBAQEBAQEBAw8BAQEICwsJGS+CUzkKBisBAQEBAQEBAQEBAQEBAQEBGgIrBBYLGwEBBAESCAEIHQENDh0BAwELBgULDSABBgMCAiECDgMBBQELEQ4HBAEcBAGHdAEDDwgFCaMJgTI+MYs7gWqCWgWGVAoZJw1Ug0ABAQEBAQEEAQEBAQEBAQEBAQEUAgYQiBIIgUqBA4JDgU8RAYMdK4IvBYFFhEeCEQdghRILaj+JNTSGGIJ8gnNDgjWBaxc3hwwOI4VJiCuEBYI4MIEPDw+CSBELgWxOAQEBAQOGL4E2AQEB
X-IronPort-AV: E=Sophos;i="5.28,458,1464678000"; 
   d="scan'208,217";a="32015197"
Received: from mail-pa0-f50.google.com ([209.85.220.50])
  by fe3.lbl.gov with ESMTP; 01 Aug 2016 20:02:30 -0700
Received: by mail-pa0-f50.google.com with SMTP id b2so5852148pat.0
        for <singu...@lbl.gov>; Mon, 01 Aug 2016 20:02:30 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20120113;
        h=mime-version:subject:from:in-reply-to:date:cc:message-id:references
         :to;
        bh=WOMs4eeXJXWRuqF78JSKRViQt6ZYPJQiu5diYzB9I+o=;
        b=vzcxYmdPixqd9vJ/4iCdjYWF1eSOQD1jCT0tuEF2WOmqzPbV6t9f5X65dILVkydICI
         N3sINkZLyjNWmeN8j1l9EV1ocPHZ01BR+BblXdhH3HNgurzobj5zsTw2KgJW5G3EYbVW
         9EhzoFfUzccpG7UcdB/prDhpYn5H6ATb+Q4Tf4YXN55kVV+iktooaXAEtH8Fw20HeQzf
         CA7mmB1DfrUf9gUPR7wvm+Eqel3esgvy/9SEmq7SwAo1fyMcwKAHGZGHvz26jL63SS+P
         //vRAx+3+iDisZ+WFq7TWtG5TVUFbQgXsRB2ilLwn6YkOO6HZSFcSx5t4eRKCvDUnX0E
         6naQ==
X-Gm-Message-State: AEkoouszHiNw+hTw/6ojirh+dMb9ba64bzBLVYhg1VDtdwvaCZUCAdGGmcrJ0+G1j6fT9w==
X-Received: by 10.66.217.170 with SMTP id oz10mr92037035pac.61.1470106949852;
        Mon, 01 Aug 2016 20:02:29 -0700 (PDT)
Return-Path: <richard...@gmail.com>
Received: from [192.168.1.20] (108-66-116-252.lightspeed.sndgca.sbcglobal.net. [108.66.116.252])
        by smtp.gmail.com with ESMTPSA id 15sm325120pfz.36.2016.08.01.20.02.28
        (version=TLS1 cipher=ECDHE-RSA-AES128-SHA bits=128/128);
        Mon, 01 Aug 2016 20:02:28 -0700 (PDT)
Content-Type: multipart/alternative; boundary="Apple-Mail=_0B2A6510-1A57-4175-89A7-D5E128D8F2BE"
Mime-Version: 1.0 (Mac OS X Mail 8.2 \(2104\))
Subject: Re: [Singularity] How to use GPU in singularity?
From: Rick Wagner <richard...@gmail.com>
In-Reply-To: <CAMfmYehTRzo_h-7+QeND0NXvs+YLTHLa+Os6g2siiXMJ0QmF2w@mail.gmail.com>
Date: Mon, 1 Aug 2016 20:02:26 -0700
Cc: Mahidhar Tatineni <mahi...@sdsc.edu>
Message-Id: <7A6CF191-D59A-4246-898B-C6259304CE9E@gmail.com>
References: <02b27dd5-dcc4-4800-97f6-7dcfcc85afd8@lbl.gov> <CAA8GL6Bsyt5oHK8O9GrDS6F=USv-aP0K9a+m8Q+jfOJ8kpxrhA@mail.gmail.com>
 <CAA8GL6DP3KhfbWV7nK5JGxNn4S+=M0=vEV0mACsoRrd6Ag2GpQ@mail.gmail.com>
 <718cb7c4-524f-4b08-bde9-3a36013fba59@lbl.gov> <4e52c56a-5475-4075-a3c7-2ae22191b544@lbl.gov>
 <CAA8GL6BdE1TRBaPD-oM7qcj8QK1cBsmJsUzYyrvkRPBP9CX+hQ@mail.gmail.com>
 <CAMfmYehdPLtiouQqMGqOx4ZbEXFbbPRL5QOxsP_vQo0us1QLuA@mail.gmail.com>
 <B927B7F6-3CFB-452D-92AB-866F9B8024E4@gmail.com> <CAMfmYeiSvcReO4jvSGJkavnex64wGZ8Phxva2kAxJ7pcp48YiA@mail.gmail.com>
 <CAMfmYeiaTxVQSNqwprHe5ckcDHPcJXy3imdepiRL+KkDh12TCQ@mail.gmail.com>
 <65CD778F-6CD1-4DB4-9668-4D89839B7053@gmail.com> <CAMfmYeg_pnJcyKGetK7WVChToaWCgGYH-nrYY9v=2+RSkuWZuQ@mail.gmail.com>
 <C5AE54CB-2BA1-4E59-88FC-D20224A46086@gmail.com> <CAMfmYeg2rR9-U-zyviCeDXRt_QgKv_K0p9pf-+qgoGPQAjxjXA@mail.gmail.com>
 <95039222-908B-4AE8-8844-551646C9733C@gmail.com> <CAMfmYeh9m_Z7N5KQy5f5ocumCrG7bX33OjpsT4jh9KgOekWcWg@mail.gmail.com>
 <CAMfmYehTRzo_h-7+QeND0NXvs+YLTHLa+Os6g2siiXMJ0QmF2w@mail.gmail.com>
To: singularity@lbl.gov
X-Mailer: Apple Mail (2.2104)

--Apple-Mail=_0B2A6510-1A57-4175-89A7-D5E128D8F2BE
Content-Transfer-Encoding: quoted-printable
Content-Type: text/plain;
	charset=utf-8

Hi Igor,

Mahidhar did the =E2=80=9Cby hand=E2=80=9D deployment of TensorFlow with CU=
DA onto our CentOS systems. We haven=E2=80=99t actually built Singularity i=
mages for this, hence our gratitude for your feedback. This seems like a gr=
eat tutorial for the web site.

=E2=80=94Rick

> On Aug 1, 2016, at 7:43 PM, Igor Yakushin <igor...@gmail.com> wrote:
>=20
> BTW, Rick: Are there any notes available about how you built singularity =
images for Comet?
> How did you handle TensorFlow?
>=20
>=20
> On Mon, Aug 1, 2016 at 9:21 PM, Igor Yakushin <igor...@gmail.com <mailto:=
igor...@gmail.com>> wrote:
> Hi Rick,
> 0) Don't use *.deb either for NVIDIA or cuda, use *.run.
> 1) Get the same version of NVIDIA as on the host and extract it (there is=
 an option for that) into a single directory in /usr/local without installi=
ng. Also pay attention to get NVIDIA*.run for your hardware. Apparently Tes=
la cards require different driver  than consumer cards.
> 2) Set both PATH and LD_LIBRARY_PATH to the same directory where NVIDIA i=
s unpacked. After that nvidia-smi should work on the singularity shell.
> 3) Get latest cuda 7.5  *.run file and install only cuda and not the driv=
er (there is an option for that; by default it would install driver as well=
 which would most likely be a different version than what you need and woul=
d conflict the version extracted from NVIDIA file)
> 4) cuda by default will also be installed into /usr/local; set LD_LIBRARY=
_PATH to point there
> 5) install the latest gpu enabled tensorflow with pip getting it from the=
ir website
> I'll try to put all this into *def file
> There might be some important prerequisite *deb files that I installed to=
 make all this work and forgot about them, so I would need to try to reprod=
uce it from scratch to rediscover them.
> Thank you,
> Igor
>=20
>=20
> On Mon, Aug 1, 2016 at 12:43 AM, Rick Wagner <richard...@gmail.com <mailt=
o:richard...@gmail.com>> wrote:
> Igor,
>=20
> If you had a chance to post your definition file or the steps you took, I=
 know several of us would appreciate it. Getting TensorFlow running on Cent=
OS was a huge effort for our support staff. And that's just one of many GPU=
-enabled applications.
>=20
> --Rick
>=20
> On Jul 31, 2016, at 10:20 PM, Igor Yakushin <igor...@gmail.com <mailto:ig=
or...@gmail.com>> wrote:
>=20
>> Thank you, Nathan. It finally works!
>>=20
>> On Sun, Jul 31, 2016 at 5:17 PM, Nathan Lin <nathan...@gmail.com <mailto=
:nathan...@gmail.com>> wrote:
>> Yes I do
>>=20
>> On Jul 31, 2016, at 5:03 PM, Igor Yakushin <igor...@gmail.com <mailto:ig=
or...@gmail.com>> wrote:
>>=20
>>> Nathan,
>>> When you import tensorflow in python, does it tell you what cuda librar=
ies it is loading or not?
>>> Do you see these messages:
>>> =3D=3D=3D=3D=3D=3D
>>> >>> import tensorflow as tf=20
>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcublas.so locally=20
>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcudnn.so locally=20
>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcufft.so locally=20
>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcuda.so locally=20
>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUD=
A library libcurand.so locally=20
>>> =3D=3D=3D=3D=3D=3D
>>> Thank you,
>>> Igor
>>>=20
>>> On Sun, Jul 31, 2016 at 1:26 PM, Nathan Lin <nathan...@gmail.com <mailt=
o:nathan...@gmail.com>> wrote:
>>> Hi Igor,
>>>=20
>>> In regards to your first questions, the OS/drivers of your building com=
puter should not matter. I built an Ubuntu 14.04 image on my RHEL 7 box for=
 our RHEL 6 cluster. I'm not sure that the toolkit is that version specific=
, my image seems to work fine and it's running 353.63. There is one thing t=
hat I do that may be helpful. I read it somewhere online and am not actuall=
y sure if it does anything, but I've included it in my image definitions ju=
st in case. Apparently there is something about initializing the CUDA Toolk=
it. As part of my definition file I run 'make' on the CUDA sample 'deviceQu=
ery'. Maybe that will help?
>>>=20
>>> Best,
>>> Nathan
>>>=20
>>> On Jul 31, 2016, at 1:51 PM, Igor Yakushin <igor...@gmail.com <mailto:i=
gor...@gmail.com>> wrote:
>>>=20
>>>> Hi Nathan,
>>>> I got a little bit further: nvidia-smi is working now but tensorflow s=
till complains:
>>>> =3D=3D=3D=3D=3D=3D=3D=3D=3D
>>>>=20
>>>> =3D=3D=3D=3D=3D=3D=3D=3D=3D
>>>> Singularity/ubuntu_14.04.img> nvidia-smi=20
>>>> Sun Jul 31 17:33:44 2016       =20
>>>> +------------------------------------------------------+              =
         =20
>>>> | NVIDIA-SMI 352.55     Driver Version: 352.55         |              =
         =20
>>>> |-------------------------------+----------------------+--------------=
--------+=20
>>>> | GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Unco=
rr. ECC |=20
>>>> | Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Com=
pute M. |=20
>>>> |=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D|=20
>>>> |   0  Tesla K40m          Off  | 0000:20:00.0     Off |              =
      0 |=20
>>>> | N/A   45C    P0    79W / 235W |    158MiB / 11519MiB |     45%      =
Default |=20
>>>> +-------------------------------+----------------------+--------------=
--------+=20
>>>> |   1  Tesla K40m          Off  | 0000:8B:00.0     Off |              =
      0 |=20
>>>> | N/A   23C    P8    18W / 235W |     61MiB / 11519MiB |      0%      =
Default |=20
>>>> +-------------------------------+----------------------+--------------=
--------+=20
>>>>                                                                       =
        =20
>>>> +---------------------------------------------------------------------=
--------+=20
>>>> | Processes:                                                       GPU=
 Memory |=20
>>>> |  GPU       PID  Type  Process name                               Usa=
ge      |=20
>>>> |=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D|=20
>>>> +---------------------------------------------------------------------=
--------+=20
>>>> Singularity/ubuntu_14.04.img> python=20
>>>> Python 2.7.6 (default, Mar 22 2014, 22:59:56) =20
>>>> [GCC 4.8.2] on linux2=20
>>>> Type "help", "copyright", "credits" or "license" for more information.=
=20
>>>> >>> import tensorflow=20
>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CU=
DA library libcublas.so locally=20
>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CU=
DA library libcudnn.so locally=20
>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CU=
DA library libcufft.so locally=20
>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CU=
DA library libcuda.so.1 locally=20
>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened CU=
DA library libcurand.so locally=20
>>>> >>> ss =3D tensorflow.Session()=20
>>>> E tensorflow/stream_executor/cuda/cuda_driver.cc:491] failed call to c=
uInit: CUDA_ERROR_NO_DEVICE=20
>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:153] retrieving =
CUDA diagnostic information for host: midway-l34-02=20
>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:160] hostname: m=
idway-l34-02=20
>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:185] libcuda rep=
orted version is: 352.93.0=20
>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:356] driver vers=
ion file contents: """NVRM version: NVIDIA UNIX x86_64 Kernel Module  352.5=
5  Thu Oct  8 15:18:00 PDT 2015=20
>>>> GCC version:  gcc version 4.4.7 20120313 (Red Hat 4.4.7-16) (GCC) =20
>>>> """=20
>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:189] kernel repo=
rted version is: 352.55.0=20
>>>> E tensorflow/stream_executor/cuda/cuda_diagnostics.cc:296] kernel vers=
ion 352.55.0 does not match DSO version 352.93.0 -- cannot find working dev=
ices in this configuration=20
>>>> I tensorflow/core/common_runtime/gpu/gpu_init.cc:81] No GPU devices av=
ailable on machine.=20
>>>> >>>=20
>>>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>>>> As far as I understand the problem is that cuda-7.5 was built or relie=
s on nvidia 352.93 while I have NVIDIA driver 352.55 both on the host and c=
ontainer. So far I could not find cuda-7.5 built with 352.55.
>>>> cuda-7.5 has stabs directory in which there is libcuda.so. The problem=
 is probably coming from there. However, I doubt I can just replace libcuda=
.so in the stubs directory by a different version or turn it into symbolic =
link to a different version in the driver? Because its size is much smaller=
 than the size of the real libcuda.so in the driver. So I suspect, it is re=
ally only some kind of interface to the real library?
>>>>=20
>>>> Thank you,
>>>> Igor
>>>>=20
>>>>=20
>>>> On Sun, Jul 31, 2016 at 9:36 AM, Igor Yakushin <igor...@gmail.com <mai=
lto:igor...@gmail.com>> wrote:
>>>> Hi Nathan,
>>>> When installing cuda libraries and tensorflow into the singularity ima=
ge, is it important to be on the same host with the same version of CUDA/OS=
 on which you are going to run later?
>>>> I do not have root on the machine I am going to run later and prepare =
the image on a different machine with a different version of nvidia driver =
and a different flavor of Linux.
>>>> Thank you,
>>>> Igor
>>>>=20
>>>>=20
>>>> On Sun, Jul 31, 2016 at 8:39 AM, Nathan Lin <nathan...@gmail.com <mail=
to:nathan...@gmail.com>> wrote:
>>>> Hi Igor,
>>>>=20
>>>> I don't necessarily have a great answer for you. If seems like you are=
 doing everything right, yet it is still not working. In my case, yes nvidi=
a-smi as well as TensorFlow both work correctly. I feel like your error sti=
ll has to do with the version of libcuda.so you are using. Notice how Pytho=
n seems to correctly load libcuda.so, yet there is later an error that is u=
nable to find libcuda.so. My first suspicion is that there is still a versi=
on mismatch between the drivers installed on the image and on the host. If =
you are sure that is not true, it may be possible that the version of the d=
river that is installed on the machine isn't new enough for the GPU. That a=
ctually occurred on our cluster, and after a sysadmin updated the driver, i=
t worked. Barring that I am not too sure. Maybe if you provide me with the =
full details of your installation (the versions of the packages that you ha=
ve installed, the OS of your image and host), I might be able to think abou=
t something, but my suspicion is that the driver version on your host machi=
ne may not be new enough.=20
>>>>=20
>>>> Best,
>>>> Nathan=20
>>>>=20
>>>> On Jul 31, 2016, at 12:17 AM, Igor Yakushin <igor...@gmail.com <mailto=
:igor...@gmail.com>> wrote:
>>>>=20
>>>>> Hi Nathan,
>>>>>=20
>>>>> I have found exactly the same version of NVIDIA driver and extracted =
from it the libraries and nvidia executables and copied them in /usr/lib64/=
nvidia and /usr/bin and created the corresponding symbolic links. However, =
I still cannot use GPU inside singularity: nvidia-smi says "GPU access bloc=
ked by the operating system" (does it work in your case?) and when tensorfl=
ow session starts it also complains that "No GPU devices available on machi=
ne". However, notice that tensorflow seems to think that a different versio=
n of NVIDIA driver is used. Not sure where it is coming from. The machine o=
n which the image was built has version 361.42
>>>>>=20
>>>>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>>>>> Python 2.7.12 (default, Jul  1 2016, 15:12:24) =20
>>>>> [GCC 5.4.0 20160609] on linux2=20
>>>>> Type "help", "copyright", "credits" or "license" for more information=
.=20
>>>>> >>> import tensorflow=20
>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened C=
UDA library libcublas.so locally=20
>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened C=
UDA library libcudnn.so locally=20
>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened C=
UDA library libcufft.so locally=20
>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened C=
UDA library libcuda.so locally=20
>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened C=
UDA library libcurand.so locally=20
>>>>> >>> ss =3D tensorflow.Session()=20
>>>>> E tensorflow/stream_executor/cuda/cuda_driver.cc:491] failed call to =
cuInit: CUDA_ERROR_UNKNOWN=20
>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:153] retrieving=
 CUDA diagnostic information for host: midway230=20
>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:160] hostname: =
midway230=20
>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:185] libcuda re=
ported version is: Not found: was unable to find libcuda.so DSO loaded into=
 this program=20
>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:347] driver ver=
sion file contents: """NVRM version: NVIDIA UNIX x86_64 Kernel Module  352.=
55  Thu Oct  8 15:18:00 PDT 2015=20
>>>>> GCC version:  gcc version 4.4.7 20120313 (Red Hat 4.4.7-16) (GCC) =20
>>>>> """=20
>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:189] kernel rep=
orted version is: 352.55.0=20
>>>>> I tensorflow/core/common_runtime/gpu/gpu_init.cc:81] No GPU devices a=
vailable on machine.=20
>>>>> >>> =20
>>>>> Singularity/tensorflow_0.9.img> nvidia-smi=20
>>>>> Failed to initialize NVML: GPU access blocked by the operating system
>>>>> =3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D
>>>>>=20
>>>>> Thank you,
>>>>> Igor
>>>>>=20
>>>>>=20
>>>>> On Thu, Jul 28, 2016 at 9:34 PM, Nathan Lin <nathan...@gmail.com <mai=
lto:nathan...@gmail.com>> wrote:
>>>>> I am not sure how to find the correct driver version, but from my tes=
ting, the version must match exactly. I will admit that I have had problems=
 finding specific versions of the driver from NVIDIA's website. I had to as=
k a sysadmin for the installer that they used. In order to extract the file=
s, you need to use the --extract-only option. For instance, you will have t=
o run something like ' sh /NVIDIA-Linux-x86_64-352.63.run --extract-only'/ =
. You will then be given a directory with all the libraries that would have=
 been installed. You will need to copy the libcuda.so.###.## library (and y=
ou can copy any NVIDIA executables that you want such as nvidia-smi). Good =
luck!
>>>>>=20
>>>>> On Thu, Jul 28, 2016 at 8:51 PM, Igor <igor...@gmail.com <mailto:igor=
...@gmail.com>> wrote:
>>>>> I mean I am using this file from NVIDIA website cuda_7.5.18_linux.run=
 to install the driver, opengl, cuda. Driver installation fails, cuda succe=
eds.=20
>>>>> Also, when I run=20
>>>>> sh cuda_7.5.18_linux.run
>>>>> I am offered to install the driver version 352.39 while on the host i=
t is 346.47. I cannot upgrade the host. Any idea where I can get 346.17?
>>>>> I tried using the same link just substitute 18 for something else but=
 have not found the files:
>>>>> wget http://developer.download.nvidia.com/compute/cuda/7.5/Prod/local=
_installers/cuda_7.5.1X_linux.run <http://developer.download.nvidia.com/com=
pute/cuda/7.5/Prod/local_installers/cuda_7.5.1X_linux.run>
>>>>>=20
>>>>>=20
>>>>>=20
>>>>> On Thursday, July 28, 2016 at 7:34:55 PM UTC-5, Igor wrote:
>>>>> Hi Nathan,
>>>>> When I try to install the driver by running NVIDIA*.run script inside=
 the image, it fails, probably because it tries to modify kernel that belon=
gs to host?
>>>>> How do I extract just libcuda.so.345.67 without installing the driver=
 (which is obviously problematic) and why would copying the library from th=
e host would not work?
>>>>> Thank you,
>>>>> Igor
>>>>>=20
>>>>> On Thursday, July 28, 2016 at 7:18:26 PM UTC-5, Nathan Lin wrote:
>>>>> Also if you are using the binary installation of TensorFlow you need =
CUDA toolkit 7.5 and cuDNN v4. These only need to be installed on our image=
. As I mentioned earlier you will need the libcuda.so.###.## library on you=
r image. It is very important that this is the same version of the NVIDIA d=
river as you have on your nose (seemingly 346.67 for you). I should've have=
 also mentioned that you want the libcuda.so.345.67 library that you get fr=
om extracting the NVIDIA installer. It will not work if you try to copy the=
 libcuda.so library that from you node.=20
>>>>>=20
>>>>> Let me know if you have any more questions.=20
>>>>>=20
>>>>> Best,
>>>>> Nathan
>>>>>=20
>>>>> On Thursday, July 28, 2016, Nathan Lin <nat...@gmail.com <>> wrote:
>>>>> Hello,
>>>>>=20
>>>>> Yes you are correct. The NVIDIA driver must be installed on your imag=
e as well. However, you honestly only need the libcuda.so.###.## library an=
d the appropriate links for that library. Once you have those installed in =
your image, it should work.=20
>>>>>=20
>>>>> Best,
>>>>> Nathan=20
>>>>>=20
>>>>> On Thursday, July 28, 2016, Igor <igor...@gmail.com <>> wrote:
>>>>> Hi All,
>>>>>=20
>>>>> I am trying to use GPU-enabled tensorflow and it cannot find GPU card=
 from inside the container.
>>>>>=20
>>>>> On the host:
>>>>> $ lspci | grep -i nvidia=20
>>>>> 20:00.0 3D controller: NVIDIA Corporation GK110BGL [Tesla K40m] (rev =
a1)=20
>>>>> 8b:00.0 3D controller: NVIDIA Corporation GK110BGL [Tesla K40m] (rev =
a1)
>>>>>=20
>>>>> $ nvidia-smi=20
>>>>> Thu Jul 28 19:01:42 2016       =20
>>>>> +------------------------------------------------------+             =
          =20
>>>>> | NVIDIA-SMI 346.47     Driver Version: 346.47         |             =
          =20
>>>>> |-------------------------------+----------------------+-------------=
---------+=20
>>>>> | GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Unc=
orr. ECC |=20
>>>>> | Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Co=
mpute M. |=20
>>>>> |=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D|=20
>>>>> |   0  Tesla K40m          Off  | 0000:20:00.0     Off |             =
       0 |=20
>>>>> | N/A   30C    P8    20W / 235W |     66MiB / 11519MiB |      0%     =
 Default |=20
>>>>> +-------------------------------+----------------------+-------------=
---------+=20
>>>>> |   1  Tesla K40m          Off  | 0000:8B:00.0     Off |             =
       0 |=20
>>>>> | N/A   26C    P8    19W / 235W |     60MiB / 11519MiB |      0%     =
 Default |=20
>>>>> +-------------------------------+----------------------+-------------=
---------+=20
>>>>>                                                                      =
         =20
>>>>> +--------------------------------------------------------------------=
---------+=20
>>>>> | Processes:                                                       GP=
U Memory |=20
>>>>> |  GPU       PID  Type  Process name                               Us=
age      |=20
>>>>> |=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D|=20
>>>>> |    0     11671    G   /usr/bin/X                                   =
    9MiB |=20
>>>>> |    1     11671    G   /usr/bin/X                                   =
    3MiB |
>>>>>=20
>>>>>=20
>>>>> Inside singularity:
>>>>> $ singularity shell /software/src/singularity_images/tensorflow_0.9.i=
mg
>>>>>=20
>>>>> Singularity/tensorflow_0.9.img> lspci | grep -i nvidia=20
>>>>> bash: lspci: command not found=20
>>>>> Singularity/tensorflow_0.9.img> nvidia-smi=20
>>>>> bash: nvidia-smi: command not found=20
>>>>> Singularity/tensorflow_0.9.img> python=20
>>>>> Python 2.7.12 (default, Jul  1 2016, 15:12:24) =20
>>>>> [GCC 5.4.0 20160609] on linux2=20
>>>>> Type "help", "copyright", "credits" or "license" for more information=
.=20
>>>>> >>> import tensorflow as tf=20
>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened C=
UDA library libcublas.so locally=20
>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened C=
UDA library libcudnn.so locally=20
>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened C=
UDA library libcufft.so locally=20
>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened C=
UDA library libcuda.so locally=20
>>>>> I tensorflow/stream_executor/dso_loader.cc:108] successfully opened C=
UDA library libcurand.so locally=20
>>>>> >>> sess =3D tf.Session()=20
>>>>> E tensorflow/stream_executor/cuda/cuda_driver.cc:491] failed call to =
cuInit: CUDA_ERROR_UNKNOWN=20
>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:153] retrieving=
 CUDA diagnostic information for host: midway-l34-01=20
>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:160] hostname: =
midway-l34-01=20
>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:185] libcuda re=
ported version is: Not found: was unable to find libcuda.so DSO loaded into=
 this program=20
>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:347] driver ver=
sion file contents: """NVRM version: NVIDIA UNIX x86_64 Kernel Module  346.=
47  Thu Feb 19 18:56:03 PST 2015=20
>>>>> GCC version:  gcc version 4.4.7 20120313 (Red Hat 4.4.7-11) (GCC) =20
>>>>> """=20
>>>>> I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:189] kernel rep=
orted version is: 346.47.0=20
>>>>> I tensorflow/core/common_runtime/gpu/gpu_init.cc:81] No GPU devices a=
vailable on machine.
>>>>>=20
>>>>> Must there be nvidia driver installed inside the container? Outside? =
The container shares the same kernel with the host and nvidia kernel module=
 needs to be loaded... How this is handled? Any requirements on nvidia driv=
er and cuda versions inside and outside of the container?
>>>>>=20
>>>>> Thank you,
>>>>> Igor
>>>>>=20
>>>>>=20
>>>>>=20
>>>>> --=20
>>>>> You received this message because you are subscribed to the Google Gr=
oups "singularity" group.
>>>>> To unsubscribe from this group and stop receiving emails from it, sen=
d an email to singu...@lbl.gov <>.
>>>>>=20
>>>>> --=20
>>>>> You received this message because you are subscribed to the Google Gr=
oups "singularity" group.
>>>>> To unsubscribe from this group and stop receiving emails from it, sen=
d an email to singu...@lbl.gov <mailto:singu...@lbl.gov>.
>>>>>=20
>>>>>=20
>>>>> --=20
>>>>> You received this message because you are subscribed to the Google Gr=
oups "singularity" group.
>>>>> To unsubscribe from this group and stop receiving emails from it, sen=
d an email to singu...@lbl.gov <mailto:singu...@lbl.gov>.
>>>>>=20
>>>>>=20
>>>>> --=20
>>>>> You received this message because you are subscribed to the Google Gr=
oups "singularity" group.
>>>>> To unsubscribe from this group and stop receiving emails from it, sen=
d an email to singu...@lbl.gov <mailto:singu...@lbl.gov>.
>>>>=20
>>>>=20
>>>> --=20
>>>> You received this message because you are subscribed to the Google Gro=
ups "singularity" group.
>>>> To unsubscribe from this group and stop receiving emails from it, send=
 an email to singu...@lbl.gov <mailto:singu...@lbl.gov>.
>>>>=20
>>>>=20
>>>>=20
>>>> --=20
>>>> You received this message because you are subscribed to the Google Gro=
ups "singularity" group.
>>>> To unsubscribe from this group and stop receiving emails from it, send=
 an email to singu...@lbl.gov <mailto:singu...@lbl.gov>.
>>>=20
>>>=20
>>> --=20
>>> You received this message because you are subscribed to the Google Grou=
ps "singularity" group.
>>> To unsubscribe from this group and stop receiving emails from it, send =
an email to singu...@lbl.gov <mailto:singu...@lbl.gov>.
>>>=20
>>>=20
>>> --=20
>>> You received this message because you are subscribed to the Google Grou=
ps "singularity" group.
>>> To unsubscribe from this group and stop receiving emails from it, send =
an email to singu...@lbl.gov <mailto:singu...@lbl.gov>.
>>=20
>>=20
>> --=20
>> You received this message because you are subscribed to the Google Group=
s "singularity" group.
>> To unsubscribe from this group and stop receiving emails from it, send a=
n email to singu...@lbl.gov <mailto:singu...@lbl.gov>.
>>=20
>>=20
>> --=20
>> You received this message because you are subscribed to the Google Group=
s "singularity" group.
>> To unsubscribe from this group and stop receiving emails from it, send a=
n email to singu...@lbl.gov <mailto:singu...@lbl.gov>.
>=20
>=20
> --=20
> You received this message because you are subscribed to the Google Groups=
 "singularity" group.
> To unsubscribe from this group and stop receiving emails from it, send an=
 email to singu...@lbl.gov <mailto:singu...@lbl.gov>.
>=20
>=20
>=20
> --=20
> You received this message because you are subscribed to the Google Groups=
 "singularity" group.
> To unsubscribe from this group and stop receiving emails from it, send an=
 email to singu...@lbl.gov <mailto:singu...@lbl.gov>.


--Apple-Mail=_0B2A6510-1A57-4175-89A7-D5E128D8F2BE
Content-Transfer-Encoding: quoted-printable
Content-Type: text/html;
	charset=utf-8

<html><head><meta http-equiv=3D"Content-Type" content=3D"text/html charset=
=3Dutf-8"></head><body style=3D"word-wrap: break-word; -webkit-nbsp-mode: s=
pace; -webkit-line-break: after-white-space;" class=3D""><div class=3D"">Hi=
 Igor,</div><div class=3D""><br class=3D""></div><div class=3D"">Mahidhar d=
id the =E2=80=9Cby hand=E2=80=9D deployment of TensorFlow with CUDA onto ou=
r CentOS systems. We haven=E2=80=99t actually built Singularity images for =
this, hence our gratitude for your feedback. This seems like a great tutori=
al for the web site.</div><div class=3D""><br class=3D""></div>=E2=80=94Ric=
k<div class=3D""><br class=3D""><div><blockquote type=3D"cite" class=3D""><=
div class=3D"">On Aug 1, 2016, at 7:43 PM, Igor Yakushin &lt;<a href=3D"mai=
lto:igor...@gmail.com" class=3D"">igor...@gmail.com</a>&gt; wrote:</div><br=
 class=3D"Apple-interchange-newline"><div class=3D""><div dir=3D"ltr" class=
=3D"">BTW, Rick: Are there any notes available about how you built singular=
ity images for Comet?<div class=3D"">How did you handle TensorFlow?</div><d=
iv class=3D""><br class=3D""></div></div><div class=3D"gmail_extra"><br cla=
ss=3D""><div class=3D"gmail_quote">On Mon, Aug 1, 2016 at 9:21 PM, Igor Yak=
ushin <span dir=3D"ltr" class=3D"">&lt;<a href=3D"mailto:igor...@gmail.com"=
 target=3D"_blank" class=3D"">igor...@gmail.com</a>&gt;</span> wrote:<br cl=
ass=3D""><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;borde=
r-left:1px #ccc solid;padding-left:1ex"><div dir=3D"ltr" class=3D"">Hi Rick=
,<div class=3D"">0) Don't use *.deb either for NVIDIA or cuda, use *.run.</=
div><div class=3D"">1) Get the same version of NVIDIA as on the host and ex=
tract it (there is an option for that) into a single directory in /usr/loca=
l without installing. Also pay attention to get NVIDIA*.run for your hardwa=
re. Apparently Tesla cards require different driver &nbsp;than consumer car=
ds.</div><div class=3D"">2) Set both PATH and LD_LIBRARY_PATH to the same d=
irectory where NVIDIA is unpacked. After that nvidia-smi should work on the=
 singularity shell.</div><div class=3D"">3) Get latest cuda 7.5 &nbsp;*.run=
 file and install only cuda and not the driver (there is an option for that=
; by default it would install driver as well which would most likely be a d=
ifferent version than what you need and would conflict the version extracte=
d from NVIDIA file)</div><div class=3D"">4) cuda by default will also be in=
stalled into /usr/local; set LD_LIBRARY_PATH to point there</div><div class=
=3D"">5) install the latest gpu enabled tensorflow with pip getting it from=
 their website</div><div class=3D"">I'll try to put all this into *def file=
</div><div class=3D"">There might be some important prerequisite *deb files=
 that I installed to make all this work and forgot about them, so I would n=
eed to try to reproduce it from scratch to rediscover them.</div><div class=
=3D"">Thank you,</div><div class=3D"">Igor</div><div class=3D""><br class=
=3D""></div></div><div class=3D"HOEnZb"><div class=3D"h5"><div class=3D"gma=
il_extra"><br class=3D""><div class=3D"gmail_quote">On Mon, Aug 1, 2016 at =
12:43 AM, Rick Wagner <span dir=3D"ltr" class=3D"">&lt;<a href=3D"mailto:ri=
chard...@gmail.com" target=3D"_blank" class=3D"">richard...@gmail.com</a>&g=
t;</span> wrote:<br class=3D""><blockquote class=3D"gmail_quote" style=3D"m=
argin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir=3D"a=
uto" class=3D""><div class=3D""></div><div class=3D"">Igor,</div><div class=
=3D""><br class=3D""></div><div class=3D"">If you had a chance to post your=
 definition file or the steps you took, I know several of us would apprecia=
te it. Getting TensorFlow running on CentOS was a huge effort for our suppo=
rt staff. And that's just one of many GPU-enabled applications.</div><span =
class=3D""><font color=3D"#888888" class=3D""><div class=3D""><br class=3D"=
"></div><div class=3D"">--Rick</div></font></span><div class=3D""><div clas=
s=3D""><div class=3D""><br class=3D"">On Jul 31, 2016, at 10:20 PM, Igor Ya=
kushin &lt;<a href=3D"mailto:igor...@gmail.com" target=3D"_blank" class=3D"=
">igor...@gmail.com</a>&gt; wrote:<br class=3D""><br class=3D""></div><bloc=
kquote type=3D"cite" class=3D""><div class=3D""><div dir=3D"ltr" class=3D""=
>Thank you, Nathan. It finally works!</div><div class=3D"gmail_extra"><br c=
lass=3D""><div class=3D"gmail_quote">On Sun, Jul 31, 2016 at 5:17 PM, Natha=
n Lin <span dir=3D"ltr" class=3D"">&lt;<a href=3D"mailto:nathan...@gmail.co=
m" target=3D"_blank" class=3D"">nathan...@gmail.com</a>&gt;</span> wrote:<b=
r class=3D""><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;b=
order-left:1px #ccc solid;padding-left:1ex"><div dir=3D"auto" class=3D""><d=
iv class=3D""></div><div class=3D"">Yes I do</div><div class=3D""><div clas=
s=3D""><div class=3D""><br class=3D"">On Jul 31, 2016, at 5:03 PM, Igor Yak=
ushin &lt;<a href=3D"mailto:igor...@gmail.com" target=3D"_blank" class=3D""=
>igor...@gmail.com</a>&gt; wrote:<br class=3D""><br class=3D""></div><block=
quote type=3D"cite" class=3D""><div class=3D""><div dir=3D"ltr" class=3D"">=
Nathan,<div class=3D"">When you import tensorflow in python, does it tell y=
ou what cuda libraries it is loading or not?</div><div class=3D"">Do you se=
e these messages:</div><div class=3D"">=3D=3D=3D=3D=3D=3D</div><div class=
=3D""><div class=3D"">&gt;&gt;&gt; import tensorflow as tf&nbsp;</div><div =
class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully ope=
ned CUDA library libcublas.so locally&nbsp;</div><div class=3D"">I tensorfl=
ow/stream_executor/dso_loader.cc:108] successfully opened CUDA library libc=
udnn.so locally&nbsp;</div><div class=3D"">I tensorflow/stream_executor/dso=
_loader.cc:108] successfully opened CUDA library libcufft.so locally&nbsp;<=
/div><div class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] succes=
sfully opened CUDA library libcuda.so locally&nbsp;</div><div class=3D"">I =
tensorflow/stream_executor/dso_loader.cc:108] successfully opened CUDA libr=
ary libcurand.so locally&nbsp;</div></div><div class=3D"">=3D=3D=3D=3D=3D=
=3D</div><div class=3D"">Thank you,</div><div class=3D"">Igor</div></div><d=
iv class=3D"gmail_extra"><br class=3D""><div class=3D"gmail_quote">On Sun, =
Jul 31, 2016 at 1:26 PM, Nathan Lin <span dir=3D"ltr" class=3D"">&lt;<a hre=
f=3D"mailto:nathan...@gmail.com" target=3D"_blank" class=3D"">nathan...@gma=
il.com</a>&gt;</span> wrote:<br class=3D""><blockquote class=3D"gmail_quote=
" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><=
div dir=3D"auto" class=3D""><div class=3D""></div><div class=3D"">Hi Igor,<=
/div><div class=3D""><br class=3D""></div><div class=3D"">In regards to you=
r first questions, the OS/drivers of your building computer should not matt=
er. I built an Ubuntu 14.04 image on my RHEL 7 box for our RHEL 6 cluster. =
I'm not sure that the toolkit is that version specific, my image seems to w=
ork fine and it's running 353.63. There is one thing that I do that may be =
helpful. I read it somewhere online and am not actually sure if it does any=
thing, but I've included it in my image definitions just in case. Apparentl=
y there is something about initializing the CUDA Toolkit. As part of my def=
inition file I run 'make' on the CUDA sample 'deviceQuery'. Maybe that will=
 help?</div><div class=3D""><br class=3D""></div><div class=3D"">Best,</div=
><div class=3D"">Nathan</div><div class=3D""><div class=3D""><div class=3D"=
"><br class=3D"">On Jul 31, 2016, at 1:51 PM, Igor Yakushin &lt;<a href=3D"=
mailto:igor...@gmail.com" target=3D"_blank" class=3D"">igor...@gmail.com</a=
>&gt; wrote:<br class=3D""><br class=3D""></div><blockquote type=3D"cite" c=
lass=3D""><div class=3D""><div dir=3D"ltr" class=3D"">Hi Nathan,<div class=
=3D"">I got a little bit further: nvidia-smi is working now but tensorflow =
still complains:</div><div class=3D"">=3D=3D=3D=3D=3D=3D=3D=3D=3D</div><div=
 class=3D""><br class=3D""></div><div class=3D"">=3D=3D=3D=3D=3D=3D=3D=3D=
=3D</div><div class=3D""><span style=3D"font-family:monospace" class=3D""><=
span style=3D"" class=3D"">Singularity/ubuntu_14.04.img&gt; nvidia-smi
</span><br class=3D"">Sun Jul 31 17:33:44 2016 &nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;<br class=3D"">+---------------------------------------------=
---------+ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<=
br class=3D"">| NVIDIA-SMI 352.55 &nbsp;&nbsp;&nbsp;&nbsp;Driver Version: 3=
52.55 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br class=3D"">|---------------=
----------------+----------------------+----------------------+
<br class=3D"">| GPU &nbsp;Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P=
ersistence-M| Bus-Id &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disp.A | Vol=
atile Uncorr. ECC |
<br class=3D"">| Fan &nbsp;Temp &nbsp;Perf &nbsp;Pwr:Usage/Cap| &nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Memory-Usage | GPU-Util &nbsp;Compute =
M. |
<br class=3D"">|=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D|
<br class=3D"">| &nbsp;&nbsp;0 &nbsp;Tesla K40m &nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;Off &nbsp;| 0000:20:00.0 &nbsp;&nbsp;&nbsp;&nbsp=
;Off | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 |
<br class=3D"">| N/A &nbsp;&nbsp;45C &nbsp;&nbsp;&nbsp;P0 &nbsp;&nbsp;&nbsp=
;79W / 235W | &nbsp;&nbsp;&nbsp;158MiB / 11519MiB | &nbsp;&nbsp;&nbsp;&nbsp=
;45% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Default |
<br class=3D"">+-------------------------------+----------------------+----=
------------------+
<br class=3D"">| &nbsp;&nbsp;1 &nbsp;Tesla K40m &nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;Off &nbsp;| 0000:8B:00.0 &nbsp;&nbsp;&nbsp;&nbsp=
;Off | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 |
<br class=3D"">| N/A &nbsp;&nbsp;23C &nbsp;&nbsp;&nbsp;P8 &nbsp;&nbsp;&nbsp=
;18W / 235W | &nbsp;&nbsp;&nbsp;&nbsp;61MiB / 11519MiB | &nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;0% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Default |
<br class=3D"">+-------------------------------+----------------------+----=
------------------+
<br class=3D""> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br class=3D"">+-------------------=
----------------------------------------------------------+
<br class=3D"">| Processes: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GPU Memory |
<br class=3D"">| &nbsp;GPU &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PID &nbsp;Ty=
pe &nbsp;Process name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Usage &nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;|
<br class=3D"">|=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D|
<br class=3D"">+-----------------------------------------------------------=
------------------+
<br class=3D"">Singularity/ubuntu_14.04.img&gt; python
<br class=3D"">Python 2.7.6 (default, Mar 22 2014, 22:59:56) &nbsp;<br clas=
s=3D"">[GCC 4.8.2] on linux2
<br class=3D"">Type "help", "copyright", "credits" or "license" for more in=
formation.
<br class=3D"">&gt;&gt;&gt; import tensorflow
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcublas.so locally
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcudnn.so locally
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcufft.so locally
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcuda.so.1 locally
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcurand.so locally
<br class=3D"">&gt;&gt;&gt; ss =3D tensorflow.Session()
<br class=3D"">E tensorflow/stream_executor/cuda/cuda_driver.cc:491] failed=
 call to cuInit: CUDA_ERROR_NO_DEVICE
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:153] r=
etrieving CUDA diagnostic information for host: midway-l34-02
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:160] h=
ostname: midway-l34-02
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:185] l=
ibcuda reported version is: 352.93.0
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:356] d=
river version file contents: """NVRM version: NVIDIA UNIX x86_64 Kernel Mod=
ule &nbsp;352.55 &nbsp;Thu Oct &nbsp;8 15:18:00 PDT 2015
<br class=3D"">GCC version: &nbsp;gcc version 4.4.7 20120313 (Red Hat 4.4.7=
-16) (GCC) &nbsp;<br class=3D"">"""
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:189] k=
ernel reported version is: 352.55.0
<br class=3D"">E tensorflow/stream_executor/cuda/cuda_diagnostics.cc:296] k=
ernel version 352.55.0 does not match DSO version 352.93.0 -- cannot find w=
orking devices in this configuration
<br class=3D"">I tensorflow/core/common_runtime/gpu/gpu_init.cc:81] No GPU =
devices available on machine.
<br class=3D"">&gt;&gt;&gt; <br class=3D"">
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D</span></div><div class=
=3D""><span style=3D"font-family:monospace" class=3D"">As far as I understa=
nd the problem is that cuda-7.5 was built or relies on nvidia 352.93 while =
I have NVIDIA driver 352.55 both on the host and container. So far I could =
not find cuda-7.5 built with 352.55.</span></div><div class=3D""><span styl=
e=3D"font-family:monospace" class=3D"">cuda-7.5 has stabs directory in whic=
h there is libcuda.so. The problem is probably coming from there. However, =
I doubt I can just replace libcuda.so in the stubs directory by a different=
 version or turn it into symbolic link to a different version in the driver=
? Because its size is much smaller than the size of the real libcuda.so in =
the driver. So I suspect, it is really only some kind of interface to the r=
eal library?</span></div><div class=3D""><span style=3D"font-family:monospa=
ce" class=3D""><br class=3D""></span></div><div class=3D""><span style=3D"f=
ont-family:monospace" class=3D"">Thank you,</span></div><div class=3D""><sp=
an style=3D"font-family:monospace" class=3D"">Igor</span></div><div class=
=3D""><span style=3D"font-family:monospace" class=3D""><br class=3D""></spa=
n></div></div><div class=3D"gmail_extra"><br class=3D""><div class=3D"gmail=
_quote">On Sun, Jul 31, 2016 at 9:36 AM, Igor Yakushin <span dir=3D"ltr" cl=
ass=3D"">&lt;<a href=3D"mailto:igor...@gmail.com" target=3D"_blank" class=
=3D"">igor...@gmail.com</a>&gt;</span> wrote:<br class=3D""><blockquote cla=
ss=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;pa=
dding-left:1ex"><div dir=3D"ltr" class=3D"">Hi Nathan,<div class=3D"">When =
installing cuda libraries and tensorflow into the singularity image, is it =
important to be on the same host with the same version of CUDA/OS on which =
you are going to run later?</div><div class=3D"">I do not have root on the =
machine I am going to run later and prepare the image on a different machin=
e with a different version of nvidia driver and a different flavor of Linux=
.</div><div class=3D"">Thank you,</div><div class=3D"">Igor</div><div class=
=3D""><br class=3D""></div></div><div class=3D""><div class=3D""><div class=
=3D"gmail_extra"><br class=3D""><div class=3D"gmail_quote">On Sun, Jul 31, =
2016 at 8:39 AM, Nathan Lin <span dir=3D"ltr" class=3D"">&lt;<a href=3D"mai=
lto:nathan...@gmail.com" target=3D"_blank" class=3D"">nathan...@gmail.com</=
a>&gt;</span> wrote:<br class=3D""><blockquote class=3D"gmail_quote" style=
=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir=
=3D"auto" class=3D""><div class=3D""></div><div class=3D"">Hi Igor,</div><d=
iv class=3D""><br class=3D""></div><div class=3D"">I don't necessarily have=
 a great answer for you. If seems like you are doing everything right, yet =
it is still not working. In my case, yes nvidia-smi as well as TensorFlow b=
oth work correctly. I feel like your error still has to do with the version=
 of libcuda.so you are using. Notice how Python seems to correctly load lib=
cuda.so, yet there is later an error that is unable to find libcuda.so. My =
first suspicion is that there is still a version mismatch between the drive=
rs installed on the image and on the host. If you are sure that is not true=
, it may be possible that the version of the driver that is installed on th=
e machine isn't new enough for the GPU. That actually occurred on our clust=
er, and after a sysadmin updated the driver, it worked. Barring that I am n=
ot too sure. Maybe if you provide me with the full details of your installa=
tion (the versions of the packages that you have installed, the OS of your =
image and host), I might be able to think about something, but my suspicion=
 is that the driver version on your host machine may not be new enough.&nbs=
p;</div><div class=3D""><br class=3D""></div><div class=3D"">Best,</div><di=
v class=3D"">Nathan&nbsp;</div><div class=3D""><div class=3D""><div class=
=3D""><br class=3D"">On Jul 31, 2016, at 12:17 AM, Igor Yakushin &lt;<a hre=
f=3D"mailto:igor...@gmail.com" target=3D"_blank" class=3D"">igor...@gmail.c=
om</a>&gt; wrote:<br class=3D""><br class=3D""></div><blockquote type=3D"ci=
te" class=3D""><div class=3D""><div dir=3D"ltr" class=3D""><div class=3D"">=
<span style=3D"font-family:monospace" class=3D"">Hi Nathan,</span></div><di=
v class=3D""><span style=3D"font-family:monospace" class=3D""><br class=3D"=
"></span></div><div class=3D""><span style=3D"font-family:monospace" class=
=3D"">I have found exactly the same version of NVIDIA driver and extracted =
from it the libraries and nvidia executables and copied them in /usr/lib64/=
nvidia and /usr/bin and created the corresponding symbolic links. However, =
I still cannot use GPU inside singularity: nvidia-smi says "GPU access bloc=
ked by the operating system" (does it work in your case?) and when tensorfl=
ow session starts it also complains that "No GPU devices available on machi=
ne". However, notice that tensorflow seems to think that a different versio=
n of NVIDIA driver is used. Not sure where it is coming from. The machine o=
n which the image was built has version&nbsp;</span><span style=3D"font-fam=
ily: monospace;" class=3D"">361.42</span></div><span style=3D"font-family:m=
onospace" class=3D""><span style=3D"" class=3D""><div class=3D""><span styl=
e=3D"font-family:monospace" class=3D""><span style=3D"" class=3D""><br clas=
s=3D""></span></span></div><div class=3D""><span style=3D"font-family:monos=
pace" class=3D""><span style=3D"" class=3D"">=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D</span></span></div>Python 2.7.12 (default, Jul &nbsp;1 2016, 15:12:2=
4) &nbsp;</span><br class=3D"">[GCC 5.4.0 20160609] on linux2
<br class=3D"">Type "help", "copyright", "credits" or "license" for more in=
formation.
<br class=3D"">&gt;&gt;&gt; import tensorflow
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcublas.so locally
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcudnn.so locally
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcufft.so locally
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcuda.so locally
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcurand.so locally
<br class=3D"">&gt;&gt;&gt; ss =3D tensorflow.Session()
<br class=3D"">E tensorflow/stream_executor/cuda/cuda_driver.cc:491] failed=
 call to cuInit: CUDA_ERROR_UNKNOWN
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:153] r=
etrieving CUDA diagnostic information for host: midway230
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:160] h=
ostname: midway230
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:185] l=
ibcuda reported version is: Not found: was unable to find libcuda.so DSO lo=
aded into this program
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:347] d=
river version file contents: """NVRM version: NVIDIA UNIX x86_64 Kernel Mod=
ule &nbsp;352.55 &nbsp;Thu Oct &nbsp;8 15:18:00 PDT 2015
<br class=3D"">GCC version: &nbsp;gcc version 4.4.7 20120313 (Red Hat 4.4.7=
-16) (GCC) &nbsp;<br class=3D"">"""
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:189] k=
ernel reported version is: 352.55.0
<br class=3D"">I tensorflow/core/common_runtime/gpu/gpu_init.cc:81] No GPU =
devices available on machine.
<br class=3D"">&gt;&gt;&gt; &nbsp;<br class=3D"">Singularity/tensorflow_0.9=
.img&gt; nvidia-smi
<br class=3D"">Failed to initialize NVML: GPU access blocked by the operati=
ng system<br class=3D"">
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D</span><div class=3D""><span style=3D"font=
-family:monospace" class=3D""><br class=3D""></span></div><div class=3D""><=
span style=3D"font-family:monospace" class=3D"">Thank you,</span></div><div=
 class=3D""><span style=3D"font-family:monospace" class=3D"">Igor</span></d=
iv><div class=3D""><span style=3D"font-family:monospace" class=3D""><br cla=
ss=3D""></span></div></div><div class=3D"gmail_extra"><br class=3D""><div c=
lass=3D"gmail_quote">On Thu, Jul 28, 2016 at 9:34 PM, Nathan Lin <span dir=
=3D"ltr" class=3D"">&lt;<a href=3D"mailto:nathan...@gmail.com" target=3D"_b=
lank" class=3D"">nathan...@gmail.com</a>&gt;</span> wrote:<br class=3D""><b=
lockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px =
#ccc solid;padding-left:1ex"><div dir=3D"ltr" class=3D"">I am no<font face=
=3D"arial, helvetica, sans-serif" class=3D"">t sure how to find the correct=
 driver version, but from my testing, the version must match exactly. I wil=
l admit that I have had problems finding specific versions of the driver fr=
om NVIDIA's website. I had to ask a sysadmin for the installer that they us=
ed. In order to extract the files, you need to use the --extract-only optio=
n. For instance, you will have to run something like '

















sh /NVIDIA-Linux-x86_64-352.63.run
--extract-only'/ . You will then be given a directory with all the librarie=
s that would have been installed. You will need to copy the libcuda.so.###.=
## library (and you can copy any NVIDIA executables that you want such as n=
vidia-smi). Good luck!</font></div><div class=3D""><div class=3D""><div cla=
ss=3D"gmail_extra"><br class=3D""><div class=3D"gmail_quote">On Thu, Jul 28=
, 2016 at 8:51 PM, Igor <span dir=3D"ltr" class=3D"">&lt;<a href=3D"mailto:=
igor...@gmail.com" target=3D"_blank" class=3D"">igor...@gmail.com</a>&gt;</=
span> wrote:<br class=3D""><blockquote class=3D"gmail_quote" style=3D"margi=
n:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir=3D"ltr" =
class=3D""><span style=3D"font-family:monospace" class=3D"">I mean I am usi=
ng this file from NVIDIA website cuda_7.5.18_linux.run to install the drive=
r, opengl, cuda. Driver installation fails, cuda succeeds.&nbsp;</span><div=
 class=3D""><span style=3D"font-family:monospace" class=3D"">Also, when I r=
un&nbsp;</span></div><div class=3D""><span style=3D"font-family:monospace" =
class=3D"">sh&nbsp;</span><font face=3D"monospace" class=3D"">cuda_7.5.18_l=
inux.run</font></div><div class=3D""><span style=3D"font-family:monospace" =
class=3D"">I am offered to install the driver version&nbsp;</span><span sty=
le=3D"font-family:monospace" class=3D"">352.39 while on the host it is&nbsp=
;</span><span style=3D"font-family:monospace" class=3D"">346.47. I cannot u=
pgrade the host. Any idea where I can get 346.17?</span></div><div class=3D=
""><span style=3D"font-family:monospace" class=3D"">I tried using the same =
link just substitute 18 for something else but have not found the files:</s=
pan></div><div class=3D""><span style=3D"font-family:monospace" class=3D"">=
<span style=3D"" class=3D"">wget <a href=3D"http://developer.download.nvidi=
a.com/compute/cuda/7.5/Prod/local_installers/cuda_7.5.1X_linux.run" target=
=3D"_blank" class=3D"">http://developer.download.nvidia.com/compute/cuda/7.=
5/Prod/local_installers/cuda_7.5.1X_linux.run</a></span><br class=3D""></sp=
an><br class=3D""></div><div class=3D""><div class=3D""><div class=3D""><br=
 class=3D""></div><div class=3D""><br class=3D""></div><div class=3D"">On T=
hursday, July 28, 2016 at 7:34:55 PM UTC-5, Igor wrote:<blockquote class=3D=
"gmail_quote" style=3D"margin:0;margin-left:0.8ex;border-left:1px #ccc soli=
d;padding-left:1ex"><div dir=3D"ltr" class=3D"">Hi Nathan,<div class=3D"">W=
hen I try to install the driver by running NVIDIA*.run script inside the im=
age, it fails, probably because it tries to modify kernel that belongs to h=
ost?</div><div class=3D"">How do I extract just libcuda.so.345.67 without i=
nstalling the driver (which is obviously problematic) and why would copying=
 the library from the host would not work?</div><div class=3D"">Thank you,<=
/div><div class=3D"">Igor<br class=3D""><br class=3D"">On Thursday, July 28=
, 2016 at 7:18:26 PM UTC-5, Nathan Lin wrote:<blockquote class=3D"gmail_quo=
te" style=3D"margin:0;margin-left:0.8ex;border-left:1px #ccc solid;padding-=
left:1ex">Also if you are using the binary installation of TensorFlow you n=
eed CUDA toolkit 7.5 and cuDNN v4. These only need to be installed on our i=
mage. As I mentioned earlier you will need the libcuda.so.###.## library on=
 your image. It is very important that this is the same version of the NVID=
IA driver as you have on your nose (seemingly 346.67 for you). I should've =
have also mentioned that you want the libcuda.so.345.67 library that you ge=
t from extracting the NVIDIA installer. It will not work if you try to copy=
&nbsp;the libcuda.so library that from you node.&nbsp;<div class=3D""><br c=
lass=3D""></div><div class=3D"">Let me know if you have any more questions.=
&nbsp;</div><div class=3D""><br class=3D""></div><div class=3D"">Best,</div=
><div class=3D"">Nathan<span class=3D""></span><br class=3D""><br class=3D"=
">On Thursday, July 28, 2016, Nathan Lin &lt;<a rel=3D"nofollow" class=3D""=
>nat...@gmail.com</a>&gt; wrote:<br class=3D""><blockquote class=3D"gmail_q=
uote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1e=
x">Hello,<div class=3D""><br class=3D""></div><div class=3D"">Yes you are c=
orrect. The NVIDIA driver must be installed on your image as well. However,=
 you honestly only need the libcuda.so.###.## library and the appropriate l=
inks for that library. Once you have those installed in your image, it shou=
ld work.&nbsp;</div><div class=3D""><br class=3D""></div><div class=3D"">Be=
st,</div><div class=3D"">Nathan&nbsp;<span class=3D""></span><br class=3D""=
><br class=3D"">On Thursday, July 28, 2016, Igor &lt;<a class=3D"">igor...@=
gmail.com</a>&gt; wrote:<br class=3D""><blockquote class=3D"gmail_quote" st=
yle=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div =
dir=3D"ltr" class=3D"">Hi All,<div class=3D""><br class=3D""><div class=3D"=
">I am trying to use GPU-enabled tensorflow and it cannot find GPU card fro=
m inside the container.</div><div class=3D""><br class=3D""></div><div clas=
s=3D"">On the host:</div><div class=3D""><span style=3D"font-family:monospa=
ce" class=3D""><span style=3D"" class=3D"">$ lspci | grep -i nvidia
</span><br class=3D"">20:00.0 3D controller: NVIDIA Corporation GK110BGL [T=
esla K40m] (rev a1)
<br class=3D"">8b:00.0 3D controller: NVIDIA Corporation GK110BGL [Tesla K4=
0m] (rev a1)<br class=3D"">
<br class=3D""></span></div><div class=3D""><span style=3D"font-family:mono=
space" class=3D""><span style=3D"" class=3D"">$ nvidia-smi
</span><br class=3D"">Thu Jul 28 19:01:42 2016 &nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;<br class=3D"">+---------------------------------------------=
---------+ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<=
br class=3D"">| NVIDIA-SMI 346.47 &nbsp;&nbsp;&nbsp;&nbsp;Driver Version: 3=
46.47 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br class=3D"">|---------------=
----------------+----------------------+----------------------+
<br class=3D"">| GPU &nbsp;Name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P=
ersistence-M| Bus-Id &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Disp.A | Vol=
atile Uncorr. ECC |
<br class=3D"">| Fan &nbsp;Temp &nbsp;Perf &nbsp;Pwr:Usage/Cap| &nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Memory-Usage | GPU-Util &nbsp;Compute =
M. |
<br class=3D"">|=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D+=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D|
<br class=3D"">| &nbsp;&nbsp;0 &nbsp;Tesla K40m &nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;Off &nbsp;| 0000:20:00.0 &nbsp;&nbsp;&nbsp;&nbsp=
;Off | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 |
<br class=3D"">| N/A &nbsp;&nbsp;30C &nbsp;&nbsp;&nbsp;P8 &nbsp;&nbsp;&nbsp=
;20W / 235W | &nbsp;&nbsp;&nbsp;&nbsp;66MiB / 11519MiB | &nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;0% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Default |
<br class=3D"">+-------------------------------+----------------------+----=
------------------+
<br class=3D"">| &nbsp;&nbsp;1 &nbsp;Tesla K40m &nbsp;&nbsp;&nbsp;&nbsp;&nb=
sp;&nbsp;&nbsp;&nbsp;&nbsp;Off &nbsp;| 0000:8B:00.0 &nbsp;&nbsp;&nbsp;&nbsp=
;Off | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 |
<br class=3D"">| N/A &nbsp;&nbsp;26C &nbsp;&nbsp;&nbsp;P8 &nbsp;&nbsp;&nbsp=
;19W / 235W | &nbsp;&nbsp;&nbsp;&nbsp;60MiB / 11519MiB | &nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;0% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Default |
<br class=3D"">+-------------------------------+----------------------+----=
------------------+
<br class=3D""> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br class=3D"">+-------------------=
----------------------------------------------------------+
<br class=3D"">| Processes: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GPU Memory |
<br class=3D"">| &nbsp;GPU &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PID &nbsp;Ty=
pe &nbsp;Process name &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&n=
bsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Usage &nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;|
<br class=3D"">|=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=3D=
=3D=3D=3D=3D=3D=3D=3D=3D|
<br class=3D"">| &nbsp;&nbsp;&nbsp;0 &nbsp;&nbsp;&nbsp;&nbsp;11671 &nbsp;&n=
bsp;&nbsp;G &nbsp;&nbsp;/usr/bin/X &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;9MiB |
<br class=3D"">| &nbsp;&nbsp;&nbsp;1 &nbsp;&nbsp;&nbsp;&nbsp;11671 &nbsp;&n=
bsp;&nbsp;G &nbsp;&nbsp;/usr/bin/X &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&=
nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3MiB |<br class=3D"">
<br class=3D""></span></div></div><div class=3D""><font face=3D"monospace" =
class=3D""><br class=3D""></font></div><div class=3D""><font face=3D"monosp=
ace" class=3D"">Inside singularity:</font></div><div class=3D""><span style=
=3D"font-family:monospace" class=3D""><span style=3D"" class=3D"">$ singula=
rity shell /software/src/singularity_images/tensorflow_0.9.img</span><br cl=
ass=3D""></span></div><div class=3D""><span style=3D"font-family:monospace"=
 class=3D""><br class=3D""></span></div><div class=3D""><span style=3D"font=
-family:monospace" class=3D""><span style=3D"" class=3D"">Singularity/tenso=
rflow_0.9.img&gt; lspci | grep -i nvidia
</span><br class=3D"">bash: lspci: command not found
<br class=3D"">Singularity/tensorflow_0.9.img&gt; nvidia-smi
<br class=3D"">bash: nvidia-smi: command not found
<br class=3D"">Singularity/tensorflow_0.9.img&gt; python
<br class=3D"">Python 2.7.12 (default, Jul &nbsp;1 2016, 15:12:24) &nbsp;<b=
r class=3D"">[GCC 5.4.0 20160609] on linux2
<br class=3D"">Type "help", "copyright", "credits" or "license" for more in=
formation.
<br class=3D"">&gt;&gt;&gt; import tensorflow as tf
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcublas.so locally
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcudnn.so locally
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcufft.so locally
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcuda.so locally
<br class=3D"">I tensorflow/stream_executor/dso_loader.cc:108] successfully=
 opened CUDA library libcurand.so locally
<br class=3D"">&gt;&gt;&gt; sess =3D tf.Session()
<br class=3D"">E tensorflow/stream_executor/cuda/cuda_driver.cc:491] failed=
 call to cuInit: CUDA_ERROR_UNKNOWN
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:153] r=
etrieving CUDA diagnostic information for host: midway-l34-01
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:160] h=
ostname: midway-l34-01
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:185] l=
ibcuda reported version is: Not found: was unable to find libcuda.so DSO lo=
aded into this program
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:347] d=
river version file contents: """NVRM version: NVIDIA UNIX x86_64 Kernel Mod=
ule &nbsp;346.47 &nbsp;Thu Feb 19 18:56:03 PST 2015
<br class=3D"">GCC version: &nbsp;gcc version 4.4.7 20120313 (Red Hat 4.4.7=
-11) (GCC) &nbsp;<br class=3D"">"""
<br class=3D"">I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:189] k=
ernel reported version is: 346.47.0
<br class=3D"">I tensorflow/core/common_runtime/gpu/gpu_init.cc:81] No GPU =
devices available on machine.<br class=3D"">
<br class=3D""></span></div><div class=3D""><span style=3D"font-family:mono=
space" class=3D"">Must there be nvidia driver installed inside the containe=
r? Outside? The container shares the same kernel with the host and nvidia k=
ernel module needs to be loaded... How this is handled? Any requirements on=
 nvidia driver and cuda versions inside and outside of the container?</span=
></div><div class=3D""><span style=3D"font-family:monospace" class=3D""><br=
 class=3D""></span></div><div class=3D""><span style=3D"font-family:monospa=
ce" class=3D"">Thank you,</span></div><div class=3D""><span style=3D"font-f=
amily:monospace" class=3D"">Igor</span></div><div class=3D""><span style=3D=
"font-family:monospace" class=3D""><br class=3D""></span></div><div class=
=3D""><font face=3D"monospace" class=3D""><br class=3D""></font></div></div=
><div class=3D""><br class=3D"webkit-block-placeholder"></div>

-- <br class=3D"">
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br class=3D"">
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a class=3D"">singu...@lbl.gov</a>.<br class=3D"">
</blockquote></div>
</blockquote></div>
</blockquote></div></div></blockquote></div></div></div></div><div class=3D=
""><div class=3D""><div class=3D""><br class=3D"webkit-block-placeholder"><=
/div>

-- <br class=3D"">
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br class=3D"">
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank" class=3D"">si=
ngu...@lbl.gov</a>.<br class=3D"">
</div></div></blockquote></div><br class=3D""></div><div class=3D""><br cla=
ss=3D"webkit-block-placeholder"></div>

-- <br class=3D"">
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br class=3D"">
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank" class=3D"">si=
ngu...@lbl.gov</a>.<br class=3D"">
</div></div></blockquote></div><br class=3D""></div><div class=3D""><br cla=
ss=3D"webkit-block-placeholder"></div>

-- <br class=3D"">
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br class=3D"">
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank" class=3D"">si=
ngu...@lbl.gov</a>.<br class=3D"">
</div></blockquote></div></div></div><div class=3D""><div class=3D""><div c=
lass=3D""><br class=3D"webkit-block-placeholder"></div>

-- <br class=3D"">
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br class=3D"">
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank" class=3D"">si=
ngu...@lbl.gov</a>.<br class=3D"">
</div></div></blockquote></div><br class=3D""></div>
</div></div></blockquote></div><br class=3D""></div><div class=3D""><br cla=
ss=3D"webkit-block-placeholder"></div>

-- <br class=3D"">
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br class=3D"">
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank" class=3D"">si=
ngu...@lbl.gov</a>.<br class=3D"">
</div></blockquote></div></div></div><div class=3D""><div class=3D""><div c=
lass=3D""><br class=3D"webkit-block-placeholder"></div>

-- <br class=3D"">
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br class=3D"">
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank" class=3D"">si=
ngu...@lbl.gov</a>.<br class=3D"">
</div></div></blockquote></div><br class=3D""></div><div class=3D""><br cla=
ss=3D"webkit-block-placeholder"></div>

-- <br class=3D"">
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br class=3D"">
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank" class=3D"">si=
ngu...@lbl.gov</a>.<br class=3D"">
</div></blockquote></div></div></div><div class=3D""><div class=3D""><div c=
lass=3D""><br class=3D"webkit-block-placeholder"></div>

-- <br class=3D"">
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br class=3D"">
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank" class=3D"">si=
ngu...@lbl.gov</a>.<br class=3D"">
</div></div></blockquote></div><br class=3D""></div><div class=3D""><br cla=
ss=3D"webkit-block-placeholder"></div>

-- <br class=3D"">
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br class=3D"">
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank" class=3D"">si=
ngu...@lbl.gov</a>.<br class=3D"">
</div></blockquote></div></div></div><div class=3D""><div class=3D""><div c=
lass=3D""><br class=3D"webkit-block-placeholder"></div>

-- <br class=3D"">
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br class=3D"">
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank" class=3D"">si=
ngu...@lbl.gov</a>.<br class=3D"">
</div></div></blockquote></div><br class=3D""></div>
</div></div></blockquote></div><br class=3D""></div><div class=3D""><br cla=
ss=3D"webkit-block-placeholder"></div>

-- <br class=3D"">
You received this message because you are subscribed to the Google Groups "=
singularity" group.<br class=3D"">
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" class=3D"">singu...@lbl.gov</a>=
.<br class=3D"">
</div></blockquote></div><br class=3D""></div></body></html>
--Apple-Mail=_0B2A6510-1A57-4175-89A7-D5E128D8F2BE--
