Date: Thu, 3 Aug 2017 14:39:28 -0700 (PDT)
From: toufique <tech...@gmail.com>
To: singularity <singu...@lbl.gov>
Message-Id: <a396e8fe-fae0-4c4c-8b76-9724a48bd84c@lbl.gov>
In-Reply-To: <CAM=pu+Lc-9f8+7vjkPLy-Fd3OYM_XSEtoTYrusgGkU-=P58VYg@mail.gmail.com>
References: <9d25d29a-08d9-4bc4-bbcf-3327a841b3da@lbl.gov> <e847efae-1f98-4eb2-b2b5-1bf80c0a3476@lbl.gov>
 <CAM=pu+K1A92qd8JBPT9NhHrP_Pv-OPf-cnkNVCfqxeMKbH4MRg@mail.gmail.com> <e8470d35-8671-4736-91d8-9b68ba47e24c@lbl.gov>
 <CAM=pu+Lc-9f8+7vjkPLy-Fd3OYM_XSEtoTYrusgGkU-=P58VYg@mail.gmail.com>
Subject: Re: [Singularity] Re: can't run singularity exec as a regular user
MIME-Version: 1.0
Content-Type: multipart/mixed; 
	boundary="----=_Part_330_795950072.1501796368683"

------=_Part_330_795950072.1501796368683
Content-Type: multipart/alternative; 
	boundary="----=_Part_331_2120897614.1501796368684"

------=_Part_331_2120897614.1501796368684
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 7bit

hi Vanessa, 

what did you mean by trying a new install with no changes in the config?  I 
can reinstall 2.3.1 ( in a different install location)  -- is that what you 
meant?  Do I need to install ( ./configure, make, make install) as myself 
or 'root'? Does it help installing this as myself?  are there any plans to 
fix this bug? If not, should I try an older version of singularity?  

thanks.

On Thursday, August 3, 2017 at 2:11:04 PM UTC-7, vanessa wrote:
>
> I think the line where it's hitting a bug is here:
>
>
> https://github.com/singularityware/singularity/blob/adf5259ac94d7b213c649f073dcda32459b0c8b7/src/util/suid.c#L80
>
> Specifically somewhere after this command:
>
>>
>> ( singularity_registry_get("NOSUID") != NULL )
>
>
>
> When I run a similar command, I see the following:
>
> VERBOSE [U=0,P=29387]      singularity_suid_init()                   
>> Running SUID program workflow
>> VERBOSE [U=0,P=29387]      singularity_suid_init()                   
>> Checking program has appropriate permissions
>> VERBOSE [U=0,P=29387]      singularity_suid_init()                   
>> Checking configuration file is properly owned by root
>> VERBOSE [U=0,P=29387]      singularity_suid_init()                   
>> Checking if singularity.conf allows us to run as suid
>> DEBUG   [U=0,P=29387]      singularity_config_get_bool_char_impl()   
>> Called singularity_config_get_bool(allow setuid, yes)
>> DEBUG   [U=0,P=29387]      singularity_config_get_value_impl()       
>> Returning configuration value allow setuid='yes'
>> DEBUG   [U=0,P=29387]      singularity_config_get_bool_char_impl()   
>> Return singularity_config_get_bool(allow setuid, yes) = 1
>> DEBUG   [U=0,P=29387]      singularity_registry_get()               
>>  Returning NULL on 'NOSUID'
>> VERBOSE [U=0,P=29387]      singularity_priv_userns()                 
>> Invoking the user namespace
>
>
> and I return NULL too, but it doesn't error out. So you don't get to the 
> last line to invoke the user namespace... I'm not completely sure about the 
> issue, but given centos 6, I bet you it has to do with the OS / version.  
> Do others have thoughts? Could you try a completely new install with no 
> changes to the config, and do a simple shell for some docker:// uri so I 
> can recreate your use case exactly?
>
>
>
> On Thu, Aug 3, 2017 at 4:45 PM, toufique <te...@gmail.com <javascript:>> 
> wrote:
>
>> Hi Vanessa,
>>
>> command: 
>>
>> singularity --debug create --size 30000 /tmp/debian_jessie_tvb_1.img . 
>> (not that this time i tried creating the container in /tmp .  So, no 
>> involvment of NFS here for the container) 
>>
>>
>> Here is the debug output:
>>
>> Enabling debugging
>> Ending argument loop
>> Singularity version: 2.3.1-dist
>> Exec'ing: /data/apps/singularity/2.3.1/libexec/singularity/cli/create.exec
>> VERBOSE [U=2527,P=48257]   message_init()                            Set 
>> messagelevel to: 5
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Initialize configuration file: 
>> /data/apps/singularity/2.3.1/etc/singularity/singularity.conf
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_parse()               
>>  Starting parse of configuration file 
>> /data/apps/singularity/2.3.1/etc/singularity/singularity.conf
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key allow setuid = 'yes'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key max loop devices = '256'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key allow pid ns = 'yes'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key config passwd = 'yes'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key config group = 'yes'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key config resolv_conf = 'yes'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key mount proc = 'yes'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key mount sys = 'yes'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key mount dev = 'yes'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key mount home = 'yes'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key mount tmp = 'yes'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key mount hostfs = 'no'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key bind path = '/etc/localtime'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key bind path = '/etc/hosts'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key bind path = '/dfs1'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key bind path = '/dfs2'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key bind path = '/data'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key user bind control = 'yes'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key enable overlay = 'yes'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key mount slave = 'yes'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_config_parse()               
>>  Got config key sessiondir max size = '16'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_parse()               
>>  Finished parsing configuration file 
>> '/data/apps/singularity/2.3.1/etc/singularity/singularity.conf'
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_init()               
>> Initializing Singularity Registry
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()               
>>  Adding value to registry: 'WRITABLE' = '1'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()               
>>  Returning singularity_registry_set(WRITABLE, 1) = 0
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()               
>>  Adding value to registry: 'LIBEXECDIR' = 
>> '/data/apps/singularity/2.3.1/libexec'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()               
>>  Returning singularity_registry_set(libexecdir, 
>> /data/apps/singularity/2.3.1/libexec) = 0
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()               
>>  Adding value to registry: 'COMMAND' = 'create'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()               
>>  Returning singularity_registry_set(COMMAND, create) = 0
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()               
>>  Adding value to registry: 'IMAGESIZE' = '30000'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()               
>>  Returning singularity_registry_set(IMAGESIZE, 30000) = 0
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()               
>>  Adding value to registry: 'MESSAGELEVEL' = '5'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()               
>>  Returning singularity_registry_set(MESSAGELEVEL, 5) = 0
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()               
>>  Adding value to registry: 'VERSION' = '2.3.1-dist'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()               
>>  Returning singularity_registry_set(version, 2.3.1-dist) = 0
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()               
>>  Adding value to registry: 'LOCALSTATEDIR' = 
>> '/data/apps/singularity/2.3.1/var'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()               
>>  Returning singularity_registry_set(localstatedir, 
>> /data/apps/singularity/2.3.1/var) = 0
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()               
>>  Adding value to registry: 'SYSCONFDIR' = '/data/apps/singularity/2.3.1/etc'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()               
>>  Returning singularity_registry_set(sysconfdir, 
>> /data/apps/singularity/2.3.1/etc) = 0
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()               
>>  Adding value to registry: 'BINDIR' = '/data/apps/singularity/2.3.1/bin'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()               
>>  Returning singularity_registry_set(bindir, 
>> /data/apps/singularity/2.3.1/bin) = 0
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_registry_set()               
>>  Adding value to registry: 'IMAGE' = '/tmp/debian_jessie_tvb_1.img'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_set()               
>>  Returning singularity_registry_set(IMAGE, /tmp/debian_jessie_tvb_1.img) = 0
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()               
>>  Returning NULL on 'HOME'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()               
>>  Returning NULL on 'TARGET_UID'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()               
>>  Returning NULL on 'TARGET_GID'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()                   
>> Initializing user info
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()                   
>> Set the calling user's username to: itoufiqu
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()                   
>> Marking uinfo structure as ready
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_priv_init()                   
>> Obtaining home directory
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_priv_init()                   
>> Set home (via getpwuid()) to: /data/users/itoufiqu
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()                   
>> Running SUID program workflow
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()                   
>> Checking program has appropriate permissions
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()                   
>> Checking configuration file is properly owned by root
>> ^[[0mVERBOSE [U=2527,P=48257]   singularity_suid_init()                   
>> Checking if singularity.conf allows us to run as suid
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_get_bool_char_impl()   
>> Called singularity_config_get_bool(allow setuid, yes)
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_get_value_impl()       
>> Returning configuration value allow setuid='yes'
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_config_get_bool_char_impl()   
>> Return singularity_config_get_bool(allow setuid, yes) = 1
>> ^[[0mDEBUG   [U=2527,P=48257]   singularity_registry_get()               
>>  Returning NULL on 'NOSUID'
>> ^[[0m^[[91mERROR   [U=2527,P=48257]   singularity_suid_init()             
>>       Singularity is not running with appropriate privileges!
>> ^[[0m^[[91mERROR   [U=2527,P=48257]   singularity_suid_init()             
>>       Check installation path is not mounted with 'nosuid', and/or consult 
>> manual.
>> ^[[0m^[[31mABORT   [U=2527,P=48257]   singularity_suid_init()             
>>       Retval = 255
>>
>>
>> Some info on the host, let me know if you need more info: 
>>
>>
>> [itoufiqu@compute-7-2 2.3.1]$ cat /etc/redhat-release                     
>>                                     
>> CentOS release 6.8 (Final)                                               
>>                                      
>> [itoufiqu@compute-7-2 2.3.1]$ uname -a                                   
>>                                                 
>> Linux compute-7-2.local 3.10.104-1.el6.elrepo.x86_64 #1 SMP Fri Oct 21 
>> 10:27:14 EDT 2016 x86_64 x86_64 x86_64 GNU/Linux  
>>
>> Thanks again!
>>
>> On Thursday, August 3, 2017 at 1:38:02 PM UTC-7, vanessa wrote:
>>>
>>> Could you please show the output with --debug and singularity --version?
>>>
>>> singularity --debug create --size 30000 /tmp/debian_jessie_tvb.img
>>>> singularity --version
>>>
>>>
>>> and also throw in information about the host, if easy to get :) 
>>>
>>> On Thu, Aug 3, 2017 at 4:24 PM, toufique <te...@gmail.com> wrote:
>>>
>>>> Hi Vanessa,
>>>>
>>>> I finally had some time to look into this earlier today.  Per your 
>>>> suggestion, I tried creating a container as myself, no luck: 
>>>>
>>>> [itoufiqu@compute-7-2 ~]$ singularity -v create --size 30000 
>>>> /tmp/debian_jessie_tvb.img
>>>> Increasing verbosity level (2)
>>>> Singularity version: 2.3.1-dist
>>>> Exec'ing: 
>>>> /data/apps/singularity/2.3.1/libexec/singularity/cli/create.exec
>>>> VERBOSE: Set messagelevel to: 2
>>>> VERBOSE: Initialize configuration file: 
>>>> /data/apps/singularity/2.3.1/etc/singularity/singularity.conf
>>>> VERBOSE: Initializing Singularity Registry
>>>> ERROR  : Singularity is not running with appropriate privileges!
>>>> ERROR  : Check installation path is not mounted with 'nosuid', and/or 
>>>> consult manual.
>>>> ABORT  : Retval = 255
>>>>
>>>> [itoufiqu@compute-7-2 ~]$ whoami
>>>> itoufiqu
>>>>
>>>>
>>>> singularity was installed as 'root' .  Below is the config file: 
>>>>
>>>> allow setuid = yes
>>>> max loop devices = 256
>>>> config passwd = yes
>>>> config group = yes
>>>> config resolv_conf = yes
>>>> mount proc = yes
>>>> mount sys = yes
>>>> mount dev = yes
>>>> mount home = yes
>>>> mount tmp = yes
>>>> mount hostfs = no
>>>> bind path = /etc/localtime
>>>> bind path = /etc/hosts
>>>> bind path = /dfs1
>>>> bind path = /dfs2
>>>> bind path = /data
>>>> user bind control = yes
>>>> enable overlay = yes
>>>> mount slave = yes
>>>> sessiondir max size = 16
>>>>
>>>> What do I need to do get this fixed, please?
>>>>
>>>> thanks.
>>>>
>>>>
>>>> On Thursday, July 27, 2017 at 5:35:33 PM UTC-7, toufique wrote:
>>>>>
>>>>> Hi, 
>>>>>
>>>>> I am sure this has been discussed in this forum.
>>>>>
>>>>> I have a container that I have setup as 'root' . Now when I go about 
>>>>> using that container to get (even) a 'shell' off the container, I get the 
>>>>> error below:
>>>>>
>>>>> ./singularity shell /tmp/singularity_containers/debian_latest.img     
>>>>>                      
>>>>> ERROR  : Singularity is not running with appropriate privileges!
>>>>> ERROR  : Check installation path is not mounted with 'nosuid', and/or 
>>>>> consult manual.
>>>>> ABORT  : Retval = 255
>>>>>
>>>>> How do I fix this so, I can install containers as a 'root' user but 
>>>>> still be able to run -  'exec' , 'run', 'shell' commands as a regular user?
>>>>>
>>>>> Thanks for your help!
>>>>>
>>>> -- 
>>>> You received this message because you are subscribed to the Google 
>>>> Groups "singularity" group.
>>>> To unsubscribe from this group and stop receiving emails from it, send 
>>>> an email to singu...@lbl.gov.
>>>>
>>>
>>>
>>>
>>> -- 
>>> Vanessa Villamia Sochat
>>> Stanford University '16
>>> (603) 321-0676
>>>
>> -- 
>> You received this message because you are subscribed to the Google Groups 
>> "singularity" group.
>> To unsubscribe from this group and stop receiving emails from it, send an 
>> email to singu...@lbl.gov <javascript:>.
>>
>
>
>
> -- 
> Vanessa Villamia Sochat
> Stanford University '16
> (603) 321-0676
>

------=_Part_331_2120897614.1501796368684
Content-Type: text/html; charset=utf-8
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">hi Vanessa,=C2=A0<div><br></div><div>what did you mean by =
trying a new install with no changes in the config? =C2=A0I can reinstall 2=
.3.1 ( in a different install location) =C2=A0-- is that what you meant? =
=C2=A0Do I need to install ( ./configure, make, make install) as myself or =
&#39;root&#39;? Does it help installing this as myself? =C2=A0are there any=
 plans to fix this bug? If not, should I try an older version of singularit=
y? =C2=A0</div><div><br></div><div>thanks.<br><br>On Thursday, August 3, 20=
17 at 2:11:04 PM UTC-7, vanessa wrote:<blockquote class=3D"gmail_quote" sty=
le=3D"margin: 0;margin-left: 0.8ex;border-left: 1px #ccc solid;padding-left=
: 1ex;"><div dir=3D"ltr">I think the line where it&#39;s hitting a bug is h=
ere:<div><br></div><div><a href=3D"https://github.com/singularityware/singu=
larity/blob/adf5259ac94d7b213c649f073dcda32459b0c8b7/src/util/suid.c#L80" t=
arget=3D"_blank" rel=3D"nofollow" onmousedown=3D"this.href=3D&#39;https://w=
ww.google.com/url?q\x3dhttps%3A%2F%2Fgithub.com%2Fsingularityware%2Fsingula=
rity%2Fblob%2Fadf5259ac94d7b213c649f073dcda32459b0c8b7%2Fsrc%2Futil%2Fsuid.=
c%23L80\x26sa\x3dD\x26sntz\x3d1\x26usg\x3dAFQjCNFtRCEbO9ctDrwOymFODUflrkIGl=
g&#39;;return true;" onclick=3D"this.href=3D&#39;https://www.google.com/url=
?q\x3dhttps%3A%2F%2Fgithub.com%2Fsingularityware%2Fsingularity%2Fblob%2Fadf=
5259ac94d7b213c649f073dcda32459b0c8b7%2Fsrc%2Futil%2Fsuid.c%23L80\x26sa\x3d=
D\x26sntz\x3d1\x26usg\x3dAFQjCNFtRCEbO9ctDrwOymFODUflrkIGlg&#39;;return tru=
e;">https://github.com/<wbr>singularityware/singularity/<wbr>blob/<wbr>adf5=
259ac94d7b213c649f073dcda3<wbr>2459b0c8b7/src/util/suid.c#L80</a><br></div>=
<div><br></div><div>Specifically somewhere after this command:</div><blockq=
uote class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-left:1p=
x solid rgb(204,204,204);padding-left:1ex"><br><span style=3D"color:rgb(36,=
41,46);font-family:SFMono-Regular,Consolas,&quot;Liberation Mono&quot;,Menl=
o,Courier,monospace;font-size:12px;white-space:pre;background-color:rgb(255=
,251,221)">( </span><span style=3D"color:rgb(0,92,197);font-family:SFMono-R=
egular,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;font-si=
ze:12px;white-space:pre">singularity_registry_get</span><span style=3D"colo=
r:rgb(36,41,46);font-family:SFMono-Regular,Consolas,&quot;Liberation Mono&q=
uot;,Menlo,Courier,monospace;font-size:12px;white-space:pre;background-colo=
r:rgb(255,251,221)">(</span><span style=3D"color:rgb(3,47,98);font-family:S=
FMono-Regular,Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;=
font-size:12px;white-space:pre"><span>&quot;</span>NOSU<wbr>ID<span>&quot;<=
/span></span><span style=3D"color:rgb(36,41,46);font-family:SFMono-Regular,=
Consolas,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;font-size:12px=
;white-space:pre;background-color:rgb(255,251,221)">) !=3D </span><span sty=
le=3D"color:rgb(0,92,197);font-family:SFMono-Regular,Consolas,&quot;Liberat=
ion Mono&quot;,Menlo,Courier,monospace;font-size:12px;white-space:pre">NULL=
</span><span style=3D"color:rgb(36,41,46);font-family:SFMono-Regular,Consol=
as,&quot;Liberation Mono&quot;,Menlo,Courier,monospace;font-size:12px;white=
-space:pre;background-color:rgb(255,251,221)"> )</span></blockquote><div><b=
r></div><div><br></div><div>When I run a similar command, I see the followi=
ng:</div><div><br></div><div><blockquote class=3D"gmail_quote" style=3D"mar=
gin:0px 0px 0px 0.8ex;border-left:1px solid rgb(204,204,204);padding-left:1=
ex">VERBOSE [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_suid_init() =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Running SUID=
 program workflow<br>VERBOSE [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singular=
ity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 Checking program has appropriate permissions<br>VERBOSE [U=3D0,P=3D2938=
7] =C2=A0 =C2=A0 =C2=A0singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Checking configuration file is properly =
owned by root<br>VERBOSE [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_=
suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
Checking if singularity.conf allows us to run as suid<br>DEBUG =C2=A0 [U=3D=
0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_config_get_bool_<wbr>char_impl=
() =C2=A0 Called singularity_config_get_bool(<wbr>allow setuid, yes)<br>DEB=
UG =C2=A0 [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_config_get_valu=
e_<wbr>impl() =C2=A0 =C2=A0 =C2=A0 Returning configuration value allow setu=
id=3D&#39;yes&#39;<br>DEBUG =C2=A0 [U=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0si=
ngularity_config_get_bool_<wbr>char_impl() =C2=A0 Return singularity_config=
_get_bool(<wbr>allow setuid, yes) =3D 1<br>DEBUG =C2=A0 [U=3D0,P=3D29387] =
=C2=A0 =C2=A0 =C2=A0singularity_registry_get() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0Returning NULL on &#39;NOSUID&#39;<br>VERBOSE [U=
=3D0,P=3D29387] =C2=A0 =C2=A0 =C2=A0singularity_priv_userns() =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Invoking the user namespace</blo=
ckquote><div><br></div><div>and I return NULL too, but it doesn&#39;t error=
 out. So you don&#39;t get to the last line to invoke the user namespace...=
 I&#39;m not completely sure about the issue, but given centos 6, I bet you=
 it has to do with the OS / version.=C2=A0 Do others have thoughts? Could y=
ou try a completely new install with no changes to the config, and do a sim=
ple shell for some docker:// uri so I can recreate your use case exactly?</=
div></div><div><br></div><div><br></div></div><div><br><div class=3D"gmail_=
quote">On Thu, Aug 3, 2017 at 4:45 PM, toufique <span dir=3D"ltr">&lt;<a hr=
ef=3D"javascript:" target=3D"_blank" gdf-obfuscated-mailto=3D"t4b8tQYjDAAJ"=
 rel=3D"nofollow" onmousedown=3D"this.href=3D&#39;javascript:&#39;;return t=
rue;" onclick=3D"this.href=3D&#39;javascript:&#39;;return true;">te...@gmai=
l.com</a>&gt;</span> wrote:<br><blockquote class=3D"gmail_quote" style=3D"m=
argin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div dir=3D"l=
tr">Hi Vanessa,<div><br></div><div>command:=C2=A0</div><div><br></div><div>=
singularity --debug create --size 30000 /tmp/debian_jessie_tvb_1.img . (not=
 that this time i tried creating the container in /tmp .=C2=A0 So, no invol=
vment of NFS here for the container)=C2=A0<br></div><div><br></div><div><br=
></div><div>Here is the debug output:</div><div><br></div><div><div>Enablin=
g debugging</div><div>Ending argument loop</div><span><div>Singularity vers=
ion: 2.3.1-dist</div><div>Exec&#39;ing: /data/apps/singularity/2.3.1/<wbr>l=
ibexec/singularity/cli/<wbr>create.exec</div></span><div>VERBOSE [U=3D2527,=
P=3D48257] =C2=A0 message_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Set messagelevel to:=
 5</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_pa=
rse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Initialize con=
figuration file: /data/apps/singularity/2.3.1/<wbr>etc/singularity/singular=
ity.<wbr>conf</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singu=
larity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0Starting parse of configuration file /data/apps/singularity/2.3.1/<wbr>e=
tc/singularity/singularity.<wbr>conf</div><div>^[[0mVERBOSE [U=3D2527,P=3D4=
8257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0Got config key allow setuid =3D &#39;yes&#39;</div><div=
>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key max loop de=
vices =3D &#39;256&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 =
singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0Got config key allow pid ns =3D &#39;yes&#39;</div><div>^[[0mVERBOSE=
 [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key config passwd =3D &#39=
;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_co=
nfig_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got con=
fig key config group =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=
=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0Got config key config resolv_conf =3D &#39;yes&#39;=
</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_pars=
e() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key m=
ount proc =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=
=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0Got config key mount sys =3D &#39;yes&#39;</div><div>^[[0mVERB=
OSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key mount dev =3D &#39;=
yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_con=
fig_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got conf=
ig key mount home =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48=
257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0Got config key mount tmp =3D &#39;yes&#39;</div><div>^[=
[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key mount hostfs=
 =3D &#39;no&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singul=
arity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0Got config key bind path =3D &#39;/etc/localtime&#39;</div><div>^[[0mVER=
BOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key bind path =3D &#39;=
/etc/hosts&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singular=
ity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0G=
ot config key bind path =3D &#39;/dfs1&#39;</div><div>^[[0mVERBOSE [U=3D252=
7,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key bind path =3D &#39;/dfs2&#39;</di=
v><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key bind =
path =3D &#39;/data&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0=
 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0Got config key user bind control =3D &#39;yes&#39;</div><div>^[[0=
mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key enable overlay =
=3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singul=
arity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0Got config key mount slave =3D &#39;yes&#39;</div><div>^[[0mVERBOSE [U=
=3D2527,P=3D48257] =C2=A0 singularity_config_parse() =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Got config key sessiondir max size =3D &#=
39;16&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singular=
ity_config_parse() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0F=
inished parsing configuration file &#39;/data/apps/singularity/2.3.1/<wbr>e=
tc/singularity/singularity.<wbr>conf&#39;</div><div>^[[0mVERBOSE [U=3D2527,=
P=3D48257] =C2=A0 singularity_registry_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 Initializing Singularity Registry</div><div>^[[0mVERBO=
SE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &#39;WRITAB=
LE&#39; =3D &#39;1&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =
=C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0Returning singularity_registry_set(<wbr>WRITABLE, 1) =3D 0</d=
iv><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set()=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to reg=
istry: &#39;LIBEXECDIR&#39; =3D &#39;/data/apps/singularity/2.3.1/<wbr>libe=
xec&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularit=
y_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Ret=
urning singularity_registry_set(<wbr>libexecdir, /data/apps/singularity/2.3=
.1/<wbr>libexec) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 s=
ingularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0Adding value to registry: &#39;COMMAND&#39; =3D &#39;create&#39;</div=
><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_se=
t() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singul=
arity_registry_set(<wbr>COMMAND, create) =3D 0</div><div>^[[0mVERBOSE [U=3D=
2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &#39;IMAGESIZE&#39=
; =3D &#39;30000&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=
=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0Returning singularity_registry_set(<wbr>IMAGESIZE, 30000) =3D =
0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_s=
et() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to=
 registry: &#39;MESSAGELEVEL&#39; =3D &#39;5&#39;</div><div>^[[0mDEBUG =C2=
=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_registry_set=
(<wbr>MESSAGELEVEL, 5) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =
=C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0Adding value to registry: &#39;VERSION&#39; =3D &#39;2.3.1-di=
st&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity=
_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Retu=
rning singularity_registry_set(<wbr>version, 2.3.1-dist) =3D 0</div><div>^[=
[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &=
#39;LOCALSTATEDIR&#39; =3D &#39;/data/apps/singularity/2.3.1/<wbr>var&#39;<=
/div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registr=
y_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning si=
ngularity_registry_set(<wbr>localstatedir, /data/apps/singularity/2.3.1/<wb=
r>var) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity=
_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Addi=
ng value to registry: &#39;SYSCONFDIR&#39; =3D &#39;/data/apps/singularity/=
2.3.1/<wbr>etc&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0=
 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0Returning singularity_registry_set(<wbr>sysconfdir, /data/apps/si=
ngularity/2.3.1/<wbr>etc) =3D 0</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257]=
 =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0Adding value to registry: &#39;BINDIR&#39; =3D &#39;/data/=
apps/singularity/2.3.1/<wbr>bin&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,=
P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_registry_set(<wbr>bindir, =
/data/apps/singularity/2.3.1/<wbr>bin) =3D 0</div><div>^[[0mVERBOSE [U=3D25=
27,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0Adding value to registry: &#39;IMAGE&#39; =3D &=
#39;/tmp/debian_jessie_tvb_1.img&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527=
,P=3D48257] =C2=A0 singularity_registry_set() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0Returning singularity_registry_set(<wbr>IMAGE, /=
tmp/debian_jessie_tvb_1.img) =3D 0</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=
=3D48257] =C2=A0 singularity_registry_get() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0Returning NULL on &#39;HOME&#39;</div><div>^[[0mDEB=
UG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_registry_get() =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Returning NULL on &#39;TARGET_=
UID&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularit=
y_registry_get() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0Ret=
urning NULL on &#39;TARGET_GID&#39;</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=
=3D48257] =C2=A0 singularity_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Initializing user info</div><div>^[[0mDEBUG =
=C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_priv_init() =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Set the calling user&#39;s=
 username to: itoufiqu</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=
=A0 singularity_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 Marking uinfo structure as ready</div><div>^[[0mDEBUG =C2=
=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_priv_init() =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Obtaining home directory</div=
><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity_priv_init() =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Set home (via g=
etpwuid()) to: /data/users/itoufiqu</div><div>^[[0mVERBOSE [U=3D2527,P=3D48=
257] =C2=A0 singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 Running SUID program workflow</div><div>^[[0mVERBO=
SE [U=3D2527,P=3D48257] =C2=A0 singularity_suid_init() =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Checking program has appropriate=
 permissions</div><div>^[[0mVERBOSE [U=3D2527,P=3D48257] =C2=A0 singularity=
_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 Checking configuration file is properly owned by root</div><div>^[[0mVERBO=
SE [U=3D2527,P=3D48257] =C2=A0 singularity_suid_init() =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Checking if singularity.conf all=
ows us to run as suid</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=
=A0 singularity_config_get_bool_<wbr>char_impl() =C2=A0 Called singularity_=
config_get_bool(<wbr>allow setuid, yes)</div><div>^[[0mDEBUG =C2=A0 [U=3D25=
27,P=3D48257] =C2=A0 singularity_config_get_value_<wbr>impl() =C2=A0 =C2=A0=
 =C2=A0 Returning configuration value allow setuid=3D&#39;yes&#39;</div><di=
v>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 singularity_config_get_bool=
_<wbr>char_impl() =C2=A0 Return singularity_config_get_bool(<wbr>allow setu=
id, yes) =3D 1</div><div>^[[0mDEBUG =C2=A0 [U=3D2527,P=3D48257] =C2=A0 sing=
ularity_registry_get() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0Returning NULL on &#39;NOSUID&#39;</div><div>^[[0m^[[91mERROR =C2=A0 [U=
=3D2527,P=3D48257] =C2=A0 singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Singularity is not running with appr=
opriate privileges!</div><div>^[[0m^[[91mERROR =C2=A0 [U=3D2527,P=3D48257] =
=C2=A0 singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 Check installation path is not mounted with &#39;nosui=
d&#39;, and/or consult manual.</div><div>^[[0m^[[31mABORT =C2=A0 [U=3D2527,=
P=3D48257] =C2=A0 singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Retval =3D 255</div><div><br></div><div><br=
></div><div>Some info on the host, let me know if you need more info:=C2=A0=
</div><div><br></div><div><br></div><div>[itoufiqu@compute-7-2 2.3.1]$ cat =
/etc/redhat-release =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=C2=A0<br=
></div><div><div>CentOS release 6.8 (Final) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0</div><div>[itoufiqu@compute-7-2 2=
.3.1]$ uname -a =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0=C2=A0</div><div>Linux compute-7-2.local 3.10.104-1.el6.elrepo.x86_64=
 #1 SMP Fri Oct 21 10:27:14 EDT 2016 x86_64 x86_64 x86_64 GNU/Linux =C2=A0<=
/div></div><div><br></div><div>Thanks again!</div><span><div><br></div>On T=
hursday, August 3, 2017 at 1:38:02 PM UTC-7, vanessa wrote:</span><blockquo=
te class=3D"gmail_quote" style=3D"margin:0;margin-left:0.8ex;border-left:1p=
x #ccc solid;padding-left:1ex"><span><div dir=3D"ltr">Could you please show=
 the output with --debug and singularity --version?<div><br></div><blockquo=
te class=3D"gmail_quote" style=3D"margin:0px 0px 0px 0.8ex;border-left:1px =
solid rgb(204,204,204);padding-left:1ex"><span style=3D"font-size:12.8px">s=
ingularity --debug create --size 30000 /tmp/debian_jessie_tvb.img</span><sp=
an style=3D"font-size:12.8px"><br></span><span style=3D"font-size:12.8px">s=
ingularity --version</span></blockquote><div><br></div><div>and also throw =
in information about the host, if easy to get :)=C2=A0</div></div></span><d=
iv><br><div class=3D"gmail_quote"><div><div>On Thu, Aug 3, 2017 at 4:24 PM,=
 toufique <span dir=3D"ltr">&lt;<a rel=3D"nofollow">te...@gmail.com</a>&gt;=
</span> wrote:<br></div></div><blockquote class=3D"gmail_quote" style=3D"ma=
rgin:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div><div><div=
 dir=3D"ltr">Hi Vanessa,<div><br></div><div>I finally had some time to look=
 into this earlier today.=C2=A0 Per your suggestion, I tried creating a con=
tainer as myself, no luck:=C2=A0<br><br><div>[itoufiqu@compute-7-2 ~]$ sing=
ularity -v create --size 30000 /tmp/debian_jessie_tvb.img</div><div>Increas=
ing verbosity level (2)</div><div>Singularity version: 2.3.1-dist</div><div=
>Exec&#39;ing: /data/apps/singularity/2.3.1/<wbr>libexec/singularity/cli/<w=
br>create.exec</div><div>VERBOSE: Set messagelevel to: 2</div><div>VERBOSE:=
 Initialize configuration file: /data/apps/singularity/2.3.1/<wbr>etc/singu=
larity/singularity.<wbr>conf</div><div>VERBOSE: Initializing Singularity Re=
gistry</div><span><div>ERROR =C2=A0: Singularity is not running with approp=
riate privileges!</div><div>ERROR =C2=A0: Check installation path is not mo=
unted with &#39;nosuid&#39;, and/or consult manual.</div><div>ABORT =C2=A0:=
 Retval =3D 255</div><div><br></div></span><div>[itoufiqu@compute-7-2 ~]$ w=
hoami</div><div><span style=3D"color:inherit;font-size:inherit">itoufiqu</s=
pan><br></div><div><br></div><div><br></div><div>singularity was installed =
as &#39;root&#39; .=C2=A0 Below is the config file:=C2=A0</div><div><br></d=
iv><div><div>allow setuid =3D yes</div><div>max loop devices =3D 256</div><=
div>config passwd =3D yes</div><div>config group =3D yes</div><div>config r=
esolv_conf =3D yes</div><div>mount proc =3D yes</div><div>mount sys =3D yes=
</div><div>mount dev =3D yes</div><div>mount home =3D yes</div><div>mount t=
mp =3D yes</div><div>mount hostfs =3D no</div><div>bind path =3D /etc/local=
time</div><div>bind path =3D /etc/hosts</div><div>bind path =3D /dfs1</div>=
<div>bind path =3D /dfs2</div><div>bind path =3D /data</div><div>user bind =
control =3D yes</div><div>enable overlay =3D yes</div><div>mount slave =3D =
yes</div><div>sessiondir max size =3D 16</div></div><div><br></div><div>Wha=
t do I need to do get this fixed, please?</div><div><br></div><div>thanks.<=
/div><div><div><div><br></div><div><br></div>On Thursday, July 27, 2017 at =
5:35:33 PM UTC-7, toufique wrote:<blockquote class=3D"gmail_quote" style=3D=
"margin:0;margin-left:0.8ex;border-left:1px #ccc solid;padding-left:1ex"><d=
iv dir=3D"ltr">Hi,=C2=A0<div><br></div><div>I am sure this has been discuss=
ed in this forum.</div><div><br></div><div>I have a container that I have s=
etup as &#39;root&#39; .=C2=A0Now when I go about using that container to g=
et (even) a &#39;shell&#39; off the container, I get the error below:<br><b=
r><div>./singularity shell /tmp/singularity_containers/<wbr>debian_latest.i=
mg =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0</div><div>ERROR =C2=A0: Singularity is not running wit=
h appropriate privileges!</div><div>ERROR =C2=A0: Check installation path i=
s not mounted with &#39;nosuid&#39;, and/or consult manual.</div><div>ABORT=
 =C2=A0: Retval =3D 255</div></div><div><br></div><div>How do I fix this so=
, I can install containers as a &#39;root&#39; user but still be able to ru=
n - =C2=A0&#39;exec&#39; , &#39;run&#39;, &#39;shell&#39; commands as a reg=
ular user?</div><div><br></div><div>Thanks for your help!</div></div></bloc=
kquote></div></div></div></div></div></div><div><div><div><div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br></div></div>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a rel=3D"nofollow">singu...@lbl.gov</a>.<br>
</div></div></blockquote></div><span><br><br clear=3D"all"><div><br></div>-=
- <br><div>Vanessa Villamia Sochat<br>Stanford University &#39;16<br><div><=
div><div><a value=3D"+16033210676">(603) 321-0676</a></div></div></div></di=
v>
</span></div>
</blockquote></div></div><div><div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"javascript:" target=3D"_blank" gdf-obfuscated-mailto=3D"=
t4b8tQYjDAAJ" rel=3D"nofollow" onmousedown=3D"this.href=3D&#39;javascript:&=
#39;;return true;" onclick=3D"this.href=3D&#39;javascript:&#39;;return true=
;">singularity...@lbl.<wbr>gov</a>.<br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
<div>Vanessa Villamia Sochat<br>Stanford University &#39;16<br><div><div><d=
iv>(603) 321-0676</div></div></div></div>
</div>
</blockquote></div></div>
------=_Part_331_2120897614.1501796368684--

------=_Part_330_795950072.1501796368683--
