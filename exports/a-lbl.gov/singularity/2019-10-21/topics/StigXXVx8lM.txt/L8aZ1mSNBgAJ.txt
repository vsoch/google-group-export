X-Received: by 10.99.189.9 with SMTP id a9mr7903652pgf.65.1496770676567;
        Tue, 06 Jun 2017 10:37:56 -0700 (PDT)
X-BeenThere: singularity@lbl.gov
Received: by 10.107.9.146 with SMTP id 18ls988279ioj.26.gmail; Tue, 06 Jun
 2017 10:37:55 -0700 (PDT)
X-Received: by 10.84.151.99 with SMTP id i90mr3459796pli.81.1496770675463;
        Tue, 06 Jun 2017 10:37:55 -0700 (PDT)
ARC-Seal: i=1; a=rsa-sha256; t=1496770675; cv=none;
        d=google.com; s=arc-20160816;
        b=EdUIC5R9Az5d+XIuX8YmcHPeV+1/2OWPF8mUK1V+G+WKkqmX9gGHfdbCktlnreIWNm
         I0v57Pnzr9eQu61S9ywsSRWobvyFMo/UHia5Z1o4gvFHDc02uqUjSNTJISUYLBHXNoYZ
         vEYtLFmPp9P2KL3U6ZMnYPISXaR38DO++PrmDgqho44sFM55mMbrYAnmiT5/TtPzOx0j
         7XCX47GvqZyJf12/fc5U1z8pmJNtlu8f/pvwL2aEjPqT4wqGRYSP4t4iUO5b31w06P8w
         LE/eclLNvER08BPqt9oF4mpscohAnuRZ95BXkmGXzHZs1A0fg5yxMsGYrBNS77Gb1VZ/
         jFfg==
ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816;
        h=to:subject:message-id:date:from:references:in-reply-to:mime-version
         :dkim-signature:arc-authentication-results;
        bh=BH33mdg6bkVAKczfBryMaDIfJZeOtDzI6yP1WyRbjIE=;
        b=GN2kCSNQBjoHDJbb4k2ULAVoCzI1Qbnvc2/OD2gvNQAOs/S3cc4NmTMbbK0/1jqpQc
         A3k6gD7vlq94kq1RNGTqIqoLrtSUlCT6/7y5AdKka9tuZ15wLEiAVKrgbV8JMeh7YjUe
         i7KdYUXxAEIRoJtBCOvFFMjAYthlgFt4G6liIxKhMmhb4PzMbpnp+OsVZ9M2933U5hX9
         im/lGiJ/ICszBkTRY1iS6K6SWFB9uGJpeJa15I3elmzlUmYkGeSCiaXQROG6lWppWqVY
         lFQdB/CIEQb1byquWY/aR3JNIqEV3muqimAE3wabqzK/6S+Svn5wqngTHFaZ+oPtu3/I
         NaGw==
ARC-Authentication-Results: i=1; mx.google.com;
       dkim=pass head...@gmail.com;
       spf=pass (google.com: domain of vso...@gmail.com designates 209.85.217.177 as permitted sender) smtp.mailfrom=vso...@gmail.com
Return-Path: <vso...@gmail.com>
Received: from fe4.lbl.gov (fe4.lbl.gov. [128.3.41.71])
        by mx.google.com with ESMTP id g26si10165458plj.522.2017.06.06.10.37.55
        for <singu...@lbl.gov>;
        Tue, 06 Jun 2017 10:37:55 -0700 (PDT)
Received-SPF: pass (google.com: domain of vso...@gmail.com designates 209.85.217.177 as permitted sender) client-ip=209.85.217.177;
Authentication-Results: mx.google.com;
       dkim=pass head...@gmail.com;
       spf=pass (google.com: domain of vso...@gmail.com designates 209.85.217.177 as permitted sender) smtp.mailfrom=vso...@gmail.com
X-Ironport-SBRS: 3.4
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: =?us-ascii?q?A2FZAAAg5zZZhrHZVdFbAxsBAQEDAQEBC?=
 =?us-ascii?q?QEBARYBAQEDAQEBCQEBAYJEPAKBDYENB4NkCIEEMohjkgWVf4ExARsbJQMhAQm?=
 =?us-ascii?q?FeQKCXQc/GAEBAQEBAQEBAQEBAhABAQEICwsIKC+CMwUCAwIeBARGIQUBAgMBA?=
 =?us-ascii?q?QEBAQEBAQEBASEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQkCDAM?=
 =?us-ascii?q?cExIBARgBAQEBAgEaCQQZAQ0OEgwDAQsGAwILDRYBCQEJAgIhAQEOAwEFARwOB?=
 =?us-ascii?q?wQBGQECBIg3gTkBAw0IBQuPW5EaP4wHgWwYBQEcgwoFg2MKGScNVoNcAQEBBwE?=
 =?us-ascii?q?BAQEBAQEBGAIGEogvghSBDIJYKSVGTxIBPQwaAQGCSYJhBYlAA4ZtgQlUhHWGd?=
 =?us-ascii?q?zuHJoZXXIRbkX+LPodbFB+BFR94DTMLdBVGGYQ0Kg8QDIIEIDYBAQEFhwcNFzC?=
 =?us-ascii?q?BaQEBAQ?=
X-IronPort-AV: E=Sophos;i="5.39,307,1493708400"; 
   d="scan'208,217";a="77105150"
Received: from mail-ua0-f177.google.com ([209.85.217.177])
  by fe4.lbl.gov with ESMTP; 06 Jun 2017 10:37:52 -0700
Received: by mail-ua0-f177.google.com with SMTP id m31so3408867uam.1
        for <singu...@lbl.gov>; Tue, 06 Jun 2017 10:37:52 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=gmail.com; s=20161025;
        h=mime-version:in-reply-to:references:from:date:message-id:subject:to;
        bh=BH33mdg6bkVAKczfBryMaDIfJZeOtDzI6yP1WyRbjIE=;
        b=dpA0Z6p38rYlqAUJ7dkGrtKrgiXM/Pl/n5kZ/BaT0lghTNPbhv6YhRrSxO22NkOUoV
         cnKBR0Erj+3lqpxBJhGokT7QEo3JkkE6s25W+MBWAkXJFN6qooxcN4q+s9Xscxl1aLS7
         IYRBJWr5jDMGJHTaRkwgRb7edM3cW00ljRGDvuilLTn96vO5l2/BoTup2z/LpHvv0R1e
         azmN2Xn8sfcWSM4Xdq+uH2faBYV/uFxDxwjeHR6tsonUju3YCi9uVFpkEupbZCNYJVLH
         yJf1U+qfNO3+6080/KpIkprr0O+iJYA1Brp6hXikIR/QLYk8YfcmGei+iIJVl/KWk9d7
         ALpg==
X-Gm-Message-State: AODbwcAOgmK3HDvADFzIJxm6NNF6ZrPNo/+ina7R+fRrO+LB249Sl9ew
	jt6xOoxlsZ0P9o5oKItZYBqAjJ/GXJYL
X-Received: by 10.159.41.196 with SMTP id s62mr2154508uas.136.1496770671982;
 Tue, 06 Jun 2017 10:37:51 -0700 (PDT)
MIME-Version: 1.0
Received: by 10.103.49.67 with HTTP; Tue, 6 Jun 2017 10:37:31 -0700 (PDT)
In-Reply-To: <F920964C-A347-41C8-A231-12A9167A2546@fordham.edu>
References: <eb2e5586-6bbb-4764-a155-83aea545ded0@lbl.gov> <CAM=pu+JNZw5WSspqPJhxfvVVa+W4CrUatPOFyJd02uNXK7QGsw@mail.gmail.com>
 <705AFBC5-ABBF-45AB-9A0A-F094AC0A7E07@fordham.edu> <CAM=pu+KwqfXQwbxYwZbAifx-rQjFgCoh-4KNwMPLaw8BD1xidg@mail.gmail.com>
 <C734A832-7C37-424C-BDA8-F3003A088C9A@fordham.edu> <6F6BCBDE-B10D-40F5-8D23-AB3470CA7DAA@gmail.com>
 <672F6430-4C6C-4A66-919B-A9C4E7FE4ECB@fordham.edu> <F0A18C08-400E-4362-AD1B-B9DA736F72AB@gmail.com>
 <59F05D2F-47A7-49BC-9F37-D16F845C159D@fordham.edu> <CAA6Bz=f=191vj-Mx29bsDtmt+vwHFp9E7wE9xse34ak762JxDQ@mail.gmail.com>
 <9CF6424D-BCDB-40E8-830C-81CE2F1C5538@fordham.edu> <CAA6Bz=eFXAstGLM8pm+p_PiaMvo8LNb=TGNJn82K+mLuM2BAFg@mail.gmail.com>
 <BDFE338B-2C36-4DE2-B94E-6AAB75FF2615@fordham.edu> <CAA6Bz=dKY7hicKNuGdea9YyHrd+n_cPTLuSS2SW2vb3xZspmug@mail.gmail.com>
 <F920964C-A347-41C8-A231-12A9167A2546@fordham.edu>
From: vanessa s <vso...@gmail.com>
Date: Tue, 6 Jun 2017 10:37:31 -0700
Message-ID: <CAM=pu+LZ3+pmkdrZG2Epa59FXTh55=_frfb_rJLGmoW-ugdYnw@mail.gmail.com>
Subject: Re: [Singularity] using Singularity to add Ubuntu to a NPACI Rocks
 Cluster node
To: singularity@lbl.gov
Content-Type: multipart/alternative; boundary="94eb2c061ec036c31e05514e1427"

--94eb2c061ec036c31e05514e1427
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

Almost! To use -w you need to run as root:

sudo singularity run -w /share/apps/ubuntu.simg

On Tue, Jun 6, 2017 at 9:04 AM, Robert Kudyba <rku...@fordham.edu> wrote:

> is this the correct usage of -w?
>
> ./singularity run -w /share/apps/ubuntu.simg
> ERROR  : Could not open image /share/apps/ubuntu.simg: Permission denied
> ABORT  : Retval =3D 255
>
>
>
> On Jun 6, 2017, at 11:18 AM, R=C3=A9my Dernat <rem...@gmail.com> wrote:
>
> I think you built your image on a machine with uid "426" which is not
> present on the cluster, so, that's normal. You just have to enter in the
> container with '-w' flag in root, and edit permissions on your runscript =
to
> fit your user on the cluster side.
>
> BTW, of course, normally, on Rocks, you had to build your image with:
> ```
> ./configure --prefix=3D/share/apps/singularity-install
> ```
> Instead of:
> ```
> ./configure --prefix=3D/export/apps/singularity-install
> ```
> Specially if some binaries contain the path of some files like
> singularity.conf
> Sorry for this mistake.
>
> Best,
> R=C3=A9my
>
>
>
> 2017-06-06 16:55 GMT+02:00 Robert Kudyba <rku...@fordham.edu>:
>
>> I was able to delete everything except the var directory:
>> rmdir session/
>> rmdir: failed to remove `session/': Device or resource busy
>> pwd
>> /share/apps/var/singularity/mnt
>>
>> But deleting the source and recloning did get me further. On the head
>> node I can run singularity commands. But again on the desired node we=E2=
=80=99d
>> like to run this on we get this:
>>
>> ./singularity
>> Error loading functions: /export/apps/singularity-insta
>> ll/libexec/singularity/functions
>>
>> On the Rocks mailing list I as reminded to do this:
>> "You need to reference singularity (or any app for that matter) as
>> /share/apps and never /export/apps
>>
>> /export/apps only exists on the head node. "
>>
>> So the good news is once I redid everything to use /share/apps I was abl=
e
>> to get the singularity command to work on the compute node.
>>
>> So once I tried a command like: ./singularity run /share/apps/ubuntu.sim=
g
>>
>> groups: cannot find name for group ID 426
>>
>> It looks like I=E2=80=99m in a shell:
>> ls -l /singularity
>> lrwxrwxrwx 1 root root 24 Jun  6 14:46 /singularity ->
>> .singularity.d/runscript
>>
>> But is that error/warning normal?
>>
>>
>> On Jun 6, 2017, at 10:01 AM, R=C3=A9my Dernat <rem...@gmail.com> wrote:
>>
>> Hi,
>>
>> Try to remove every previous install and the install src directory. Then=
,
>> logout/login and clone singularity again. Finally, build it from a clean
>> environment.
>> Let us know if it solves your issue.
>>
>> Otherwise, it could be a bug. Try to create a symbolic link to
>> configuration file where it is searching (/etc/singularity/singularity.
>> conf).
>>
>> Best regards,
>> R=C3=A9my
>>
>> 2017-06-06 15:51 GMT+02:00 Robert Kudyba <rku...@fordham.edu>:
>>
>>> OK I did that but still getting the bathing error about the conf file. =
I
>>> did find a previous thread mentioning this https://groups.google.com
>>> /a/lbl.gov/forum/#!topic/singularity/mTPunMFQF4k
>>> <https://urldefense.proofpoint.com/v2/url?u=3Dhttps-3A__groups.google.c=
om_a_lbl.gov_forum_-23-21topic_singularity_mTPunMFQF4k&d=3DDwMFaQ&c=3DaqMfX=
OEvEJQh2iQMCb7Wy8l0sPnURkcqADc2guUW8IM&r=3DX0jL9y0sL4r4iU_qVtR3lLNo4tOL1ry_=
m7-psV3GejY&m=3D6bH1ymxbi1sjYEf1b1I5mFgmrV6i74K8qBLXr92Gwts&s=3D8idh7dZXYfl=
c0-GnBBay6ept9BXftZeazG5A09GHiNA&e=3D> but
>>> there=E2=80=99s no solution on how to point to an alternative location,=
 like a -c
>>> option. I updated the init file to add /export/apps/singularity-install
>>> to the $PATH.
>>>
>>>
>>> ./singularity --debug create /export/apps/ubuntu.simg
>>> Enabling debugging
>>> Ending argument loop
>>> Singularity version: 2.3-master.gda9cd20
>>> Exec'ing: /export/apps/singularity-install/libexec/singularity/cli/cre
>>> ate.exec
>>> VERBOSE [U=3D0,P=3D17149]      message_init()                          =
  Set
>>> messagelevel to: 5
>>> VERBOSE [U=3D0,P=3D17149]      singularity_config_parse()
>>> Initialize configuration file: /etc/singularity/singularity.conf
>>> ERROR   [U=3D0,P=3D17149]      singularity_config_parse()
>>> Specified configuration file /etc/singularity/singularity.conf does not
>>> appear to be a normal file.
>>> ERROR   [U=3D0,P=3D17149]      singularity_config_parse()
>>> Could not open configuration file /etc/singularity/singularity.conf: No
>>> such file or directory
>>> VERBOSE [U=3D0,P=3D17149]      singularity_registry_init()
>>> Initializing Singularity Registry
>>> VERBOSE [U=3D0,P=3D17149]      singularity_registry_set()
>>> Adding value to registry: 'WRITABLE' =3D '1'
>>> DEBUG   [U=3D0,P=3D17149]      singularity_registry_set()
>>> Returning singularity_registry_set(WRITABLE, 1) =3D 0
>>> VERBOSE [U=3D0,P=3D17149]      singularity_registry_set()
>>> Adding value to registry: 'LIBEXECDIR' =3D '/export/apps/singularity-in=
st
>>> all/libexec'
>>> DEBUG   [U=3D0,P=3D17149]      singularity_registry_set()
>>> Returning singularity_registry_set(libexecdir,
>>> /export/apps/singularity-install/libexec) =3D 0
>>> VERBOSE [U=3D0,P=3D17149]      singularity_registry_set()
>>> Adding value to registry: 'COMMAND' =3D 'create'
>>> DEBUG   [U=3D0,P=3D17149]      singularity_registry_set()
>>> Returning singularity_registry_set(COMMAND, create) =3D 0
>>> VERBOSE [U=3D0,P=3D17149]      singularity_registry_set()
>>> Adding value to registry: 'MESSAGELEVEL' =3D '5'
>>> DEBUG   [U=3D0,P=3D17149]      singularity_registry_set()
>>> Returning singularity_registry_set(MESSAGELEVEL, 5) =3D 0
>>> VERBOSE [U=3D0,P=3D17149]      singularity_registry_set()
>>> Adding value to registry: 'VERSION' =3D '2.3-master.gda9cd20'
>>> DEBUG   [U=3D0,P=3D17149]      singularity_registry_set()
>>> Returning singularity_registry_set(version, 2.3-master.gda9cd20) =3D 0
>>> VERBOSE [U=3D0,P=3D17149]      singularity_registry_set()
>>> Adding value to registry: 'LOCALSTATEDIR' =3D '/export/apps/singularity=
-inst
>>> all/var'
>>> DEBUG   [U=3D0,P=3D17149]      singularity_registry_set()
>>> Returning singularity_registry_set(localstatedir,
>>> /export/apps/singularity-install/var) =3D 0
>>> VERBOSE [U=3D0,P=3D17149]      singularity_registry_set()
>>> Adding value to registry: 'SYSCONFDIR' =3D '/export/apps/singularity-in=
st
>>> all/etc'
>>> DEBUG   [U=3D0,P=3D17149]      singularity_registry_set()
>>> Returning singularity_registry_set(sysconfdir,
>>> /export/apps/singularity-install/etc) =3D 0
>>> VERBOSE [U=3D0,P=3D17149]      singularity_registry_set()
>>> Adding value to registry: 'BINDIR' =3D '/export/apps/singularity-inst
>>> all/bin'
>>> DEBUG   [U=3D0,P=3D17149]      singularity_registry_set()
>>> Returning singularity_registry_set(bindir,
>>> /export/apps/singularity-install/bin) =3D 0
>>> VERBOSE [U=3D0,P=3D17149]      singularity_registry_set()
>>> Adding value to registry: 'IMAGE' =3D '/export/apps/ubuntu.simg'
>>> DEBUG   [U=3D0,P=3D17149]      singularity_registry_set()
>>> Returning singularity_registry_set(IMAGE, /export/apps/ubuntu.simg) =3D=
 0
>>> DEBUG   [U=3D0,P=3D17149]      singularity_registry_get()
>>> Returning NULL on 'HOME'
>>> DEBUG   [U=3D0,P=3D17149]      singularity_registry_get()
>>> Returning NULL on 'TARGET_UID'
>>> DEBUG   [U=3D0,P=3D17149]      singularity_registry_get()
>>> Returning NULL on 'TARGET_GID'
>>> DEBUG   [U=3D0,P=3D17149]      singularity_priv_init()
>>> Initializing user info
>>> DEBUG   [U=3D0,P=3D17149]      singularity_priv_init()                 =
  Set
>>> the calling user's username to: root
>>> DEBUG   [U=3D0,P=3D17149]      singularity_priv_init()
>>> Marking uinfo structure as ready
>>> DEBUG   [U=3D0,P=3D17149]      singularity_priv_init()
>>> Obtaining home directory
>>> VERBOSE [U=3D0,P=3D17149]      singularity_priv_init()                 =
  Set
>>> home (via getpwuid()) to: /root
>>> VERBOSE [U=3D0,P=3D17149]      singularity_suid_init()
>>> Running SUID program workflow
>>> VERBOSE [U=3D0,P=3D17149]      singularity_suid_init()
>>> Checking program has appropriate permissions
>>> VERBOSE [U=3D0,P=3D17149]      singularity_suid_init()
>>> Checking configuration file is properly owned by root
>>> ABORT   [U=3D0,P=3D17149]      singularity_suid_init()
>>> Running in privileged mode, root must own the Singularity configuration
>>> file: /etc/singularity/singularity.conf
>>> ABORT   [U=3D0,P=3D17149]      singularity_suid_init()
>>> Retval =3D 255
>>>
>>>
>>> On Jun 6, 2017, at 2:53 AM, R=C3=A9my Dernat <rem...@gmail.com> wrote:
>>>
>>> Hi Robert,
>>>
>>> You just have to install singularity on a NFS export; Replace:
>>>
>>> ```
>>>  ./configure --prefix=3D/export/apps/singularity-install --sysconfdir=
=3D/etc
>>> ```
>>> With:
>>> ```
>>>  ./configure --prefix=3D/export/apps/singularity-install
>>> ```
>>>
>>> Then, it should works as expected.
>>>
>>> Do not forget that some singularity commands, like `bootstrap` in 2.3 o=
r
>>> many more in previous release need sudo/root privileges.
>>>
>>> Best regards,
>>> R=C3=A9my
>>>
>>> 2017-06-05 23:09 GMT+02:00 Robert Kudyba <rku...@fordham.edu>:
>>>
>>>>
>>>> On Jun 5, 2017, at 4:30 PM, Rick Wagner <richard...@gmail.com>
>>>> wrote:
>>>>
>>>>
>>>> On Jun 5, 2017, at 4:13 PM, Robert Kudyba <rku...@fordham.edu> wrote:
>>>>
>>>>
>>>> On Jun 5, 2017, at 4:08 PM, Rick Wagner <richard...@gmail.com>
>>>> wrote:
>>>>
>>>> Robert,
>>>>
>>>> That=E2=80=99s an NFS export for the Rocks head node that may be mount=
ed nosuid
>>>>
>>>>
>>>> Right in /etc/fstab for other applications we already have this:
>>>>
>>>> UUID=3Dxxxxx /export                 ext4    defaults        1 2
>>>>
>>>> So what else needs to be done?
>>>>
>>>>
>>>> One option is to build an RPM using the spec file in the Singularity
>>>> repo and put that in contrib for your Rocks distro along with a packag=
e tag
>>>> in extend compute. That=E2=80=99s my preference because I don=E2=80=99=
t like serving
>>>> applications over NFS, especially ones with setuid.
>>>>
>>>> WARNING: the following will allow any executable with a setuid bit in
>>>> that NFS file system to be run.
>>>>
>>>> You can try changing defaults to defaults,suid and remounting the file
>>>> system on a compute node.
>>>>
>>>>
>>>> Is this an =E2=80=9Cor=E2=80=9D suggestion? I don=E2=80=99t have a pro=
blem with changing the
>>>> /etc/fstab. I did that and ran:
>>>>   rocks sync config
>>>>   rocks sync users
>>>>
>>>> Also made sure to use the config option as /share/apps (not
>>>> /export/apps as that=E2=80=99s just for the head node)
>>>>
>>>> Still getting:
>>>> /share/apps/bin
>>>> ./singularity shell /share/apps/ubuntu.simg
>>>> ERROR  : Session directory does not exist:
>>>> /export/apps/var/singularity/mnt/session
>>>> ABORT  : Retval =3D 255
>>>>
>>>> --
>>>> You received this message because you are subscribed to the Google
>>>> Groups "singularity" group.
>>>> To unsubscribe from this group and stop receiving emails from it, send
>>>> an email to singu...@lbl.gov.
>>>>
>>>
>>>
>>> --
>>> You received this message because you are subscribed to the Google
>>> Groups "singularity" group.
>>> To unsubscribe from this group and stop receiving emails from it, send
>>> an email to singu...@lbl.gov.
>>>
>>>
>>>
>>> --
>>> You received this message because you are subscribed to the Google
>>> Groups "singularity" group.
>>> To unsubscribe from this group and stop receiving emails from it, send
>>> an email to singu...@lbl.gov.
>>>
>>
>>
>> --
>> You received this message because you are subscribed to the Google Group=
s
>> "singularity" group.
>> To unsubscribe from this group and stop receiving emails from it, send a=
n
>> email to singu...@lbl.gov.
>>
>>
>>
>> --
>> You received this message because you are subscribed to the Google Group=
s
>> "singularity" group.
>> To unsubscribe from this group and stop receiving emails from it, send a=
n
>> email to singu...@lbl.gov.
>>
>
>
> --
> You received this message because you are subscribed to the Google Groups
> "singularity" group.
> To unsubscribe from this group and stop receiving emails from it, send an
> email to singu...@lbl.gov.
>
>
> --
> You received this message because you are subscribed to the Google Groups
> "singularity" group.
> To unsubscribe from this group and stop receiving emails from it, send an
> email to singu...@lbl.gov.
>



--=20
Vanessa Villamia Sochat
Stanford University '16
(603) 321-0676

--94eb2c061ec036c31e05514e1427
Content-Type: text/html; charset="UTF-8"
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr">Almost! To use -w you need to run as root:<div><br></div><=
div>sudo singularity run -w /share/apps/ubuntu.simg</div></div><div class=
=3D"gmail_extra"><br><div class=3D"gmail_quote">On Tue, Jun 6, 2017 at 9:04=
 AM, Robert Kudyba <span dir=3D"ltr">&lt;<a href=3D"mailto:rku...@fordham.e=
du" target=3D"_blank">rku...@fordham.edu</a>&gt;</span> wrote:<br><blockquo=
te class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc so=
lid;padding-left:1ex"><div style=3D"word-wrap:break-word">is this the corre=
ct usage of -w?<div><br></div><div><div style=3D"margin:0px;font-size:10px;=
line-height:normal;font-family:Menlo"><span style=3D"font-variant-ligatures=
:no-common-ligatures">./singularity run -w /share/apps/ubuntu.simg=C2=A0</s=
pan></div><div style=3D"margin:0px;font-size:10px;line-height:normal;font-f=
amily:Menlo;color:rgb(255,59,29)"><span style=3D"font-variant-ligatures:no-=
common-ligatures">ERROR=C2=A0 : Could not open image /share/apps/ubuntu.sim=
g: Permission denied</span></div><div style=3D"margin:0px;font-size:10px;li=
ne-height:normal;font-family:Menlo;color:rgb(195,55,32)"><span style=3D"fon=
t-variant-ligatures:no-common-ligatures">ABORT=C2=A0 : Retval =3D 255</span=
></div><div><div class=3D"h5"><div><span style=3D"font-variant-ligatures:no=
-common-ligatures"><br></span></div><div><span style=3D"font-variant-ligatu=
res:no-common-ligatures"><br></span></div><div><span style=3D"font-variant-=
ligatures:no-common-ligatures"><br></span></div><div><blockquote type=3D"ci=
te"><div>On Jun 6, 2017, at 11:18 AM, R=C3=A9my Dernat &lt;<a href=3D"mailt=
o:rem...@gmail.com" target=3D"_blank">rem...@gmail.com</a>&gt; wrote:</div>=
<br class=3D"m_1840847850162928191Apple-interchange-newline"><div><div dir=
=3D"ltr">I think you built your image on a machine with uid &quot;426&quot;=
 which is not present on the cluster, so, that&#39;s normal. You just have =
to enter in the container with &#39;-w&#39; flag in root, and edit permissi=
ons on your runscript to fit your user on the cluster side.<div><br></div><=
div>BTW, of course, normally, on Rocks, you had to build your image with:</=
div><div>```</div><div><span style=3D"font-family:Menlo;font-size:10px;font=
-variant-ligatures:no-common-ligatures">./configure --prefix=3D/share/apps/=
singular</span><span style=3D"font-family:Menlo;font-size:10px;font-variant=
-ligatures:no-common-ligatures">i<wbr>ty-install</span><br></div><div>```</=
div><div>Instead of:</div><div><div>```</div><div><span style=3D"font-famil=
y:Menlo;font-size:10px;font-variant-ligatures:no-common-ligatures">./config=
ure --prefix=3D/export/apps/singular</span><span style=3D"font-family:Menlo=
;font-size:10px;font-variant-ligatures:no-common-ligatures"><wbr>ity-instal=
l</span><br></div><div>```</div></div><div>Specially if some binaries conta=
in the path of some files like singularity.conf</div><div>Sorry for this mi=
stake.<br></div><div><br></div><div>Best,</div><div>R=C3=A9my</div><div><br=
></div><div><br></div></div><div class=3D"gmail_extra"><br><div class=3D"gm=
ail_quote">2017-06-06 16:55 GMT+02:00 Robert Kudyba <span dir=3D"ltr">&lt;<=
a href=3D"mailto:rku...@fordham.edu" target=3D"_blank">rku...@fordham.edu</=
a>&gt;</span>:<br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .=
8ex;border-left:1px #ccc solid;padding-left:1ex"><div style=3D"word-wrap:br=
eak-word"><div>I was able to delete everything except the var directory:=C2=
=A0</div><div><div style=3D"margin:0px;font-size:10px;line-height:normal;fo=
nt-family:Menlo"><span style=3D"font-variant-ligatures:no-common-ligatures"=
>rmdir session/</span></div><div style=3D"margin:0px;font-size:10px;line-he=
ight:normal;font-family:Menlo"><span style=3D"font-variant-ligatures:no-com=
mon-ligatures">rmdir: failed to remove `session/&#39;: Device or resource b=
usy</span></div><div style=3D"margin:0px;font-size:10px;line-height:normal;=
font-family:Menlo"><span style=3D"font-variant-ligatures:no-common-ligature=
s">pwd</span></div><div style=3D"margin:0px;font-size:10px;line-height:norm=
al;font-family:Menlo"><span style=3D"font-variant-ligatures:no-common-ligat=
ures">/share/apps/var/singularity/mn<wbr>t</span></div></div><div><span sty=
le=3D"font-variant-ligatures:no-common-ligatures"><br></span></div><div>But=
 deleting the source and recloning did get me further. On the head node I c=
an run singularity commands. But again on the desired node we=E2=80=99d lik=
e to run this on we get this:</div><div><br></div><div><div style=3D"margin=
:0px;font-size:10px;line-height:normal;font-family:Menlo"><span style=3D"fo=
nt-variant-ligatures:no-common-ligatures">./singularity=C2=A0</span></div><=
div style=3D"margin:0px;font-size:10px;line-height:normal;font-family:Menlo=
"><span style=3D"font-variant-ligatures:no-common-ligatures">Error loading =
functions: /export/apps/singularity-insta<wbr>ll/libexec/singularity/functi=
o<wbr>ns</span></div></div><div><br></div><div>On the Rocks mailing list I =
as reminded to do this:</div><div>&quot;You need to reference singularity (=
or any app for that matter) as /share/apps and never /export/apps<br><br>/e=
xport/apps only exists on the head node. &quot;</div><div><br></div><div>So=
 the good news is once I redid everything to use /share/apps I was able to =
get the singularity command to work on the compute node.</div><div><br></di=
v><div>So once I tried a command like:=C2=A0<span style=3D"font-family:Menl=
o;font-size:10px">./singularity run /share/apps/ubuntu.simg</span><span sty=
le=3D"font-family:Menlo;font-size:10px">=C2=A0</span></div><div style=3D"ma=
rgin:0px;font-size:10px;line-height:normal;font-family:Menlo"><span style=
=3D"font-variant-ligatures:no-common-ligatures">groups: cannot find name fo=
r group ID 426</span></div><div><br></div><div>It looks like I=E2=80=99m in=
 a shell:</div><div><div style=3D"margin:0px;font-size:10px;line-height:nor=
mal;font-family:Menlo"><span style=3D"font-variant-ligatures:no-common-liga=
tures">ls -l /singularity=C2=A0</span></div><div style=3D"margin:0px;font-s=
ize:10px;line-height:normal;font-family:Menlo"><span style=3D"font-variant-=
ligatures:no-common-ligatures">lrwxrwxrwx 1 root root 24 Jun=C2=A0 6 14:46 =
/singularity -&gt; .singularity.d/runscript</span></div></div><div><br></di=
v><div>But is that error/warning normal?</div><div><div class=3D"m_18408478=
50162928191h5"><div><br></div><br><div><blockquote type=3D"cite"><div>On Ju=
n 6, 2017, at 10:01 AM, R=C3=A9my Dernat &lt;<a href=3D"mailto:rem...@gmail=
.com" target=3D"_blank">rem...@gmail.com</a>&gt; wrote:</div><br class=3D"m=
_1840847850162928191m_-672932233201048330Apple-interchange-newline"><div><d=
iv dir=3D"ltr">Hi,<div><br></div><div>Try to remove every previous install =
and the install src directory. Then, logout/login and clone singularity aga=
in. Finally, build it from a clean environment.</div><div>Let us know if it=
 solves your issue.</div><div><br></div><div>Otherwise, it could be a bug. =
Try to create a symbolic link to configuration file where it is searching (=
/etc/singularity/singularity.<wbr>conf).</div><div><br></div><div>Best rega=
rds,</div><div>R=C3=A9my</div></div><div class=3D"gmail_extra"><br><div cla=
ss=3D"gmail_quote">2017-06-06 15:51 GMT+02:00 Robert Kudyba <span dir=3D"lt=
r">&lt;<a href=3D"mailto:rku...@fordham.edu" target=3D"_blank">rku...@fordh=
am.edu</a>&gt;</span>:<br><blockquote class=3D"gmail_quote" style=3D"margin=
:0 0 0 .8ex;border-left:1px #ccc solid;padding-left:1ex"><div style=3D"word=
-wrap:break-word"><div>OK I did that but still getting the bathing error ab=
out the conf file. I did find a previous thread mentioning this=C2=A0<a hre=
f=3D"https://urldefense.proofpoint.com/v2/url?u=3Dhttps-3A__groups.google.c=
om_a_lbl.gov_forum_-23-21topic_singularity_mTPunMFQF4k&amp;d=3DDwMFaQ&amp;c=
=3DaqMfXOEvEJQh2iQMCb7Wy8l0sPnURkcqADc2guUW8IM&amp;r=3DX0jL9y0sL4r4iU_qVtR3=
lLNo4tOL1ry_m7-psV3GejY&amp;m=3D6bH1ymxbi1sjYEf1b1I5mFgmrV6i74K8qBLXr92Gwts=
&amp;s=3D8idh7dZXYflc0-GnBBay6ept9BXftZeazG5A09GHiNA&amp;e=3D" target=3D"_b=
lank">https://groups.google.com<wbr>/a/lbl.gov/forum/#!topic/singu<wbr>lari=
ty/mTPunMFQF4k</a>=C2=A0but there=E2=80=99s no solution on how to point to =
an alternative location, like a -c option. I updated the init file to add /=
export/apps/singularity-insta<wbr>ll to the $PATH.</div><div><br></div><div=
><br></div><div><div style=3D"margin:0px;font-size:10px;line-height:normal;=
font-family:Menlo"><span style=3D"font-variant-ligatures:no-common-ligature=
s">./singularity --debug create /export/apps/ubuntu.simg</span></div><div s=
tyle=3D"margin:0px;font-size:10px;line-height:normal;font-family:Menlo"><sp=
an style=3D"font-variant-ligatures:no-common-ligatures">Enabling debugging<=
/span></div><div style=3D"margin:0px;font-size:10px;line-height:normal;font=
-family:Menlo"><span style=3D"font-variant-ligatures:no-common-ligatures">E=
nding argument loop</span></div><div style=3D"margin:0px;font-size:10px;lin=
e-height:normal;font-family:Menlo"><span style=3D"font-variant-ligatures:no=
-common-ligatures">Singularity version: 2.3-master.gda9cd20</span></div><di=
v style=3D"margin:0px;font-size:10px;line-height:normal;font-family:Menlo">=
<span style=3D"font-variant-ligatures:no-common-ligatures">Exec&#39;ing: /e=
xport/apps/singularity-insta<wbr>ll/libexec/singularity/cli/cre<wbr>ate.exe=
c</span></div><div style=3D"margin:0px;font-size:10px;line-height:normal;fo=
nt-family:Menlo"><span style=3D"font-variant-ligatures:no-common-ligatures"=
>VERBOSE [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 message_init()=C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 Set messagelevel to: 5</span></div><div style=3D"margin:0px;font=
-size:10px;line-height:normal;font-family:Menlo"><span style=3D"font-varian=
t-ligatures:no-common-ligatures">VERBOSE [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=
=A0 singularity_config_parse()=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 Initialize configuration file: /etc/singularity/singularity.c<wb=
r>onf</span></div><div style=3D"margin:0px;font-size:10px;line-height:norma=
l;font-family:Menlo;color:rgb(255,59,29)"><span style=3D"font-variant-ligat=
ures:no-common-ligatures">ERROR =C2=A0 [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=
=A0 singularity_config_parse()=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 Specified configuration file /etc/singularity/singularity.c<wbr>=
onf does not appear to be a normal file.</span></div><div style=3D"margin:0=
px;font-size:10px;line-height:normal;font-family:Menlo;color:rgb(255,59,29)=
"><span style=3D"font-variant-ligatures:no-common-ligatures">ERROR =C2=A0 [=
U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_config_parse()=C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Could not open configuration =
file /etc/singularity/singularity.c<wbr>onf: No such file or directory</spa=
n></div><div style=3D"margin:0px;font-size:10px;line-height:normal;font-fam=
ily:Menlo"><span style=3D"font-variant-ligatures:no-common-ligatures">VERBO=
SE [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_registry_init() =C2=A0=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Initializing Singularity Registr=
y</span></div><div style=3D"margin:0px;font-size:10px;line-height:normal;fo=
nt-family:Menlo"><span style=3D"font-variant-ligatures:no-common-ligatures"=
>VERBOSE [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_registry_set()=
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Adding value to reg=
istry: &#39;WRITABLE&#39; =3D &#39;1&#39;</span></div><div style=3D"margin:=
0px;font-size:10px;line-height:normal;font-family:Menlo"><span style=3D"fon=
t-variant-ligatures:no-common-ligatures">DEBUG =C2=A0 [U=3D0,P=3D17149]=C2=
=A0 =C2=A0 =C2=A0 singularity_registry_set()=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 Returning singularity_registry_set(WRITA<wbr>BLE, =
1) =3D 0</span></div><div style=3D"margin:0px;font-size:10px;line-height:no=
rmal;font-family:Menlo"><span style=3D"font-variant-ligatures:no-common-lig=
atures">VERBOSE [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_registry_=
set()=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Adding value t=
o registry: &#39;LIBEXECDIR&#39; =3D &#39;/export/apps/singularity-inst<wbr=
>all/libexec&#39;</span></div><div style=3D"margin:0px;font-size:10px;line-=
height:normal;font-family:Menlo"><span style=3D"font-variant-ligatures:no-c=
ommon-ligatures">DEBUG =C2=A0 [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singula=
rity_registry_set()=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
Returning singularity_registry_set(libex<wbr>ecdir, /export/apps/singularit=
y-insta<wbr>ll/libexec) =3D 0</span></div><div style=3D"margin:0px;font-siz=
e:10px;line-height:normal;font-family:Menlo"><span style=3D"font-variant-li=
gatures:no-common-ligatures">VERBOSE [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 =
singularity_registry_set()=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 Adding value to registry: &#39;COMMAND&#39; =3D &#39;create&#39;</sp=
an></div><div style=3D"margin:0px;font-size:10px;line-height:normal;font-fa=
mily:Menlo"><span style=3D"font-variant-ligatures:no-common-ligatures">DEBU=
G =C2=A0 [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_registry_set()=
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Returning singulari=
ty_registry_set(COMMA<wbr>ND, create) =3D 0</span></div><div style=3D"margi=
n:0px;font-size:10px;line-height:normal;font-family:Menlo"><span style=3D"f=
ont-variant-ligatures:no-common-ligatures">VERBOSE [U=3D0,P=3D17149]=C2=A0 =
=C2=A0 =C2=A0 singularity_registry_set()=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 Adding value to registry: &#39;MESSAGELEVEL&#39; =3D &=
#39;5&#39;</span></div><div style=3D"margin:0px;font-size:10px;line-height:=
normal;font-family:Menlo"><span style=3D"font-variant-ligatures:no-common-l=
igatures">DEBUG =C2=A0 [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_re=
gistry_set()=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Returni=
ng singularity_registry_set(MESSA<wbr>GELEVEL, 5) =3D 0</span></div><div st=
yle=3D"margin:0px;font-size:10px;line-height:normal;font-family:Menlo"><spa=
n style=3D"font-variant-ligatures:no-common-ligatures">VERBOSE [U=3D0,P=3D1=
7149]=C2=A0 =C2=A0 =C2=A0 singularity_registry_set()=C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Adding value to registry: &#39;VERSION&#=
39; =3D &#39;2.3-master.gda9cd20&#39;</span></div><div style=3D"margin:0px;=
font-size:10px;line-height:normal;font-family:Menlo"><span style=3D"font-va=
riant-ligatures:no-common-ligatures">DEBUG =C2=A0 [U=3D0,P=3D17149]=C2=A0 =
=C2=A0 =C2=A0 singularity_registry_set()=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 Returning singularity_registry_set(versi<wbr>on, 2.3-m=
aster.gda9cd20) =3D 0</span></div><div style=3D"margin:0px;font-size:10px;l=
ine-height:normal;font-family:Menlo"><span style=3D"font-variant-ligatures:=
no-common-ligatures">VERBOSE [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singular=
ity_registry_set()=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 A=
dding value to registry: &#39;LOCALSTATEDIR&#39; =3D &#39;/export/apps/sing=
ularity-inst<wbr>all/var&#39;</span></div><div style=3D"margin:0px;font-siz=
e:10px;line-height:normal;font-family:Menlo"><span style=3D"font-variant-li=
gatures:no-common-ligatures">DEBUG =C2=A0 [U=3D0,P=3D17149]=C2=A0 =C2=A0 =
=C2=A0 singularity_registry_set()=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 Returning singularity_registry_set(local<wbr>statedir, /expor=
t/apps/singularity-insta<wbr>ll/var) =3D 0</span></div><div style=3D"margin=
:0px;font-size:10px;line-height:normal;font-family:Menlo"><span style=3D"fo=
nt-variant-ligatures:no-common-ligatures">VERBOSE [U=3D0,P=3D17149]=C2=A0 =
=C2=A0 =C2=A0 singularity_registry_set()=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 Adding value to registry: &#39;SYSCONFDIR&#39; =3D &#3=
9;/export/apps/singularity-inst<wbr>all/etc&#39;</span></div><div style=3D"=
margin:0px;font-size:10px;line-height:normal;font-family:Menlo"><span style=
=3D"font-variant-ligatures:no-common-ligatures">DEBUG =C2=A0 [U=3D0,P=3D171=
49]=C2=A0 =C2=A0 =C2=A0 singularity_registry_set()=C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Returning singularity_registry_set(sysco<wb=
r>nfdir, /export/apps/singularity-insta<wbr>ll/etc) =3D 0</span></div><div =
style=3D"margin:0px;font-size:10px;line-height:normal;font-family:Menlo"><s=
pan style=3D"font-variant-ligatures:no-common-ligatures">VERBOSE [U=3D0,P=
=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_registry_set()=C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Adding value to registry: &#39;BINDI=
R&#39; =3D &#39;/export/apps/singularity-inst<wbr>all/bin&#39;</span></div>=
<div style=3D"margin:0px;font-size:10px;line-height:normal;font-family:Menl=
o"><span style=3D"font-variant-ligatures:no-common-ligatures">DEBUG =C2=A0 =
[U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_registry_set()=C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Returning singularity_registr=
y_set(bindi<wbr>r, /export/apps/singularity-insta<wbr>ll/bin) =3D 0</span><=
/div><div style=3D"margin:0px;font-size:10px;line-height:normal;font-family=
:Menlo"><span style=3D"font-variant-ligatures:no-common-ligatures">VERBOSE =
[U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_registry_set()=C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Adding value to registry: &#3=
9;IMAGE&#39; =3D &#39;/export/apps/ubuntu.simg&#39;</span></div><div style=
=3D"margin:0px;font-size:10px;line-height:normal;font-family:Menlo"><span s=
tyle=3D"font-variant-ligatures:no-common-ligatures">DEBUG =C2=A0 [U=3D0,P=
=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_registry_set()=C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Returning singularity_registry_set(I=
MAGE<wbr>, /export/apps/ubuntu.simg) =3D 0</span></div><div style=3D"margin=
:0px;font-size:10px;line-height:normal;font-family:Menlo"><span style=3D"fo=
nt-variant-ligatures:no-common-ligatures">DEBUG =C2=A0 [U=3D0,P=3D17149]=C2=
=A0 =C2=A0 =C2=A0 singularity_registry_get()=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 Returning NULL on &#39;HOME&#39;</span></div><div =
style=3D"margin:0px;font-size:10px;line-height:normal;font-family:Menlo"><s=
pan style=3D"font-variant-ligatures:no-common-ligatures">DEBUG =C2=A0 [U=3D=
0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_registry_get()=C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Returning NULL on &#39;TARGET_UID=
&#39;</span></div><div style=3D"margin:0px;font-size:10px;line-height:norma=
l;font-family:Menlo"><span style=3D"font-variant-ligatures:no-common-ligatu=
res">DEBUG =C2=A0 [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_registr=
y_get()=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Returning NU=
LL on &#39;TARGET_GID&#39;</span></div><div style=3D"margin:0px;font-size:1=
0px;line-height:normal;font-family:Menlo"><span style=3D"font-variant-ligat=
ures:no-common-ligatures">DEBUG =C2=A0 [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=
=A0 singularity_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 Initializing user info</span></div><div style=3D"margin:0=
px;font-size:10px;line-height:normal;font-family:Menlo"><span style=3D"font=
-variant-ligatures:no-common-ligatures">DEBUG =C2=A0 [U=3D0,P=3D17149]=C2=
=A0 =C2=A0 =C2=A0 singularity_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Set the calling user&#39;s username to: roo=
t</span></div><div style=3D"margin:0px;font-size:10px;line-height:normal;fo=
nt-family:Menlo"><span style=3D"font-variant-ligatures:no-common-ligatures"=
>DEBUG =C2=A0 [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_priv_init()=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Marking uin=
fo structure as ready</span></div><div style=3D"margin:0px;font-size:10px;l=
ine-height:normal;font-family:Menlo"><span style=3D"font-variant-ligatures:=
no-common-ligatures">DEBUG =C2=A0 [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 sin=
gularity_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 Obtaining home directory</span></div><div style=3D"margin:0px;fo=
nt-size:10px;line-height:normal;font-family:Menlo"><span style=3D"font-vari=
ant-ligatures:no-common-ligatures">VERBOSE [U=3D0,P=3D17149]=C2=A0 =C2=A0 =
=C2=A0 singularity_priv_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 Set home (via getpwuid()) to: /root</span></div><div s=
tyle=3D"margin:0px;font-size:10px;line-height:normal;font-family:Menlo"><sp=
an style=3D"font-variant-ligatures:no-common-ligatures">VERBOSE [U=3D0,P=3D=
17149]=C2=A0 =C2=A0 =C2=A0 singularity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Running SUID program workflow</span>=
</div><div style=3D"margin:0px;font-size:10px;line-height:normal;font-famil=
y:Menlo"><span style=3D"font-variant-ligatures:no-common-ligatures">VERBOSE=
 [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_suid_init() =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Checking program has a=
ppropriate permissions</span></div><div style=3D"margin:0px;font-size:10px;=
line-height:normal;font-family:Menlo"><span style=3D"font-variant-ligatures=
:no-common-ligatures">VERBOSE [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singula=
rity_suid_init() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 Checking configuration file is properly owned by root</span></div><d=
iv style=3D"margin:0px;font-size:10px;line-height:normal;font-family:Menlo;=
color:rgb(195,55,32)"><span style=3D"font-variant-ligatures:no-common-ligat=
ures">ABORT =C2=A0 [U=3D0,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_suid_i=
nit() =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Runnin=
g in privileged mode, root must own the Singularity configuration file: /et=
c/singularity/singularity.c<wbr>onf</span></div><div style=3D"margin:0px;fo=
nt-size:10px;line-height:normal;font-family:Menlo;color:rgb(195,55,32)"><sp=
an style=3D"font-variant-ligatures:no-common-ligatures">ABORT =C2=A0 [U=3D0=
,P=3D17149]=C2=A0 =C2=A0 =C2=A0 singularity_suid_init() =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 Retval =3D 255</span></div></=
div><div><div class=3D"m_1840847850162928191m_-672932233201048330h5"><div><=
span style=3D"font-variant-ligatures:no-common-ligatures"><br></span></div>=
<br><div><blockquote type=3D"cite"><div>On Jun 6, 2017, at 2:53 AM, R=C3=A9=
my Dernat &lt;<a href=3D"mailto:rem...@gmail.com" target=3D"_blank">rem...@=
gmail.com</a>&gt; wrote:</div><br class=3D"m_1840847850162928191m_-67293223=
3201048330m_9141356409832340507Apple-interchange-newline"><div><div dir=3D"=
ltr">Hi Robert,<div><br></div><div>You just have to install singularity on =
a NFS export; Replace:</div><div><br></div><div>```</div><div><span style=
=3D"font-variant-ligatures:no-common-ligatures;font-family:Menlo;font-size:=
10px">=C2=A0</span><span style=3D"font-variant-ligatures:no-common-ligature=
s;font-family:Menlo;font-size:10px">./configure --prefix=3D/export/apps/sin=
gular<wbr>ity-install --sysconfdir=3D/etc</span><br></div><div>```</div><di=
v>With:</div><div>```</div><div><span style=3D"font-variant-ligatures:no-co=
mmon-ligatures;font-family:Menlo;font-size:10px">=C2=A0</span><span style=
=3D"font-variant-ligatures:no-common-ligatures;font-family:Menlo;font-size:=
10px">./configure --prefix=3D/export/apps/singular<wbr>ity-install</span><b=
r></div><div>```</div><div><br></div><div>Then, it should works as expected=
.</div><div><br></div><div>Do not forget that some singularity commands, li=
ke `bootstrap` in 2.3 or many more in previous release need sudo/root privi=
leges.</div><div><br></div><div>Best regards,<br>R=C3=A9my</div></div><div =
class=3D"gmail_extra"><br><div class=3D"gmail_quote">2017-06-05 23:09 GMT+0=
2:00 Robert Kudyba <span dir=3D"ltr">&lt;<a href=3D"mailto:rku...@fordham.e=
du" target=3D"_blank">rku...@fordham.edu</a>&gt;</span>:<br><blockquote cla=
ss=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;pa=
dding-left:1ex"><div style=3D"word-wrap:break-word"><span><br><div><blockqu=
ote type=3D"cite"><div>On Jun 5, 2017, at 4:30 PM, Rick Wagner &lt;<a href=
=3D"mailto:richard...@gmail.com" target=3D"_blank">richard...@gmail.com</a>=
&gt; wrote:</div><br class=3D"m_1840847850162928191m_-672932233201048330m_9=
141356409832340507m_-5619588665609687384Apple-interchange-newline"><div><di=
v style=3D"word-wrap:break-word"><br><div><blockquote type=3D"cite"><div>On=
 Jun 5, 2017, at 4:13 PM, Robert Kudyba &lt;<a href=3D"mailto:rku...@fordha=
m.edu" target=3D"_blank">rku...@fordham.edu</a>&gt; wrote:</div><br class=
=3D"m_1840847850162928191m_-672932233201048330m_9141356409832340507m_-56195=
88665609687384Apple-interchange-newline"><div><div style=3D"word-wrap:break=
-word"><br><div><blockquote type=3D"cite"><div>On Jun 5, 2017, at 4:08 PM, =
Rick Wagner &lt;<a href=3D"mailto:richard...@gmail.com" target=3D"_blank">r=
ichard...@gmail.com</a>&gt; wrote:</div><br class=3D"m_1840847850162928191m=
_-672932233201048330m_9141356409832340507m_-5619588665609687384Apple-interc=
hange-newline"><div><div style=3D"word-wrap:break-word"><div>Robert,</div><=
div><br></div><div>That=E2=80=99s an NFS export for the Rocks head node tha=
t may be mounted nosuid</div></div></div></blockquote><br></div><div>Right =
in /etc/fstab for other applications we already have this:</div><div><br></=
div><div><div style=3D"margin:0px;font-size:10px;line-height:normal;font-fa=
mily:Menlo"><span style=3D"font-variant-ligatures:no-common-ligatures">UUID=
=3Dxxxxx /export =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 ex=
t4=C2=A0 =C2=A0 defaults=C2=A0 =C2=A0 =C2=A0 =C2=A0 1 2</span></div><div><s=
pan style=3D"font-variant-ligatures:no-common-ligatures"><br></span></div><=
/div>So what else needs to be done?</div></div></blockquote><div><br></div>=
<div>One option is to build an RPM using the spec file in the Singularity r=
epo and put that in contrib for your Rocks distro along with a package tag =
in extend compute. That=E2=80=99s my preference because I don=E2=80=99t lik=
e serving applications over NFS, especially ones with setuid.</div><div><br=
></div><div>WARNING: the following will allow any executable with a setuid =
bit in that NFS file system to be run.</div><div><br></div><div>You can try=
 changing defaults to defaults,suid and remounting the file system on a com=
pute node.</div></div></div></div></blockquote><br></div></span><div>Is thi=
s an =E2=80=9Cor=E2=80=9D suggestion? I don=E2=80=99t have a problem with c=
hanging the /etc/fstab. I did that and ran:</div><div><div style=3D"margin:=
0px;font-size:10px;line-height:normal;font-family:Menlo"><span style=3D"fon=
t-variant-ligatures:no-common-ligatures">=C2=A0=C2=A0rocks sync config</spa=
n></div><div style=3D"margin:0px;font-size:10px;line-height:normal;font-fam=
ily:Menlo"><span style=3D"font-variant-ligatures:no-common-ligatures">=C2=
=A0 rocks sync users</span></div><div style=3D"margin:0px;font-size:10px;li=
ne-height:normal;font-family:Menlo"><br></div></div>Also made sure to use t=
he config option as /share/apps (not /export/apps as that=E2=80=99s just fo=
r the head node)<div><br></div><div>Still getting:</div><div><div><div styl=
e=3D"margin:0px;font-size:10px;line-height:normal;font-family:Menlo"><span =
style=3D"font-variant-ligatures:no-common-ligatures">/share/apps/bin</span>=
</div></div><div><div style=3D"margin:0px;font-size:10px;line-height:normal=
;font-family:Menlo"><div style=3D"margin:0px;line-height:normal"><span styl=
e=3D"font-variant-ligatures:no-common-ligatures">./singularity shell /share=
/apps/ubuntu.simg</span></div><span><div style=3D"margin:0px;line-height:no=
rmal;color:rgb(255,59,29)"><span style=3D"font-variant-ligatures:no-common-=
ligatures">ERROR=C2=A0 : Session directory does not exist: /export/apps/var=
/singularity/m<wbr>nt/session</span></div><div style=3D"margin:0px;line-hei=
ght:normal;color:rgb(195,55,32)"><span style=3D"font-variant-ligatures:no-c=
ommon-ligatures">ABORT=C2=A0 : Retval =3D 255</span></div></span></div></di=
v></div></div><div><br class=3D"m_1840847850162928191m_-672932233201048330m=
_9141356409832340507webkit-block-placeholder"></div>

-- <br><div class=3D"m_1840847850162928191m_-672932233201048330m_9141356409=
832340507HOEnZb"><div class=3D"m_1840847850162928191m_-672932233201048330m_=
9141356409832340507h5">
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.go<wbr>v</a>.<br>
</div></div></blockquote></div><br></div><div><br class=3D"m_18408478501629=
28191m_-672932233201048330m_9141356409832340507webkit-block-placeholder"></=
div>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.go<wbr>v</a>.<br>
</div></blockquote></div><br></div></div></div><div class=3D"m_184084785016=
2928191m_-672932233201048330HOEnZb"><div class=3D"m_1840847850162928191m_-6=
72932233201048330h5"><div><br class=3D"m_1840847850162928191m_-672932233201=
048330webkit-block-placeholder"></div>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.go<wbr>v</a>.<br>
</div></div></blockquote></div><br></div><div><br class=3D"m_18408478501629=
28191m_-672932233201048330webkit-block-placeholder"></div>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.go<wbr>v</a>.<br>
</div></blockquote></div><br></div></div></div><div class=3D"m_184084785016=
2928191HOEnZb"><div class=3D"m_1840847850162928191h5"><div><br class=3D"m_1=
840847850162928191webkit-block-placeholder"></div>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.go<wbr>v</a>.<br>
</div></div></blockquote></div><br></div><div><br class=3D"m_18408478501629=
28191webkit-block-placeholder"></div>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.<wbr>gov</a>.<br>
</div></blockquote></div><br></div></div></div></div><div class=3D"HOEnZb">=
<div class=3D"h5">

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.<wbr>gov</a>.<br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
<div class=3D"gmail_signature" data-smartmail=3D"gmail_signature">Vanessa V=
illamia Sochat<br>Stanford University &#39;16<br><div><div><div>(603) 321-0=
676</div></div></div></div>
</div>

--94eb2c061ec036c31e05514e1427--
