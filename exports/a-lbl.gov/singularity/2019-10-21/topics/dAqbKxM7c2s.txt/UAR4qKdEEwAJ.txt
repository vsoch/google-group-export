X-Received: by 10.237.49.66 with SMTP id 60mr1395587qtg.57.1487714537113;
        Tue, 21 Feb 2017 14:02:17 -0800 (PST)
X-BeenThere: singularity@lbl.gov
Received: by 10.107.157.138 with SMTP id g132ls3889601ioe.5.gmail; Tue, 21 Feb
 2017 14:02:16 -0800 (PST)
X-Received: by 10.98.63.140 with SMTP id z12mr19134346pfj.129.1487714536128;
        Tue, 21 Feb 2017 14:02:16 -0800 (PST)
Return-Path: <gmku...@lbl.gov>
Received: from fe4.lbl.gov (fe4.lbl.gov. [128.3.41.71])
        by mx.google.com with ESMTP id w7si23117954pgw.107.2017.02.21.14.02.15
        for <singu...@lbl.gov>;
        Tue, 21 Feb 2017 14:02:16 -0800 (PST)
Received-SPF: pass (google.com: domain of gmku...@lbl.gov designates 209.85.213.200 as permitted sender) client-ip=209.85.213.200;
Authentication-Results: mx.google.com;
       spf=pass (google.com: domain of gmku...@lbl.gov designates 209.85.213.200 as permitted sender) smtp.mailfrom=gmku...@lbl.gov
X-Ironport-SBRS: 2.7
X-IronPort-Anti-Spam-Filtered: true
X-IronPort-Anti-Spam-Result: A2FqAADBt6xYf8jVVdFeHAEBBAEBCgEBFwEBBAEBCgEBgkSBQ3gRB4NMCIoIkhaCZIUojSiBShslAx8BBoFzgi+BWgKCagc/GAEBAQEBAQEBAQEBAhABAQkLCwobMYIzBAIDGQUEBD0KAy4BAQEBAQEBAQEBAQEBAQEBGgINIg8DKQEBAQMBGgkrMAsJAgsNIAEJAgIhAQ8DAQUBCxEGCAcEARwEiGtKAw0IBZFIkRY/jAOCJoc7DYN3AQEBAQYBAQEBAQEiEospglGBVREBgyKCXwWJDweHMYUbhW86AYZzhxCEG4F7U4EHg0KDUIYoiDWCDYccFB6BFQ8QgQIvCBkJN2QFg3U5HYICHzUHiAVHgWcBAQE
X-IronPort-AV: E=Sophos;i="5.35,191,1484035200"; 
   d="scan'208,217";a="64878790"
Received: from mail-yb0-f200.google.com ([209.85.213.200])
  by fe4.lbl.gov with ESMTP; 21 Feb 2017 14:02:10 -0800
Received: by mail-yb0-f200.google.com with SMTP id i66so195095549yba.4
        for <singu...@lbl.gov>; Tue, 21 Feb 2017 14:02:10 -0800 (PST)
X-Gm-Message-State: AMke39k/auhLgc9TeNFZv9q80qbwoCQqfZK7u09+7VbDOzwfdjc7PajW1p5RNe0G0evsMaG5Ar9hWzvqMQoyClMOKzh9YA4XneK4svX1JgS7A86uwdBqnqRIoxuJFXCg/NOwUQOA3/BXq5PZ9woEDsM+z04=
X-Received: by 10.13.249.130 with SMTP id j124mr23553984ywf.124.1487714529871;
        Tue, 21 Feb 2017 14:02:09 -0800 (PST)
X-Received: by 10.13.249.130 with SMTP id j124mr23553959ywf.124.1487714529518;
 Tue, 21 Feb 2017 14:02:09 -0800 (PST)
MIME-Version: 1.0
Received: by 10.129.110.69 with HTTP; Tue, 21 Feb 2017 14:02:08 -0800 (PST)
In-Reply-To: <CAO+LYDX+2A6+h7Tuz315YsriCzczTG7eEBy2JU=VDoe_5W2pmg@mail.gmail.com>
References: <CAJm6r9-oXj4pPnoDY48u1Sf58dHtavBCF25Ca3QuxegqiHOkog@mail.gmail.com>
 <23dd4099-4149-4296-b9f7-a3e90cb21840@lbl.gov> <3d1f4bbd-5f5c-44d2-989d-32c899f7a432@lbl.gov>
 <CAKswpQhoxBV+neT+PwpXQVJB=Ow3F23xkB=gPn8grkz4n96-0g@mail.gmail.com>
 <CAO+LYDWC5FZrhH-dcWUmRDFdfQciaC2_NQYZFFV7WxN9tLuGfQ@mail.gmail.com>
 <CACtFfPFbueOmTpXxpfL6RxBKb7zbmtayuDXH+RHM1FSN=mqkdQ@mail.gmail.com>
 <CAN7etTzkMFyMofc05A8vhuRj4MXCD+oHOLKZUG+NcwguwTHqHA@mail.gmail.com> <CAO+LYDX+2A6+h7Tuz315YsriCzczTG7eEBy2JU=VDoe_5W2pmg@mail.gmail.com>
From: "Gregory M. Kurtzer" <gmku...@lbl.gov>
Date: Tue, 21 Feb 2017 14:02:08 -0800
Message-ID: <CAN7etTzDLGE7YgWQwHZHk+349RVDd_CiuAhG3KepB4bDAq5bhQ@mail.gmail.com>
Subject: Re: [Singularity] Not able to return with MVAPICH2
To: singularity <singu...@lbl.gov>
Content-Type: multipart/alternative; boundary=94eb2c0826b00f7413054911886c

--94eb2c0826b00f7413054911886c
Content-Type: text/plain; charset=UTF-8

BTW, you might be able to avoid the zombie if you run it like:

$ mpirun_rsh -np 1 localhost SINGULARITY_NOSESSIONCLEANUP=1 singularity
exec /tmp/user.img date

NOSESSIONCLEANUP inhibits the session thread which cleanups after the
container exits.



On Tue, Feb 21, 2017 at 1:13 PM, Xiaoyi Lu@gmail <cheri...@gmail.com>
wrote:

> Thanks for the update, Greg. This is good to know.
>
> Xiaoyi
>
> On Tue, Feb 21, 2017 at 4:10 PM, Gregory M. Kurtzer <gmku...@lbl.gov>
> wrote:
>
>> Hello,
>>
>> I did a quick verification of what you described using MVAPICH2 and the
>> latest lib-refactor code I'm working on. It seems that there is a conflict
>> somehow with MVAPICH2 and how we are managing the signal handler pipes as
>> if I avoid Singularity's forking, I can circumvent the issue.
>>
>> Brian and I spoke about it and one or both of us will hopefully have time
>> to debug this in more detail shortly.
>>
>> Thanks!
>>
>> On Mon, Feb 6, 2017 at 12:41 PM, Jie Zhang <jessezh...@gmail.com>
>> wrote:
>>
>>> Hi, Brian,
>>>
>>> For #1, the results are basically as what we knew.
>>>
>>> zhanjie   4178  0.0  0.0  34976  1340 pts/0    Sl+  13:07   0:00  |
>>>               \_ /home/zhanjie/singularity/master.install/bin/mpispawn 0
>>> zhanjie   4180  0.0  0.0   5432  1688 pts/0    S+   13:07   0:00  |
>>>                   \_ /usr/local/libexec/singularity/sexec date
>>> zhanjie   4183  0.6  0.0      0     0 pts/0    Z+   13:07   0:00  |
>>>                            \_ [date] <defunct>
>>>
>>> For #2, I run `mpirun_rsh -np 1 sandy4 /usr/local/bin/singularity exec
>>> singularity-centos7.img strace date'. It's stuck at the end, even though it
>>> shows `+++ exited with 0 +++'.
>>>
>>> action_exec_do /usr/local/libexec/singularity/sexec strace
>>> execve("/usr/bin/date", ["date"], [/* 87 vars */]) = 0
>>> brk(0)                                  = 0x2462000
>>> mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0)
>>> = 0x7f3284495000
>>> access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or
>>> directory)
>>> open("/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 6
>>> fstat(6, {st_mode=S_IFREG|0644, st_size=15081, ...}) = 0
>>> mmap(NULL, 15081, PROT_READ, MAP_PRIVATE, 6, 0) = 0x7f3284491000
>>> close(6)                                = 0
>>> open("/lib64/libc.so.6", O_RDONLY|O_CLOEXEC) = 6
>>> read(6, "\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0>\0\1\0\0\0
>>> \34\2\0\0\0\0\0"..., 832) = 832
>>> fstat(6, {st_mode=S_IFREG|0755, st_size=2112384, ...}) = 0
>>> mmap(NULL, 3936832, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 6,
>>> 0) = 0x7f3283eb3000
>>> mprotect(0x7f328406a000, 2097152, PROT_NONE) = 0
>>> mmap(0x7f328426a000, 24576, PROT_READ|PROT_WRITE,
>>> MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 6, 0x1b7000) = 0x7f328426a000
>>> mmap(0x7f3284270000, 16960, PROT_READ|PROT_WRITE,
>>> MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f3284270000
>>> close(6)                                = 0
>>> mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0)
>>> = 0x7f3284490000
>>> mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0)
>>> = 0x7f328448e000
>>> arch_prctl(ARCH_SET_FS, 0x7f328448e740) = 0
>>> mprotect(0x7f328426a000, 16384, PROT_READ) = 0
>>> mprotect(0x60d000, 4096, PROT_READ)     = 0
>>> mprotect(0x7f3284496000, 4096, PROT_READ) = 0
>>> munmap(0x7f3284491000, 15081)           = 0
>>> brk(0)                                  = 0x2462000
>>> brk(0x2483000)                          = 0x2483000
>>> brk(0)                                  = 0x2483000
>>> open("/usr/lib/locale/locale-archive", O_RDONLY|O_CLOEXEC) = 6
>>> fstat(6, {st_mode=S_IFREG|0644, st_size=106065056, ...}) = 0
>>> mmap(NULL, 106065056, PROT_READ, MAP_PRIVATE, 6, 0) = 0x7f327d98c000
>>> close(6)                                = 0
>>> open("/usr/share/zoneinfo/EST", O_RDONLY|O_CLOEXEC) = 6
>>> fstat(6, {st_mode=S_IFREG|0644, st_size=118, ...}) = 0
>>> fstat(6, {st_mode=S_IFREG|0644, st_size=118, ...}) = 0
>>> mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0)
>>> = 0x7f3284494000
>>> read(6, "TZif2\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\1\0\0\0\1\0\0\0\0"...,
>>> 4096) = 118
>>> lseek(6, -62, SEEK_CUR)                 = 56
>>> read(6, "TZif2\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\1\0\0\0\1\0\0\0\0"...,
>>> 4096) = 62
>>> close(6)                                = 0
>>> munmap(0x7f3284494000, 4096)            = 0
>>> fstat(1, {st_mode=S_IFCHR|0620, st_rdev=makedev(136, 0), ...}) = 0
>>> mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0)
>>> = 0x7f3284494000
>>> write(1, "Mon Feb  6 15:29:11 EST 2017\n", 29Mon Feb  6 15:29:11 EST 2017
>>> ) = 29
>>> close(1)                                = 0
>>> munmap(0x7f3284494000, 4096)            = 0
>>> close(2)                                = 0
>>> exit_group(0)                           = ?
>>> +++ exited with 0 +++
>>> *****stuck here*****
>>>
>>> MVAPICH2 is public available, can you please try and see if you can
>>> reproduce this issue?
>>>
>>>
>>> Thanks,
>>> -Jie
>>>
>>> --------------------------------------------
>>> Department of Computer Science & Engineering
>>> Erwin E. Dreese Laboratories 774
>>> The Ohio State University
>>> 2015 Neil Avenue
>>> Columbus, OH 43210, USA
>>>
>>> On Tue, Jan 31, 2017 at 12:08 PM, Xiaoyi Lu@gmail <cheri...@gmail.com>
>>> wrote:
>>>
>>>> Thanks, Brian. We will explore these and get back to you.
>>>>
>>>> Xiaoyi
>>>>
>>>>
>>>> On Tue, Jan 31, 2017 at 11:59 AM, Brian Bockelman <bock...@gmail.com>
>>>> wrote:
>>>>
>>>>> Hi Xiaoyi,
>>>>>
>>>>> Two things would help -
>>>>>
>>>>> 1) Output of "ps faux" when done with the mpirun case.  This will help
>>>>> understand which processes are running and have which parentage.
>>>>> 2) For the case that's sticking, for any singularity processes, a
>>>>> stack trace.
>>>>>
>>>>> The poll command you reference tends to be waiting on a sub-process to
>>>>> exec, so it's possible we are not looking at the right thing.
>>>>>
>>>>> Thanks,
>>>>>
>>>>> Brian
>>>>>
>>>>> On Tue, Jan 31, 2017 at 10:43 AM, Xiaoyi Lu <cheri...@gmail.com>
>>>>> wrote:
>>>>> > Hi, Krishna,
>>>>> >
>>>>> > Jie is traveling internationally. Here is the new update from us.
>>>>> >
>>>>> > We found that with mpirun_rsh, the parent process did not get back
>>>>> from
>>>>> > singularity_fork() in `singularity_sessiondir_init'.
>>>>> >
>>>>> > It seems that it keeps on waiting on signal from watchdog (poll(fds,
>>>>> > watchdog_rpipe == -1 ? 2 : 3, -1)).
>>>>> >
>>>>> >
>>>>> > We are pretty sure this difference, compared to the case without
>>>>> mpirun_rsh.
>>>>> >
>>>>> >
>>>>> > Any thoughts here?
>>>>> >
>>>>> >
>>>>> > Thanks,
>>>>> >
>>>>> > Xiaoyi
>>>>> >
>>>>> >
>>>>> > On Friday, January 27, 2017 at 11:18:59 AM UTC-5, Jie Zhang wrote:
>>>>> >>
>>>>> >> Thanks, Krishna,
>>>>> >>
>>>>> >> I corrected the way to run strace.
>>>>> >> 1. singularity exec singularity-centos7.img strace date
>>>>> >> 2. mpirun_rsh -np 1  host1  singularity exec singularity-centos7.img
>>>>> >> strace date
>>>>> >>
>>>>> >> I see both of them show `+++exited with 0+++' at the end, even
>>>>> though it's
>>>>> >> stuck after that for #2.
>>>>> >> The log files are attached below.
>>>>> >>
>>>>> >>
>>>>> >>
>>>>> >> On Friday, January 27, 2017 at 3:47:30 AM UTC-5, Krishna Muriki
>>>>> wrote:
>>>>> >>>
>>>>> >>> Jie,
>>>>> >>>
>>>>> >>> What we should do is to run strace on the date command inside the
>>>>> >>> singularity container not on the singularity command itself. Mount
>>>>> this
>>>>> >>> singularity container singularity-centos7.img in read/write mode
>>>>> on your
>>>>> >>> endpoint, install strace package into it. After then when you
>>>>> invoke
>>>>> >>> mpirun_rsh run it like this:
>>>>> >>>
>>>>> >>> mpirun_rsh -np 1  host1  singularity exec singularity-centos7.img
>>>>> strace
>>>>> >>> date
>>>>> >>>
>>>>> >>> Thanks,
>>>>> >>> Krishna.
>>>>> >>>
>>>>> >>> On Thu, Jan 26, 2017 at 10:55 PM, Jie Zhang <jes...@gmail.com>
>>>>> wrote:
>>>>> >>>>
>>>>> >>>> Hi, Krishna,
>>>>> >>>>
>>>>> >>>> I tried adding strace to the plain singularity case (strace
>>>>> >>>> /usr/local/bin/singularity exec singularity-centos7.img date),
>>>>> what I found
>>>>> >>>> is that it actually exited with error (255) at the end
>>>>> >>>> (non-root-strace.log).
>>>>> >>>> If trying with root (sudo strace /usr/local/bin/singularity exec
>>>>> >>>> singularity-centos7.img date), there's no error. (root-strace.log)
>>>>> >>>> Trying with mpirun_rsh, it looks hanging on futex system call.
>>>>> >>>> (non-root-mpirun_rsh-strace.log)
>>>>> >>>>
>>>>> >>>> Please take a look at the log files attached below to see if you
>>>>> have
>>>>> >>>> any insight.
>>>>> >>>>
>>>>> >>>>
>>>>> >>>>
>>>>> >>>> On Thursday, January 26, 2017 at 8:10:22 PM UTC-5, Krishna Muriki
>>>>> wrote:
>>>>> >>>>>
>>>>> >>>>> Jie,
>>>>> >>>>>
>>>>> >>>>> Could you add strace to the container and run strace date to see
>>>>> why
>>>>> >>>>> the date process is going defunct ? Also first try running with
>>>>> -np 1 host1
>>>>> >>>>> and then scale to -np 2 and multiple nodes.
>>>>> >>>>>
>>>>> >>>>> Thanks,
>>>>> >>>>> Krishna.
>>>>> >>>>>
>>>>> >>>>> On Thu, Jan 26, 2017 at 5:07 PM, Jie Zhang <jes...@gmail.com
>>>>> >
>>>>> >>>>> wrote:
>>>>> >>>>>>
>>>>> >>>>>> Hi, Krishna,
>>>>> >>>>>>
>>>>> >>>>>>
>>>>> >>>>>> Without mpirun_rsh, all other tests work fine.
>>>>> >>>>>>
>>>>> >>>>>> ssh host1  singularity exec singularity-centos7.img date
>>>>> >>>>>> singularity exec singularity-centos7.img date
>>>>> >>>>>>
>>>>> >>>>>>
>>>>> >>>>>>
>>>>> >>>>>> On Thursday, January 26, 2017 at 7:58:21 PM UTC-5, Krishna
>>>>> Muriki
>>>>> >>>>>> wrote:
>>>>> >>>>>>>
>>>>> >>>>>>> Jie,
>>>>> >>>>>>>
>>>>> >>>>>>> Can you do a couple of tests, see if directly running
>>>>> 'singularity
>>>>> >>>>>>> exec singularity-centos7.img date' without mpirun_rsh returns
>>>>> the prompt
>>>>> >>>>>>> back to you properly. If that also gets struck, add strace to
>>>>> your container
>>>>> >>>>>>> and run strace date.
>>>>> >>>>>>>
>>>>> >>>>>>> If that does return properly try running with 'ssh host1
>>>>> singularity
>>>>> >>>>>>> exec singularity-centos7.img date' without mpirun_rsh and see
>>>>> if that works.
>>>>> >>>>>>>
>>>>> >>>>>>> --Krishna.
>>>>> >>>>>>>
>>>>> >>>>>>> On Thu, Jan 26, 2017 at 1:51 PM, Jie Zhang <zh...@osu.edu>
>>>>> wrote:
>>>>> >>>>>>>>
>>>>> >>>>>>>> Hello,
>>>>> >>>>>>>>
>>>>> >>>>>>>> I'm trying singularity with MVAPICH2. I found a small issue
>>>>> here.
>>>>> >>>>>>>> When running `mpirun_rsh -np 2  host1 host1  singularity exec
>>>>> >>>>>>>> singularity-centos7.img date', the routine (date) got
>>>>> executed successfully,
>>>>> >>>>>>>> but the mpi command is not able to return.
>>>>> >>>>>>>>
>>>>> >>>>>>>> [runbot@host1:singularity]$mpirun_rsh -np 2  host1 host1
>>>>> >>>>>>>> singularity exec singularity-centos7.img date
>>>>> >>>>>>>> Thu Jan 26 16:38:35 EST 2017
>>>>> >>>>>>>> Thu Jan 26 16:38:35 EST 2017
>>>>> >>>>>>>> (stuck here...., can Not return)
>>>>> >>>>>>>>
>>>>> >>>>>>>> And I can see the `date' command does not return properly.
>>>>> >>>>>>>> [runbot@host1:singularity]$ps -Af | grep runbot
>>>>> >>>>>>>> .........
>>>>> >>>>>>>> runbot   7347  7345  0 16:45 pts/1    00:00:00
>>>>> >>>>>>>> /home/runbot/singularity/master.install/bin/mpispawn 0
>>>>> >>>>>>>> runbot  7349  7347  0 16:45 pts/1    00:00:00
>>>>> >>>>>>>> /usr/local/libexec/singularity/sexec date
>>>>> >>>>>>>> runbot  7350  7347  0 16:45 pts/1    00:00:00
>>>>> >>>>>>>> /usr/local/libexec/singularity/sexec date
>>>>> >>>>>>>> runbot  7355  7349  0 16:45 pts/1    00:00:00 [date] <defunct>
>>>>> >>>>>>>> runbot  7356  7350  0 16:45 pts/1    00:00:00 [date] <defunct>
>>>>> >>>>>>>>
>>>>> >>>>>>>> I'm not sure whether the issue is from either mpi launcher,
>>>>> >>>>>>>> singularity or the interaction between both. Do you have any
>>>>> idea?
>>>>> >>>>>>>>
>>>>> >>>>>>>>
>>>>> >>>>>>>> Thanks,
>>>>> >>>>>>>> -Jie
>>>>> >>>>>>>>
>>>>> >>>>>>>> --------------------------------------------
>>>>> >>>>>>>> Department of Computer Science & Engineering
>>>>> >>>>>>>> Erwin E. Dreese Laboratories, 2015 Neil Avenue
>>>>> >>>>>>>> Ohio State University
>>>>> >>>>>>>>
>>>>> >>>>>>>> --
>>>>> >>>>>>>> You received this message because you are subscribed to the
>>>>> Google
>>>>> >>>>>>>> Groups "singularity" group.
>>>>> >>>>>>>> To unsubscribe from this group and stop receiving emails from
>>>>> it,
>>>>> >>>>>>>> send an email to singu...@lbl.gov.
>>>>> >>>>>>>
>>>>> >>>>>>>
>>>>> >>>>>> --
>>>>> >>>>>> You received this message because you are subscribed to the
>>>>> Google
>>>>> >>>>>> Groups "singularity" group.
>>>>> >>>>>> To unsubscribe from this group and stop receiving emails from
>>>>> it, send
>>>>> >>>>>> an email to singu...@lbl.gov.
>>>>> >>>>>
>>>>> >>>>>
>>>>> >>>> --
>>>>> >>>> You received this message because you are subscribed to the Google
>>>>> >>>> Groups "singularity" group.
>>>>> >>>> To unsubscribe from this group and stop receiving emails from it,
>>>>> send
>>>>> >>>> an email to singu...@lbl.gov.
>>>>> >>>
>>>>> >>>
>>>>> > --
>>>>> > You received this message because you are subscribed to the Google
>>>>> Groups
>>>>> > "singularity" group.
>>>>> > To unsubscribe from this group and stop receiving emails from it,
>>>>> send an
>>>>> > email to singu...@lbl.gov.
>>>>>
>>>>> --
>>>>> You received this message because you are subscribed to the Google
>>>>> Groups "singularity" group.
>>>>> To unsubscribe from this group and stop receiving emails from it, send
>>>>> an email to singu...@lbl.gov.
>>>>>
>>>>
>>>> --
>>>> You received this message because you are subscribed to the Google
>>>> Groups "singularity" group.
>>>> To unsubscribe from this group and stop receiving emails from it, send
>>>> an email to singu...@lbl.gov.
>>>>
>>>
>>> --
>>> You received this message because you are subscribed to the Google
>>> Groups "singularity" group.
>>> To unsubscribe from this group and stop receiving emails from it, send
>>> an email to singu...@lbl.gov.
>>>
>>
>>
>>
>> --
>> Gregory M. Kurtzer
>> HPC Systems Architect and Technology Developer
>> Lawrence Berkeley National Laboratory HPCS
>> University of California Berkeley Research IT
>> Singularity Linux Containers (http://singularity.lbl.gov/)
>> Warewulf Cluster Management (http://warewulf.lbl.gov/)
>> GitHub: https://github.com/gmkurtzer, Twitter: https://twitt
>> er.com/gmkurtzer
>>
>> --
>> You received this message because you are subscribed to the Google Groups
>> "singularity" group.
>> To unsubscribe from this group and stop receiving emails from it, send an
>> email to singu...@lbl.gov.
>>
>
> --
> You received this message because you are subscribed to the Google Groups
> "singularity" group.
> To unsubscribe from this group and stop receiving emails from it, send an
> email to singu...@lbl.gov.
>



-- 
Gregory M. Kurtzer
HPC Systems Architect and Technology Developer
Lawrence Berkeley National Laboratory HPCS
University of California Berkeley Research IT
Singularity Linux Containers (http://singularity.lbl.gov/)
Warewulf Cluster Management (http://warewulf.lbl.gov/)
GitHub: https://github.com/gmkurtzer, Twitter: https://twitter.com/gmkurtzer

--94eb2c0826b00f7413054911886c
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable

<div dir=3D"ltr"><div>BTW, you might be able to avoid the zombie if you run=
 it like:</div><div><br></div><div>$ mpirun_rsh -np 1 localhost SINGULARITY=
_NOSESSIONCLEANUP=3D1 singularity exec /tmp/user.img date<br></div><div><br=
></div><div>NOSESSIONCLEANUP inhibits the session thread which cleanups aft=
er the container exits.</div><div><br></div><div><br></div></div><div class=
=3D"gmail_extra"><br><div class=3D"gmail_quote">On Tue, Feb 21, 2017 at 1:1=
3 PM, Xiaoyi Lu@gmail <span dir=3D"ltr">&lt;<a href=3D"mailto:cheri...@gmai=
l.com" target=3D"_blank">cheri...@gmail.com</a>&gt;</span> wrote:<br><block=
quote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc=
 solid;padding-left:1ex"><div dir=3D"ltr">Thanks for the update, Greg. This=
 is good to know.=C2=A0<span class=3D"HOEnZb"><font color=3D"#888888"><div>=
<br></div><div>Xiaoyi</div></font></span></div><div class=3D"HOEnZb"><div c=
lass=3D"h5"><div class=3D"gmail_extra"><br><div class=3D"gmail_quote">On Tu=
e, Feb 21, 2017 at 4:10 PM, Gregory M. Kurtzer <span dir=3D"ltr">&lt;<a hre=
f=3D"mailto:gmku...@lbl.gov" target=3D"_blank">gmku...@lbl.gov</a>&gt;</spa=
n> wrote:<br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;b=
order-left:1px #ccc solid;padding-left:1ex"><div dir=3D"ltr">Hello,<div><br=
></div><div>I did a quick verification of what you described using MVAPICH2=
 and the latest lib-refactor code I&#39;m working on. It seems that there i=
s a conflict somehow with MVAPICH2 and how we are managing the signal handl=
er pipes as if I avoid Singularity&#39;s forking, I can circumvent the issu=
e.</div><div><br></div><div>Brian and I spoke about it and one or both of u=
s will hopefully have time to debug this in more detail shortly.</div><div>=
<br></div><div>Thanks!</div></div><div class=3D"gmail_extra"><div><div clas=
s=3D"m_1355088625254818441h5"><br><div class=3D"gmail_quote">On Mon, Feb 6,=
 2017 at 12:41 PM, Jie Zhang <span dir=3D"ltr">&lt;<a href=3D"mailto:jessez=
h...@gmail.com" target=3D"_blank">jessezh...@gmail.com</a>&gt;</span> wrote=
:<br><blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-le=
ft:1px #ccc solid;padding-left:1ex"><div dir=3D"ltr">Hi, Brian,<div><br></d=
iv><div>For #1, the results are basically as what we knew.</div><div><br></=
div><div>zhanjie =C2=A0 4178 =C2=A00.0 =C2=A00.0 =C2=A034976 =C2=A01340 pts=
/0 =C2=A0 =C2=A0Sl+ =C2=A013:07 =C2=A0 0:00 =C2=A0| =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 \_ /home/zhanjie/singularity/mast=
<wbr>er.install/bin/mpispawn 0</div><div>zhanjie =C2=A0 4180 =C2=A00.0 =C2=
=A00.0 =C2=A0 5432 =C2=A01688 pts/0 =C2=A0 =C2=A0S+ =C2=A0 13:07 =C2=A0 0:0=
0 =C2=A0| =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 \_ /usr/local/libexec/singularity<wbr>/sexec date</div><div>z=
hanjie =C2=A0 4183 =C2=A00.6 =C2=A00.0 =C2=A0 =C2=A0 =C2=A00 =C2=A0 =C2=A0 =
0 pts/0 =C2=A0 =C2=A0Z+ =C2=A0 13:07 =C2=A0 0:00 =C2=A0| =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0\_ [date] &lt;defunct&gt;=C2=A0</div><div><br></div><di=
v>For #2, I run `mpirun_rsh -np 1 sandy4 /usr/local/bin/singularity exec si=
ngularity-centos7.img strace date&#39;. It&#39;s stuck at the end, even tho=
ugh it shows `+++ exited with 0 +++&#39;.</div><div><br></div><div><div>act=
ion_exec_do /usr/local/libexec/singularity<wbr>/sexec strace</div><div>exec=
ve(&quot;/usr/bin/date&quot;, [&quot;date&quot;], [/* 87 vars */]) =3D 0</d=
iv><div>brk(0) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=3D 0x2462000</d=
iv><div>mmap(NULL, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -=
1, 0) =3D 0x7f3284495000</div><div>access(&quot;/etc/ld.so.preload&quot;, R=
_OK) =C2=A0 =C2=A0 =C2=A0=3D -1 ENOENT (No such file or directory)</div><di=
v>open(&quot;/etc/ld.so.cache&quot;, O_RDONLY|O_CLOEXEC) =3D 6</div><div>fs=
tat(6, {st_mode=3DS_IFREG|0644, st_size=3D15081, ...}) =3D 0</div><div>mmap=
(NULL, 15081, PROT_READ, MAP_PRIVATE, 6, 0) =3D 0x7f3284491000</div><div>cl=
ose(6) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=3D 0</div><div>open(&quot;/li=
b64/libc.so.6&quot;, O_RDONLY|O_CLOEXEC) =3D 6</div><div>read(6, &quot;\177=
ELF\2\1\1\3\0\0\0\0\0\0\0<wbr>\0\3\0&gt;\0\1\0\0\0 \34\2\0\0\0\0\0&quot;...=
, 832) =3D 832</div><div>fstat(6, {st_mode=3DS_IFREG|0755, st_size=3D211238=
4, ...}) =3D 0</div><div>mmap(NULL, 3936832, PROT_READ|PROT_EXEC, MAP_PRIVA=
TE|MAP_DENYWRITE, 6, 0) =3D 0x7f3283eb3000</div><div>mprotect(0x7f328406a00=
0, 2097152, PROT_NONE) =3D 0</div><div>mmap(0x7f328426a000, 24576, PROT_REA=
D|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENY<wbr>WRITE, 6, 0x1b7000) =3D 0x=
7f328426a000</div><div>mmap(0x7f3284270000, 16960, PROT_READ|PROT_WRITE, MA=
P_PRIVATE|MAP_FIXED|MAP_ANON<wbr>YMOUS, -1, 0) =3D 0x7f3284270000</div><div=
>close(6) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=3D 0</div><div>mmap(NULL, =
4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) =3D 0x7f32844=
90000</div><div>mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANON=
YMOUS, -1, 0) =3D 0x7f328448e000</div><div>arch_prctl(ARCH_SET_FS, 0x7f3284=
48e740) =3D 0</div><div>mprotect(0x7f328426a000, 16384, PROT_READ) =3D 0</d=
iv><div>mprotect(0x60d000, 4096, PROT_READ) =C2=A0 =C2=A0 =3D 0</div><div>m=
protect(0x7f3284496000, 4096, PROT_READ) =3D 0</div><div>munmap(0x7f3284491=
000, 15081) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =3D 0</div><div>brk(0) =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=3D 0x2462000</div><div>brk(0x2483=
000) =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0=3D 0x2483000</div><div>brk(0) =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0=3D 0x2483000</div><div>open(&quot;/usr/lib/locale/loca=
le-a<wbr>rchive&quot;, O_RDONLY|O_CLOEXEC) =3D 6</div><div>fstat(6, {st_mod=
e=3DS_IFREG|0644, st_size=3D106065056, ...}) =3D 0</div><div>mmap(NULL, 106=
065056, PROT_READ, MAP_PRIVATE, 6, 0) =3D 0x7f327d98c000</div><div>close(6)=
 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=3D 0</div><div>open(&quot;/usr/share=
/zoneinfo/EST&quot;<wbr>, O_RDONLY|O_CLOEXEC) =3D 6</div><div>fstat(6, {st_=
mode=3DS_IFREG|0644, st_size=3D118, ...}) =3D 0</div><div>fstat(6, {st_mode=
=3DS_IFREG|0644, st_size=3D118, ...}) =3D 0</div><div>mmap(NULL, 4096, PROT=
_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) =3D 0x7f3284494000</div=
><div>read(6, &quot;TZif2\0\0\0\0\0\0\0\0\0\0\0\0<wbr>\0\0\0\0\0\0\1\0\0\0\=
1\0\0\0\0<wbr>&quot;..., 4096) =3D 118</div><div>lseek(6, -62, SEEK_CUR) =
=C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =3D 56</div><div>re=
ad(6, &quot;TZif2\0\0\0\0\0\0\0\0\0\0\0\0<wbr>\0\0\0\0\0\0\1\0\0\0\1\0\0\0\=
0<wbr>&quot;..., 4096) =3D 62</div><div>close(6) =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0=3D 0</div><div>munmap(0x7f3284494000, 4096) =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0=3D 0</div><div>fstat(1, {st_mode=3DS_IFCHR|0620, s=
t_rdev=3Dmakedev(136, 0), ...}) =3D 0</div><div>mmap(NULL, 4096, PROT_READ|=
PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) =3D 0x7f3284494000</div><div>=
write(1, &quot;Mon Feb =C2=A06 15:29:11 EST 2017\n&quot;, 29Mon Feb =C2=A06=
 15:29:11 EST 2017</div><div>) =3D 29</div><div>close(1) =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0=3D 0</div><div>munmap(0x7f3284494000, 4096) =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0=3D 0</div><div>close(2) =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =
=C2=A0 =C2=A0 =C2=A0=3D 0</div><div>exit_group(0) =C2=A0 =C2=A0 =C2=A0 =C2=
=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =C2=A0 =3D ?</d=
iv><div>+++ exited with 0 +++</div></div><div><font color=3D"#ff0000">*****=
stuck here*****</font></div><div><font color=3D"#ff0000"><br></font></div><=
div>MVAPICH2 is public available, can you please try and see if you can rep=
roduce this issue?<font color=3D"#ff0000"><br></font></div><div><br></div><=
/div><div class=3D"gmail_extra"><br clear=3D"all"><div><div class=3D"m_1355=
088625254818441m_-8917703324977184479m_5553504256568381150gmail_signature" =
data-smartmail=3D"gmail_signature"><div dir=3D"ltr"><div><span><div dir=3D"=
ltr"><div><font size=3D"2" face=3D"tahoma, sans-serif" color=3D"#000000">Th=
anks,</font></div><font size=3D"2" face=3D"tahoma, sans-serif"><font color=
=3D"#000000">-Jie<br><br>------------------------------<wbr>--------------<=
/font></font></div><div dir=3D"ltr"><span style=3D"color:rgb(0,0,0);font-fa=
mily:tahoma,sans-serif;font-size:small">Department of Computer Science &amp=
; Engineering</span><font size=3D"2" face=3D"tahoma, sans-serif"><font colo=
r=3D"#000000"><br></font></font></div></span><div dir=3D"ltr"><span style=
=3D"color:rgb(0,0,0);font-family:tahoma,sans-serif;font-size:small">Erwin E=
. Dreese Laboratories 774</span></div><div dir=3D"ltr"><span style=3D"color=
:rgb(0,0,0);font-family:tahoma,sans-serif;font-size:small">The Ohio State U=
niversity</span><span style=3D"color:rgb(0,0,0);font-family:tahoma,sans-ser=
if;font-size:small"><br></span></div><div><span style=3D"color:rgb(0,0,0);f=
ont-family:tahoma,sans-serif;font-size:small">2015 Neil Avenue</span></div>=
<div><span style=3D"color:rgb(0,0,0);font-family:tahoma,sans-serif;font-siz=
e:small">Columbus, OH 43210, USA</span></div><div dir=3D"ltr"><span style=
=3D"font-family:times new roman,serif;color:rgb(51,51,255)"></span></div></=
div></div></div></div><div><div class=3D"m_1355088625254818441m_-8917703324=
977184479h5">
<br><div class=3D"gmail_quote">On Tue, Jan 31, 2017 at 12:08 PM, Xiaoyi Lu@=
gmail <span dir=3D"ltr">&lt;<a href=3D"mailto:cheri...@gmail.com" target=3D=
"_blank">cheri...@gmail.com</a>&gt;</span> wrote:<br><blockquote class=3D"g=
mail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padding-l=
eft:1ex"><div dir=3D"ltr">Thanks, Brian. We will explore these and get back=
 to you.<span class=3D"m_1355088625254818441m_-8917703324977184479m_5553504=
256568381150HOEnZb"><font color=3D"#888888"><div><br></div><div>Xiaoyi</div=
><div><br></div></font></span></div><div class=3D"m_1355088625254818441m_-8=
917703324977184479m_5553504256568381150HOEnZb"><div class=3D"m_135508862525=
4818441m_-8917703324977184479m_5553504256568381150h5"><div class=3D"gmail_e=
xtra"><br><div class=3D"gmail_quote">On Tue, Jan 31, 2017 at 11:59 AM, Bria=
n Bockelman <span dir=3D"ltr">&lt;<a href=3D"mailto:bock...@gmail.com" targ=
et=3D"_blank">bock...@gmail.com</a>&gt;</span> wrote:<br><blockquote class=
=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1px #ccc solid;padd=
ing-left:1ex">Hi Xiaoyi,<br>
<br>
Two things would help -<br>
<br>
1) Output of &quot;ps faux&quot; when done with the mpirun case.=C2=A0 This=
 will help<br>
understand which processes are running and have which parentage.<br>
2) For the case that&#39;s sticking, for any singularity processes, a stack=
 trace.<br>
<br>
The poll command you reference tends to be waiting on a sub-process to<br>
exec, so it&#39;s possible we are not looking at the right thing.<br>
<br>
Thanks,<br>
<br>
Brian<br>
<div class=3D"m_1355088625254818441m_-8917703324977184479m_5553504256568381=
150m_1863973391569103025HOEnZb"><div class=3D"m_1355088625254818441m_-89177=
03324977184479m_5553504256568381150m_1863973391569103025h5"><br>
On Tue, Jan 31, 2017 at 10:43 AM, Xiaoyi Lu &lt;<a href=3D"mailto:cheri...@=
gmail.com" target=3D"_blank">cheri...@gmail.com</a>&gt; wrote:<br>
&gt; Hi, Krishna,<br>
&gt;<br>
&gt; Jie is traveling internationally. Here is the new update from us.<br>
&gt;<br>
&gt; We found that with mpirun_rsh, the parent process did not get back fro=
m<br>
&gt; singularity_fork() in `singularity_sessiondir_init&#39;.<br>
&gt;<br>
&gt; It seems that it keeps on waiting on signal from watchdog (poll(fds,<b=
r>
&gt; watchdog_rpipe =3D=3D -1 ? 2 : 3, -1)).<br>
&gt;<br>
&gt;<br>
&gt; We are pretty sure this difference, compared to the case without mpiru=
n_rsh.<br>
&gt;<br>
&gt;<br>
&gt; Any thoughts here?<br>
&gt;<br>
&gt;<br>
&gt; Thanks,<br>
&gt;<br>
&gt; Xiaoyi<br>
&gt;<br>
&gt;<br>
&gt; On Friday, January 27, 2017 at 11:18:59 AM UTC-5, Jie Zhang wrote:<br>
&gt;&gt;<br>
&gt;&gt; Thanks, Krishna,<br>
&gt;&gt;<br>
&gt;&gt; I corrected the way to run strace.<br>
&gt;&gt; 1. singularity exec singularity-centos7.img strace date<br>
&gt;&gt; 2. mpirun_rsh -np 1=C2=A0 host1=C2=A0 singularity exec singularity=
-centos7.img<br>
&gt;&gt; strace date<br>
&gt;&gt;<br>
&gt;&gt; I see both of them show `+++exited with 0+++&#39; at the end, even=
 though it&#39;s<br>
&gt;&gt; stuck after that for #2.<br>
&gt;&gt; The log files are attached below.<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt;<br>
&gt;&gt; On Friday, January 27, 2017 at 3:47:30 AM UTC-5, Krishna Muriki wr=
ote:<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; Jie,<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; What we should do is to run strace on the date command inside =
the<br>
&gt;&gt;&gt; singularity container not on the singularity command itself. M=
ount this<br>
&gt;&gt;&gt; singularity container singularity-centos7.img in read/write mo=
de on your<br>
&gt;&gt;&gt; endpoint, install strace package into it. After then when you =
invoke<br>
&gt;&gt;&gt; mpirun_rsh run it like this:<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; mpirun_rsh -np 1=C2=A0 host1=C2=A0 singularity exec singularit=
y-centos7.img strace<br>
&gt;&gt;&gt; date<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; Thanks,<br>
&gt;&gt;&gt; Krishna.<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt; On Thu, Jan 26, 2017 at 10:55 PM, Jie Zhang &lt;<a href=3D"mai=
lto:jes...@gmail.com" target=3D"_blank">jes...@gmail.com</a>&gt; wrote:<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; Hi, Krishna,<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; I tried adding strace to the plain singularity case (strac=
e<br>
&gt;&gt;&gt;&gt; /usr/local/bin/singularity exec singularity-centos7.img da=
te), what I found<br>
&gt;&gt;&gt;&gt; is that it actually exited with error (255) at the end<br>
&gt;&gt;&gt;&gt; (non-root-strace.log).<br>
&gt;&gt;&gt;&gt; If trying with root (sudo strace /usr/local/bin/singularit=
y exec<br>
&gt;&gt;&gt;&gt; singularity-centos7.img date), there&#39;s no error. (root=
-strace.log)<br>
&gt;&gt;&gt;&gt; Trying with mpirun_rsh, it looks hanging on futex system c=
all.<br>
&gt;&gt;&gt;&gt; (non-root-mpirun_rsh-strace.lo<wbr>g)<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; Please take a look at the log files attached below to see =
if you have<br>
&gt;&gt;&gt;&gt; any insight.<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; On Thursday, January 26, 2017 at 8:10:22 PM UTC-5, Krishna=
 Muriki wrote:<br>
&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt; Jie,<br>
&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt; Could you add strace to the container and run strace d=
ate to see why<br>
&gt;&gt;&gt;&gt;&gt; the date process is going defunct ? Also first try run=
ning with -np 1 host1<br>
&gt;&gt;&gt;&gt;&gt; and then scale to -np 2 and multiple nodes.<br>
&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt; Thanks,<br>
&gt;&gt;&gt;&gt;&gt; Krishna.<br>
&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt; On Thu, Jan 26, 2017 at 5:07 PM, Jie Zhang &lt;<a href=
=3D"mailto:jes...@gmail.com" target=3D"_blank">jes...@gmail.com</a>&gt;<br>
&gt;&gt;&gt;&gt;&gt; wrote:<br>
&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt; Hi, Krishna,<br>
&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt; Without mpirun_rsh, all other tests work fine.<br>
&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt; ssh host1=C2=A0 singularity exec singularity-cento=
s7.img date<br>
&gt;&gt;&gt;&gt;&gt;&gt; singularity exec singularity-centos7.img date<br>
&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt; On Thursday, January 26, 2017 at 7:58:21 PM UTC-5,=
 Krishna Muriki<br>
&gt;&gt;&gt;&gt;&gt;&gt; wrote:<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Jie,<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt; Can you do a couple of tests, see if directly =
running=C2=A0 &#39;singularity<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt; exec singularity-centos7.img date&#39; without=
 mpirun_rsh returns the prompt<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt; back to you properly. If that also gets struck=
, add strace to your container<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt; and run strace date.<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt; If that does return properly try running with =
&#39;ssh host1=C2=A0 singularity<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt; exec singularity-centos7.img date&#39; without=
 mpirun_rsh and see if that works.<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt; --Krishna.<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt; On Thu, Jan 26, 2017 at 1:51 PM, Jie Zhang &lt=
;<a href=3D"mailto:zh...@osu.edu" target=3D"_blank">zh...@osu.edu</a>&gt; w=
rote:<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Hello,<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I&#39;m trying singularity with MVAPICH2. =
I found a small issue here.<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; When running `mpirun_rsh -np 2=C2=A0 host1=
 host1=C2=A0 singularity exec<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; singularity-centos7.img date&#39;, the rou=
tine (date) got executed successfully,<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; but the mpi command is not able to return.=
<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; [runbot@host1:singularity]$mpi<wbr>run_rsh=
 -np 2=C2=A0 host1 host1<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; singularity exec singularity-centos7.img d=
ate<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Thu Jan 26 16:38:35 EST 2017<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Thu Jan 26 16:38:35 EST 2017<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; (stuck here...., can Not return)<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; And I can see the `date&#39; command does =
not return properly.<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; [runbot@host1:singularity]$ps -Af | grep r=
unbot<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; .........<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; runbot=C2=A0 =C2=A07347=C2=A0 7345=C2=A0 0=
 16:45 pts/1=C2=A0 =C2=A0 00:00:00<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; /home/runbot/singularity/maste<wbr>r.insta=
ll/bin/mpispawn 0<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; runbot=C2=A0 7349=C2=A0 7347=C2=A0 0 16:45=
 pts/1=C2=A0 =C2=A0 00:00:00<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; /usr/local/libexec/singularity<wbr>/sexec =
date<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; runbot=C2=A0 7350=C2=A0 7347=C2=A0 0 16:45=
 pts/1=C2=A0 =C2=A0 00:00:00<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; /usr/local/libexec/singularity<wbr>/sexec =
date<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; runbot=C2=A0 7355=C2=A0 7349=C2=A0 0 16:45=
 pts/1=C2=A0 =C2=A0 00:00:00 [date] &lt;defunct&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; runbot=C2=A0 7356=C2=A0 7350=C2=A0 0 16:45=
 pts/1=C2=A0 =C2=A0 00:00:00 [date] &lt;defunct&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; I&#39;m not sure whether the issue is from=
 either mpi launcher,<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; singularity or the interaction between bot=
h. Do you have any idea?<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Thanks,<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; -Jie<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; ------------------------------<wbr>-------=
-------<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Department of Computer Science &amp; Engin=
eering<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Erwin E. Dreese Laboratories, 2015 Neil Av=
enue<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Ohio State University<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; --<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; You received this message because you are =
subscribed to the Google<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Groups &quot;singularity&quot; group.<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; To unsubscribe from this group and stop re=
ceiving emails from it,<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; send an email to <a href=3D"mailto:singu..=
.@lbl.gov" target=3D"_blank">singu...@lbl.gov</a>.<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;&gt; --<br>
&gt;&gt;&gt;&gt;&gt;&gt; You received this message because you are subscrib=
ed to the Google<br>
&gt;&gt;&gt;&gt;&gt;&gt; Groups &quot;singularity&quot; group.<br>
&gt;&gt;&gt;&gt;&gt;&gt; To unsubscribe from this group and stop receiving =
emails from it, send<br>
&gt;&gt;&gt;&gt;&gt;&gt; an email to <a href=3D"mailto:singu...@lbl.gov" ta=
rget=3D"_blank">singu...@lbl.gov</a>.<br>
&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt;&gt;<br>
&gt;&gt;&gt;&gt; --<br>
&gt;&gt;&gt;&gt; You received this message because you are subscribed to th=
e Google<br>
&gt;&gt;&gt;&gt; Groups &quot;singularity&quot; group.<br>
&gt;&gt;&gt;&gt; To unsubscribe from this group and stop receiving emails f=
rom it, send<br>
&gt;&gt;&gt;&gt; an email to <a href=3D"mailto:singu...@lbl.gov" target=3D"=
_blank">singu...@lbl.gov</a>.<br>
&gt;&gt;&gt;<br>
&gt;&gt;&gt;<br>
&gt; --<br>
&gt; You received this message because you are subscribed to the Google Gro=
ups<br>
&gt; &quot;singularity&quot; group.<br>
&gt; To unsubscribe from this group and stop receiving emails from it, send=
 an<br>
&gt; email to <a href=3D"mailto:singularity%...@lbl.gov" target=3D"_blank">=
singularity+unsubscribe@lbl.go<wbr>v</a>.<br>
<br>
--<br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singularity%...@lbl.gov" target=3D"_blank">singul=
arity+unsubscribe@lbl.go<wbr>v</a>.<br>
</div></div></blockquote></div><br></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.go<wbr>v</a>.<br>
</div></div></blockquote></div><br></div></div></div><div class=3D"m_135508=
8625254818441m_-8917703324977184479HOEnZb"><div class=3D"m_1355088625254818=
441m_-8917703324977184479h5">

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.go<wbr>v</a>.<br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div></div><=
/div><span class=3D"m_1355088625254818441HOEnZb"><font color=3D"#888888">--=
 <br><div class=3D"m_1355088625254818441m_-8917703324977184479gmail_signatu=
re" data-smartmail=3D"gmail_signature"><div dir=3D"ltr"><div><div dir=3D"lt=
r"><div><div dir=3D"ltr"><div><div dir=3D"ltr"><div dir=3D"ltr"><div dir=3D=
"ltr"><div>Gregory M. Kurtzer</div><div>HPC Systems Architect and Technolog=
y Developer</div><div>Lawrence Berkeley National Laboratory HPCS<br>Univers=
ity of California Berkeley Research IT<br>Singularity Linux Containers=C2=
=A0(<a href=3D"http://singularity.lbl.gov/" target=3D"_blank">http://singul=
arity<wbr>.lbl.gov/</a>)</div><div>Warewulf Cluster Management=C2=A0(<a hre=
f=3D"http://warewulf.lbl.gov/" target=3D"_blank">http://warewulf.lb<wbr>l.g=
ov/</a>)</div><div>GitHub:=C2=A0<a href=3D"https://github.com/gmkurtzer" ta=
rget=3D"_blank">https://github.com/gmk<wbr>urtzer</a>,=C2=A0<span style=3D"=
font-size:12.8px">Twitter:=C2=A0</span><a href=3D"https://twitter.com/gmkur=
tzer" style=3D"font-size:12.8px" target=3D"_blank">https://twitt<wbr>er.com=
/gmkurtzer</a></div></div></div></div></div></div></div></div></div></div><=
/div>
</font></span></div><div class=3D"m_1355088625254818441HOEnZb"><div class=
=3D"m_1355088625254818441h5">

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.go<wbr>v</a>.<br>
</div></div></blockquote></div><br></div>

<p></p>

-- <br>
You received this message because you are subscribed to the Google Groups &=
quot;singularity&quot; group.<br>
To unsubscribe from this group and stop receiving emails from it, send an e=
mail to <a href=3D"mailto:singu...@lbl.gov" target=3D"_blank">singularity+u=
nsubscribe@lbl.<wbr>gov</a>.<br>
</div></div></blockquote></div><br><br clear=3D"all"><div><br></div>-- <br>=
<div class=3D"gmail_signature" data-smartmail=3D"gmail_signature"><div dir=
=3D"ltr"><div><div dir=3D"ltr"><div><div dir=3D"ltr"><div><div dir=3D"ltr">=
<div dir=3D"ltr"><div dir=3D"ltr"><div>Gregory M. Kurtzer</div><div>HPC Sys=
tems Architect and Technology Developer</div><div>Lawrence Berkeley Nationa=
l Laboratory HPCS<br>University of California Berkeley Research IT<br>Singu=
larity Linux Containers=C2=A0(<a href=3D"http://singularity.lbl.gov/" targe=
t=3D"_blank">http://singularity.lbl.gov/</a>)</div><div>Warewulf Cluster Ma=
nagement=C2=A0(<a href=3D"http://warewulf.lbl.gov/" target=3D"_blank">http:=
//warewulf.lbl.gov/</a>)</div><div>GitHub:=C2=A0<a href=3D"https://github.c=
om/gmkurtzer" target=3D"_blank">https://github.com/gmkurtzer</a>,=C2=A0<spa=
n style=3D"font-size:12.8px">Twitter:=C2=A0</span><a href=3D"https://twitte=
r.com/gmkurtzer" style=3D"font-size:12.8px" target=3D"_blank">https://twitt=
er.com/gmkurtzer</a></div></div></div></div></div></div></div></div></div><=
/div></div>
</div>

--94eb2c0826b00f7413054911886c--
